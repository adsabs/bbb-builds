!function(){!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("hbs/handlebars",t):"object"==typeof exports?exports.Handlebars=t():e.Handlebars=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(){var e=h();return e.compile=function(t,n){return l.compile(t,n,e)},e.precompile=function(t,n){return l.precompile(t,n,e)},e.AST=s.default,e.Compiler=l.Compiler,e.JavaScriptCompiler=c.default,e.Parser=o.parser,e.parse=o.parse,e}var r=n(8).default;t.__esModule=!0;var a=r(n(1)),s=r(n(2)),o=n(3),l=n(4),c=r(n(5)),u=r(n(6)),d=r(n(7)),h=a.default.create,p=i();p.create=i,d.default(p),p.Visitor=u.default,p.default=p,t.default=p,e.exports=t.default},function(e,t,n){"use strict";function i(){var e=new s.HandlebarsEnvironment;return c.extend(e,s),e.SafeString=o.default,e.Exception=l.default,e.Utils=c,e.escapeExpression=c.escapeExpression,e.VM=u,e.template=function(t){return u.template(t,e)},e}var r=n(9).default,a=n(8).default;t.__esModule=!0;var s=r(n(10)),o=a(n(11)),l=a(n(12)),c=r(n(13)),u=r(n(14)),d=a(n(7)),h=i();h.create=i,d.default(h),h.default=h,t.default=h,e.exports=t.default},function(e,t,n){"use strict";t.__esModule=!0;var i={Program:function(e,t,n,i){this.loc=i,this.type="Program",this.body=e,this.blockParams=t,this.strip=n},MustacheStatement:function(e,t,n,i,r,a){this.loc=a,this.type="MustacheStatement",this.path=e,this.params=t||[],this.hash=n,this.escaped=i,this.strip=r},BlockStatement:function(e,t,n,i,r,a,s,o,l){this.loc=l,this.type="BlockStatement",this.path=e,this.params=t||[],this.hash=n,this.program=i,this.inverse=r,this.openStrip=a,this.inverseStrip=s,this.closeStrip=o},PartialStatement:function(e,t,n,i,r){this.loc=r,this.type="PartialStatement",this.name=e,this.params=t||[],this.hash=n,this.indent="",this.strip=i},ContentStatement:function(e,t){this.loc=t,this.type="ContentStatement",this.original=this.value=e},CommentStatement:function(e,t,n){this.loc=n,this.type="CommentStatement",this.value=e,this.strip=t},SubExpression:function(e,t,n,i){this.loc=i,this.type="SubExpression",this.path=e,this.params=t||[],this.hash=n},PathExpression:function(e,t,n,i,r){this.loc=r,this.type="PathExpression",this.data=e,this.original=i,this.parts=n,this.depth=t},StringLiteral:function(e,t){this.loc=t,this.type="StringLiteral",this.original=this.value=e},NumberLiteral:function(e,t){this.loc=t,this.type="NumberLiteral",this.original=this.value=Number(e)},BooleanLiteral:function(e,t){this.loc=t,this.type="BooleanLiteral",this.original=this.value="true"===e},UndefinedLiteral:function(e){this.loc=e,this.type="UndefinedLiteral",this.original=this.value=void 0},NullLiteral:function(e){this.loc=e,this.type="NullLiteral",this.original=this.value=null},Hash:function(e,t){this.loc=t,this.type="Hash",this.pairs=e},HashPair:function(e,t,n){this.loc=n,this.type="HashPair",this.key=e,this.value=t},helpers:{helperExpression:function(e){return!("SubExpression"!==e.type&&!e.params.length&&!e.hash)},scopedId:function(e){return/^\.|this\b/.test(e.original)},simpleId:function(e){return 1===e.parts.length&&!i.helpers.scopedId(e)&&!e.depth}}};t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default,r=n(9).default;t.__esModule=!0,t.parse=function(e,t){return"Program"===e.type?e:(a.default.yy=u,u.locInfo=function(e){return new u.SourceLocation(t&&t.srcName,e)},(new o.default).accept(a.default.parse(e)))};var a=i(n(15)),s=i(n(2)),o=i(n(16)),l=r(n(17)),c=n(13);t.parser=a.default;var u={};c.extend(u,l,s.default)},function(e,t,n){"use strict";function i(){}function r(e,t){if(e===t)return!0;if(l.isArray(e)&&l.isArray(t)&&e.length===t.length){for(var n=0;n<e.length;n++)if(!r(e[n],t[n]))return!1;return!0}}function a(e){if(!e.path.parts){var t=e.path;e.path=new c.default.PathExpression(!1,0,[t.original+""],t.original+"",t.loc)}}var s=n(8).default;t.__esModule=!0,t.Compiler=i,t.precompile=function(e,t,n){if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new o.default("You must pass a string or Handlebars AST to Handlebars.precompile. You passed "+e);"data"in(t=t||{})||(t.data=!0),t.compat&&(t.useDepths=!0);var i=n.parse(e,t),r=(new n.Compiler).compile(i,t);return(new n.JavaScriptCompiler).compile(r,t)},t.compile=function(e,t,n){function i(){var t=n.parse(e,a),i=(new n.Compiler).compile(t,a),r=(new n.JavaScriptCompiler).compile(i,a,void 0,!0);return n.template(r)}function r(e,t){return s||(s=i()),s.call(this,e,t)}var a=void 0===arguments[1]?{}:arguments[1];if(null==e||"string"!=typeof e&&"Program"!==e.type)throw new o.default("You must pass a string or Handlebars AST to Handlebars.compile. You passed "+e);"data"in a||(a.data=!0),a.compat&&(a.useDepths=!0);var s=void 0;return r._setup=function(e){return s||(s=i()),s._setup(e)},r._child=function(e,t,n,r){return s||(s=i()),s._child(e,t,n,r)},r};var o=s(n(12)),l=n(13),c=s(n(2)),u=[].slice;i.prototype={compiler:i,equals:function(e){var t=this.opcodes.length;if(e.opcodes.length!==t)return!1;for(a=0;a<t;a++){var n=this.opcodes[a],i=e.opcodes[a];if(n.opcode!==i.opcode||!r(n.args,i.args))return!1}t=this.children.length;for(var a=0;a<t;a++)if(!this.children[a].equals(e.children[a]))return!1;return!0},guid:0,compile:function(e,t){this.sourceNode=[],this.opcodes=[],this.children=[],this.options=t,this.stringParams=t.stringParams,this.trackIds=t.trackIds,t.blockParams=t.blockParams||[];var n=t.knownHelpers;if(t.knownHelpers={helperMissing:!0,blockHelperMissing:!0,each:!0,if:!0,unless:!0,with:!0,log:!0,lookup:!0},n)for(var i in n)i in n&&(t.knownHelpers[i]=n[i]);return this.accept(e)},compileProgram:function(e){var t=(new this.compiler).compile(e,this.options),n=this.guid++;return this.usePartial=this.usePartial||t.usePartial,this.children[n]=t,this.useDepths=this.useDepths||t.useDepths,n},accept:function(e){this.sourceNode.unshift(e);var t=this[e.type](e);return this.sourceNode.shift(),t},Program:function(e){this.options.blockParams.unshift(e.blockParams);for(var t=e.body,n=t.length,i=0;i<n;i++)this.accept(t[i]);return this.options.blockParams.shift(),this.isSimple=1===n,this.blockParams=e.blockParams?e.blockParams.length:0,this},BlockStatement:function(e){a(e);var t=e.program,n=e.inverse;t=t&&this.compileProgram(t),n=n&&this.compileProgram(n);var i=this.classifySexpr(e);"helper"===i?this.helperSexpr(e,t,n):"simple"===i?(this.simpleSexpr(e),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("blockValue",e.path.original)):(this.ambiguousSexpr(e,t,n),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.opcode("emptyHash"),this.opcode("ambiguousBlockValue")),this.opcode("append")},PartialStatement:function(e){this.usePartial=!0;var t=e.params;if(t.length>1)throw new o.default("Unsupported number of partial arguments: "+t.length,e);t.length||t.push({type:"PathExpression",parts:[],depth:0});var n=e.name.original,i="SubExpression"===e.name.type;i&&this.accept(e.name),this.setupFullMustacheParams(e,void 0,void 0,!0);var r=e.indent||"";this.options.preventIndent&&r&&(this.opcode("appendContent",r),r=""),this.opcode("invokePartial",i,n,r),this.opcode("append")},MustacheStatement:function(e){this.SubExpression(e),e.escaped&&!this.options.noEscape?this.opcode("appendEscaped"):this.opcode("append")},ContentStatement:function(e){e.value&&this.opcode("appendContent",e.value)},CommentStatement:function(){},SubExpression:function(e){a(e);var t=this.classifySexpr(e);"simple"===t?this.simpleSexpr(e):"helper"===t?this.helperSexpr(e):this.ambiguousSexpr(e)},ambiguousSexpr:function(e,t,n){var i=e.path,r=i.parts[0],a=null!=t||null!=n;this.opcode("getContext",i.depth),this.opcode("pushProgram",t),this.opcode("pushProgram",n),this.accept(i),this.opcode("invokeAmbiguous",r,a)},simpleSexpr:function(e){this.accept(e.path),this.opcode("resolvePossibleLambda")},helperSexpr:function(e,t,n){var i=this.setupFullMustacheParams(e,t,n),r=e.path,a=r.parts[0];if(this.options.knownHelpers[a])this.opcode("invokeKnownHelper",i.length,a);else{if(this.options.knownHelpersOnly)throw new o.default("You specified knownHelpersOnly, but used the unknown helper "+a,e);r.falsy=!0,this.accept(r),this.opcode("invokeHelper",i.length,r.original,c.default.helpers.simpleId(r))}},PathExpression:function(e){this.addDepth(e.depth),this.opcode("getContext",e.depth);var t=e.parts[0],n=c.default.helpers.scopedId(e),i=!e.depth&&!n&&this.blockParamIndex(t);i?this.opcode("lookupBlockParam",i,e.parts):t?e.data?(this.options.data=!0,this.opcode("lookupData",e.depth,e.parts)):this.opcode("lookupOnContext",e.parts,e.falsy,n):this.opcode("pushContext")},StringLiteral:function(e){this.opcode("pushString",e.value)},NumberLiteral:function(e){this.opcode("pushLiteral",e.value)},BooleanLiteral:function(e){this.opcode("pushLiteral",e.value)},UndefinedLiteral:function(){this.opcode("pushLiteral","undefined")},NullLiteral:function(){this.opcode("pushLiteral","null")},Hash:function(e){var t=e.pairs,n=0,i=t.length;for(this.opcode("pushHash");n<i;n++)this.pushParam(t[n].value);for(;n--;)this.opcode("assignToHash",t[n].key);this.opcode("popHash")},opcode:function(e){this.opcodes.push({opcode:e,args:u.call(arguments,1),loc:this.sourceNode[0].loc})},addDepth:function(e){e&&(this.useDepths=!0)},classifySexpr:function(e){var t=c.default.helpers.simpleId(e.path),n=t&&!!this.blockParamIndex(e.path.parts[0]),i=!n&&c.default.helpers.helperExpression(e),r=!n&&(i||t);if(r&&!i){var a=e.path.parts[0],s=this.options;s.knownHelpers[a]?i=!0:s.knownHelpersOnly&&(r=!1)}return i?"helper":r?"ambiguous":"simple"},pushParams:function(e){for(var t=0,n=e.length;t<n;t++)this.pushParam(e[t])},pushParam:function(e){var t=null!=e.value?e.value:e.original||"";if(this.stringParams)t.replace&&(t=t.replace(/^(\.?\.\/)*/g,"").replace(/\//g,".")),e.depth&&this.addDepth(e.depth),this.opcode("getContext",e.depth||0),this.opcode("pushStringParam",t,e.type),"SubExpression"===e.type&&this.accept(e);else{if(this.trackIds){var n=void 0;if(!e.parts||c.default.helpers.scopedId(e)||e.depth||(n=this.blockParamIndex(e.parts[0])),n){var i=e.parts.slice(1).join(".");this.opcode("pushId","BlockParam",n,i)}else(t=e.original||t).replace&&(t=t.replace(/^\.\//g,"").replace(/^\.$/g,"")),this.opcode("pushId",e.type,t)}this.accept(e)}},setupFullMustacheParams:function(e,t,n,i){var r=e.params;return this.pushParams(r),this.opcode("pushProgram",t),this.opcode("pushProgram",n),e.hash?this.accept(e.hash):this.opcode("emptyHash",i),r},blockParamIndex:function(e){for(var t=0,n=this.options.blockParams.length;t<n;t++){var i=this.options.blockParams[t],r=i&&l.indexOf(i,e);if(i&&r>=0)return[t,r]}}}},function(e,t,n){"use strict";function i(e){this.value=e}function r(){}function a(e,t,n,i){var r=t.popStack(),a=0,s=n.length;for(e&&s--;a<s;a++)r=t.nameLookup(r,n[a],i);return e?[t.aliasable("this.strict"),"(",r,", ",t.quotedString(n[a]),")"]:r}var s=n(8).default;t.__esModule=!0;var o=n(10),l=s(n(12)),c=n(13),u=s(n(18));r.prototype={nameLookup:function(e,t){return r.isValidJavaScriptVariableName(t)?[e,".",t]:[e,"['",t,"']"]},depthedLookup:function(e){return[this.aliasable("this.lookup"),'(depths, "',e,'")']},compilerInfo:function(){var e=o.COMPILER_REVISION;return[e,o.REVISION_CHANGES[e]]},appendToBuffer:function(e,t,n){return c.isArray(e)||(e=[e]),e=this.source.wrap(e,t),this.environment.isSimple?["return ",e,";"]:n?["buffer += ",e,";"]:(e.appendToBuffer=!0,e)},initializeBuffer:function(){return this.quotedString("")},compile:function(e,t,n,i){this.environment=e,this.options=t,this.stringParams=this.options.stringParams,this.trackIds=this.options.trackIds,this.precompile=!i,this.name=this.environment.name,this.isChild=!!n,this.context=n||{programs:[],environments:[]},this.preamble(),this.stackSlot=0,this.stackVars=[],this.aliases={},this.registers={list:[]},this.hashes=[],this.compileStack=[],this.inlineStack=[],this.blockParams=[],this.compileChildren(e,t),this.useDepths=this.useDepths||e.useDepths||this.options.compat,this.useBlockParams=this.useBlockParams||e.useBlockParams;var r=e.opcodes,a=void 0,s=void 0,o=void 0,c=void 0;for(o=0,c=r.length;o<c;o++)a=r[o],this.source.currentLocation=a.loc,s=s||a.loc,this[a.opcode].apply(this,a.args);if(this.source.currentLocation=s,this.pushSource(""),this.stackSlot||this.inlineStack.length||this.compileStack.length)throw new l.default("Compile completed with content left on stack");var u=this.createFunctionContext(i);if(this.isChild)return u;var d={compiler:this.compilerInfo(),main:u},h=this.context.programs;for(o=0,c=h.length;o<c;o++)h[o]&&(d[o]=h[o]);return this.environment.usePartial&&(d.usePartial=!0),this.options.data&&(d.useData=!0),this.useDepths&&(d.useDepths=!0),this.useBlockParams&&(d.useBlockParams=!0),this.options.compat&&(d.compat=!0),i?d.compilerOptions=this.options:(d.compiler=JSON.stringify(d.compiler),this.source.currentLocation={start:{line:1,column:0}},d=this.objectLiteral(d),t.srcName?(d=d.toStringWithSourceMap({file:t.destName})).map=d.map&&d.map.toString():d=d.toString()),d},preamble:function(){this.lastContext=0,this.source=new u.default(this.options.srcName)},createFunctionContext:function(e){var t="",n=this.stackVars.concat(this.registers.list);n.length>0&&(t+=", "+n.join(", "));var i=0;for(var r in this.aliases){var a=this.aliases[r];this.aliases.hasOwnProperty(r)&&a.children&&a.referenceCount>1&&(t+=", alias"+ ++i+"="+r,a.children[0]="alias"+i)}var s=["depth0","helpers","partials","data"];(this.useBlockParams||this.useDepths)&&s.push("blockParams"),this.useDepths&&s.push("depths");var o=this.mergeSource(t);return e?(s.push(o),Function.apply(this,s)):this.source.wrap(["function(",s.join(","),") {\n  ",o,"}"])},mergeSource:function(e){var t=this.environment.isSimple,n=!this.forceBuffer,i=void 0,r=void 0,a=void 0,s=void 0;return this.source.each(function(e){e.appendToBuffer?(a?e.prepend("  + "):a=e,s=e):(a&&(r?a.prepend("buffer += "):i=!0,s.add(";"),a=s=void 0),r=!0,t||(n=!1))}),n?a?(a.prepend("return "),s.add(";")):r||this.source.push('return "";'):(e+=", buffer = "+(i?"":this.initializeBuffer()),a?(a.prepend("return buffer + "),s.add(";")):this.source.push("return buffer;")),e&&this.source.prepend("var "+e.substring(2)+(i?"":";\n")),this.source.merge()},blockValue:function(e){var t=this.aliasable("helpers.blockHelperMissing"),n=[this.contextName(0)];this.setupHelperArgs(e,0,n);var i=this.popStack();n.splice(1,0,i),this.push(this.source.functionCall(t,"call",n))},ambiguousBlockValue:function(){var e=this.aliasable("helpers.blockHelperMissing"),t=[this.contextName(0)];this.setupHelperArgs("",0,t,!0),this.flushInline();var n=this.topStack();t.splice(1,0,n),this.pushSource(["if (!",this.lastHelper,") { ",n," = ",this.source.functionCall(e,"call",t),"}"])},appendContent:function(e){this.pendingContent?e=this.pendingContent+e:this.pendingLocation=this.source.currentLocation,this.pendingContent=e},append:function(){if(this.isInline())this.replaceStack(function(e){return[" != null ? ",e,' : ""']}),this.pushSource(this.appendToBuffer(this.popStack()));else{var e=this.popStack();this.pushSource(["if (",e," != null) { ",this.appendToBuffer(e,void 0,!0)," }"]),this.environment.isSimple&&this.pushSource(["else { ",this.appendToBuffer("''",void 0,!0)," }"])}},appendEscaped:function(){this.pushSource(this.appendToBuffer([this.aliasable("this.escapeExpression"),"(",this.popStack(),")"]))},getContext:function(e){this.lastContext=e},pushContext:function(){this.pushStackLiteral(this.contextName(this.lastContext))},lookupOnContext:function(e,t,n){var i=0;n||!this.options.compat||this.lastContext?this.pushContext():this.push(this.depthedLookup(e[i++])),this.resolvePath("context",e,i,t)},lookupBlockParam:function(e,t){this.useBlockParams=!0,this.push(["blockParams[",e[0],"][",e[1],"]"]),this.resolvePath("context",t,1)},lookupData:function(e,t){e?this.pushStackLiteral("this.data(data, "+e+")"):this.pushStackLiteral("data"),this.resolvePath("data",t,0,!0)},resolvePath:function(e,t,n,i){var r=this;if(this.options.strict||this.options.assumeObjects)this.push(a(this.options.strict,this,t,e));else for(var s=t.length;n<s;n++)this.replaceStack(function(a){var s=r.nameLookup(a,t[n],e);return i?[" && ",s]:[" != null ? ",s," : ",a]})},resolvePossibleLambda:function(){this.push([this.aliasable("this.lambda"),"(",this.popStack(),", ",this.contextName(0),")"])},pushStringParam:function(e,t){this.pushContext(),this.pushString(t),"SubExpression"!==t&&("string"==typeof e?this.pushString(e):this.pushStackLiteral(e))},emptyHash:function(e){this.trackIds&&this.push("{}"),this.stringParams&&(this.push("{}"),this.push("{}")),this.pushStackLiteral(e?"undefined":"{}")},pushHash:function(){this.hash&&this.hashes.push(this.hash),this.hash={values:[],types:[],contexts:[],ids:[]}},popHash:function(){var e=this.hash;this.hash=this.hashes.pop(),this.trackIds&&this.push(this.objectLiteral(e.ids)),this.stringParams&&(this.push(this.objectLiteral(e.contexts)),this.push(this.objectLiteral(e.types))),this.push(this.objectLiteral(e.values))},pushString:function(e){this.pushStackLiteral(this.quotedString(e))},pushLiteral:function(e){this.pushStackLiteral(e)},pushProgram:function(e){null!=e?this.pushStackLiteral(this.programExpression(e)):this.pushStackLiteral(null)},invokeHelper:function(e,t,n){var i=this.popStack(),r=this.setupHelper(e,t),a=n?[r.name," || "]:"",s=["("].concat(a,i);this.options.strict||s.push(" || ",this.aliasable("helpers.helperMissing")),s.push(")"),this.push(this.source.functionCall(s,"call",r.callParams))},invokeKnownHelper:function(e,t){var n=this.setupHelper(e,t);this.push(this.source.functionCall(n.name,"call",n.callParams))},invokeAmbiguous:function(e,t){this.useRegister("helper");var n=this.popStack();this.emptyHash();var i=this.setupHelper(0,e,t),r=["(","(helper = ",this.lastHelper=this.nameLookup("helpers",e,"helper")," || ",n,")"];this.options.strict||(r[0]="(helper = ",r.push(" != null ? helper : ",this.aliasable("helpers.helperMissing"))),this.push(["(",r,i.paramsInit?["),(",i.paramsInit]:[],"),","(typeof helper === ",this.aliasable('"function"')," ? ",this.source.functionCall("helper","call",i.callParams)," : helper))"])},invokePartial:function(e,t,n){var i=[],r=this.setupParams(t,1,i,!1);e&&(t=this.popStack(),delete r.name),n&&(r.indent=JSON.stringify(n)),r.helpers="helpers",r.partials="partials",e?i.unshift(t):i.unshift(this.nameLookup("partials",t,"partial")),this.options.compat&&(r.depths="depths"),r=this.objectLiteral(r),i.push(r),this.push(this.source.functionCall("this.invokePartial","",i))},assignToHash:function(e){var t=this.popStack(),n=void 0,i=void 0,r=void 0;this.trackIds&&(r=this.popStack()),this.stringParams&&(i=this.popStack(),n=this.popStack());var a=this.hash;n&&(a.contexts[e]=n),i&&(a.types[e]=i),r&&(a.ids[e]=r),a.values[e]=t},pushId:function(e,t,n){"BlockParam"===e?this.pushStackLiteral("blockParams["+t[0]+"].path["+t[1]+"]"+(n?" + "+JSON.stringify("."+n):"")):"PathExpression"===e?this.pushString(t):"SubExpression"===e?this.pushStackLiteral("true"):this.pushStackLiteral("null")},compiler:r,compileChildren:function(e,t){for(var n=e.children,i=void 0,r=void 0,a=0,s=n.length;a<s;a++){i=n[a],r=new this.compiler;var o=this.matchExistingProgram(i);null==o?(this.context.programs.push(""),o=this.context.programs.length,i.index=o,i.name="program"+o,this.context.programs[o]=r.compile(i,t,this.context,!this.precompile),this.context.environments[o]=i,this.useDepths=this.useDepths||r.useDepths,this.useBlockParams=this.useBlockParams||r.useBlockParams):(i.index=o,i.name="program"+o,this.useDepths=this.useDepths||i.useDepths,this.useBlockParams=this.useBlockParams||i.useBlockParams)}},matchExistingProgram:function(e){for(var t=0,n=this.context.environments.length;t<n;t++){var i=this.context.environments[t];if(i&&i.equals(e))return t}},programExpression:function(e){var t=this.environment.children[e],n=[t.index,"data",t.blockParams];return(this.useBlockParams||this.useDepths)&&n.push("blockParams"),this.useDepths&&n.push("depths"),"this.program("+n.join(", ")+")"},useRegister:function(e){this.registers[e]||(this.registers[e]=!0,this.registers.list.push(e))},push:function(e){return e instanceof i||(e=this.source.wrap(e)),this.inlineStack.push(e),e},pushStackLiteral:function(e){this.push(new i(e))},pushSource:function(e){this.pendingContent&&(this.source.push(this.appendToBuffer(this.source.quotedString(this.pendingContent),this.pendingLocation)),this.pendingContent=void 0),e&&this.source.push(e)},replaceStack:function(e){var t=["("],n=void 0,r=void 0,a=void 0;if(!this.isInline())throw new l.default("replaceStack on non-inline");var s=this.popStack(!0);if(s instanceof i)t=["(",n=[s.value]],a=!0;else{r=!0;var o=this.incrStack();t=["((",this.push(o)," = ",s,")"],n=this.topStack()}var c=e.call(this,n);a||this.popStack(),r&&this.stackSlot--,this.push(t.concat(c,")"))},incrStack:function(){return++this.stackSlot>this.stackVars.length&&this.stackVars.push("stack"+this.stackSlot),this.topStackName()},topStackName:function(){return"stack"+this.stackSlot},flushInline:function(){var e=this.inlineStack;this.inlineStack=[];for(var t=0,n=e.length;t<n;t++){var r=e[t];if(r instanceof i)this.compileStack.push(r);else{var a=this.incrStack();this.pushSource([a," = ",r,";"]),this.compileStack.push(a)}}},isInline:function(){return this.inlineStack.length},popStack:function(e){var t=this.isInline(),n=(t?this.inlineStack:this.compileStack).pop();if(!e&&n instanceof i)return n.value;if(!t){if(!this.stackSlot)throw new l.default("Invalid stack pop");this.stackSlot--}return n},topStack:function(){var e=this.isInline()?this.inlineStack:this.compileStack,t=e[e.length-1];return t instanceof i?t.value:t},contextName:function(e){return this.useDepths&&e?"depths["+e+"]":"depth"+e},quotedString:function(e){return this.source.quotedString(e)},objectLiteral:function(e){return this.source.objectLiteral(e)},aliasable:function(e){var t=this.aliases[e];return t?(t.referenceCount++,t):(t=this.aliases[e]=this.source.wrap(e),t.aliasable=!0,t.referenceCount=1,t)},setupHelper:function(e,t,n){var i=[];return{params:i,paramsInit:this.setupHelperArgs(t,e,i,n),name:this.nameLookup("helpers",t,"helper"),callParams:[this.contextName(0)].concat(i)}},setupParams:function(e,t,n){var i={},r=[],a=[],s=[],o=void 0;i.name=this.quotedString(e),i.hash=this.popStack(),this.trackIds&&(i.hashIds=this.popStack()),this.stringParams&&(i.hashTypes=this.popStack(),i.hashContexts=this.popStack());var l=this.popStack(),c=this.popStack();(c||l)&&(i.fn=c||"this.noop",i.inverse=l||"this.noop");for(var u=t;u--;)o=this.popStack(),n[u]=o,this.trackIds&&(s[u]=this.popStack()),this.stringParams&&(a[u]=this.popStack(),r[u]=this.popStack());return this.trackIds&&(i.ids=this.source.generateArray(s)),this.stringParams&&(i.types=this.source.generateArray(a),i.contexts=this.source.generateArray(r)),this.options.data&&(i.data="data"),this.useBlockParams&&(i.blockParams="blockParams"),i},setupHelperArgs:function(e,t,n,i){var r=this.setupParams(e,t,n,!0);return r=this.objectLiteral(r),i?(this.useRegister("options"),n.push("options"),["options=",r]):(n.push(r),"")}},function(){for(var e="break else new var case finally return void catch for switch while continue function this with default if throw delete in try do instanceof typeof abstract enum int short boolean export interface static byte extends long super char final native synchronized class float package throws const goto private transient debugger implements protected volatile double import public let yield await null true false".split(" "),t=r.RESERVED_WORDS={},n=0,i=e.length;n<i;n++)t[e[n]]=!0}(),r.isValidJavaScriptVariableName=function(e){return!r.RESERVED_WORDS[e]&&/^[a-zA-Z_$][0-9a-zA-Z_$]*$/.test(e)},t.default=r,e.exports=t.default},function(e,t,n){"use strict";function i(){this.parents=[]}var r=n(8).default;t.__esModule=!0;var a=r(n(12)),s=r(n(2));i.prototype={constructor:i,mutating:!1,acceptKey:function(e,t){var n=this.accept(e[t]);if(this.mutating){if(n&&(!n.type||!s.default[n.type]))throw new a.default('Unexpected node type "'+n.type+'" found when accepting '+t+" on "+e.type);e[t]=n}},acceptRequired:function(e,t){if(this.acceptKey(e,t),!e[t])throw new a.default(e.type+" requires "+t)},acceptArray:function(e){for(var t=0,n=e.length;t<n;t++)this.acceptKey(e,t),e[t]||(e.splice(t,1),t--,n--)},accept:function(e){if(e){this.current&&this.parents.unshift(this.current),this.current=e;var t=this[e.type](e);return this.current=this.parents.shift(),!this.mutating||t?t:!1!==t?e:void 0}},Program:function(e){this.acceptArray(e.body)},MustacheStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},BlockStatement:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash"),this.acceptKey(e,"program"),this.acceptKey(e,"inverse")},PartialStatement:function(e){this.acceptRequired(e,"name"),this.acceptArray(e.params),this.acceptKey(e,"hash")},ContentStatement:function(){},CommentStatement:function(){},SubExpression:function(e){this.acceptRequired(e,"path"),this.acceptArray(e.params),this.acceptKey(e,"hash")},PathExpression:function(){},StringLiteral:function(){},NumberLiteral:function(){},BooleanLiteral:function(){},UndefinedLiteral:function(){},NullLiteral:function(){},Hash:function(e){this.acceptArray(e.pairs)},HashPair:function(e){this.acceptRequired(e,"value")}},t.default=i,e.exports=t.default},function(e,t,n){(function(n){"use strict";t.__esModule=!0,t.default=function(e){var t=void 0!==n?n:window,i=t.Handlebars;e.noConflict=function(){t.Handlebars===e&&(t.Handlebars=i)}},e.exports=t.default}).call(t,function(){return this}())},function(e,t,n){"use strict";t.default=function(e){return e&&e.__esModule?e:{default:e}},t.__esModule=!0},function(e,t,n){"use strict";t.default=function(e){if(e&&e.__esModule)return e;var t={};if("object"==typeof e&&null!==e)for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t},t.__esModule=!0},function(e,t,n){"use strict";function i(e,t){this.helpers=e||{},this.partials=t||{},r(this)}function r(e){e.registerHelper("helperMissing",function(){if(1!==arguments.length)throw new c.default('Missing helper: "'+arguments[arguments.length-1].name+'"')}),e.registerHelper("blockHelperMissing",function(t,n){var i=n.inverse,r=n.fn;if(!0===t)return r(this);if(!1===t||null==t)return i(this);if(d(t))return t.length>0?(n.ids&&(n.ids=[n.name]),e.helpers.each(t,n)):i(this);if(n.data&&n.ids){var s=a(n.data);s.contextPath=l.appendContextPath(n.data.contextPath,n.name),n={data:s}}return r(t,n)}),e.registerHelper("each",function(e,t){function n(t,n,r){u&&(u.key=t,u.index=n,u.first=0===n,u.last=!!r,p&&(u.contextPath=p+t)),o+=i(e[t],{data:u,blockParams:l.blockParams([e[t],t],[p+t,null])})}if(!t)throw new c.default("Must pass iterator to #each");var i=t.fn,r=t.inverse,s=0,o="",u=void 0,p=void 0;if(t.data&&t.ids&&(p=l.appendContextPath(t.data.contextPath,t.ids[0])+"."),h(e)&&(e=e.call(this)),t.data&&(u=a(t.data)),e&&"object"==typeof e)if(d(e))for(var f=e.length;s<f;s++)n(s,s,s===e.length-1);else{var g=void 0;for(var m in e)e.hasOwnProperty(m)&&(g&&n(g,s-1),g=m,s++);g&&n(g,s-1,!0)}return 0===s&&(o=r(this)),o}),e.registerHelper("if",function(e,t){return h(e)&&(e=e.call(this)),!t.hash.includeZero&&!e||l.isEmpty(e)?t.inverse(this):t.fn(this)}),e.registerHelper("unless",function(t,n){return e.helpers.if.call(this,t,{fn:n.inverse,inverse:n.fn,hash:n.hash})}),e.registerHelper("with",function(e,t){h(e)&&(e=e.call(this));var n=t.fn;if(l.isEmpty(e))return t.inverse(this);if(t.data&&t.ids){var i=a(t.data);i.contextPath=l.appendContextPath(t.data.contextPath,t.ids[0]),t={data:i}}return n(e,t)}),e.registerHelper("log",function(t,n){var i=n.data&&null!=n.data.level?parseInt(n.data.level,10):1;e.log(i,t)}),e.registerHelper("lookup",function(e,t){return e&&e[t]})}function a(e){var t=l.extend({},e);return t._parent=e,t}var s=n(9).default,o=n(8).default;t.__esModule=!0,t.HandlebarsEnvironment=i,t.createFrame=a;var l=s(n(13)),c=o(n(12));t.VERSION="3.0.1";t.COMPILER_REVISION=6;var u={1:"<= 1.0.rc.2",2:"== 1.0.0-rc.3",3:"== 1.0.0-rc.4",4:"== 1.x.x",5:"== 2.0.0-alpha.x",6:">= 2.0.0-beta.1"};t.REVISION_CHANGES=u;var d=l.isArray,h=l.isFunction,p=l.toString;i.prototype={constructor:i,logger:f,log:g,registerHelper:function(e,t){if("[object Object]"===p.call(e)){if(t)throw new c.default("Arg not supported with multiple helpers");l.extend(this.helpers,e)}else this.helpers[e]=t},unregisterHelper:function(e){delete this.helpers[e]},registerPartial:function(e,t){if("[object Object]"===p.call(e))l.extend(this.partials,e);else{if(void 0===t)throw new c.default("Attempting to register a partial as undefined");this.partials[e]=t}},unregisterPartial:function(e){delete this.partials[e]}};var f={methodMap:{0:"debug",1:"info",2:"warn",3:"error"},DEBUG:0,INFO:1,WARN:2,ERROR:3,level:1,log:function(e,t){if("undefined"!=typeof console&&f.level<=e){var n=f.methodMap[e];(console[n]||console.log).call(console,t)}}};t.logger=f;var g=f.log;t.log=g},function(e,t,n){"use strict";function i(e){this.string=e}t.__esModule=!0,i.prototype.toString=i.prototype.toHTML=function(){return""+this.string},t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(e,t){var n=t&&t.loc,a=void 0,s=void 0;n&&(e+=" - "+(a=n.start.line)+":"+(s=n.start.column));for(var o=Error.prototype.constructor.call(this,e),l=0;l<r.length;l++)this[r[l]]=o[r[l]];Error.captureStackTrace&&Error.captureStackTrace(this,i),n&&(this.lineNumber=a,this.column=s)}t.__esModule=!0;var r=["description","fileName","lineNumber","message","name","number","stack"];i.prototype=new Error,t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(e){return r[e]}t.__esModule=!0,t.extend=function(e){for(var t=1;t<arguments.length;t++)for(var n in arguments[t])Object.prototype.hasOwnProperty.call(arguments[t],n)&&(e[n]=arguments[t][n]);return e},t.indexOf=function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]===t)return n;return-1},t.escapeExpression=function(e){if("string"!=typeof e){if(e&&e.toHTML)return e.toHTML();if(null==e)return"";if(!e)return e+"";e=""+e}return s.test(e)?e.replace(a,i):e},t.isEmpty=function(e){return!e&&0!==e||!(!c(e)||0!==e.length)},t.blockParams=function(e,t){return e.path=t,e},t.appendContextPath=function(e,t){return(e?e+".":"")+t};var r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},a=/[&<>"'`]/g,s=/[&<>"'`]/,o=Object.prototype.toString;t.toString=o,(l=function(e){return"function"==typeof e})(/x/)&&(t.isFunction=l=function(e){return"function"==typeof e&&"[object Function]"===o.call(e)});var l;t.isFunction=l;var c=Array.isArray||function(e){return!(!e||"object"!=typeof e)&&"[object Array]"===o.call(e)};t.isArray=c},function(e,t,n){"use strict";function i(e,t,n,i,r,a,s){function o(t){var r=void 0===arguments[1]?{}:arguments[1];return n.call(e,t,e.helpers,e.partials,r.data||i,a&&[r.blockParams].concat(a),s&&[t].concat(s))}return o.program=t,o.depth=s?s.length:0,o.blockParams=r||0,o}function r(e,t){return t&&"root"in t||((t=t?c.createFrame(t):{}).root=e),t}var a=n(9).default,s=n(8).default;t.__esModule=!0,t.checkRevision=function(e){var t=e&&e[0]||1,n=c.COMPILER_REVISION;if(t!==n){if(t<n){var i=c.REVISION_CHANGES[n],r=c.REVISION_CHANGES[t];throw new l.default("Template was precompiled with an older version of Handlebars than the current runtime. Please update your precompiler to a newer version ("+i+") or downgrade your runtime to an older version ("+r+").")}throw new l.default("Template was precompiled with a newer version of Handlebars than the current runtime. Please update your runtime to a newer version ("+e[1]+").")}},t.template=function(e,t){function n(t){var i=void 0===arguments[1]?{}:arguments[1],s=i.data;n._setup(i),!i.partial&&e.useData&&(s=r(t,s));var o=void 0,l=e.useBlockParams?[]:void 0;return e.useDepths&&(o=i.depths?[t].concat(i.depths):[t]),e.main.call(a,t,a.helpers,a.partials,s,l,o)}if(!t)throw new l.default("No environment passed to template");if(!e||!e.main)throw new l.default("Unknown template object: "+typeof e);t.VM.checkRevision(e.compiler);var a={strict:function(e,t){if(!(t in e))throw new l.default('"'+t+'" not defined in '+e);return e[t]},lookup:function(e,t){for(var n=e.length,i=0;i<n;i++)if(e[i]&&null!=e[i][t])return e[i][t]},lambda:function(e,t){return"function"==typeof e?e.call(t):e},escapeExpression:o.escapeExpression,invokePartial:function(n,i,r){r.hash&&(i=o.extend({},i,r.hash)),n=t.VM.resolvePartial.call(this,n,i,r);var a=t.VM.invokePartial.call(this,n,i,r);if(null==a&&t.compile&&(r.partials[r.name]=t.compile(n,e.compilerOptions,t),a=r.partials[r.name](i,r)),null!=a){if(r.indent){for(var s=a.split("\n"),c=0,u=s.length;c<u&&(s[c]||c+1!==u);c++)s[c]=r.indent+s[c];a=s.join("\n")}return a}throw new l.default("The partial "+r.name+" could not be compiled when running in runtime-only mode")},fn:function(t){return e[t]},programs:[],program:function(e,t,n,r,a){var s=this.programs[e],o=this.fn(e);return t||a||r||n?s=i(this,e,o,t,n,r,a):s||(s=this.programs[e]=i(this,e,o)),s},data:function(e,t){for(;e&&t--;)e=e._parent;return e},merge:function(e,t){var n=e||t;return e&&t&&e!==t&&(n=o.extend({},t,e)),n},noop:t.VM.noop,compilerInfo:e.compiler};return n.isTop=!0,n._setup=function(n){n.partial?(a.helpers=n.helpers,a.partials=n.partials):(a.helpers=a.merge(n.helpers,t.helpers),e.usePartial&&(a.partials=a.merge(n.partials,t.partials)))},n._child=function(t,n,r,s){if(e.useBlockParams&&!r)throw new l.default("must pass block params");if(e.useDepths&&!s)throw new l.default("must pass parent depths");return i(a,t,e[t],n,0,r,s)},n},t.wrapProgram=i,t.resolvePartial=function(e,t,n){return e?e.call||n.name||(n.name=e,e=n.partials[e]):e=n.partials[n.name],e},t.invokePartial=function(e,t,n){if(n.partial=!0,void 0===e)throw new l.default("The partial "+n.name+" could not be found");if(e instanceof Function)return e(t,n)},t.noop=function(){return""};var o=a(n(13)),l=s(n(12)),c=n(10)},function(e,t,n){"use strict";t.__esModule=!0;var i=function(){function e(){this.yy={}}var t={trace:function(){},yy:{},symbols_:{error:2,root:3,program:4,EOF:5,program_repetition0:6,statement:7,mustache:8,block:9,rawBlock:10,partial:11,content:12,COMMENT:13,CONTENT:14,openRawBlock:15,END_RAW_BLOCK:16,OPEN_RAW_BLOCK:17,helperName:18,openRawBlock_repetition0:19,openRawBlock_option0:20,CLOSE_RAW_BLOCK:21,openBlock:22,block_option0:23,closeBlock:24,openInverse:25,block_option1:26,OPEN_BLOCK:27,openBlock_repetition0:28,openBlock_option0:29,openBlock_option1:30,CLOSE:31,OPEN_INVERSE:32,openInverse_repetition0:33,openInverse_option0:34,openInverse_option1:35,openInverseChain:36,OPEN_INVERSE_CHAIN:37,openInverseChain_repetition0:38,openInverseChain_option0:39,openInverseChain_option1:40,inverseAndProgram:41,INVERSE:42,inverseChain:43,inverseChain_option0:44,OPEN_ENDBLOCK:45,OPEN:46,mustache_repetition0:47,mustache_option0:48,OPEN_UNESCAPED:49,mustache_repetition1:50,mustache_option1:51,CLOSE_UNESCAPED:52,OPEN_PARTIAL:53,partialName:54,partial_repetition0:55,partial_option0:56,param:57,sexpr:58,OPEN_SEXPR:59,sexpr_repetition0:60,sexpr_option0:61,CLOSE_SEXPR:62,hash:63,hash_repetition_plus0:64,hashSegment:65,ID:66,EQUALS:67,blockParams:68,OPEN_BLOCK_PARAMS:69,blockParams_repetition_plus0:70,CLOSE_BLOCK_PARAMS:71,path:72,dataName:73,STRING:74,NUMBER:75,BOOLEAN:76,UNDEFINED:77,NULL:78,DATA:79,pathSegments:80,SEP:81,$accept:0,$end:1},terminals_:{2:"error",5:"EOF",13:"COMMENT",14:"CONTENT",16:"END_RAW_BLOCK",17:"OPEN_RAW_BLOCK",21:"CLOSE_RAW_BLOCK",27:"OPEN_BLOCK",31:"CLOSE",32:"OPEN_INVERSE",37:"OPEN_INVERSE_CHAIN",42:"INVERSE",45:"OPEN_ENDBLOCK",46:"OPEN",49:"OPEN_UNESCAPED",52:"CLOSE_UNESCAPED",53:"OPEN_PARTIAL",59:"OPEN_SEXPR",62:"CLOSE_SEXPR",66:"ID",67:"EQUALS",69:"OPEN_BLOCK_PARAMS",71:"CLOSE_BLOCK_PARAMS",74:"STRING",75:"NUMBER",76:"BOOLEAN",77:"UNDEFINED",78:"NULL",79:"DATA",81:"SEP"},productions_:[0,[3,2],[4,1],[7,1],[7,1],[7,1],[7,1],[7,1],[7,1],[12,1],[10,3],[15,5],[9,4],[9,4],[22,6],[25,6],[36,6],[41,2],[43,3],[43,1],[24,3],[8,5],[8,5],[11,5],[57,1],[57,1],[58,5],[63,1],[65,3],[68,3],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[18,1],[54,1],[54,1],[73,2],[72,1],[80,3],[80,1],[6,0],[6,2],[19,0],[19,2],[20,0],[20,1],[23,0],[23,1],[26,0],[26,1],[28,0],[28,2],[29,0],[29,1],[30,0],[30,1],[33,0],[33,2],[34,0],[34,1],[35,0],[35,1],[38,0],[38,2],[39,0],[39,1],[40,0],[40,1],[44,0],[44,1],[47,0],[47,2],[48,0],[48,1],[50,0],[50,2],[51,0],[51,1],[55,0],[55,2],[56,0],[56,1],[60,0],[60,2],[61,0],[61,1],[64,1],[64,2],[70,1],[70,2]],performAction:function(e,t,n,i,r,a,s){var o=a.length-1;switch(r){case 1:return a[o-1];case 2:this.$=new i.Program(a[o],null,{},i.locInfo(this._$));break;case 3:case 4:case 5:case 6:case 7:this.$=a[o];break;case 8:this.$=new i.CommentStatement(i.stripComment(a[o]),i.stripFlags(a[o],a[o]),i.locInfo(this._$));break;case 9:this.$=new i.ContentStatement(a[o],i.locInfo(this._$));break;case 10:this.$=i.prepareRawBlock(a[o-2],a[o-1],a[o],this._$);break;case 11:this.$={path:a[o-3],params:a[o-2],hash:a[o-1]};break;case 12:this.$=i.prepareBlock(a[o-3],a[o-2],a[o-1],a[o],!1,this._$);break;case 13:this.$=i.prepareBlock(a[o-3],a[o-2],a[o-1],a[o],!0,this._$);break;case 14:case 15:case 16:this.$={path:a[o-4],params:a[o-3],hash:a[o-2],blockParams:a[o-1],strip:i.stripFlags(a[o-5],a[o])};break;case 17:this.$={strip:i.stripFlags(a[o-1],a[o-1]),program:a[o]};break;case 18:var l=i.prepareBlock(a[o-2],a[o-1],a[o],a[o],!1,this._$),c=new i.Program([l],null,{},i.locInfo(this._$));c.chained=!0,this.$={strip:a[o-2].strip,program:c,chain:!0};break;case 19:this.$=a[o];break;case 20:this.$={path:a[o-1],strip:i.stripFlags(a[o-2],a[o])};break;case 21:case 22:this.$=i.prepareMustache(a[o-3],a[o-2],a[o-1],a[o-4],i.stripFlags(a[o-4],a[o]),this._$);break;case 23:this.$=new i.PartialStatement(a[o-3],a[o-2],a[o-1],i.stripFlags(a[o-4],a[o]),i.locInfo(this._$));break;case 24:case 25:this.$=a[o];break;case 26:this.$=new i.SubExpression(a[o-3],a[o-2],a[o-1],i.locInfo(this._$));break;case 27:this.$=new i.Hash(a[o],i.locInfo(this._$));break;case 28:this.$=new i.HashPair(i.id(a[o-2]),a[o],i.locInfo(this._$));break;case 29:this.$=i.id(a[o-1]);break;case 30:case 31:this.$=a[o];break;case 32:this.$=new i.StringLiteral(a[o],i.locInfo(this._$));break;case 33:this.$=new i.NumberLiteral(a[o],i.locInfo(this._$));break;case 34:this.$=new i.BooleanLiteral(a[o],i.locInfo(this._$));break;case 35:this.$=new i.UndefinedLiteral(i.locInfo(this._$));break;case 36:this.$=new i.NullLiteral(i.locInfo(this._$));break;case 37:case 38:this.$=a[o];break;case 39:this.$=i.preparePath(!0,a[o],this._$);break;case 40:this.$=i.preparePath(!1,a[o],this._$);break;case 41:a[o-2].push({part:i.id(a[o]),original:a[o],separator:a[o-1]}),this.$=a[o-2];break;case 42:this.$=[{part:i.id(a[o]),original:a[o]}];break;case 43:this.$=[];break;case 44:a[o-1].push(a[o]);break;case 45:this.$=[];break;case 46:a[o-1].push(a[o]);break;case 53:this.$=[];break;case 54:a[o-1].push(a[o]);break;case 59:this.$=[];break;case 60:a[o-1].push(a[o]);break;case 65:this.$=[];break;case 66:a[o-1].push(a[o]);break;case 73:this.$=[];break;case 74:a[o-1].push(a[o]);break;case 77:this.$=[];break;case 78:a[o-1].push(a[o]);break;case 81:this.$=[];break;case 82:a[o-1].push(a[o]);break;case 85:this.$=[];break;case 86:a[o-1].push(a[o]);break;case 89:this.$=[a[o]];break;case 90:a[o-1].push(a[o]);break;case 91:this.$=[a[o]];break;case 92:a[o-1].push(a[o])}},table:[{3:1,4:2,5:[2,43],6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],46:[2,43],49:[2,43],53:[2,43]},{1:[3]},{5:[1,4]},{5:[2,2],7:5,8:6,9:7,10:8,11:9,12:10,13:[1,11],14:[1,18],15:16,17:[1,21],22:14,25:15,27:[1,19],32:[1,20],37:[2,2],42:[2,2],45:[2,2],46:[1,12],49:[1,13],53:[1,17]},{1:[2,1]},{5:[2,44],13:[2,44],14:[2,44],17:[2,44],27:[2,44],32:[2,44],37:[2,44],42:[2,44],45:[2,44],46:[2,44],49:[2,44],53:[2,44]},{5:[2,3],13:[2,3],14:[2,3],17:[2,3],27:[2,3],32:[2,3],37:[2,3],42:[2,3],45:[2,3],46:[2,3],49:[2,3],53:[2,3]},{5:[2,4],13:[2,4],14:[2,4],17:[2,4],27:[2,4],32:[2,4],37:[2,4],42:[2,4],45:[2,4],46:[2,4],49:[2,4],53:[2,4]},{5:[2,5],13:[2,5],14:[2,5],17:[2,5],27:[2,5],32:[2,5],37:[2,5],42:[2,5],45:[2,5],46:[2,5],49:[2,5],53:[2,5]},{5:[2,6],13:[2,6],14:[2,6],17:[2,6],27:[2,6],32:[2,6],37:[2,6],42:[2,6],45:[2,6],46:[2,6],49:[2,6],53:[2,6]},{5:[2,7],13:[2,7],14:[2,7],17:[2,7],27:[2,7],32:[2,7],37:[2,7],42:[2,7],45:[2,7],46:[2,7],49:[2,7],53:[2,7]},{5:[2,8],13:[2,8],14:[2,8],17:[2,8],27:[2,8],32:[2,8],37:[2,8],42:[2,8],45:[2,8],46:[2,8],49:[2,8],53:[2,8]},{18:22,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:33,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:34,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{4:35,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{12:36,14:[1,18]},{18:38,54:37,58:39,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,9],13:[2,9],14:[2,9],16:[2,9],17:[2,9],27:[2,9],32:[2,9],37:[2,9],42:[2,9],45:[2,9],46:[2,9],49:[2,9],53:[2,9]},{18:41,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:42,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:43,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[2,73],47:44,59:[2,73],66:[2,73],74:[2,73],75:[2,73],76:[2,73],77:[2,73],78:[2,73],79:[2,73]},{21:[2,30],31:[2,30],52:[2,30],59:[2,30],62:[2,30],66:[2,30],69:[2,30],74:[2,30],75:[2,30],76:[2,30],77:[2,30],78:[2,30],79:[2,30]},{21:[2,31],31:[2,31],52:[2,31],59:[2,31],62:[2,31],66:[2,31],69:[2,31],74:[2,31],75:[2,31],76:[2,31],77:[2,31],78:[2,31],79:[2,31]},{21:[2,32],31:[2,32],52:[2,32],59:[2,32],62:[2,32],66:[2,32],69:[2,32],74:[2,32],75:[2,32],76:[2,32],77:[2,32],78:[2,32],79:[2,32]},{21:[2,33],31:[2,33],52:[2,33],59:[2,33],62:[2,33],66:[2,33],69:[2,33],74:[2,33],75:[2,33],76:[2,33],77:[2,33],78:[2,33],79:[2,33]},{21:[2,34],31:[2,34],52:[2,34],59:[2,34],62:[2,34],66:[2,34],69:[2,34],74:[2,34],75:[2,34],76:[2,34],77:[2,34],78:[2,34],79:[2,34]},{21:[2,35],31:[2,35],52:[2,35],59:[2,35],62:[2,35],66:[2,35],69:[2,35],74:[2,35],75:[2,35],76:[2,35],77:[2,35],78:[2,35],79:[2,35]},{21:[2,36],31:[2,36],52:[2,36],59:[2,36],62:[2,36],66:[2,36],69:[2,36],74:[2,36],75:[2,36],76:[2,36],77:[2,36],78:[2,36],79:[2,36]},{21:[2,40],31:[2,40],52:[2,40],59:[2,40],62:[2,40],66:[2,40],69:[2,40],74:[2,40],75:[2,40],76:[2,40],77:[2,40],78:[2,40],79:[2,40],81:[1,45]},{66:[1,32],80:46},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{50:47,52:[2,77],59:[2,77],66:[2,77],74:[2,77],75:[2,77],76:[2,77],77:[2,77],78:[2,77],79:[2,77]},{23:48,36:50,37:[1,52],41:51,42:[1,53],43:49,45:[2,49]},{26:54,41:55,42:[1,53],45:[2,51]},{16:[1,56]},{31:[2,81],55:57,59:[2,81],66:[2,81],74:[2,81],75:[2,81],76:[2,81],77:[2,81],78:[2,81],79:[2,81]},{31:[2,37],59:[2,37],66:[2,37],74:[2,37],75:[2,37],76:[2,37],77:[2,37],78:[2,37],79:[2,37]},{31:[2,38],59:[2,38],66:[2,38],74:[2,38],75:[2,38],76:[2,38],77:[2,38],78:[2,38],79:[2,38]},{18:58,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{28:59,31:[2,53],59:[2,53],66:[2,53],69:[2,53],74:[2,53],75:[2,53],76:[2,53],77:[2,53],78:[2,53],79:[2,53]},{31:[2,59],33:60,59:[2,59],66:[2,59],69:[2,59],74:[2,59],75:[2,59],76:[2,59],77:[2,59],78:[2,59],79:[2,59]},{19:61,21:[2,45],59:[2,45],66:[2,45],74:[2,45],75:[2,45],76:[2,45],77:[2,45],78:[2,45],79:[2,45]},{18:65,31:[2,75],48:62,57:63,58:66,59:[1,40],63:64,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{66:[1,70]},{21:[2,39],31:[2,39],52:[2,39],59:[2,39],62:[2,39],66:[2,39],69:[2,39],74:[2,39],75:[2,39],76:[2,39],77:[2,39],78:[2,39],79:[2,39],81:[1,45]},{18:65,51:71,52:[2,79],57:72,58:66,59:[1,40],63:73,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{24:74,45:[1,75]},{45:[2,50]},{4:76,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],37:[2,43],42:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{45:[2,19]},{18:77,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{4:78,6:3,13:[2,43],14:[2,43],17:[2,43],27:[2,43],32:[2,43],45:[2,43],46:[2,43],49:[2,43],53:[2,43]},{24:79,45:[1,75]},{45:[2,52]},{5:[2,10],13:[2,10],14:[2,10],17:[2,10],27:[2,10],32:[2,10],37:[2,10],42:[2,10],45:[2,10],46:[2,10],49:[2,10],53:[2,10]},{18:65,31:[2,83],56:80,57:81,58:66,59:[1,40],63:82,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{59:[2,85],60:83,62:[2,85],66:[2,85],74:[2,85],75:[2,85],76:[2,85],77:[2,85],78:[2,85],79:[2,85]},{18:65,29:84,31:[2,55],57:85,58:66,59:[1,40],63:86,64:67,65:68,66:[1,69],69:[2,55],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,31:[2,61],34:87,57:88,58:66,59:[1,40],63:89,64:67,65:68,66:[1,69],69:[2,61],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{18:65,20:90,21:[2,47],57:91,58:66,59:[1,40],63:92,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{31:[1,93]},{31:[2,74],59:[2,74],66:[2,74],74:[2,74],75:[2,74],76:[2,74],77:[2,74],78:[2,74],79:[2,74]},{31:[2,76]},{21:[2,24],31:[2,24],52:[2,24],59:[2,24],62:[2,24],66:[2,24],69:[2,24],74:[2,24],75:[2,24],76:[2,24],77:[2,24],78:[2,24],79:[2,24]},{21:[2,25],31:[2,25],52:[2,25],59:[2,25],62:[2,25],66:[2,25],69:[2,25],74:[2,25],75:[2,25],76:[2,25],77:[2,25],78:[2,25],79:[2,25]},{21:[2,27],31:[2,27],52:[2,27],62:[2,27],65:94,66:[1,95],69:[2,27]},{21:[2,89],31:[2,89],52:[2,89],62:[2,89],66:[2,89],69:[2,89]},{21:[2,42],31:[2,42],52:[2,42],59:[2,42],62:[2,42],66:[2,42],67:[1,96],69:[2,42],74:[2,42],75:[2,42],76:[2,42],77:[2,42],78:[2,42],79:[2,42],81:[2,42]},{21:[2,41],31:[2,41],52:[2,41],59:[2,41],62:[2,41],66:[2,41],69:[2,41],74:[2,41],75:[2,41],76:[2,41],77:[2,41],78:[2,41],79:[2,41],81:[2,41]},{52:[1,97]},{52:[2,78],59:[2,78],66:[2,78],74:[2,78],75:[2,78],76:[2,78],77:[2,78],78:[2,78],79:[2,78]},{52:[2,80]},{5:[2,12],13:[2,12],14:[2,12],17:[2,12],27:[2,12],32:[2,12],37:[2,12],42:[2,12],45:[2,12],46:[2,12],49:[2,12],53:[2,12]},{18:98,66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{36:50,37:[1,52],41:51,42:[1,53],43:100,44:99,45:[2,71]},{31:[2,65],38:101,59:[2,65],66:[2,65],69:[2,65],74:[2,65],75:[2,65],76:[2,65],77:[2,65],78:[2,65],79:[2,65]},{45:[2,17]},{5:[2,13],13:[2,13],14:[2,13],17:[2,13],27:[2,13],32:[2,13],37:[2,13],42:[2,13],45:[2,13],46:[2,13],49:[2,13],53:[2,13]},{31:[1,102]},{31:[2,82],59:[2,82],66:[2,82],74:[2,82],75:[2,82],76:[2,82],77:[2,82],78:[2,82],79:[2,82]},{31:[2,84]},{18:65,57:104,58:66,59:[1,40],61:103,62:[2,87],63:105,64:67,65:68,66:[1,69],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{30:106,31:[2,57],68:107,69:[1,108]},{31:[2,54],59:[2,54],66:[2,54],69:[2,54],74:[2,54],75:[2,54],76:[2,54],77:[2,54],78:[2,54],79:[2,54]},{31:[2,56],69:[2,56]},{31:[2,63],35:109,68:110,69:[1,108]},{31:[2,60],59:[2,60],66:[2,60],69:[2,60],74:[2,60],75:[2,60],76:[2,60],77:[2,60],78:[2,60],79:[2,60]},{31:[2,62],69:[2,62]},{21:[1,111]},{21:[2,46],59:[2,46],66:[2,46],74:[2,46],75:[2,46],76:[2,46],77:[2,46],78:[2,46],79:[2,46]},{21:[2,48]},{5:[2,21],13:[2,21],14:[2,21],17:[2,21],27:[2,21],32:[2,21],37:[2,21],42:[2,21],45:[2,21],46:[2,21],49:[2,21],53:[2,21]},{21:[2,90],31:[2,90],52:[2,90],62:[2,90],66:[2,90],69:[2,90]},{67:[1,96]},{18:65,57:112,58:66,59:[1,40],66:[1,32],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,22],13:[2,22],14:[2,22],17:[2,22],27:[2,22],32:[2,22],37:[2,22],42:[2,22],45:[2,22],46:[2,22],49:[2,22],53:[2,22]},{31:[1,113]},{45:[2,18]},{45:[2,72]},{18:65,31:[2,67],39:114,57:115,58:66,59:[1,40],63:116,64:67,65:68,66:[1,69],69:[2,67],72:23,73:24,74:[1,25],75:[1,26],76:[1,27],77:[1,28],78:[1,29],79:[1,31],80:30},{5:[2,23],13:[2,23],14:[2,23],17:[2,23],27:[2,23],32:[2,23],37:[2,23],42:[2,23],45:[2,23],46:[2,23],49:[2,23],53:[2,23]},{62:[1,117]},{59:[2,86],62:[2,86],66:[2,86],74:[2,86],75:[2,86],76:[2,86],77:[2,86],78:[2,86],79:[2,86]},{62:[2,88]},{31:[1,118]},{31:[2,58]},{66:[1,120],70:119},{31:[1,121]},{31:[2,64]},{14:[2,11]},{21:[2,28],31:[2,28],52:[2,28],62:[2,28],66:[2,28],69:[2,28]},{5:[2,20],13:[2,20],14:[2,20],17:[2,20],27:[2,20],32:[2,20],37:[2,20],42:[2,20],45:[2,20],46:[2,20],49:[2,20],53:[2,20]},{31:[2,69],40:122,68:123,69:[1,108]},{31:[2,66],59:[2,66],66:[2,66],69:[2,66],74:[2,66],75:[2,66],76:[2,66],77:[2,66],78:[2,66],79:[2,66]},{31:[2,68],69:[2,68]},{21:[2,26],31:[2,26],52:[2,26],59:[2,26],62:[2,26],66:[2,26],69:[2,26],74:[2,26],75:[2,26],76:[2,26],77:[2,26],78:[2,26],79:[2,26]},{13:[2,14],14:[2,14],17:[2,14],27:[2,14],32:[2,14],37:[2,14],42:[2,14],45:[2,14],46:[2,14],49:[2,14],53:[2,14]},{66:[1,125],71:[1,124]},{66:[2,91],71:[2,91]},{13:[2,15],14:[2,15],17:[2,15],27:[2,15],32:[2,15],42:[2,15],45:[2,15],46:[2,15],49:[2,15],53:[2,15]},{31:[1,126]},{31:[2,70]},{31:[2,29]},{66:[2,92],71:[2,92]},{13:[2,16],14:[2,16],17:[2,16],27:[2,16],32:[2,16],37:[2,16],42:[2,16],45:[2,16],46:[2,16],49:[2,16],53:[2,16]}],defaultActions:{4:[2,1],49:[2,50],51:[2,19],55:[2,52],64:[2,76],73:[2,80],78:[2,17],82:[2,84],92:[2,48],99:[2,18],100:[2,72],105:[2,88],107:[2,58],110:[2,64],111:[2,11],123:[2,70],124:[2,29]},parseError:function(e,t){throw new Error(e)},parse:function(e){var t=this,n=[0],i=[null],r=[],a=this.table,s="",o=0,l=0,c=0;this.lexer.setInput(e),this.lexer.yy=this.yy,this.yy.lexer=this.lexer,this.yy.parser=this,void 0===this.lexer.yylloc&&(this.lexer.yylloc={});var u=this.lexer.yylloc;r.push(u);var d=this.lexer.options&&this.lexer.options.ranges;"function"==typeof this.yy.parseError&&(this.parseError=this.yy.parseError);for(var h,p,f,g,m,b,v,y,w,_={};;){if(f=n[n.length-1],this.defaultActions[f]?g=this.defaultActions[f]:(null!==h&&void 0!==h||(h=function(){var e;return"number"!=typeof(e=t.lexer.lex()||1)&&(e=t.symbols_[e]||e),e}()),g=a[f]&&a[f][h]),void 0===g||!g.length||!g[0]){var x="";if(!c){w=[];for(b in a[f])this.terminals_[b]&&b>2&&w.push("'"+this.terminals_[b]+"'");x=this.lexer.showPosition?"Parse error on line "+(o+1)+":\n"+this.lexer.showPosition()+"\nExpecting "+w.join(", ")+", got '"+(this.terminals_[h]||h)+"'":"Parse error on line "+(o+1)+": Unexpected "+(1==h?"end of input":"'"+(this.terminals_[h]||h)+"'"),this.parseError(x,{text:this.lexer.match,token:this.terminals_[h]||h,line:this.lexer.yylineno,loc:u,expected:w})}}if(g[0]instanceof Array&&g.length>1)throw new Error("Parse Error: multiple actions possible at state: "+f+", token: "+h);switch(g[0]){case 1:n.push(h),i.push(this.lexer.yytext),r.push(this.lexer.yylloc),n.push(g[1]),h=null,p?(h=p,p=null):(l=this.lexer.yyleng,s=this.lexer.yytext,o=this.lexer.yylineno,u=this.lexer.yylloc,c>0&&c--);break;case 2:if(v=this.productions_[g[1]][1],_.$=i[i.length-v],_._$={first_line:r[r.length-(v||1)].first_line,last_line:r[r.length-1].last_line,first_column:r[r.length-(v||1)].first_column,last_column:r[r.length-1].last_column},d&&(_._$.range=[r[r.length-(v||1)].range[0],r[r.length-1].range[1]]),void 0!==(m=this.performAction.call(_,s,l,o,this.yy,g[1],i,r)))return m;v&&(n=n.slice(0,-1*v*2),i=i.slice(0,-1*v),r=r.slice(0,-1*v)),n.push(this.productions_[g[1]][0]),i.push(_.$),r.push(_._$),y=a[n[n.length-2]][n[n.length-1]],n.push(y);break;case 3:return!0}}return!0}},n=function(){var e={EOF:1,parseError:function(e,t){if(!this.yy.parser)throw new Error(e);this.yy.parser.parseError(e,t)},setInput:function(e){return this._input=e,this._more=this._less=this.done=!1,this.yylineno=this.yyleng=0,this.yytext=this.matched=this.match="",this.conditionStack=["INITIAL"],this.yylloc={first_line:1,first_column:0,last_line:1,last_column:0},this.options.ranges&&(this.yylloc.range=[0,0]),this.offset=0,this},input:function(){var e=this._input[0];return this.yytext+=e,this.yyleng++,this.offset++,this.match+=e,this.matched+=e,e.match(/(?:\r\n?|\n).*/g)?(this.yylineno++,this.yylloc.last_line++):this.yylloc.last_column++,this.options.ranges&&this.yylloc.range[1]++,this._input=this._input.slice(1),e},unput:function(e){var t=e.length,n=e.split(/(?:\r\n?|\n)/g);this._input=e+this._input,this.yytext=this.yytext.substr(0,this.yytext.length-t-1),this.offset-=t;var i=this.match.split(/(?:\r\n?|\n)/g);this.match=this.match.substr(0,this.match.length-1),this.matched=this.matched.substr(0,this.matched.length-1),n.length-1&&(this.yylineno-=n.length-1);var r=this.yylloc.range;return this.yylloc={first_line:this.yylloc.first_line,last_line:this.yylineno+1,first_column:this.yylloc.first_column,last_column:n?(n.length===i.length?this.yylloc.first_column:0)+i[i.length-n.length].length-n[0].length:this.yylloc.first_column-t},this.options.ranges&&(this.yylloc.range=[r[0],r[0]+this.yyleng-t]),this},more:function(){return this._more=!0,this},less:function(e){this.unput(this.match.slice(e))},pastInput:function(){var e=this.matched.substr(0,this.matched.length-this.match.length);return(e.length>20?"...":"")+e.substr(-20).replace(/\n/g,"")},upcomingInput:function(){var e=this.match;return e.length<20&&(e+=this._input.substr(0,20-e.length)),(e.substr(0,20)+(e.length>20?"...":"")).replace(/\n/g,"")},showPosition:function(){var e=this.pastInput(),t=new Array(e.length+1).join("-");return e+this.upcomingInput()+"\n"+t+"^"},next:function(){if(this.done)return this.EOF;this._input||(this.done=!0);var e,t,n,i,r;this._more||(this.yytext="",this.match="");for(var a=this._currentRules(),s=0;s<a.length&&(!(n=this._input.match(this.rules[a[s]]))||t&&!(n[0].length>t[0].length)||(t=n,i=s,this.options.flex));s++);return t?((r=t[0].match(/(?:\r\n?|\n).*/g))&&(this.yylineno+=r.length),this.yylloc={first_line:this.yylloc.last_line,last_line:this.yylineno+1,first_column:this.yylloc.last_column,last_column:r?r[r.length-1].length-r[r.length-1].match(/\r?\n?/)[0].length:this.yylloc.last_column+t[0].length},this.yytext+=t[0],this.match+=t[0],this.matches=t,this.yyleng=this.yytext.length,this.options.ranges&&(this.yylloc.range=[this.offset,this.offset+=this.yyleng]),this._more=!1,this._input=this._input.slice(t[0].length),this.matched+=t[0],e=this.performAction.call(this,this.yy,this,a[i],this.conditionStack[this.conditionStack.length-1]),this.done&&this._input&&(this.done=!1),e||void 0):""===this._input?this.EOF:this.parseError("Lexical error on line "+(this.yylineno+1)+". Unrecognized text.\n"+this.showPosition(),{text:"",token:null,line:this.yylineno})},lex:function(){var e=this.next();return void 0!==e?e:this.lex()},begin:function(e){this.conditionStack.push(e)},popState:function(){return this.conditionStack.pop()},_currentRules:function(){return this.conditions[this.conditionStack[this.conditionStack.length-1]].rules},topState:function(){return this.conditionStack[this.conditionStack.length-2]},pushState:function(e){this.begin(e)}};return e.options={},e.performAction=function(e,t,n,i){function r(e,n){return t.yytext=t.yytext.substr(e,t.yyleng-n)}switch(n){case 0:if("\\\\"===t.yytext.slice(-2)?(r(0,1),this.begin("mu")):"\\"===t.yytext.slice(-1)?(r(0,1),this.begin("emu")):this.begin("mu"),t.yytext)return 14;break;case 1:return 14;case 2:return this.popState(),14;case 3:return t.yytext=t.yytext.substr(5,t.yyleng-9),this.popState(),16;case 4:return 14;case 5:return this.popState(),13;case 6:return 59;case 7:return 62;case 8:return 17;case 9:return this.popState(),this.begin("raw"),21;case 10:return 53;case 11:return 27;case 12:return 45;case 13:case 14:return this.popState(),42;case 15:return 32;case 16:return 37;case 17:return 49;case 18:return 46;case 19:this.unput(t.yytext),this.popState(),this.begin("com");break;case 20:return this.popState(),13;case 21:return 46;case 22:return 67;case 23:case 24:return 66;case 25:return 81;case 26:break;case 27:return this.popState(),52;case 28:return this.popState(),31;case 29:return t.yytext=r(1,2).replace(/\\"/g,'"'),74;case 30:return t.yytext=r(1,2).replace(/\\'/g,"'"),74;case 31:return 79;case 32:case 33:return 76;case 34:return 77;case 35:return 78;case 36:return 75;case 37:return 69;case 38:return 71;case 39:case 40:return 66;case 41:return"INVALID";case 42:return 5}},e.rules=[/^(?:[^\x00]*?(?=(\{\{)))/,/^(?:[^\x00]+)/,/^(?:[^\x00]{2,}?(?=(\{\{|\\\{\{|\\\\\{\{|$)))/,/^(?:\{\{\{\{\/[^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=[=}\s\/.])\}\}\}\})/,/^(?:[^\x00]*?(?=(\{\{\{\{\/)))/,/^(?:[\s\S]*?--(~)?\}\})/,/^(?:\()/,/^(?:\))/,/^(?:\{\{\{\{)/,/^(?:\}\}\}\})/,/^(?:\{\{(~)?>)/,/^(?:\{\{(~)?#)/,/^(?:\{\{(~)?\/)/,/^(?:\{\{(~)?\^\s*(~)?\}\})/,/^(?:\{\{(~)?\s*else\s*(~)?\}\})/,/^(?:\{\{(~)?\^)/,/^(?:\{\{(~)?\s*else\b)/,/^(?:\{\{(~)?\{)/,/^(?:\{\{(~)?&)/,/^(?:\{\{(~)?!--)/,/^(?:\{\{(~)?![\s\S]*?\}\})/,/^(?:\{\{(~)?)/,/^(?:=)/,/^(?:\.\.)/,/^(?:\.(?=([=~}\s\/.)|])))/,/^(?:[\/.])/,/^(?:\s+)/,/^(?:\}(~)?\}\})/,/^(?:(~)?\}\})/,/^(?:"(\\["]|[^"])*")/,/^(?:'(\\[']|[^'])*')/,/^(?:@)/,/^(?:true(?=([~}\s)])))/,/^(?:false(?=([~}\s)])))/,/^(?:undefined(?=([~}\s)])))/,/^(?:null(?=([~}\s)])))/,/^(?:-?[0-9]+(?:\.[0-9]+)?(?=([~}\s)])))/,/^(?:as\s+\|)/,/^(?:\|)/,/^(?:([^\s!"#%-,\.\/;->@\[-\^`\{-~]+(?=([=~}\s\/.)|]))))/,/^(?:\[[^\]]*\])/,/^(?:.)/,/^(?:$)/],e.conditions={mu:{rules:[6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42],inclusive:!1},emu:{rules:[2],inclusive:!1},com:{rules:[5],inclusive:!1},raw:{rules:[3,4],inclusive:!1},INITIAL:{rules:[0,1,42],inclusive:!0}},e}();return t.lexer=n,e.prototype=t,t.Parser=e,new e}();t.default=i,e.exports=t.default},function(e,t,n){"use strict";function i(){}function r(e,t,n){void 0===t&&(t=e.length);var i=e[t-1],r=e[t-2];return i?"ContentStatement"===i.type?(r||!n?/\r?\n\s*?$/:/(^|\r?\n)\s*?$/).test(i.original):void 0:n}function a(e,t,n){void 0===t&&(t=-1);var i=e[t+1],r=e[t+2];return i?"ContentStatement"===i.type?(r||!n?/^\s*?\r?\n/:/^\s*?(\r?\n|$)/).test(i.original):void 0:n}function s(e,t,n){var i=e[null==t?0:t+1];if(i&&"ContentStatement"===i.type&&(n||!i.rightStripped)){var r=i.value;i.value=i.value.replace(n?/^\s+/:/^[ \t]*\r?\n?/,""),i.rightStripped=i.value!==r}}function o(e,t,n){var i=e[null==t?e.length-1:t-1];if(i&&"ContentStatement"===i.type&&(n||!i.leftStripped)){var r=i.value;return i.value=i.value.replace(n?/\s+$/:/[ \t]+$/,""),i.leftStripped=i.value!==r,i.leftStripped}}var l=n(8).default;t.__esModule=!0;var c=l(n(6));(i.prototype=new c.default).Program=function(e){var t=!this.isRootSeen;this.isRootSeen=!0;for(var n=e.body,i=0,l=n.length;i<l;i++){var c=n[i],u=this.accept(c);if(u){var d=r(n,i,t),h=a(n,i,t),p=u.openStandalone&&d,f=u.closeStandalone&&h,g=u.inlineStandalone&&d&&h;u.close&&s(n,i,!0),u.open&&o(n,i,!0),g&&(s(n,i),o(n,i)&&"PartialStatement"===c.type&&(c.indent=/([ \t]+$)/.exec(n[i-1].original)[1])),p&&(s((c.program||c.inverse).body),o(n,i)),f&&(s(n,i),o((c.inverse||c.program).body))}}return e},i.prototype.BlockStatement=function(e){this.accept(e.program),this.accept(e.inverse);var t=e.program||e.inverse,n=e.program&&e.inverse,i=n,l=n;if(n&&n.chained)for(i=n.body[0].program;l.chained;)l=l.body[l.body.length-1].program;var c={open:e.openStrip.open,close:e.closeStrip.close,openStandalone:a(t.body),closeStandalone:r((i||t).body)};if(e.openStrip.close&&s(t.body,null,!0),n){var u=e.inverseStrip;u.open&&o(t.body,null,!0),u.close&&s(i.body,null,!0),e.closeStrip.open&&o(l.body,null,!0),r(t.body)&&a(i.body)&&(o(t.body),s(i.body))}else e.closeStrip.open&&o(t.body,null,!0);return c},i.prototype.MustacheStatement=function(e){return e.strip},i.prototype.PartialStatement=i.prototype.CommentStatement=function(e){var t=e.strip||{};return{inlineStandalone:!0,open:t.open,close:t.close}},t.default=i,e.exports=t.default},function(e,t,n){"use strict";var i=n(8).default;t.__esModule=!0,t.SourceLocation=function(e,t){this.source=e,this.start={line:t.first_line,column:t.first_column},this.end={line:t.last_line,column:t.last_column}},t.id=function(e){return/^\[.*\]$/.test(e)?e.substr(1,e.length-2):e},t.stripFlags=function(e,t){return{open:"~"===e.charAt(2),close:"~"===t.charAt(t.length-3)}},t.stripComment=function(e){return e.replace(/^\{\{~?\!-?-?/,"").replace(/-?-?~?\}\}$/,"")},t.preparePath=function(e,t,n){n=this.locInfo(n);for(var i=e?"@":"",a=[],s=0,o=0,l=t.length;o<l;o++){var c=t[o].part,u=t[o].original!==c;if(i+=(t[o].separator||"")+c,u||".."!==c&&"."!==c&&"this"!==c)a.push(c);else{if(a.length>0)throw new r.default("Invalid path: "+i,{loc:n});".."===c&&s++}}return new this.PathExpression(e,s,a,i,n)},t.prepareMustache=function(e,t,n,i,r,a){var s=i.charAt(3)||i.charAt(2),o="{"!==s&&"&"!==s;return new this.MustacheStatement(e,t,n,o,r,this.locInfo(a))},t.prepareRawBlock=function(e,t,n,i){if(e.path.original!==n){var a={loc:e.path.loc};throw new r.default(e.path.original+" doesn't match "+n,a)}i=this.locInfo(i);var s=new this.Program([t],null,{},i);return new this.BlockStatement(e.path,e.params,e.hash,s,void 0,{},{},{},i)},t.prepareBlock=function(e,t,n,i,a,s){if(i&&i.path&&e.path.original!==i.path.original){var o={loc:e.path.loc};throw new r.default(e.path.original+" doesn't match "+i.path.original,o)}t.blockParams=e.blockParams;var l=void 0,c=void 0;return n&&(n.chain&&(n.program.body[0].closeStrip=i.strip),c=n.strip,l=n.program),a&&(a=l,l=t,t=a),new this.BlockStatement(e.path,e.params,e.hash,t,l,e.strip,c,i&&i.strip,this.locInfo(s))};var r=i(n(12))},function(e,t,n){"use strict";function i(e,t,n){if(a.isArray(e)){for(var i=[],r=0,s=e.length;r<s;r++)i.push(t.wrap(e[r],n));return i}return"boolean"==typeof e||"number"==typeof e?e+"":e}function r(e){this.srcFile=e,this.source=[]}t.__esModule=!0;var a=n(13),s=void 0;try{}catch(e){}s||((s=function(e,t,n,i){this.src="",i&&this.add(i)}).prototype={add:function(e){a.isArray(e)&&(e=e.join("")),this.src+=e},prepend:function(e){a.isArray(e)&&(e=e.join("")),this.src=e+this.src},toStringWithSourceMap:function(){return{code:this.toString()}},toString:function(){return this.src}}),r.prototype={prepend:function(e,t){this.source.unshift(this.wrap(e,t))},push:function(e,t){this.source.push(this.wrap(e,t))},merge:function(){var e=this.empty();return this.each(function(t){e.add(["  ",t,"\n"])}),e},each:function(e){for(var t=0,n=this.source.length;t<n;t++)e(this.source[t])},empty:function(){var e=void 0===arguments[0]?this.currentLocation||{start:{}}:arguments[0];return new s(e.start.line,e.start.column,this.srcFile)},wrap:function(e){var t=void 0===arguments[1]?this.currentLocation||{start:{}}:arguments[1];return e instanceof s?e:(e=i(e,this,t),new s(t.start.line,t.start.column,this.srcFile,e))},functionCall:function(e,t,n){return n=this.generateList(n),this.wrap([e,t?"."+t+"(":"(",n,")"])},quotedString:function(e){return'"'+(e+"").replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")+'"'},objectLiteral:function(e){var t=[];for(var n in e)if(e.hasOwnProperty(n)){var r=i(e[n],this);"undefined"!==r&&t.push([this.quotedString(n),":",r])}var a=this.generateList(t);return a.prepend("{"),a.add("}"),a},generateList:function(e,t){for(var n=this.empty(t),r=0,a=e.length;r<a;r++)r&&n.add(","),n.add(i(e[r],this,t));return n},generateArray:function(e,t){var n=this.generateList(e,t);return n.prepend("["),n.add("]"),n}},t.default=r,e.exports=t.default}])}),function(){function e(e,t,n){for(var i=(n||0)-1,r=e?e.length:0;++i<r;)if(e[i]===t)return i;return-1}function t(t,n){var i=typeof n;if(t=t.cache,"boolean"==i||null==n)return t[n]?0:-1;"number"!=i&&"string"!=i&&(i="object");var r="number"==i?n:y+n;return t=(t=t[i])&&t[r],"object"==i?t&&e(t,n)>-1?0:-1:t?0:-1}function n(e){var t=this.cache,n=typeof e;if("boolean"==n||null==e)t[e]=!0;else{"number"!=n&&"string"!=n&&(n="object");var i="number"==n?e:y+e,r=t[n]||(t[n]={});"object"==n?(r[i]||(r[i]=[])).push(e):r[i]=!0}}function i(e){return e.charCodeAt(0)}function r(e,t){for(var n=e.criteria,i=t.criteria,r=-1,a=n.length;++r<a;){var s=n[r],o=i[r];if(s!==o){if(s>o||void 0===s)return 1;if(s<o||void 0===o)return-1}}return e.index-t.index}function a(e){var t=-1,i=e.length,r=e[0],a=e[i/2|0],s=e[i-1];if(r&&"object"==typeof r&&a&&"object"==typeof a&&s&&"object"==typeof s)return!1;var o=l();o.false=o.null=o.true=o.undefined=!1;var c=l();for(c.array=e,c.cache=o,c.push=n;++t<i;)c.push(e[t]);return c}function s(e){return"\\"+X[e]}function o(){return g.pop()||[]}function l(){return m.pop()||{array:null,cache:null,criteria:null,false:!1,index:0,null:!1,number:null,object:null,push:null,string:null,true:!1,undefined:!1,value:null}}function c(e){return"function"!=typeof e.toString&&"string"==typeof(e+"")}function u(e){e.length=0,g.length<_&&g.push(e)}function d(e){var t=e.cache;t&&d(t),e.array=e.cache=e.criteria=e.object=e.number=e.string=e.value=null,m.length<_&&m.push(e)}function h(e,t,n){t||(t=0),void 0===n&&(n=e?e.length:0);for(var i=-1,r=n-t||0,a=Array(r<0?0:r);++i<r;)a[i]=e[t+i];return a}function p(n){function g(e){return e&&"object"==typeof e&&!Ht(e)&&St.call(e,"__wrapped__")?e:new m(e)}function m(e,t){this.__chain__=!!t,this.__wrapped__=e}function _(e){function t(){if(i){var e=h(i);Et.apply(e,arguments)}if(this instanceof t){var a=te(n.prototype),s=n.apply(a,e||arguments);return Ee(s)?s:a}return n.apply(r,e||arguments)}var n=e[0],i=e[2],r=e[4];return Ut(t,e),t}function X(e,t,n,i,r){if(n){var a=n(e);if(void 0!==a)return a}if(!Ee(e))return e;var s=mt.call(e);if(!W[s]||!Vt.nodeClass&&c(e))return e;var l=Ft[s];switch(s){case B:case V:return new l(+e);case H:case J:return new l(e);case G:return a=l(e.source,P.exec(e)),a.lastIndex=e.lastIndex,a}var d=Ht(e);if(t){var p=!i;i||(i=o()),r||(r=o());for(var f=i.length;f--;)if(i[f]==e)return r[f];a=d?l(e.length):{}}else a=d?h(e):tn({},e);return d&&(St.call(e,"index")&&(a.index=e.index),St.call(e,"input")&&(a.input=e.input)),t?(i.push(e),r.push(a),(d?en:an)(e,function(e,s){a[s]=X(e,t,n,i,r)}),p&&(u(i),u(r)),a):a}function te(e,t){return Ee(e)?Ot(e):{}}function ne(e,t,n){if("function"!=typeof e)return Qe;if(void 0===t||!("prototype"in e))return e;var i=e.__bindData__;if(void 0===i&&(Vt.funcNames&&(i=!e.name),!(i=i||!Vt.funcDecomp))){var r=_t.call(e);Vt.funcNames||(i=!M.test(r)),i||(i=D.test(r),Ut(e,i))}if(!1===i||!0!==i&&1&i[1])return e;switch(n){case 1:return function(n){return e.call(t,n)};case 2:return function(n,i){return e.call(t,n,i)};case 3:return function(n,i,r){return e.call(t,n,i,r)};case 4:return function(n,i,r,a){return e.call(t,n,i,r,a)}}return Je(e,t)}function ie(e){function t(){var e=l?s:this;if(r){var f=h(r);Et.apply(f,arguments)}if((a||u)&&(f||(f=h(arguments)),a&&Et.apply(f,a),u&&f.length<o))return i|=16,ie([n,d?i:-4&i,f,null,s,o]);if(f||(f=arguments),c&&(n=e[p]),this instanceof t){e=te(n.prototype);var g=n.apply(e,f);return Ee(g)?g:e}return n.apply(e,f)}var n=e[0],i=e[1],r=e[2],a=e[3],s=e[4],o=e[5],l=1&i,c=2&i,u=4&i,d=8&i,p=n;return Ut(t,e),t}function re(n,i){var r=-1,s=ge(),o=n?n.length:0,l=o>=w&&s===e,c=[];if(l){var u=a(i);u?(s=t,i=u):l=!1}for(;++r<o;){var h=n[r];s(i,h)<0&&c.push(h)}return l&&d(i),c}function se(e,t,n,i){for(var r=(i||0)-1,a=e?e.length:0,s=[];++r<a;){var o=e[r];if(o&&"object"==typeof o&&"number"==typeof o.length&&(Ht(o)||ye(o))){t||(o=se(o,t,n));var l=-1,c=o.length,u=s.length;for(s.length+=c;++l<c;)s[u++]=o[l]}else n||s.push(o)}return s}function oe(e,t,n,i,r,a){if(n){var s=n(e,t);if(void 0!==s)return!!s}if(e===t)return 0!==e||1/e==1/t;var l=typeof e,d=typeof t;if(!(e!==e||e&&Z[l]||t&&Z[d]))return!1;if(null==e||null==t)return e===t;var h=mt.call(e),p=mt.call(t);if(h==L&&(h=z),p==L&&(p=z),h!=p)return!1;switch(h){case B:case V:return+e==+t;case H:return e!=+e?t!=+t:0==e?1/e==1/t:e==+t;case G:case J:return e==ct(t)}var f=h==F;if(!f){var g=St.call(e,"__wrapped__"),m=St.call(t,"__wrapped__");if(g||m)return oe(g?e.__wrapped__:e,m?t.__wrapped__:t,n,i,r,a);if(h!=z||!Vt.nodeClass&&(c(e)||c(t)))return!1;var b=!Vt.argsObject&&ye(e)?ot:e.constructor,v=!Vt.argsObject&&ye(t)?ot:t.constructor;if(b!=v&&!(Se(b)&&b instanceof b&&Se(v)&&v instanceof v)&&"constructor"in e&&"constructor"in t)return!1}var y=!r;r||(r=o()),a||(a=o());for(var w=r.length;w--;)if(r[w]==e)return a[w]==t;var _=0;if(s=!0,r.push(e),a.push(t),f){if(w=e.length,_=t.length,(s=_==w)||i)for(;_--;){var x=w,S=t[_];if(i)for(;x--&&!(s=oe(e[x],S,n,i,r,a)););else if(!(s=oe(e[_],S,n,i,r,a)))break}}else rn(t,function(t,o,l){if(St.call(l,o))return _++,s=St.call(e,o)&&oe(e[o],t,n,i,r,a)}),s&&!i&&rn(e,function(e,t,n){if(St.call(n,t))return s=--_>-1});return r.pop(),a.pop(),y&&(u(r),u(a)),s}function le(e,t,n,i,r){(Ht(t)?Re:an)(t,function(t,a){var s,o,l=t,c=e[a];if(t&&((o=Ht(t))||sn(t))){for(var u=i.length;u--;)if(s=i[u]==t){c=r[u];break}if(!s){var d;n&&(d=void 0!==(l=n(c,t)))&&(c=l),d||(c=o?Ht(c)?c:[]:sn(c)?c:{}),i.push(t),r.push(c),d||le(c,t,n,i,r)}}else n&&void 0===(l=n(c,t))&&(l=t),void 0!==l&&(c=l);e[a]=c})}function ce(e,t){return e+wt(Lt()*(t-e+1))}function ue(n,i,r){var s=-1,l=ge(),c=n?n.length:0,h=[],p=!i&&c>=w&&l===e,f=r||p?o():h;for(p&&(l=t,f=a(f));++s<c;){var g=n[s],m=r?r(g,s,n):g;(i?!s||f[f.length-1]!==m:l(f,m)<0)&&((r||p)&&f.push(m),h.push(g))}return p?(u(f.array),d(f)):r&&u(f),h}function de(e){return function(t,n,i){var r={};if(n=g.createCallback(n,i,3),Ht(t))for(var a=-1,s=t.length;++a<s;){var o=t[a];e(r,o,n(o,a,t),t)}else en(t,function(t,i,a){e(r,t,n(t,i,a),a)});return r}}function he(e,t,n,i,r,a){var s=1&t,o=4&t,l=16&t,c=32&t;if(!(2&t)&&!Se(e))throw new ut;l&&!n.length&&(t&=-17,l=n=!1),c&&!i.length&&(t&=-33,c=i=!1);var u=e&&e.__bindData__;return u&&!0!==u?((u=h(u))[2]&&(u[2]=h(u[2])),u[3]&&(u[3]=h(u[3])),!s||1&u[1]||(u[4]=r),!s&&1&u[1]&&(t|=8),!o||4&u[1]||(u[5]=a),l&&Et.apply(u[2]||(u[2]=[]),n),c&&Pt.apply(u[3]||(u[3]=[]),i),u[1]|=t,he.apply(null,u)):(1==t||17===t?_:ie)([e,t,n,i,r,a])}function pe(){K.shadowedProps=N,K.array=K.bottom=K.loop=K.top="",K.init="iterable",K.useHas=!0;for(var e,t=0;e=arguments[t];t++)for(var n in e)K[n]=e[n];var i=K.args;return K.firstArg=/^[^,]+/.exec(i)[0],rt("baseCreateCallback, errorClass, errorProto, hasOwnProperty, indicatorObject, isArguments, isArray, isString, keys, objectProto, objectTypes, nonEnumProps, stringClass, stringProto, toString","return function("+i+") {\n"+$t(K)+"\n}")(ne,$,ht,St,v,ye,Ht,ke,K.keys,pt,Z,Bt,J,ft,mt)}function fe(e){return Yt[e]}function ge(){var t=(t=g.indexOf)===Ve?e:t;return t}function me(e){return"function"==typeof e&&bt.test(e)}function be(e){var t,n;return!(!(e&&mt.call(e)==z&&(t=e.constructor,!Se(t)||t instanceof t))||!Vt.argsClass&&ye(e)||!Vt.nodeClass&&c(e))&&(Vt.ownLast?(rn(e,function(e,t,i){return n=St.call(i,t),!1}),!1!==n):(rn(e,function(e,t){n=t}),void 0===n||St.call(e,n)))}function ve(e){return Kt[e]}function ye(e){return e&&"object"==typeof e&&"number"==typeof e.length&&mt.call(e)==L||!1}function we(e,t,n){var i=Gt(e),r=i.length;for(t=ne(t,n,3);r--;){var a=i[r];if(!1===t(e[a],a,e))break}return e}function _e(e){var t=[];return rn(e,function(e,n){Se(e)&&t.push(n)}),t.sort()}function xe(e){for(var t=-1,n=Gt(e),i=n.length,r={};++t<i;){var a=n[t];r[e[a]]=a}return r}function Se(e){return"function"==typeof e}function Ee(e){return!(!e||!Z[typeof e])}function Ae(e){return"number"==typeof e||e&&"object"==typeof e&&mt.call(e)==H||!1}function ke(e){return"string"==typeof e||e&&"object"==typeof e&&mt.call(e)==J||!1}function Ce(e){for(var t=-1,n=Gt(e),i=n.length,r=et(i);++t<i;)r[t]=e[n[t]];return r}function Pe(e,t,n){var i=-1,r=ge(),a=e?e.length:0,s=!1;return n=(n<0?jt(0,a+n):n)||0,Ht(e)?s=r(e,t,n)>-1:"number"==typeof a?s=(ke(e)?e.indexOf(t,n):r(e,t,n))>-1:en(e,function(e){if(++i>=n)return!(s=e===t)}),s}function Me(e,t,n){var i=!0;if(t=g.createCallback(t,n,3),Ht(e))for(var r=-1,a=e.length;++r<a&&(i=!!t(e[r],r,e)););else en(e,function(e,n,r){return i=!!t(e,n,r)});return i}function Oe(e,t,n){var i=[];if(t=g.createCallback(t,n,3),Ht(e))for(var r=-1,a=e.length;++r<a;){var s=e[r];t(s,r,e)&&i.push(s)}else en(e,function(e,n,r){t(e,n,r)&&i.push(e)});return i}function Te(e,t,n){if(t=g.createCallback(t,n,3),!Ht(e)){var i;return en(e,function(e,n,r){if(t(e,n,r))return i=e,!1}),i}for(var r=-1,a=e.length;++r<a;){var s=e[r];if(t(s,r,e))return s}}function Re(e,t,n){if(t&&void 0===n&&Ht(e))for(var i=-1,r=e.length;++i<r&&!1!==t(e[i],i,e););else en(e,t,n);return e}function De(e,t,n){var i=e,r=e?e.length:0;if(t=t&&void 0===n?t:ne(t,n,3),Ht(e))for(;r--&&!1!==t(e[r],r,e););else{if("number"!=typeof r){var a=Gt(e);r=a.length}else Vt.unindexedChars&&ke(e)&&(i=e.split(""));en(e,function(e,n,s){return n=a?a[--r]:--r,t(i[n],n,s)})}return e}function Ie(e,t,n){var i=-1,r=e?e.length:0,a=et("number"==typeof r?r:0);if(t=g.createCallback(t,n,3),Ht(e))for(;++i<r;)a[i]=t(e[i],i,e);else en(e,function(e,n,r){a[++i]=t(e,n,r)});return a}function je(e,t,n){var r=-1/0,a=r;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&Ht(e))for(var s=-1,o=e.length;++s<o;){var l=e[s];l>a&&(a=l)}else t=null==t&&ke(e)?i:g.createCallback(t,n,3),en(e,function(e,n,i){var s=t(e,n,i);s>r&&(r=s,a=e)});return a}function Ne(e,t,n,i){var r=arguments.length<3;if(t=g.createCallback(t,i,4),Ht(e)){var a=-1,s=e.length;for(r&&(n=e[++a]);++a<s;)n=t(n,e[a],a,e)}else en(e,function(e,i,a){n=r?(r=!1,e):t(n,e,i,a)});return n}function qe(e,t,n,i){var r=arguments.length<3;return t=g.createCallback(t,i,4),De(e,function(e,i,a){n=r?(r=!1,e):t(n,e,i,a)}),n}function Le(e){var t=-1,n=e?e.length:0,i=et("number"==typeof n?n:0);return Re(e,function(e){var n=ce(0,++t);i[t]=i[n],i[n]=e}),i}function Fe(e,t,n){var i;if(t=g.createCallback(t,n,3),Ht(e))for(var r=-1,a=e.length;++r<a&&!(i=t(e[r],r,e)););else en(e,function(e,n,r){return!(i=t(e,n,r))});return!!i}function Be(e,t,n){var i=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var a=-1;for(t=g.createCallback(t,n,3);++a<r&&t(e[a],a,e);)i++}else if(null==(i=t)||n)return e?e[0]:f;return h(e,0,Nt(jt(0,i),r))}function Ve(t,n,i){if("number"==typeof i){var r=t?t.length:0;i=i<0?jt(0,r+i):i||0}else if(i){var a=Ue(t,n);return t[a]===n?a:-1}return e(t,n,i)}function $e(e,t,n){if("number"!=typeof t&&null!=t){var i=0,r=-1,a=e?e.length:0;for(t=g.createCallback(t,n,3);++r<a&&t(e[r],r,e);)i++}else i=null==t||n?1:jt(0,t);return h(e,i)}function Ue(e,t,n,i){var r=0,a=e?e.length:r;for(t=(n=n?g.createCallback(n,i,1):Qe)(t);r<a;){var s=r+a>>>1;n(e[s])<t?r=s+1:a=s}return r}function He(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(n=g.createCallback(n,i,3)),ue(e,t,n)}function ze(){for(var e=arguments.length>1?arguments:arguments[0],t=-1,n=e?je(un(e,"length")):0,i=et(n<0?0:n);++t<n;)i[t]=un(e,t);return i}function Ge(e,t){var n=-1,i=e?e.length:0,r={};for(t||!i||Ht(e[0])||(t=[]);++n<i;){var a=e[n];t?r[a]=t[n]:a&&(r[a[0]]=a[1])}return r}function Je(e,t){return arguments.length>2?he(e,17,h(arguments,2),null,t):he(e,1,null,null,t)}function We(e,t,n){var i,r,a,s,o,l,c,u=0,d=!1,h=!0;if(!Se(e))throw new ut;if(t=jt(0,t)||0,!0===n){var p=!0;h=!1}else Ee(n)&&(p=n.leading,d="maxWait"in n&&(jt(t,n.maxWait)||0),h="trailing"in n?n.trailing:h);var g=function(){var n=t-(hn()-s);if(n<=0){r&&yt(r);var d=c;r=l=c=f,d&&(u=hn(),a=e.apply(o,i),l||r||(i=o=null))}else l=kt(g,n)},m=function(){l&&yt(l),r=l=c=f,(h||d!==t)&&(u=hn(),a=e.apply(o,i),l||r||(i=o=null))};return function(){if(i=arguments,s=hn(),o=this,c=h&&(l||!p),!1===d)var n=p&&!l;else{r||p||(u=s);var f=d-(s-u),b=f<=0;b?(r&&(r=yt(r)),u=s,a=e.apply(o,i)):r||(r=kt(m,f))}return b&&l?l=yt(l):l||t===d||(l=kt(g,t)),n&&(b=!0,a=e.apply(o,i)),!b||l||r||(i=o=null),a}}function Qe(e){return e}function Ye(e,t,n){var i=!0,r=t&&_e(t);t&&(n||r.length)||(null==n&&(n=t),a=m,t=e,e=g,r=_e(t)),!1===n?i=!1:Ee(n)&&"chain"in n&&(i=n.chain);var a=e,s=Se(a);Re(r,function(n){var r=e[n]=t[n];s&&(a.prototype[n]=function(){var t=this.__chain__,n=this.__wrapped__,s=[n];Et.apply(s,arguments);var o=r.apply(e,s);if(i||t){if(n===o&&Ee(o))return this;(o=new a(o)).__chain__=t}return o})})}function Ke(){}function Ze(e){return function(t){return t[e]}}function Xe(){return this.__wrapped__}var et=(n=n?ae.defaults(ee.Object(),n,ae.pick(ee,j)):ee).Array,tt=n.Boolean,nt=n.Date,it=n.Error,rt=n.Function,at=n.Math,st=n.Number,ot=n.Object,lt=n.RegExp,ct=n.String,ut=n.TypeError,dt=[],ht=it.prototype,pt=ot.prototype,ft=ct.prototype,gt=n._,mt=pt.toString,bt=lt("^"+ct(mt).replace(/[.*+?^${}()|[\]\\]/g,"\\$&").replace(/toString| for [^\]]+/g,".*?")+"$"),vt=at.ceil,yt=n.clearTimeout,wt=at.floor,_t=rt.prototype.toString,xt=me(xt=ot.getPrototypeOf)&&xt,St=pt.hasOwnProperty,Et=dt.push,At=pt.propertyIsEnumerable,kt=n.setTimeout,Ct=dt.splice,Pt=dt.unshift,Mt=function(){try{var e={},t=me(t=ot.defineProperty)&&t,n=t(e,e,e)&&t}catch(e){}return n}(),Ot=me(Ot=ot.create)&&Ot,Tt=me(Tt=et.isArray)&&Tt,Rt=n.isFinite,Dt=n.isNaN,It=me(It=ot.keys)&&It,jt=at.max,Nt=at.min,qt=n.parseInt,Lt=at.random,Ft={};Ft[F]=et,Ft[B]=tt,Ft[V]=nt,Ft[U]=rt,Ft[z]=ot,Ft[H]=st,Ft[G]=lt,Ft[J]=ct;var Bt={};Bt[F]=Bt[V]=Bt[H]={constructor:!0,toLocaleString:!0,toString:!0,valueOf:!0},Bt[B]=Bt[J]={constructor:!0,toString:!0,valueOf:!0},Bt[$]=Bt[U]=Bt[G]={constructor:!0,toString:!0},Bt[z]={constructor:!0},function(){for(var e=N.length;e--;){var t=N[e];for(var n in Bt)St.call(Bt,n)&&!St.call(Bt[n],t)&&(Bt[n][t]=!1)}}(),m.prototype=g.prototype;var Vt=g.support={};!function(){var e=function(){this.x=1},t={0:1,length:1},i=[];e.prototype={valueOf:1,y:1};for(var r in new e)i.push(r);for(r in arguments);Vt.argsClass=mt.call(arguments)==L,Vt.argsObject=arguments.constructor==ot&&!(arguments instanceof et),Vt.enumErrorProps=At.call(ht,"message")||At.call(ht,"name"),Vt.enumPrototypes=At.call(e,"prototype"),Vt.funcDecomp=!me(n.WinRTError)&&D.test(p),Vt.funcNames="string"==typeof rt.name,Vt.nonEnumArgs=0!=r,Vt.nonEnumShadows=!/valueOf/.test(i),Vt.ownLast="x"!=i[0],Vt.spliceObjects=(dt.splice.call(t,0,1),!t[0]),Vt.unindexedChars="x"[0]+ot("x")[0]!="xx";try{Vt.nodeClass=!(mt.call(document)==z&&!({toString:0}+""))}catch(e){Vt.nodeClass=!0}}(1),g.templateSettings={escape:/<%-([\s\S]+?)%>/g,evaluate:/<%([\s\S]+?)%>/g,interpolate:O,variable:"",imports:{_:g}};var $t=function(e){var t="var index, iterable = "+e.firstArg+", result = "+e.init+";\nif (!iterable) return result;\n"+e.top+";";e.array?(t+="\nvar length = iterable.length; index = -1;\nif ("+e.array+") {  ",Vt.unindexedChars&&(t+="\n  if (isString(iterable)) {\n    iterable = iterable.split('')\n  }  "),t+="\n  while (++index < length) {\n    "+e.loop+";\n  }\n}\nelse {  "):Vt.nonEnumArgs&&(t+="\n  var length = iterable.length; index = -1;\n  if (length && isArguments(iterable)) {\n    while (++index < length) {\n      index += '';\n      "+e.loop+";\n    }\n  } else {  "),Vt.enumPrototypes&&(t+="\n  var skipProto = typeof iterable == 'function';\n  "),Vt.enumErrorProps&&(t+="\n  var skipErrorProps = iterable === errorProto || iterable instanceof Error;\n  ");var n=[];if(Vt.enumPrototypes&&n.push('!(skipProto && index == "prototype")'),Vt.enumErrorProps&&n.push('!(skipErrorProps && (index == "message" || index == "name"))'),e.useHas&&e.keys)t+="\n  var ownIndex = -1,\n      ownProps = objectTypes[typeof iterable] && keys(iterable),\n      length = ownProps ? ownProps.length : 0;\n\n  while (++ownIndex < length) {\n    index = ownProps[ownIndex];\n",n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }  ";else if(t+="\n  for (index in iterable) {\n",e.useHas&&n.push("hasOwnProperty.call(iterable, index)"),n.length&&(t+="    if ("+n.join(" && ")+") {\n  "),t+=e.loop+";    ",n.length&&(t+="\n    }"),t+="\n  }    ",Vt.nonEnumShadows){for(t+="\n\n  if (iterable !== objectProto) {\n    var ctor = iterable.constructor,\n        isProto = iterable === (ctor && ctor.prototype),\n        className = iterable === stringProto ? stringClass : iterable === errorProto ? errorClass : toString.call(iterable),\n        nonEnum = nonEnumProps[className];\n      ",k=0;k<7;k++)t+="\n    index = '"+e.shadowedProps[k]+"';\n    if ((!(isProto && nonEnum[index]) && hasOwnProperty.call(iterable, index))",e.useHas||(t+=" || (!nonEnum[index] && iterable[index] !== objectProto[index])"),t+=") {\n      "+e.loop+";\n    }      ";t+="\n  }    "}return(e.array||Vt.nonEnumArgs)&&(t+="\n}"),t+=e.bottom+";\nreturn result"};Ot||(te=function(){function e(){}return function(t){if(Ee(t)){e.prototype=t;var i=new e;e.prototype=null}return i||n.Object()}}());var Ut=Mt?function(e,t){Y.value=t,Mt(e,"__bindData__",Y),Y.value=null}:Ke;Vt.argsClass||(ye=function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&St.call(e,"callee")&&!At.call(e,"callee")||!1});var Ht=Tt||function(e){return e&&"object"==typeof e&&"number"==typeof e.length&&mt.call(e)==F||!1},zt=pe({args:"object",init:"[]",top:"if (!(objectTypes[typeof object])) return result",loop:"result.push(index)"}),Gt=It?function(e){return Ee(e)?Vt.enumPrototypes&&"function"==typeof e||Vt.nonEnumArgs&&e.length&&ye(e)?zt(e):It(e):[]}:zt,Jt={args:"collection, callback, thisArg",top:"callback = callback && typeof thisArg == 'undefined' ? callback : baseCreateCallback(callback, thisArg, 3)",array:"typeof length == 'number'",keys:Gt,loop:"if (callback(iterable[index], index, collection) === false) return result"},Wt={args:"object, source, guard",top:"var args = arguments,\n    argsIndex = 0,\n    argsLength = typeof guard == 'number' ? 2 : args.length;\nwhile (++argsIndex < argsLength) {\n  iterable = args[argsIndex];\n  if (iterable && objectTypes[typeof iterable]) {",keys:Gt,loop:"if (typeof result[index] == 'undefined') result[index] = iterable[index]",bottom:"  }\n}"},Qt={top:"if (!objectTypes[typeof iterable]) return result;\n"+Jt.top,array:!1},Yt={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},Kt=xe(Yt),Zt=lt("("+Gt(Kt).join("|")+")","g"),Xt=lt("["+Gt(Yt).join("")+"]","g"),en=pe(Jt),tn=pe(Wt,{top:Wt.top.replace(";",";\nif (argsLength > 3 && typeof args[argsLength - 2] == 'function') {\n  var callback = baseCreateCallback(args[--argsLength - 1], args[argsLength--], 2);\n} else if (argsLength > 2 && typeof args[argsLength - 1] == 'function') {\n  callback = args[--argsLength];\n}"),loop:"result[index] = callback ? callback(result[index], iterable[index]) : iterable[index]"}),nn=pe(Wt),rn=pe(Jt,Qt,{useHas:!1}),an=pe(Jt,Qt);Se(/x/)&&(Se=function(e){return"function"==typeof e&&mt.call(e)==U});var sn=xt?function(e){if(!e||mt.call(e)!=z||!Vt.argsClass&&ye(e))return!1;var t=e.valueOf,n=me(t)&&(n=xt(t))&&xt(n);return n?e==n||xt(e)==n:be(e)}:be,on=de(function(e,t,n){St.call(e,n)?e[n]++:e[n]=1}),ln=de(function(e,t,n){(St.call(e,n)?e[n]:e[n]=[]).push(t)}),cn=de(function(e,t,n){e[n]=t}),un=Ie,dn=Oe,hn=me(hn=nt.now)&&hn||function(){return(new nt).getTime()},pn=8==qt(x+"08")?qt:function(e,t){return qt(ke(e)?e.replace(T,""):e,t||0)};return g.after=function(e,t){if(!Se(t))throw new ut;return function(){if(--e<1)return t.apply(this,arguments)}},g.assign=tn,g.at=function(e){var t=arguments,n=-1,i=se(t,!0,!1,1),r=t[2]&&t[2][t[1]]===e?1:i.length,a=et(r);for(Vt.unindexedChars&&ke(e)&&(e=e.split(""));++n<r;)a[n]=e[i[n]];return a},g.bind=Je,g.bindAll=function(e){for(var t=arguments.length>1?se(arguments,!0,!1,1):_e(e),n=-1,i=t.length;++n<i;){var r=t[n];e[r]=he(e[r],1,null,null,e)}return e},g.bindKey=function(e,t){return arguments.length>2?he(t,19,h(arguments,2),null,e):he(t,3,null,null,e)},g.chain=function(e){return e=new m(e),e.__chain__=!0,e},g.compact=function(e){for(var t=-1,n=e?e.length:0,i=[];++t<n;){var r=e[t];r&&i.push(r)}return i},g.compose=function(){for(var e=arguments,t=e.length;t--;)if(!Se(e[t]))throw new ut;return function(){for(var t=arguments,n=e.length;n--;)t=[e[n].apply(this,t)];return t[0]}},g.constant=function(e){return function(){return e}},g.countBy=on,g.create=function(e,t){var n=te(e);return t?tn(n,t):n},g.createCallback=function(e,t,n){var i=typeof e;if(null==e||"function"==i)return ne(e,t,n);if("object"!=i)return Ze(e);var r=Gt(e),a=r[0],s=e[a];return 1!=r.length||s!==s||Ee(s)?function(t){for(var n=r.length,i=!1;n--&&(i=oe(t[r[n]],e[r[n]],null,!0)););return i}:function(e){var t=e[a];return s===t&&(0!==s||1/s==1/t)}},g.curry=function(e,t){return t="number"==typeof t?t:+t||e.length,he(e,4,null,null,null,t)},g.debounce=We,g.defaults=nn,g.defer=function(e){if(!Se(e))throw new ut;var t=h(arguments,1);return kt(function(){e.apply(f,t)},1)},g.delay=function(e,t){if(!Se(e))throw new ut;var n=h(arguments,2);return kt(function(){e.apply(f,n)},t)},g.difference=function(e){return re(e,se(arguments,!0,!0,1))},g.filter=Oe,g.flatten=function(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n="function"!=typeof t&&i&&i[t]===e?null:t,t=!1),null!=n&&(e=Ie(e,n,i)),se(e,t)},g.forEach=Re,g.forEachRight=De,g.forIn=rn,g.forInRight=function(e,t,n){var i=[];rn(e,function(e,t){i.push(t,e)});var r=i.length;for(t=ne(t,n,3);r--&&!1!==t(i[r--],i[r],e););return e},g.forOwn=an,g.forOwnRight=we,g.functions=_e,g.groupBy=ln,g.indexBy=cn,g.initial=function(e,t,n){var i=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var a=r;for(t=g.createCallback(t,n,3);a--&&t(e[a],a,e);)i++}else i=null==t||n?1:t||i;return h(e,0,Nt(jt(0,r-i),r))},g.intersection=function(){for(var n=[],i=-1,r=arguments.length,s=o(),l=ge(),c=l===e,h=o();++i<r;){var p=arguments[i];(Ht(p)||ye(p))&&(n.push(p),s.push(c&&p.length>=w&&a(i?n[i]:h)))}var f=n[0],g=-1,m=f?f.length:0,b=[];e:for(;++g<m;){var v=s[0];if(p=f[g],(v?t(v,p):l(h,p))<0){for(i=r,(v||h).push(p);--i;)if(((v=s[i])?t(v,p):l(n[i],p))<0)continue e;b.push(p)}}for(;r--;)(v=s[r])&&d(v);return u(s),u(h),b},g.invert=xe,g.invoke=function(e,t){var n=h(arguments,2),i=-1,r="function"==typeof t,a=e?e.length:0,s=et("number"==typeof a?a:0);return Re(e,function(e){s[++i]=(r?t:e[t]).apply(e,n)}),s},g.keys=Gt,g.map=Ie,g.mapValues=function(e,t,n){var i={};return t=g.createCallback(t,n,3),an(e,function(e,n,r){i[n]=t(e,n,r)}),i},g.max=je,g.memoize=function(e,t){if(!Se(e))throw new ut;var n=function(){var i=n.cache,r=t?t.apply(this,arguments):y+arguments[0];return St.call(i,r)?i[r]:i[r]=e.apply(this,arguments)};return n.cache={},n},g.merge=function(e){var t=arguments,n=2;if(!Ee(e))return e;if("number"!=typeof t[2]&&(n=t.length),n>3&&"function"==typeof t[n-2])var i=ne(t[--n-1],t[n--],2);else n>2&&"function"==typeof t[n-1]&&(i=t[--n]);for(var r=h(arguments,1,n),a=-1,s=o(),l=o();++a<n;)le(e,r[a],i,s,l);return u(s),u(l),e},g.min=function(e,t,n){var r=1/0,a=r;if("function"!=typeof t&&n&&n[t]===e&&(t=null),null==t&&Ht(e))for(var s=-1,o=e.length;++s<o;){var l=e[s];l<a&&(a=l)}else t=null==t&&ke(e)?i:g.createCallback(t,n,3),en(e,function(e,n,i){var s=t(e,n,i);s<r&&(r=s,a=e)});return a},g.omit=function(e,t,n){var i={};if("function"!=typeof t){var r=[];rn(e,function(e,t){r.push(t)});for(var a=-1,s=(r=re(r,se(arguments,!0,!1,1))).length;++a<s;){var o=r[a];i[o]=e[o]}}else t=g.createCallback(t,n,3),rn(e,function(e,n,r){t(e,n,r)||(i[n]=e)});return i},g.once=function(e){var t,n;if(!Se(e))throw new ut;return function(){return t?n:(t=!0,n=e.apply(this,arguments),e=null,n)}},g.pairs=function(e){for(var t=-1,n=Gt(e),i=n.length,r=et(i);++t<i;){var a=n[t];r[t]=[a,e[a]]}return r},g.partial=function(e){return he(e,16,h(arguments,1))},g.partialRight=function(e){return he(e,32,null,h(arguments,1))},g.pick=function(e,t,n){var i={};if("function"!=typeof t)for(var r=-1,a=se(arguments,!0,!1,1),s=Ee(e)?a.length:0;++r<s;){var o=a[r];o in e&&(i[o]=e[o])}else t=g.createCallback(t,n,3),rn(e,function(e,n,r){t(e,n,r)&&(i[n]=e)});return i},g.pluck=un,g.property=Ze,g.pull=function(e){for(var t=arguments,n=0,i=t.length,r=e?e.length:0;++n<i;)for(var a=-1,s=t[n];++a<r;)e[a]===s&&(Ct.call(e,a--,1),r--);return e},g.range=function(e,t,n){e=+e||0,n="number"==typeof n?n:+n||1,null==t&&(t=e,e=0);for(var i=-1,r=jt(0,vt((t-e)/(n||1))),a=et(r);++i<r;)a[i]=e,e+=n;return a},g.reject=function(e,t,n){return t=g.createCallback(t,n,3),Oe(e,function(e,n,i){return!t(e,n,i)})},g.remove=function(e,t,n){var i=-1,r=e?e.length:0,a=[];for(t=g.createCallback(t,n,3);++i<r;){var s=e[i];t(s,i,e)&&(a.push(s),Ct.call(e,i--,1),r--)}return a},g.rest=$e,g.shuffle=Le,g.sortBy=function(e,t,n){var i=-1,a=Ht(t),s=e?e.length:0,c=et("number"==typeof s?s:0);for(a||(t=g.createCallback(t,n,3)),Re(e,function(e,n,r){var s=c[++i]=l();a?s.criteria=Ie(t,function(t){return e[t]}):(s.criteria=o())[0]=t(e,n,r),s.index=i,s.value=e}),s=c.length,c.sort(r);s--;){var h=c[s];c[s]=h.value,a||u(h.criteria),d(h)}return c},g.tap=function(e,t){return t(e),e},g.throttle=function(e,t,n){var i=!0,r=!0;if(!Se(e))throw new ut;return!1===n?i=!1:Ee(n)&&(i="leading"in n?n.leading:i,r="trailing"in n?n.trailing:r),Q.leading=i,Q.maxWait=t,Q.trailing=r,We(e,t,Q)},g.times=function(e,t,n){e=(e=+e)>-1?e:0;var i=-1,r=et(e);for(t=ne(t,n,1);++i<e;)r[i]=t(i);return r},g.toArray=function(e){return e&&"number"==typeof e.length?Vt.unindexedChars&&ke(e)?e.split(""):h(e):Ce(e)},g.transform=function(e,t,n,i){var r=Ht(e);if(null==n)if(r)n=[];else{var a=e&&e.constructor,s=a&&a.prototype;n=te(s)}return t&&(t=g.createCallback(t,i,4),(r?en:an)(e,function(e,i,r){return t(n,e,i,r)})),n},g.union=function(){return ue(se(arguments,!0,!0))},g.uniq=He,g.values=Ce,g.where=dn,g.without=function(e){return re(e,h(arguments,1))},g.wrap=function(e,t){return he(t,16,[e])},g.xor=function(){for(var e=-1,t=arguments.length;++e<t;){var n=arguments[e];if(Ht(n)||ye(n))var i=i?ue(re(i,n).concat(re(n,i))):n}return i||[]},g.zip=ze,g.zipObject=Ge,g.collect=Ie,g.drop=$e,g.each=Re,g.eachRight=De,g.extend=tn,g.methods=_e,g.object=Ge,g.select=Oe,g.tail=$e,g.unique=He,g.unzip=ze,Ye(g),g.clone=function(e,t,n,i){return"boolean"!=typeof t&&null!=t&&(i=n,n=t,t=!1),X(e,t,"function"==typeof n&&ne(n,i,1))},g.cloneDeep=function(e,t,n){return X(e,!0,"function"==typeof t&&ne(t,n,1))},g.contains=Pe,g.escape=function(e){return null==e?"":ct(e).replace(Xt,fe)},g.every=Me,g.find=Te,g.findIndex=function(e,t,n){var i=-1,r=e?e.length:0;for(t=g.createCallback(t,n,3);++i<r;)if(t(e[i],i,e))return i;return-1},g.findKey=function(e,t,n){var i;return t=g.createCallback(t,n,3),an(e,function(e,n,r){if(t(e,n,r))return i=n,!1}),i},g.findLast=function(e,t,n){var i;return t=g.createCallback(t,n,3),De(e,function(e,n,r){if(t(e,n,r))return i=e,!1}),i},g.findLastIndex=function(e,t,n){var i=e?e.length:0;for(t=g.createCallback(t,n,3);i--;)if(t(e[i],i,e))return i;return-1},g.findLastKey=function(e,t,n){var i;return t=g.createCallback(t,n,3),we(e,function(e,n,r){if(t(e,n,r))return i=n,!1}),i},g.has=function(e,t){return!!e&&St.call(e,t)},g.identity=Qe,g.indexOf=Ve,g.isArguments=ye,g.isArray=Ht,g.isBoolean=function(e){return!0===e||!1===e||e&&"object"==typeof e&&mt.call(e)==B||!1},g.isDate=function(e){return e&&"object"==typeof e&&mt.call(e)==V||!1},g.isElement=function(e){return e&&1===e.nodeType||!1},g.isEmpty=function(e){var t=!0;if(!e)return t;var n=mt.call(e),i=e.length;return n==F||n==J||(Vt.argsClass?n==L:ye(e))||n==z&&"number"==typeof i&&Se(e.splice)?!i:(an(e,function(){return t=!1}),t)},g.isEqual=function(e,t,n,i){return oe(e,t,"function"==typeof n&&ne(n,i,2))},g.isFinite=function(e){return Rt(e)&&!Dt(parseFloat(e))},g.isFunction=Se,g.isNaN=function(e){return Ae(e)&&e!=+e},g.isNull=function(e){return null===e},g.isNumber=Ae,g.isObject=Ee,g.isPlainObject=sn,g.isRegExp=function(e){return e&&Z[typeof e]&&mt.call(e)==G||!1},g.isString=ke,g.isUndefined=function(e){return void 0===e},g.lastIndexOf=function(e,t,n){var i=e?e.length:0;for("number"==typeof n&&(i=(n<0?jt(0,i+n):Nt(n,i-1))+1);i--;)if(e[i]===t)return i;return-1},g.mixin=Ye,g.noConflict=function(){return n._=gt,this},g.noop=Ke,g.now=hn,g.parseInt=pn,g.random=function(e,t,n){var i=null==e,r=null==t;if(null==n&&("boolean"==typeof e&&r?(n=e,e=1):r||"boolean"!=typeof t||(n=t,r=!0)),i&&r&&(t=1),e=+e||0,r?(t=e,e=0):t=+t||0,n||e%1||t%1){var a=Lt();return Nt(e+a*(t-e+parseFloat("1e-"+((a+"").length-1))),t)}return ce(e,t)},g.reduce=Ne,g.reduceRight=qe,g.result=function(e,t){if(e){var n=e[t];return Se(n)?e[t]():n}},g.runInContext=p,g.size=function(e){var t=e?e.length:0;return"number"==typeof t?t:Gt(e).length},g.some=Fe,g.sortedIndex=Ue,g.template=function(e,t,n){var i=g.templateSettings;e=ct(e||""),n=nn({},n,i);var r,a=nn({},n.imports,i.imports),o=Gt(a),l=Ce(a),c=0,u=n.interpolate||R,d="__p += '",h=lt((n.escape||R).source+"|"+u.source+"|"+(u===O?C:R).source+"|"+(n.evaluate||R).source+"|$","g");e.replace(h,function(t,n,i,a,o,l){return i||(i=a),d+=e.slice(c,l).replace(I,s),n&&(d+="' +\n__e("+n+") +\n'"),o&&(r=!0,d+="';\n"+o+";\n__p += '"),i&&(d+="' +\n((__t = ("+i+")) == null ? '' : __t) +\n'"),c=l+t.length,t}),d+="';\n";var p=n.variable,m=p;m||(d="with ("+(p="obj")+") {\n"+d+"\n}\n"),d=(r?d.replace(S,""):d).replace(E,"$1").replace(A,"$1;"),d="function("+p+") {\n"+(m?"":p+" || ("+p+" = {});\n")+"var __t, __p = '', __e = _.escape"+(r?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+d+"return __p\n}";var b="\n/*\n//# sourceURL="+(n.sourceURL||"/lodash/template/source["+q+++"]")+"\n*/";try{var v=rt(o,"return "+d+b).apply(f,l)}catch(e){throw e.source=d,e}return t?v(t):(v.source=d,v)},g.unescape=function(e){return null==e?"":ct(e).replace(Zt,ve)},g.uniqueId=function(e){var t=++b;return ct(null==e?"":e)+t},g.all=Me,g.any=Fe,g.detect=Te,g.findWhere=Te,g.foldl=Ne,g.foldr=qe,g.include=Pe,g.inject=Ne,Ye(function(){var e={};return an(g,function(t,n){g.prototype[n]||(e[n]=t)}),e}(),!1),g.first=Be,g.last=function(e,t,n){var i=0,r=e?e.length:0;if("number"!=typeof t&&null!=t){var a=r;for(t=g.createCallback(t,n,3);a--&&t(e[a],a,e);)i++}else if(null==(i=t)||n)return e?e[r-1]:f;return h(e,jt(0,r-i))},g.sample=function(e,t,n){if(e&&"number"!=typeof e.length?e=Ce(e):Vt.unindexedChars&&ke(e)&&(e=e.split("")),null==t||n)return e?e[ce(0,e.length-1)]:f;var i=Le(e);return i.length=Nt(jt(0,t),i.length),i},g.take=Be,g.head=Be,an(g,function(e,t){var n="sample"!==t;g.prototype[t]||(g.prototype[t]=function(t,i){var r=this.__chain__,a=e(this.__wrapped__,t,i);return r||null!=t&&(!i||n&&"function"==typeof t)?new m(a,r):a})}),g.VERSION="2.4.2",g.prototype.chain=function(){return this.__chain__=!0,this},g.prototype.toString=function(){return ct(this.__wrapped__)},g.prototype.value=Xe,g.prototype.valueOf=Xe,en(["join","pop","shift"],function(e){var t=dt[e];g.prototype[e]=function(){var e=this.__chain__,n=t.apply(this.__wrapped__,arguments);return e?new m(n,e):n}}),en(["push","reverse","sort","unshift"],function(e){var t=dt[e];g.prototype[e]=function(){return t.apply(this.__wrapped__,arguments),this}}),en(["concat","slice","splice"],function(e){var t=dt[e];g.prototype[e]=function(){return new m(t.apply(this.__wrapped__,arguments),this.__chain__)}}),Vt.spliceObjects||en(["pop","shift","splice"],function(e){var t=dt[e],n="splice"==e;g.prototype[e]=function(){var e=this.__chain__,i=this.__wrapped__,r=t.apply(i,arguments);return 0===i.length&&delete i[0],e||n?new m(r,e):r}}),g}var f,g=[],m=[],b=0,v={},y=+new Date+"",w=75,_=40,x=" \t\v\f \ufeff\n\r\u2028\u2029 ᠎             　",S=/\b__p \+= '';/g,E=/\b(__p \+=) '' \+/g,A=/(__e\(.*?\)|\b__t\)) \+\n'';/g,C=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,P=/\w*$/,M=/^\s*function[ \n\r\t]+\w/,O=/<%=([\s\S]+?)%>/g,T=RegExp("^["+x+"]*0+(?=.$)"),R=/($^)/,D=/\bthis\b/,I=/['\n\r\t\u2028\u2029\\]/g,j=["Array","Boolean","Date","Error","Function","Math","Number","Object","RegExp","String","_","attachEvent","clearTimeout","isFinite","isNaN","parseInt","setTimeout"],N=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],q=0,L="[object Arguments]",F="[object Array]",B="[object Boolean]",V="[object Date]",$="[object Error]",U="[object Function]",H="[object Number]",z="[object Object]",G="[object RegExp]",J="[object String]",W={};W[U]=!1,W[L]=W[F]=W[B]=W[V]=W[H]=W[z]=W[G]=W[J]=!0;var Q={leading:!1,maxWait:0,trailing:!1},Y={configurable:!1,enumerable:!1,value:null,writable:!1},K={args:"",array:null,bottom:"",firstArg:"",init:"",keys:null,loop:"",shadowedProps:null,support:null,top:"",useHas:!1},Z={boolean:!1,function:!0,object:!0,number:!1,string:!1,undefined:!1},X={"\\":"\\","'":"'","\n":"n","\r":"r","\t":"t","\u2028":"u2028","\u2029":"u2029"},ee=Z[typeof window]&&window||this,te=Z[typeof exports]&&exports&&!exports.nodeType&&exports,ne=Z[typeof module]&&module&&!module.nodeType&&module,ie=ne&&ne.exports===te&&te,re=Z[typeof global]&&global;!re||re.global!==re&&re.window!==re||(ee=re);var ae=p();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(ee._=ae,define("underscore",[],function(){return ae})):te&&ne?ie?(ne.exports=ae)._=ae:te._=ae:ee._=ae}.call(this),function(e,t){if("function"==typeof define&&define.amd)define("backbone",["underscore","jquery","exports"],function(n,i,r){e.Backbone=t(e,r,n,i)});else if("undefined"!=typeof exports){var n=require("underscore");t(e,exports,n)}else e.Backbone=t(e,{},e._,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,t,n,i){var r=e.Backbone,a=[],s=a.slice;t.VERSION="1.1.2",t.$=i,t.noConflict=function(){return e.Backbone=r,this},t.emulateHTTP=!1,t.emulateJSON=!1;var o=t.Events={on:function(e,t,n){return c(this,"on",e,[t,n])&&t?(this._events||(this._events={}),(this._events[e]||(this._events[e]=[])).push({callback:t,context:n,ctx:n||this}),this):this},once:function(e,t,i){if(!c(this,"once",e,[t,i])||!t)return this;var r=this,a=n.once(function(){r.off(e,a),t.apply(this,arguments)});return a._callback=t,this.on(e,a,i)},off:function(e,t,i){var r,a,s,o,l,u,d,h;if(!this._events||!c(this,"off",e,[t,i]))return this;if(!e&&!t&&!i)return this._events=void 0,this;for(l=0,u=(o=e?[e]:n.keys(this._events)).length;l<u;l++)if(e=o[l],s=this._events[e]){if(this._events[e]=r=[],t||i)for(d=0,h=s.length;d<h;d++)a=s[d],(t&&t!==a.callback&&t!==a.callback._callback||i&&i!==a.context)&&r.push(a);r.length||delete this._events[e]}return this},trigger:function(e){if(!this._events)return this;var t=s.call(arguments,1);if(!c(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&u(n,t),i&&u(i,arguments),this},stopListening:function(e,t,i){var r=this._listeningTo;if(!r)return this;var a=!t&&!i;i||"object"!=typeof t||(i=this),e&&((r={})[e._listenId]=e);for(var s in r)(e=r[s]).off(t,i,this),(a||n.isEmpty(e._events))&&delete this._listeningTo[s];return this}},l=/\s+/,c=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var r in n)e[t].apply(e,[r,n[r]].concat(i));return!1}if(l.test(n)){for(var a=n.split(l),s=0,o=a.length;s<o;s++)e[t].apply(e,[a[s]].concat(i));return!1}return!0},u=function(e,t){var n,i=-1,r=e.length,a=t[0],s=t[1],o=t[2];switch(t.length){case 0:for(;++i<r;)(n=e[i]).callback.call(n.ctx);return;case 1:for(;++i<r;)(n=e[i]).callback.call(n.ctx,a);return;case 2:for(;++i<r;)(n=e[i]).callback.call(n.ctx,a,s);return;case 3:for(;++i<r;)(n=e[i]).callback.call(n.ctx,a,s,o);return;default:for(;++i<r;)(n=e[i]).callback.apply(n.ctx,t);return}},d={listenTo:"on",listenToOnce:"once"};n.each(d,function(e,t){o[t]=function(t,i,r){return(this._listeningTo||(this._listeningTo={}))[t._listenId||(t._listenId=n.uniqueId("l"))]=t,r||"object"!=typeof i||(r=this),t[e](i,r,this),this}}),o.bind=o.on,o.unbind=o.off,n.extend(t,o);var h=t.Model=function(e,t){var i=e||{};t||(t={}),this.cid=n.uniqueId("c"),this.attributes={},t.collection&&(this.collection=t.collection),t.parse&&(i=this.parse(i,t)||{}),i=n.defaults({},i,n.result(this,"defaults")),this.set(i,t),this.changed={},this.initialize.apply(this,arguments)};n.extend(h.prototype,o,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(e){return n.clone(this.attributes)},sync:function(){return t.sync.apply(this,arguments)},get:function(e){return this.attributes[e]},escape:function(e){return n.escape(this.get(e))},has:function(e){return null!=this.get(e)},set:function(e,t,i){var r,a,s,o,l,c,u,d;if(null==e)return this;if("object"==typeof e?(a=e,i=t):(a={})[e]=t,i||(i={}),!this._validate(a,i))return!1;s=i.unset,l=i.silent,o=[],c=this._changing,this._changing=!0,c||(this._previousAttributes=n.clone(this.attributes),this.changed={}),d=this.attributes,u=this._previousAttributes,this.idAttribute in a&&(this.id=a[this.idAttribute]);for(r in a)t=a[r],n.isEqual(d[r],t)||o.push(r),n.isEqual(u[r],t)?delete this.changed[r]:this.changed[r]=t,s?delete d[r]:d[r]=t;if(!l){o.length&&(this._pending=i);for(var h=0,p=o.length;h<p;h++)this.trigger("change:"+o[h],this,d[o[h]],i)}if(c)return this;if(!l)for(;this._pending;)i=this._pending,this._pending=!1,this.trigger("change",this,i);return this._pending=!1,this._changing=!1,this},unset:function(e,t){return this.set(e,void 0,n.extend({},t,{unset:!0}))},clear:function(e){var t={};for(var i in this.attributes)t[i]=void 0;return this.set(t,n.extend({},e,{unset:!0}))},hasChanged:function(e){return null==e?!n.isEmpty(this.changed):n.has(this.changed,e)},changedAttributes:function(e){if(!e)return!!this.hasChanged()&&n.clone(this.changed);var t,i=!1,r=this._changing?this._previousAttributes:this.attributes;for(var a in e)n.isEqual(r[a],t=e[a])||((i||(i={}))[a]=t);return i},previous:function(e){return null!=e&&this._previousAttributes?this._previousAttributes[e]:null},previousAttributes:function(){return n.clone(this._previousAttributes)},fetch:function(e){void 0===(e=e?n.clone(e):{}).parse&&(e.parse=!0);var t=this,i=e.success;return e.success=function(n){if(!t.set(t.parse(n,e),e))return!1;i&&i(t,n,e),t.trigger("sync",t,n,e)},N(this,e),this.sync("read",this,e)},save:function(e,t,i){var r,a,s,o=this.attributes;if(null==e||"object"==typeof e?(r=e,i=t):(r={})[e]=t,i=n.extend({validate:!0},i),r&&!i.wait){if(!this.set(r,i))return!1}else if(!this._validate(r,i))return!1;r&&i.wait&&(this.attributes=n.extend({},o,r)),void 0===i.parse&&(i.parse=!0);var l=this,c=i.success;return i.success=function(e){l.attributes=o;var t=l.parse(e,i);if(i.wait&&(t=n.extend(r||{},t)),n.isObject(t)&&!l.set(t,i))return!1;c&&c(l,e,i),l.trigger("sync",l,e,i)},N(this,i),"patch"===(a=this.isNew()?"create":i.patch?"patch":"update")&&(i.attrs=r),s=this.sync(a,this,i),r&&i.wait&&(this.attributes=o),s},destroy:function(e){var t=this,i=(e=e?n.clone(e):{}).success,r=function(){t.trigger("destroy",t,t.collection,e)};if(e.success=function(n){(e.wait||t.isNew())&&r(),i&&i(t,n,e),t.isNew()||t.trigger("sync",t,n,e)},this.isNew())return e.success(),!1;N(this,e);var a=this.sync("delete",this,e);return e.wait||r(),a},url:function(){var e=n.result(this,"urlRoot")||n.result(this.collection,"url")||j();return this.isNew()?e:e.replace(/([^\/])$/,"$1/")+encodeURIComponent(this.id)},parse:function(e,t){return e},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return!this.has(this.idAttribute)},isValid:function(e){return this._validate({},n.extend(e||{},{validate:!0}))},_validate:function(e,t){if(!t.validate||!this.validate)return!0;e=n.extend({},this.attributes,e);var i=this.validationError=this.validate(e,t)||null;return!i||(this.trigger("invalid",this,i,n.extend(t,{validationError:i})),!1)}});var p=["keys","values","pairs","invert","pick","omit"];n.each(p,function(e){h.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.attributes),n[e].apply(n,t)}});var f=t.Collection=function(e,t){t||(t={}),t.model&&(this.model=t.model),void 0!==t.comparator&&(this.comparator=t.comparator),this._reset(),this.initialize.apply(this,arguments),e&&this.reset(e,n.extend({silent:!0},t))},g={add:!0,remove:!0,merge:!0},m={add:!0,remove:!1};n.extend(f.prototype,o,{model:h,initialize:function(){},toJSON:function(e){return this.map(function(t){return t.toJSON(e)})},sync:function(){return t.sync.apply(this,arguments)},add:function(e,t){return this.set(e,n.extend({merge:!1},t,m))},remove:function(e,t){var i=!n.isArray(e);e=i?[e]:n.clone(e),t||(t={});var r,a,s,o;for(r=0,a=e.length;r<a;r++)(o=e[r]=this.get(e[r]))&&(delete this._byId[o.id],delete this._byId[o.cid],s=this.indexOf(o),this.models.splice(s,1),this.length--,t.silent||(t.index=s,o.trigger("remove",o,this,t)),this._removeReference(o,t));return i?e[0]:e},set:function(e,t){(t=n.defaults({},t,g)).parse&&(e=this.parse(e,t));var i=!n.isArray(e);e=i?e?[e]:[]:n.clone(e);var r,a,s,o,l,c,u,d=t.at,p=this.model,f=this.comparator&&null==d&&!1!==t.sort,m=n.isString(this.comparator)?this.comparator:null,b=[],v=[],y={},w=t.add,_=t.merge,x=t.remove,S=!(f||!w||!x)&&[];for(r=0,a=e.length;r<a;r++){if(l=e[r]||{},s=l instanceof h?o=l:l[p.prototype.idAttribute||"id"],c=this.get(s))x&&(y[c.cid]=!0),_&&(l=l===o?o.attributes:l,t.parse&&(l=c.parse(l,t)),c.set(l,t),f&&!u&&c.hasChanged(m)&&(u=!0)),e[r]=c;else if(w){if(!(o=e[r]=this._prepareModel(l,t)))continue;b.push(o),this._addReference(o,t)}o=c||o,!S||!o.isNew()&&y[o.id]||S.push(o),y[o.id]=!0}if(x){for(r=0,a=this.length;r<a;++r)y[(o=this.models[r]).cid]||v.push(o);v.length&&this.remove(v,t)}if(b.length||S&&S.length)if(f&&(u=!0),this.length+=b.length,null!=d)for(r=0,a=b.length;r<a;r++)this.models.splice(d+r,0,b[r]);else{S&&(this.models.length=0);var E=S||b;for(r=0,a=E.length;r<a;r++)this.models.push(E[r])}if(u&&this.sort({silent:!0}),!t.silent){for(r=0,a=b.length;r<a;r++)(o=b[r]).trigger("add",o,this,t);(u||S&&S.length)&&this.trigger("sort",this,t)}return i?e[0]:e},reset:function(e,t){t||(t={});for(var i=0,r=this.models.length;i<r;i++)this._removeReference(this.models[i],t);return t.previousModels=this.models,this._reset(),e=this.add(e,n.extend({silent:!0},t)),t.silent||this.trigger("reset",this,t),e},push:function(e,t){return this.add(e,n.extend({at:this.length},t))},pop:function(e){var t=this.at(this.length-1);return this.remove(t,e),t},unshift:function(e,t){return this.add(e,n.extend({at:0},t))},shift:function(e){var t=this.at(0);return this.remove(t,e),t},slice:function(){return s.apply(this.models,arguments)},get:function(e){if(null!=e)return this._byId[e]||this._byId[e.id]||this._byId[e.cid]},at:function(e){return this.models[e]},where:function(e,t){return n.isEmpty(e)?t?void 0:[]:this[t?"find":"filter"](function(t){for(var n in e)if(e[n]!==t.get(n))return!1;return!0})},findWhere:function(e){return this.where(e,!0)},sort:function(e){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return e||(e={}),n.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(n.bind(this.comparator,this)),e.silent||this.trigger("sort",this,e),this},pluck:function(e){return n.invoke(this.models,"get",e)},fetch:function(e){void 0===(e=e?n.clone(e):{}).parse&&(e.parse=!0);var t=e.success,i=this;return e.success=function(n){var r=e.reset?"reset":"set";i[r](n,e),t&&t(i,n,e),i.trigger("sync",i,n,e)},N(this,e),this.sync("read",this,e)},create:function(e,t){if(t=t?n.clone(t):{},!(e=this._prepareModel(e,t)))return!1;t.wait||this.add(e,t);var i=this,r=t.success;return t.success=function(e,n){t.wait&&i.add(e,t),r&&r(e,n,t)},e.save(null,t),e},parse:function(e,t){return e},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(e,t){if(e instanceof h)return e;(t=t?n.clone(t):{}).collection=this;var i=new this.model(e,t);return i.validationError?(this.trigger("invalid",this,i.validationError,t),!1):i},_addReference:function(e,t){this._byId[e.cid]=e,null!=e.id&&(this._byId[e.id]=e),e.collection||(e.collection=this),e.on("all",this._onModelEvent,this)},_removeReference:function(e,t){this===e.collection&&delete e.collection,e.off("all",this._onModelEvent,this)},_onModelEvent:function(e,t,n,i){("add"!==e&&"remove"!==e||n===this)&&("destroy"===e&&this.remove(t,i),t&&e==="change:"+t.idAttribute&&(delete this._byId[t.previous(t.idAttribute)],null!=t.id&&(this._byId[t.id]=t)),this.trigger.apply(this,arguments))}});var b=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain","sample"];n.each(b,function(e){f.prototype[e]=function(){var t=s.call(arguments);return t.unshift(this.models),n[e].apply(n,t)}});var v=["groupBy","countBy","sortBy","indexBy"];n.each(v,function(e){f.prototype[e]=function(t,i){var r=n.isFunction(t)?t:function(e){return e.get(t)};return n[e](this.models,r,i)}});var y=t.View=function(e){this.cid=n.uniqueId("view"),e||(e={}),n.extend(this,n.pick(e,_)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},w=/^(\S+)\s*(.*)$/,_=["model","collection","el","id","attributes","className","tagName","events"];n.extend(y.prototype,o,{tagName:"div",$:function(e){return this.$el.find(e)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(e,n){return this.$el&&this.undelegateEvents(),this.$el=e instanceof t.$?e:t.$(e),this.el=this.$el[0],!1!==n&&this.delegateEvents(),this},delegateEvents:function(e){if(!e&&!(e=n.result(this,"events")))return this;this.undelegateEvents();for(var t in e){var i=e[t];if(n.isFunction(i)||(i=this[e[t]]),i){var r=t.match(w),a=r[1],s=r[2];i=n.bind(i,this),a+=".delegateEvents"+this.cid,""===s?this.$el.on(a,i):this.$el.on(a,s,i)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(n.result(this,"el"),!1);else{var e=n.extend({},n.result(this,"attributes"));this.id&&(e.id=n.result(this,"id")),this.className&&(e.class=n.result(this,"className"));var i=t.$("<"+n.result(this,"tagName")+">").attr(e);this.setElement(i,!1)}}}),t.sync=function(e,i,r){var a=S[e];n.defaults(r||(r={}),{emulateHTTP:t.emulateHTTP,emulateJSON:t.emulateJSON});var s={type:a,dataType:"json"};if(r.url||(s.url=n.result(i,"url")||j()),null!=r.data||!i||"create"!==e&&"update"!==e&&"patch"!==e||(s.contentType="application/json",s.data=JSON.stringify(r.attrs||i.toJSON(r))),r.emulateJSON&&(s.contentType="application/x-www-form-urlencoded",s.data=s.data?{model:s.data}:{}),r.emulateHTTP&&("PUT"===a||"DELETE"===a||"PATCH"===a)){s.type="POST",r.emulateJSON&&(s.data._method=a);var o=r.beforeSend;r.beforeSend=function(e){if(e.setRequestHeader("X-HTTP-Method-Override",a),o)return o.apply(this,arguments)}}"GET"===s.type||r.emulateJSON||(s.processData=!1),"PATCH"===s.type&&x&&(s.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var l=r.xhr=t.ajax(n.extend(s,r));return i.trigger("request",i,l,r),l};var x=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),S={create:"POST",update:"PUT",patch:"PATCH",delete:"DELETE",read:"GET"};t.ajax=function(){return t.$.ajax.apply(t.$,arguments)};var E=t.Router=function(e){e||(e={}),e.routes&&(this.routes=e.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},A=/\((.*?)\)/g,k=/(\(\?)?:\w+/g,C=/\*\w+/g,P=/[\-{}\[\]+?.,\\\^$|#\s]/g;n.extend(E.prototype,o,{initialize:function(){},route:function(e,i,r){n.isRegExp(e)||(e=this._routeToRegExp(e)),n.isFunction(i)&&(r=i,i=""),r||(r=this[i]);var a=this;return t.history.route(e,function(n){var s=a._extractParameters(e,n);a.execute(r,s),a.trigger.apply(a,["route:"+i].concat(s)),a.trigger("route",i,s),t.history.trigger("route",a,i,s)}),this},execute:function(e,t){e&&e.apply(this,t)},navigate:function(e,n){return t.history.navigate(e,n),this},_bindRoutes:function(){if(this.routes){this.routes=n.result(this,"routes");for(var e,t=n.keys(this.routes);null!=(e=t.pop());)this.route(e,this.routes[e])}},_routeToRegExp:function(e){return e=e.replace(P,"\\$&").replace(A,"(?:$1)?").replace(k,function(e,t){return t?e:"([^/?]+)"}).replace(C,"([^?]*?)"),new RegExp("^"+e+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(e,t){var i=e.exec(t).slice(1);return n.map(i,function(e,t){return t===i.length-1?e||null:e?decodeURIComponent(e):null})}});var M=t.History=function(){this.handlers=[],n.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},O=/^[#\/]|\s+$/g,T=/^\/+|\/+$/g,R=/msie [\w.]+/,D=/\/$/,I=/#.*$/;M.started=!1,n.extend(M.prototype,o,{interval:50,atRoot:function(){return this.location.pathname.replace(/[^\/]$/,"$&/")===this.root},getHash:function(e){var t=(e||this).location.href.match(/#(.*)$/);return t?t[1]:""},getFragment:function(e,t){if(null==e)if(this._hasPushState||!this._wantsHashChange||t){e=decodeURI(this.location.pathname+this.location.search);var n=this.root.replace(D,"");e.indexOf(n)||(e=e.slice(n.length))}else e=this.getHash();return e.replace(O,"")},start:function(e){if(M.started)throw new Error("Backbone.history has already been started");M.started=!0,this.options=n.extend({root:"/"},this.options,e),this.root=this.options.root,this._wantsHashChange=!1!==this.options.hashChange,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var i=this.getFragment(),r=document.documentMode,a=R.exec(navigator.userAgent.toLowerCase())&&(!r||r<=7);if(this.root=("/"+this.root+"/").replace(T,"/"),a&&this._wantsHashChange){var s=t.$('<iframe src="javascript:0" tabindex="-1">');this.iframe=s.hide().appendTo("body")[0].contentWindow,this.navigate(i)}this._hasPushState?t.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!a?t.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=i;var o=this.location;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot())return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+"#"+this.fragment),!0;this._hasPushState&&this.atRoot()&&o.hash&&(this.fragment=this.getHash().replace(O,""),this.history.replaceState({},document.title,this.root+this.fragment))}if(!this.options.silent)return this.loadUrl()},stop:function(){t.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),this._checkUrlInterval&&clearInterval(this._checkUrlInterval),M.started=!1},route:function(e,t){this.handlers.unshift({route:e,callback:t})},checkUrl:function(e){var t=this.getFragment();if(t===this.fragment&&this.iframe&&(t=this.getFragment(this.getHash(this.iframe))),t===this.fragment)return!1;this.iframe&&this.navigate(t),this.loadUrl()},loadUrl:function(e){return e=this.fragment=this.getFragment(e),n.any(this.handlers,function(t){if(t.route.test(e))return t.callback(e),!0})},navigate:function(e,t){if(!M.started)return!1;t&&!0!==t||(t={trigger:!!t});var n=this.root+(e=this.getFragment(e||""));if(e=e.replace(I,""),this.fragment!==e){if(this.fragment=e,""===e&&"/"!==n&&(n=n.slice(0,-1)),this._hasPushState)this.history[t.replace?"replaceState":"pushState"]({},document.title,n);else{if(!this._wantsHashChange)return this.location.assign(n);this._updateHash(this.location,e,t.replace),this.iframe&&e!==this.getFragment(this.getHash(this.iframe))&&(t.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,e,t.replace))}return t.trigger?this.loadUrl(e):void 0}},_updateHash:function(e,t,n){if(n){var i=e.href.replace(/(javascript:|#).*$/,"");e.replace(i+"#"+t)}else e.hash="#"+t}}),t.history=new M;h.extend=f.extend=E.extend=y.extend=M.extend=function(e,t){var i,r=this;i=e&&n.has(e,"constructor")?e.constructor:function(){return r.apply(this,arguments)},n.extend(i,r,t);var a=function(){this.constructor=i};return a.prototype=r.prototype,i.prototype=new a,e&&n.extend(i.prototype,e),i.__super__=r.prototype,i};var j=function(){throw new Error('A "url" property or function must be specified')},N=function(e,t){var n=t.error;t.error=function(i){n&&n(e,i,t),e.trigger("error",e,i,t)}};return t}),function(e){define("backbone-validation",["backbone"],function(){return function(){Backbone.Validation=function(e){"use strict";var t={forceUpdate:!1,selector:"name",labelFormatter:"sentenceCase",valid:Function.prototype,invalid:Function.prototype},n={formatLabel:function(e,n){return l[t.labelFormatter](e,n)},format:function(){var e=Array.prototype.slice.call(arguments);return e.shift().replace(/\{(\d+)\}/g,function(t,n){return void 0!==e[n]?e[n]:t})}},i=function(t,n,r){return n=n||{},r=r||"",e.each(t,function(a,s){t.hasOwnProperty(s)&&(a&&e.isArray(a)?e.forEach(a,function(e,t){i(e,n,r+s+"."+t+"."),n[r+s+"."+t]=e}):a&&"object"==typeof a&&a.constructor===Object&&i(a,n,r+s+"."),n[r+s]=a)}),n},r=function(){var r=function(t,n){return n=n||e.keys(e.result(t,"validation")||{}),e.reduce(n,function(e,t){return e[t]=void 0,e},{})},s=function(t,n){var i=t.attributes;if(e.isFunction(i)?i=i(n):e.isString(i)&&e.isFunction(c[i])&&(i=c[i](n)),e.isArray(i))return i},o=function(t,n){var i=t.validation?e.result(t,"validation")[n]||{}:{};return(e.isFunction(i)||e.isString(i))&&(i={fn:i}),e.isArray(i)||(i=[i]),e.reduce(i,function(t,n){return e.each(e.without(e.keys(n),"msg"),function(e){t.push({fn:u[e],val:n[e],msg:n.msg})}),t},[])},l=function(t,i,r,a){return e.reduce(o(t,i),function(s,o){var l=e.extend({},n,u),c=o.fn.call(l,r,i,o.val,t,a);return!1!==c&&!1!==s&&(c&&!s?e.result(o,"msg")||c:s)},"")},d=function(t,n,i){var r,a={},s=!0,o=e.clone(n);return e.each(i,function(e,n){(r=l(t,n,e,o))&&(a[n]=r,s=!1)}),{invalidAttrs:a,isValid:s}},h=function(t,n){return{preValidate:function(t,n){var i,r=this,a={};return e.isObject(t)?(e.each(t,function(e,t){(i=r.preValidate(t,e))&&(a[t]=i)}),e.isEmpty(a)?void 0:a):l(this,t,n,e.extend({},this.attributes))},isValid:function(r){var a,o,c,u;return r=r||s(n,t),e.isString(r)?o=[r]:e.isArray(r)&&(o=r),o&&(a=i(this.attributes),e.each(this.associatedViews,function(t){e.each(o,function(i){(c=l(this,i,a[i],e.extend({},this.attributes)))?(n.invalid(t,i,c,n.selector),(u=u||{})[i]=c):n.valid(t,i,n.selector)},this)},this)),!0===r&&(u=this.validate()),u&&this.trigger("invalid",this,u,{validationError:u}),o?!u:!this.validation||this._isValid},validate:function(a,o){var l=this,c=!a,u=e.extend({},n,o),h=r(l,s(n,t)),p=e.extend({},h,l.attributes,a),f=i(p),g=a?i(a):f,m=d(l,p,e.pick(f,e.keys(h)));if(l._isValid=m.isValid,e.each(l.associatedViews,function(t){e.each(h,function(e,n){var i=m.invalidAttrs.hasOwnProperty(n),r=g.hasOwnProperty(n);i||u.valid(t,n,u.selector),i&&(r||c)&&u.invalid(t,n,m.invalidAttrs[n],u.selector)})}),e.defer(function(){l.trigger("validated",l._isValid,l,m.invalidAttrs),l.trigger("validated:"+(l._isValid?"valid":"invalid"),l,m.invalidAttrs)}),!u.forceUpdate&&e.intersection(e.keys(m.invalidAttrs),e.keys(g)).length>0)return m.invalidAttrs}}},p=function(t,n,i){n.associatedViews?n.associatedViews.push(t):n.associatedViews=[t],e.extend(n,h(t,i))},f=function(t,n){n&&t.associatedViews.length>1?t.associatedViews=e.without(t.associatedViews,n):(delete t.validate,delete t.preValidate,delete t.isValid,delete t.associatedViews)},g=function(e){p(this.view,e,this.options)},m=function(e){f(e)};return{version:"0.11.3",configure:function(n){e.extend(t,n)},bind:function(n,i){var r=(i=e.extend({},t,a,i)).model||n.model,s=i.collection||n.collection;if(void 0===r&&void 0===s)throw"Before you execute the binding your view must have a model or a collection.\nSee http://thedersen.com/projects/backbone-validation/#using-form-model-validation for more information.";r?p(n,r,i):s&&(s.each(function(e){p(n,e,i)}),s.bind("add",g,{view:n,options:i}),s.bind("remove",m))},unbind:function(t,n){var i=(n=e.extend({},n)).model||t.model,r=n.collection||t.collection;i?f(i,t):r&&(r.each(function(e){f(e,t)}),r.unbind("add",g),r.unbind("remove",m))},mixin:h(null,t)}}(),a=r.callbacks={valid:function(e,t,n){e.$("["+n+'~="'+t+'"]').removeClass("invalid").removeAttr("data-error")},invalid:function(e,t,n,i){e.$("["+i+'~="'+t+'"]').addClass("invalid").attr("data-error",n)}},s=r.patterns={digits:/^\d+$/,number:/^-?(?:\d+|\d{1,3}(?:,\d{3})+)(?:\.\d+)?$/,email:/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))$/i,url:/^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i},o=r.messages={required:"{0} is required",acceptance:"{0} must be accepted",min:"{0} must be greater than or equal to {1}",max:"{0} must be less than or equal to {1}",range:"{0} must be between {1} and {2}",length:"{0} must be {1} characters",minLength:"{0} must be at least {1} characters",maxLength:"{0} must be at most {1} characters",rangeLength:"{0} must be between {1} and {2} characters",oneOf:"{0} must be one of: {1}",equalTo:"{0} must be the same as {1}",digits:"{0} must only contain digits",number:"{0} must be a number",email:"{0} must be a valid email",url:"{0} must be a valid url",inlinePattern:"{0} is invalid"},l=r.labelFormatters={none:function(e){return e},sentenceCase:function(e){return e.replace(/(?:^\w|[A-Z]|\b\w)/g,function(e,t){return 0===t?e.toUpperCase():" "+e.toLowerCase()}).replace(/_/g," ")},label:function(e,t){return t.labels&&t.labels[e]||l.sentenceCase(e,t)}},c=r.attributeLoaders={inputNames:function(e){var t=[];return e&&e.$("form [name]").each(function(){/^(?:input|select|textarea)$/i.test(this.nodeName)&&this.name&&"submit"!==this.type&&-1===t.indexOf(this.name)&&t.push(this.name)}),t}},u=r.validators=function(){var t=String.prototype.trim?function(e){return null===e?"":String.prototype.trim.call(e)}:function(e){var t=/^\s+/,n=/\s+$/;return null===e?"":e.toString().replace(t,"").replace(n,"")},n=function(t){return e.isNumber(t)||e.isString(t)&&t.match(s.number)},i=function(n){return!(e.isNull(n)||e.isUndefined(n)||e.isString(n)&&""===t(n)||e.isArray(n)&&e.isEmpty(n))};return{fn:function(t,n,i,r,a){return e.isString(i)&&(i=r[i]),i.call(r,t,n,a)},required:function(t,n,r,a,s){var l=e.isFunction(r)?r.call(a,t,n,s):r;return!(!l&&!i(t))&&(l&&!i(t)?this.format(o.required,this.formatLabel(n,a)):void 0)},acceptance:function(t,n,i,r){if("true"!==t&&(!e.isBoolean(t)||!1===t))return this.format(o.acceptance,this.formatLabel(n,r))},min:function(e,t,i,r){if(!n(e)||e<i)return this.format(o.min,this.formatLabel(t,r),i)},max:function(e,t,i,r){if(!n(e)||e>i)return this.format(o.max,this.formatLabel(t,r),i)},range:function(e,t,i,r){if(!n(e)||e<i[0]||e>i[1])return this.format(o.range,this.formatLabel(t,r),i[0],i[1])},length:function(t,n,i,r){if(!e.isString(t)||t.length!==i)return this.format(o.length,this.formatLabel(n,r),i)},minLength:function(t,n,i,r){if(!e.isString(t)||t.length<i)return this.format(o.minLength,this.formatLabel(n,r),i)},maxLength:function(t,n,i,r){if(!e.isString(t)||t.length>i)return this.format(o.maxLength,this.formatLabel(n,r),i)},rangeLength:function(t,n,i,r){if(!e.isString(t)||t.length<i[0]||t.length>i[1])return this.format(o.rangeLength,this.formatLabel(n,r),i[0],i[1])},oneOf:function(t,n,i,r){if(!e.include(i,t))return this.format(o.oneOf,this.formatLabel(n,r),i.join(", "))},equalTo:function(e,t,n,i,r){if(e!==r[n])return this.format(o.equalTo,this.formatLabel(t,i),this.formatLabel(n,i))},pattern:function(e,t,n,r){if(!i(e)||!e.toString().match(s[n]||n))return this.format(o[n]||o.inlinePattern,this.formatLabel(t,r),n)}}}();return e.each(u,function(t,i){u[i]=e.bind(u[i],e.extend({},n,u))}),r}(_)}.apply(e,arguments)})}(this),require.config({deps:"undefined"!=typeof window&&window.skipMain?[]:["js/apps/discovery/main"],waitSeconds:30,config:{es6:{modules:void 0},"js/widgets/export/widget":{url:"http://adsabs-classic-exports-service.elasticbeanstalk.com",target:"/"},"js/components/persistent_storage":{namespace:"bumblebee"},"js/apps/discovery/main":{core:{controllers:{FeedbackMediator:"js/wraps/discovery_mediator",QueryMediator:"js/components/query_mediator",Diagnostics:"js/bugutils/diagnostics",AlertsController:"js/wraps/alerts_mediator",Orcid:"js/modules/orcid/module"},services:{Api:"js/services/api",PubSub:"js/services/pubsub",Navigator:"js/apps/discovery/navigator",PersistentStorage:"js/services/storage",HistoryManager:"js/components/history_manager"},objects:{User:"js/components/user",Session:"js/components/session",DynamicConfig:"discovery.vars",MasterPageManager:"js/page_managers/master",AppStorage:"js/components/app_storage",RecaptchaManager:"js/components/recaptcha_manager",CSRFManager:"js/components/csrf_manager",LibraryController:"js/components/library_controller",DocStashController:"js/components/doc_stash_controller"},modules:{FacetFactory:"js/widgets/facet/factory"}},widgets:{LandingPage:"js/wraps/landing_page_manager/landing_page_manager",SearchPage:"js/wraps/results_page_manager",DetailsPage:"js/wraps/abstract_page_manager/abstract_page_manager",AuthenticationPage:"js/wraps/authentication_page_manager",SettingsPage:"js/wraps/user_settings_page_manager/user_page_manager",OrcidPage:"js/wraps/orcid_page_manager/orcid_page_manager",OrcidInstructionsPage:"js/wraps/orcid-instructions-page-manager/manager",LibrariesPage:"js/wraps/libraries_page_manager/libraries_page_manager",HomePage:"js/wraps/home_page_manager/home_page_manager",PublicLibrariesPage:"js/wraps/public_libraries_page_manager/public_libraries_manager",ErrorPage:"js/wraps/error_page_manager/error_page_manager",Authentication:"js/widgets/authentication/widget",UserSettings:"js/widgets/user_settings/widget",UserPreferences:"js/widgets/preferences/widget",LibraryImport:"js/widgets/library_import/widget",BreadcrumbsWidget:"js/widgets/filter_visualizer/widget",NavbarWidget:"js/widgets/navbar/widget",UserNavbarWidget:"js/widgets/user_navbar/widget",AlertsWidget:"js/widgets/alerts/widget",ClassicSearchForm:"js/widgets/classic_form/widget",SearchWidget:"js/widgets/search_bar/search_bar_widget",PaperSearchForm:"js/widgets/paper_search_form/widget",Results:"js/widgets/results/widget",QueryInfo:"js/widgets/query_info/query_info_widget",QueryDebugInfo:"js/widgets/api_query/widget",ExportWidget:"js/widgets/export/widget",Sort:"js/widgets/sort/widget",ExportDropdown:"js/wraps/export_dropdown",VisualizationDropdown:"js/wraps/visualization_dropdown",AuthorNetwork:"js/wraps/author_network",PaperNetwork:"js/wraps/paper_network",ConceptCloud:"js/widgets/wordcloud/widget",BubbleChart:"js/widgets/bubble_chart/widget",Metrics:"js/widgets/metrics/widget",CitationHelper:"js/widgets/citation_helper/widget",OrcidBigWidget:"js/modules/orcid/widget/widget",AuthorFacet:"js/wraps/author_facet",BibgroupFacet:"js/wraps/bibgroup_facet",BibstemFacet:"js/wraps/bibstem_facet",DataFacet:"js/wraps/data_facet",DatabaseFacet:"js/wraps/database_facet",GrantsFacet:"js/wraps/grants_facet",KeywordFacet:"js/wraps/keyword_facet",ObjectFacet:"js/wraps/object_facet",RefereedFacet:"js/wraps/refereed_facet",VizierFacet:"js/wraps/vizier_facet",GraphTabs:"js/wraps/graph_tabs",FooterWidget:"js/widgets/footer/widget",PubtypeFacet:"js/wraps/pubtype_facet",ShowAbstract:"js/widgets/abstract/widget",ShowGraphics:"js/widgets/graphics/widget",ShowGraphicsSidebar:"js/wraps/sidebar-graphics-widget",ShowReferences:"js/wraps/references",ShowCitations:"js/wraps/citations",ShowCoreads:"js/wraps/coreads",MetaTagsWidget:"js/widgets/meta_tags/widget",ShowTableofcontents:"js/wraps/table_of_contents",ShowResources:"es6!js/widgets/resources/widget.jsx",ShowRecommender:"js/widgets/recommender/widget",ShowMetrics:"js/wraps/paper_metrics",ShowPaperExport:"js/wraps/paper_export",ShowLibraryAdd:"js/wraps/abstract_page_library_add/widget",IndividualLibraryWidget:"js/widgets/library_individual/widget",AllLibrariesWidget:"js/widgets/libraries_all/widget",LibraryListWidget:"js/widgets/library_list/widget"},plugins:{}}},map:{"*":{pubsub_service_impl:"js/services/default_pubsub",analytics_config:"discovery.vars"}},paths:{config:"./discovery.config",main:"js/apps/discovery/main",router:"js/apps/discovery/router",analytics:"js/components/analytics",underscore:"libs/lodash/lodash.compat",async:"libs/requirejs-plugins/async",babel:"libs/requirejs-babel-plugin/babel-5.8.34.min",backbone:"libs/backbone/backbone","backbone-validation":"libs/backbone-validation/backbone-validation","backbone.babysitter":"libs/backbone.babysitter/backbone.babysitter","backbone.eventbinder":"libs/backbone.eventbinder/backbone.eventbinder","backbone.stickit":"libs/backbone.stickit/backbone.stickit","backbone.wreqr":"libs/backbone.wreqr/lib/backbone.wreqr",bootstrap:"libs/bootstrap/bootstrap",cache:"libs/dsjslib/lib/Cache",chai:"../bower_components/chai/chai",classnames:"../bower_components/classnames/index",clipboard:"libs/clipboard/clipboard",d3:"libs/d3/d3","d3-cloud":"libs/d3-cloud/d3.layout.cloud","dev-react":"../bower_components/react/react-with-addons",enzyme:"libs/enzyme/enzyme","es5-shim":"libs/es5-shim/es5-shim",es6:"libs/requirejs-babel-plugin/es6",filesaver:"libs/FileSaver/FileSaver","google-analytics":"//www.google-analytics.com/analytics","google-recaptcha":"//www.google.com/recaptcha/api.js?&render=explicit&onload=onRecaptchaLoad",hbs:"libs/require-handlebars-plugin/hbs",jquery:"//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min","jquery-querybuilder":"libs/jQuery-QueryBuilder/query-builder","jquery-ui":"//ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min",marionette:"libs/marionette/backbone.marionette",mathjax:"//cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS_HTML&amp;delayStartupUntil=configured",mocha:"libs/mocha/mocha",moment:"libs/momentjs/moment","persist-js":"libs/persist-js/src/persist",react:"//cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-with-addons.min","react-backbone":"libs/react-backbone/react.backbone","react-dom":"//cdnjs.cloudflare.com/ajax/libs/react/15.6.1/react-dom.min","react-redux":"libs/react-redux/index",redux:"libs/redux/index","redux-thunk":"libs/redux-thunk/index",select2:"libs/select2/select2",sinon:"../bower_components/sinon/index",sprintf:"libs/sprintf/sprintf",squire:"../bower_components/squire/src/Squire"},hbs:{templateExtension:"html",helpers:!1},shim:{Backbone:{deps:["backbone"],exports:"Backbone"},mocha:{exports:"mocha"},"backbone.stickit":{deps:["backbone"]},"backbone-validation":{deps:["backbone"]},bootstrap:{deps:["jquery","jquery-ui"]},backbone:{deps:["jquery","underscore"]},marionette:{deps:["jquery","underscore","backbone"],exports:"Marionette"},cache:{exports:"Cache"},"jquery-querybuilder":{deps:["jquery"]},"d3-cloud":{deps:["d3"]},"jquery-ui":{deps:["jquery"]},sprintf:{exports:"sprintf"},"persist-js":{exports:"Persist"},mathjax:{exports:"MathJax",init:function(){return MathJax.Hub.Config({HTML:["input/TeX","output/HTML-CSS"],TeX:{extensions:["AMSmath.js","AMSsymbols.js"],equationNumbers:{autoNumber:"AMS"}},extensions:["tex2jax.js"],jax:["input/TeX","output/HTML-CSS"],tex2jax:{inlineMath:[["$","$"],["\\(","\\)"]],displayMath:[["$$","$$"],["\\[","\\]"]],processEscapes:!0},"HTML-CSS":{availableFonts:["TeX"],linebreaks:{automatic:!0}}}),MathJax.Hub.Startup.onload(),MathJax}}},callback:function(){require(["hbs/handlebars"],function(e){e.registerHelper("compare",function(e,t,n){var i,r;if(arguments.length<3)throw new Error("Handlerbars Helper 'compare' needs 2 parameters");if(r=void 0!==n&&n.hash&&n.hash.operator?n.hash.operator:"===",!(i={"==":function(e,t){return e==t},"===":function(e,t){return e===t},"!=":function(e,t){return e!=t},"!==":function(e,t){return e!==t},"<":function(e,t){return e<t},">":function(e,t){return e>t},"<=":function(e,t){return e<=t},">=":function(e,t){return e>=t},typeof:function(e,t){return typeof e==t}})[r])throw new Error("Handlerbars Helper 'compare' doesn't know the operator "+r);return i[r](e,t)?n.fn(this):n.inverse(this)})}),require(["backbone-validation"],function(){_.extend(Backbone.Validation.callbacks,{valid:function(e,t,n){e.$("input[name="+t+"]").closest(".form-group").removeClass("has-error").find(".help-block").html("").addClass("no-show")},invalid:function(e,t,n,i){var r=e.$("[name="+t+"]");$group=r.closest(".form-group"),!0===e.submit&&($group.addClass("has-error"),$group.find(".help-block").html(n).removeClass("no-show"))}})})}}),define("config",function(){}),define("js/components/multi_params",["backbone","underscore","jquery"],function(e,t,n){return e.Model.extend({locked:!1,_checkLock:function(){if(!0===this.locked)throw Error("Object locked for modifications")},isLocked:function(){return this.locked},lock:function(){this.locked=!0},unlock:function(){this.locked=!1},clone:function(){if(this.isLocked()){var e=new this.constructor(this.attributes);return e.lock(),e}return new this.constructor(this.attributes)},_validate:function(e,n){for(attr in e){if(!t.isString(attr))throw new Error("Keys must be strings, not: "+attr);var i=e[attr];if(i=t.without(t.flatten(i),"",!1,null,void 0,NaN),!t.isArray(i))throw new Error("Values were not converted to an Array");if(t.isEmpty(i)&&!0!==n.unset)throw new Error("Empty values not allowed");if(!t.every(i,function(e){return t.isString(e)||t.isNumber(e)&&!t.isNaN(e)}))throw new Error("Invalid value (not a string or number): "+i);e[attr]=i}return!0},set:function(n,i,r){this._checkLock();var a;if(null==n)return this;"object"==typeof n?(a=n,r=i):(a={})[n]=i;for(attr in a){var s=a[attr];t.isArray(s)||(a[attr]=t.flatten([s]))}e.Model.prototype.set.call(this,a,r)},unset:function(){this._checkLock(),e.Model.prototype.unset.apply(this,arguments)},add:function(n,i,r){this._checkLock();var a;if(null==n)return this;"object"==typeof n?(a=n,r=i):(a={})[n]=i;for(attr in a){var s=a[attr];t.isArray(s)||(s=t.flatten([s])),this.has(attr)&&(s=t.clone(this.get(attr)).concat(s)),a[attr]=s}e.Model.prototype.set.call(this,a,r)},sync:function(){throw Error("MultiParams cannot be saved to server")},url:function(e){e||(e=this.attributes);var i=t.pairs(e).sort(function(e,t){return e[0]>t[0]?1:e[0]<t[0]?-1:0}),r=n.param(t.object(i),!0);return r=r.replace(/\+/g,"%20"),r=r.replace(/%E2%80%9[ECD]/g,"%22")},parse:function(e,n){if(t.isString(e)){var i={};return(e=decodeURI(e)).indexOf("?")>-1&&(i["#path"]=[e.slice(0,e.indexOf("?"))],e=e.slice(e.indexOf("?")+1)),e.indexOf("#")>-1&&(i["#hash"]=this._parse(e.slice(e.indexOf("#")+1)),e=e.slice(0,e.indexOf("#"))),i["#query"]=this._parse(e),this._checkParsed(i)}return this._checkParsed(e)},_parse:function(e){var t,n={};if(!e.trim())return n;for(var i,r,a=e.slice(e.indexOf("?")+1).split("&"),s=0;s<a.length;s++){t=a[s].split("="),i=decodeURIComponent(t[0].split("+").join(" "));var o=t[1];t.length>2&&(t.shift(),o=t.join("=")),r=decodeURIComponent(o.split("+").join(" ")),void 0!==n[i]?n[i].push(r):n[i]=[r]}return n},_checkParsed:function(e){return t.isObject(e)&&"#query"in e?e["#query"]:e},load:function(e){this._checkLock();var t=this.parse(e);return this.clear(),this.set(t),this}})}),define("js/components/solr_params",["js/components/multi_params","backbone","underscore","jquery"],function(e,t,n,i){return e.extend({fieldsToConcatenate:[],defaultOperator:" ",fieldProcessors:{"*":function(e,t){return[e.join(t.defaultOperator)]}},initialize:function(e,t){t&&n.extend(this,n.pick(t,["fieldsToConcatenate","defaultOperator","fieldProcessors"]))},url:function(t,i){for(var r=n.clone(this.attributes),a=this.fieldsToConcatenate.length,s="",o=0;o<a;o++)s=this.fieldsToConcatenate[o],this.has(s)&&(this.fieldProcessors[s]?r[s]=this.fieldProcessors[s](this.get(s),this):r[s]=this.fieldProcessors["*"](this.get(s),this));return e.prototype.url.call(this,r)}})}),define("js/components/facade",["underscore","js/components/facade"],function(e,t){"use strict";return(t=function(e,t){var n;return n={},this.mixIn(e,t,n),n.mixIn=this.mixIn,n}).prototype.mixIn=function(t,n,i){var r,a;i=i||this;for(r in t)if(a=t[r],r in n){var s=n[r];if("function"==typeof a)i[r]=e.bind(a,n);else if("function"==typeof s)i[r]=e.bind(s,n);else if(e.isUndefined(s));else if(e.isString(s)||e.isNumber(s)||e.isBoolean(s)||e.isDate(s)||e.isNull(s)||e.isRegExp(s))i["get"+r.substring(0,1).toUpperCase()+r.substring(1)]=e.bind(function(){return this.ctx[this.name]},{ctx:n,name:r}),i[r]=s;else if(s.hasOwnProperty("__facade__")&&s.__facade__)i[r]=s;else{if(!(e.isObject(s)&&"getHardenedInstance"in s))throw new Error("Sorry, you can't wrap '"+r+"': "+s);i[r]=s.getHardenedInstance()}}else{if("function"!=typeof a)throw new Error("Unknown key: "+r+"("+a+")");i[r]=e.bind(a,n)}return i.__facade__=!n||Boolean(!n.constructor||(!n.constructor.name||n.constructor.name)),i},t}),define("js/components/api_query",["backbone","underscore","js/components/solr_params","js/components/facade"],function(e,t,n,i){var r={add:"add values",set:"set (replace existing)",get:"get values",has:"has a key",url:"url string of the params",load:"loads query as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},a=function(e,t){this.innerQuery=e instanceof n?new i(r,e):new i(r,new n(e,t))},s={};return t.each(t.keys(r),function(e,t,n){s[e]=function(){return this.innerQuery[e].apply(this.innerQuery,arguments)}}),t.extend(a.prototype,s,{clone:function(){var e=this.innerQuery.clone.apply(this.innerQuery,arguments);return new a(e)},load:function(){var e=this.innerQuery.load.apply(this.innerQuery,arguments);return new a(e)}}),a}),define("js/components/pubsub_events",[],function(){return{START_SEARCH:"[PubSub]-New-Query",INVITING_REQUEST:"[PubSub]-Inviting-Request",DELIVERING_REQUEST:"[PubSub]-New-Request",EXECUTE_REQUEST:"[PubSub]-Execute-Request",EXECUTE_STORED_QUERY:"[PubSub]-Execute-Stored-Query",DELIVERING_RESPONSE:"[PubSub]-New-Response",CLOSING_GATES:"[PubSub]-Closing",CLOSED_FOR_BUSINESS:"[PubSub]-Closed",OPENING_GATES:"[PubSub]-Opening",OPEN_FOR_BUSINESS:"[PubSub]-Ready",SMALL_FIRE:"[PubSub]-Problem",BIG_FIRE:"[PubSub]-Big-Problem",CITY_BURNING:"[PubSub]-Disaster",FEEDBACK:"[FC]-FeedBack",DISPLAY_DOCUMENTS:"[Router]-Display-Documents",DISPLAY_DOCUMENTS_DETAILS:"[Router]-Display-Documents-Details",GET_QTREE:"[FC]-GetQTree",NAVIGATE:"[Router]-Navigate-With-Trigger",PAGE_CHANGE:"[Navigator]Page-Changed",CUSTOM_EVENT:"[PubSub]-Custom-Event",ARIA_ANNOUNCEMENT:"[PubSub]-Aria-Announcement",USER_ANNOUNCEMENT:"[PubSub]-User-Announcement",ALERT:"[Alert]-Message",ORCID_ANNOUNCEMENT:"[PubSub]-Orcid-Announcement",APP_LOADED:"[App]-Application-Loaded",APP_BOOTSTRAPPED:"[App]-Application-Bootstrapped",APP_STARTING:"[App]-Application-Starting",APP_STARTED:"[App]-Application-Started",APP_EXIT:"[App]-Exit",PAPER_SELECTION:"[User]-Paper-Selection",BULK_PAPER_SELECTION:"[User]-Bulk-Paper-Selection",STORAGE_PAPER_UPDATE:"[User]-Paper-Update",LIBRARY_CHANGE:"[PubSub]-Library-Change"}}),define("js/components/pubsub_key",["underscore"],function(e){var t=function(t){e.extend(this,t)};return e.extend(t,{newInstance:function(n){var i={id:e.has(n,"id")?n.id:e.uniqueId(":psk"),creator:e.has(n,"creator")?n.creator:null};return new t({getId:function(){return i.id},getCreator:function(){return i.creator}})}}),t}),define("js/mixins/dependon",["underscore","js/components/pubsub_events","js/components/pubsub_key"],function(e,t,n){return{BeeHive:{setBeeHive:function(t){if(e.isEmpty(t))throw new Error("Huh? Empty Beehive? Trying to be funny?");this.__beehive=t},getBeeHive:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactivate (or dead :<})");return this.__beehive},hasBeeHive:function(){return!(!this.__beehive||!(this.__beehive.active||this.__beehive.__facade__&&this.__beehive.getActive()))},getPubSub:function(){if(!this.hasBeeHive())throw new Error("The BeeHive is inactive (or dead >:})");if(this.__ctx||(this.__ctx={}),this.__ctx.pubsub)return this.__ctx.pubsub;var i=this.__beehive.getService("PubSub");return i&&i.__facade__?i:(this.__ctx.pubsub={_key:i.getPubSubKey(),_exec:function(t,r){if((r=e.toArray(r))[0]instanceof n)throw Error("You have given us a PubSub key, this.publish() method does not need it.");r.unshift(this._key),i[t].apply(i,r)},publish:function(){this._exec("publish",arguments)},subscribe:function(){this._exec("subscribe",arguments)},subscribeOnce:function(){this._exec("subscribeOnce",arguments)},unpublish:function(){this._exec("unpublish",arguments)},getCurrentPubSubKey:function(){return this._key}},e.extend(this.__ctx.pubsub,t),this.__ctx.pubsub)},hasPubSub:function(){return!!this.hasBeeHive()&&e.isObject(this.__beehive.getService("PubSub"))}},App:{setApp:function(t){if(e.isUndefined(t))throw new Error("App object cannot be empty");this.__app=t},getApp:function(){return this.__app},hasApp:function(){return!e.isEmpty(this.__app)}}}}),define("js/mixins/hardened",["underscore","js/components/facade"],function(e,t){return{_getHardenedInstance:function(e,n){if(!("hardenedInterface"in this||e))throw Error("Error: this.hardenedInterface is not defined");return new t(e||("hardenedInterface"in this?this.hardenedInterface:{}),n)},getHardenedInstance:function(e){return this._getHardenedInstance(e,this)}}}),define("js/components/api_feedback",["underscore","backbone","js/mixins/hardened"],function(e,t,n){var i=function(t){e.extend(this,e.defaults(t||{},{code:200,msg:void 0})),this.setCode(this.code)};i.CODES={INVALID_PASSWORD:498,ACCOUNT_NOT_FOUND:495,ALREADY_LOGGED_IN:493,REQUIRES_LOGIN:491,TOO_MANY_CHARACTERS:486,BAD_REQUEST:400,UNAUTHORIZED:401,NOT_FOUND:404,INTERNAL_SERVER_ERROR:500,BAD_GATEWAY:502,SERVER_ERROR:503,TOO_MANY_FAILURES:580,ALL_FINE:200,KEEP_WAITING:190,TESTING:0,MAKE_SPACE:-1,UNMAKE_SPACE:-1.1,SEARCH_CYCLE_STARTED:-2,SEARCH_CYCLE_FAILED_TO_START:-3,SEARCH_CYCLE_PROGRESS:-4,SEARCH_CYCLE_STOP_MONITORING:-5,SEARCH_CYCLE_FINISHED:-6,QUERY_ASSISTANT:-7,ALERT:-8,CANNOT_ROUTE:-9,API_REQUEST_ERROR:-10,BIBCODE_DATA_REQUESTED:-11};var r={};return e.each(e.pairs(i.CODES),function(e){r[e[1]]=e[0]}),e.extend(i.prototype,{hardenedInterface:{code:"integer value of the code",msg:"string message",toJSON:"for cloning",getApiRequest:"to get the original request",getSenderKey:"retrieve the senders key"},initialize:function(){},toJSON:function(){return{code:this.code,msg:this.msg}},setCode:function(e){if(!r[e])throw new Error("This code is not in the list ApiCodes - please extend js/components/api_feedback first:",this.code);this.code=e},setApiRequest:function(e){this.req=e},getApiRequest:function(){return this.req},setMsg:function(e){this.msg=e},getSenderKey:function(){return this.senderKey},setSenderKey:function(e){this.senderKey=e}},n),i.extend=t.Model.extend,i}),define("js/components/default_request",["underscore","backbone","js/components/api_query","js/components/multi_params"],function(e,t,n,i){var r=function(t){if(e.isString(t))return!0;if(e.isArray(t))for(var n=t.length,i=0;i<n;i++){var r=t[i];if(!e.isString(r)&&!e.isNumber(r))return!1}return!0},a={query:function(t){return!!e.isUndefined(t)||t instanceof n},target:r,sender:r,options:r};return i.extend({_validate:function(e,t){for(attr in e){var n=e[attr];if(!(attr in a))throw new Error("Invalid attr: "+attr);if(!a[attr].call(a,n))throw new Error("Invalid value:key "+attr+n)}return!0},set:function(e,n,i){this._checkLock();var r;if(null==e)return this;"object"==typeof e?(r=e,i=n):(r={})[e]=n,t.Model.prototype.set.call(this,r,i)},_checkParsed:function(t){if(e.isObject(t)){var i={};return"#query"in t&&!e.isEmpty(t["#query"])&&(i.query=new n(t["#query"])),"#path"in t&&(i.target=t["#path"][0]),"#hash"in t&&e.extend(i,e.each(t["#hash"],function(e,t,n){1==e.length&&(n[t]=e[0])})),i}return t},url:function(t){t||(t=this.attributes);var n=t.target,r=n?e.isArray(n)?n.join("/"):n:"";return"query"in t&&(r+="?"+t.query.url()),"sender"in t&&(r+="#"+i.prototype.url.call(this,{sender:t.sender})),r},load:function(e){return i.prototype.load.call(this,e.indexOf("?")>-1?e:e+"?")}})}),define("js/components/api_request",["underscore","backbone","js/components/facade","js/components/default_request"],function(e,t,n,i){var r={get:"get a key",set:"set (replace existing)",url:"url string defining this request",has:"has a key",load:"loads request as a string",clear:"clears all values",unset:"removes a key",toJSON:"values back as JSON object",clone:"make a copy",isLocked:!0,lock:!0,unlock:!0,pairs:"get all values as pairs",keys:"as keys",values:"only values",hasChanged:"whether this object has modification (since its creation)",previousAttributes:"get all changed attributes",previous:"previous values for a given attribute"},a=function(e,t){this.innerRequest=e instanceof i?new n(r,e):new n(r,new i(e,t))},s={};return e.each(e.keys(r),function(e,t,n){s[e]=function(){return this.innerRequest[e].apply(this.innerRequest,arguments)}}),e.extend(a.prototype,s,{clone:function(){var e=this.innerRequest.clone.apply(this.innerRequest,arguments);return new a(e)},load:function(){var e=this.innerRequest.load.apply(this.innerRequest,arguments);return new a(e)}}),a}),define("js/components/api_targets",["underscore","backbone"],function(e,t){var n={BOOTSTRAP:"/accounts/bootstrap",SEARCH:"search/query",QTREE:"search/qtree",BIGQUERY:"search/bigquery",EXPORT:"export/",SERVICE_AUTHOR_NETWORK:"vis/author-network",SERVICE_PAPER_NETWORK:"vis/paper-network",SERVICE_WORDCLOUD:"vis/word-cloud",SERVICE_METRICS:"metrics",SERVICE_OBJECTS:"objects",SERVICE_OBJECTS_QUERY:"objects/query",SERVICE_CITATION_HELPER:"citation_helper",MYADS_STORAGE:"vault",CSRF:"accounts/csrf",USER:"accounts/user",USER_DATA:"vault/user-data",SITE_CONFIGURATION:"vault/configuration",TOKEN:"accounts/token",LOGOUT:"accounts/logout",REGISTER:"accounts/register",VERIFY:"accounts/verify",DELETE:"accounts/user/delete",RESET_PASSWORD:"accounts/reset-password",CHANGE_PASSWORD:"accounts/change-password",CHANGE_EMAIL:"accounts/change-email",RECOMMENDER:"recommender",GRAPHICS:"graphics",FEEDBACK:"feedback/slack",LIBRARY_IMPORT_CLASSIC_AUTH:"harbour/auth/classic",LIBRARY_IMPORT_CLASSIC_MIRRORS:"harbour/mirrors",LIBRARY_IMPORT_CLASSIC_TO_BBB:"biblib/classic",LIBRARY_IMPORT_ADS2_AUTH:"harbour/auth/twopointoh",LIBRARY_IMPORT_ADS2_TO_BBB:"biblib/twopointoh",LIBRARY_IMPORT_ZOTERO:"harbour/export/twopointoh/zotero",LIBRARY_IMPORT_MENDELEY:"harbour/export/twopointoh/mendeley",LIBRARY_IMPORT_CREDENTIALS:"harbour/user",ORCID_PREFERENCES:"orcid/preferences",LIBRARIES:"biblib/libraries",DOCUMENTS:"biblib/documents",PERMISSIONS:"biblib/permissions",_limits:{ExportWidget:{default:500,limit:3e3},Metrics:{default:6e3,limit:6e3},AuthorNetwork:{default:400,limit:1e3},PaperNetwork:{default:400,limit:1e3},ConceptCloud:{default:150,limit:150},BubbleChart:{default:1500}}};return n._doesntNeedCredentials=[n.SEARCH,n.QTREE,n.BIGQUERY,n.EXPORT,n.SERVICE_AUTHOR_NETWORK,n.SERVICE_PAPER_NETWORK,n.SERVICE_WORDCLOUD,n.SERVICE_METRICS,n.RECOMMENDER,n.GRAPHICS,n.FEEDBACK],n}),define("js/mixins/api_access",["underscore","backbone","js/components/api_query","js/components/api_request"],function(e,t,n,i){return{onBootstrap:function(e){if(e.access_token){this.getBeeHive().getService("Api").setVals({access_token:e.token_type+":"+e.access_token,refresh_token:e.refresh_token,expire_in:e.expire_in}),console.warn("Redefining access_token: "+e.access_token);var t=this.getBeeHive().getObject("User"),n=e.anonymous?void 0:e.username;t.setUser(n)}else console.warn("bootstrap didn't provide access_token!")},getApiAccess:function(e){e=e||{};var t=this.getBeeHive().getService("Api"),r=location.origin+location.pathname,a=this,s=$.Deferred();return t[e.tokenRefresh?"_request":"request"](new i({query:new n({redirect_uri:r}),target:this.bootstrapUrls?this.bootstrapUrls[0]:"/accounts/bootstrap"}),{done:function(t){e.reconnect&&a.onBootstrap(t),s.resolve(t)},fail:function(){s.reject(arguments)},type:"GET"}),s}}}),define("js/components/api_query_updater",["underscore","js/components/api_query"],function(e,t){var n=function(t,n){if(!t||!e.isString(t))throw new Error("You must initialize the ApiQueryUpdater with a context (which is a string)");this.context=t,this.defaultOperator=" ",this.operators=[" ","AND","OR","NOT","NEAR"],this.defaultMode="limit",this.operationModes=["limit","exclude","expand","replace"],this.impossibleString="￼￼￼",e.extend(this,n)};return e.extend(n.prototype,{updateQuery:function(t,n,i,r){if(!n||!e.isString(n))throw new Error("You must tell us what parameter to update in the ApiQuery");r=this._sanitizeConditionAsArray(r);var a;if("limit"==(i=this._sanitizeMode(i)))a="AND";else if("exclude"==i)a="NOT";else{if("expand"!=i){if("replace"==i)return this._closeExistingVals(t,this._n(n)),t.set(this._n(n),["AND",r[0]]),t.set(n,r[0]);throw new Error("Unsupported mode/operator:",i)}a="OR"}if(!t.has(n)){var s=[a].concat(r);return t.set(n,this._buildQueryFromConditions(s)),void t.set(this._n(n),s)}var o,l,c,u,d=this._n(n),h=e.clone(t.get(n));if(u=this._getExistingVals(t,d)){if(u[0]!==a)return this._closeExistingVals(t,d),this.updateQuery(t,n,i,r);o=this._buildQueryFromConditions(u)}else if(u=[a],1==h.length)if(-1==h[0].indexOf(" "))o=h[0],u.push(h[0]);else{o=h[0];var p=h[0].toLowerCase();p.indexOf(" and ")>-1||p.indexOf(" or ")>-1||p.indexOf(" not ")>-1||p.indexOf(" near")>-1||p.indexOf("(")>2?u.push("("+h[0]+")"):u.push(h[0])}else o=this.impossibleString;if("limit"==i||"expand"==i){c=e.union(u,r),l=this._buildQueryFromConditions(c);m=e.clone(h);if(this._modifyArrayReplaceString(m,o,l))return t.set(n,m),void t.set(d,c)}if("exclude"==i){var f=e.clone(u);f[0]="OR",o=" NOT "+this._buildQueryFromConditions(f),c=e.union(u,r);var g=e.clone(c);g[0]="OR",l=" NOT "+this._buildQueryFromConditions(g);var m=e.clone(h);if(this._modifyArrayReplaceString(m,o,l))return t.set(n,m),void t.set(d,c)}"limit"==i?c=this._modifyArrayAddString(h,r,"AND"):"exclude"==i?c=this._modifyArrayAddString(h,r,"NOT"):"expand"==i&&(c=this._modifyArrayAddString(h,r,"OR")),t.set(d,c),t.set(n,h)},needsEscape:function(e){for(var t,n=0;n<e.length;n++)if("\\"==(t=e[n])||"+"==t||"-"==t||"!"==t||"("==t||")"==t||":"==t||"^"==t||"["==t||"]"==t||'"'==t||"{"==t||"}"==t||"~"==t||"*"==t||"?"==t||"|"==t||"&"==t||"/"==t)return!0;return!1},escape:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t||n.push("\\"),n.push(t);return n.join("")},escapeInclWhitespace:function(e){for(var t,n=[],i=0;i<e.length;i++)"\\"!=(t=e[i])&&"+"!=t&&"-"!=t&&"!"!=t&&"("!=t&&")"!=t&&":"!=t&&"^"!=t&&"["!=t&&"]"!=t&&'"'!=t&&"{"!=t&&"}"!=t&&"~"!=t&&"*"!=t&&"?"!=t&&"|"!=t&&"&"!=t&&"/"!=t&&" "!=t&&"\t"!=t||n.push("\\"),n.push(t);return n.join("")},quoteIfNecessary:function(e,t,n){return this.quote(e,t,n,!0)},quote:function(t,n,i,r){n||(n='"'),i||(i=n),e.isUndefined(r)&&(r=!1);for(var a,s=[],o=!1,l=0;l<t.length;l++)"\\"!=(a=t[l])&&"+"!=a&&"-"!=a&&"!"!=a&&"("!=a&&")"!=a&&":"!=a&&"^"!=a&&"["!=a&&"]"!=a&&'"'!=a&&"{"!=a&&"}"!=a&&"~"!=a&&"|"!=a&&"&"!=a&&"/"!=a&&" "!=a&&"\t"!=a||(o=!0),a!=n&&a!=i||!(0==l||l>0&&"\\"!==t[l-1])||s.push("\\"),s.push(a);return 1==r&&"\\"==s[0]&&'"'==s[1]&&"\\"==s[s.length-2]&&'"'==s[s.length-1]?(s[0]="",s[s.length-2]="",s.join("")):o||0==r?n+s.join("")+i:s.join("")},saveTmpEntry:function(e,t,n){var i,r=this._getTmpStorage(e,!0);return t in r&&(i=r[t]),r[t]=n,i},removeTmpEntry:function(e,t){var n=this._getTmpStorage(e,!0),i=n[t];return delete n[t],i},getTmpEntry:function(e,t,n){var i;return i=n?this._getTmpStorage(e,!0):this._getTmpStorage(e,!1),t in i?i[t]:(i[t]=n,n)},hasTmpEntry:function(e,t){return t in this._getTmpStorage(e)},_getTmpStorage:function(e,t){var n=this._n("__tmpStorage");if(!e.hasOwnProperty(n)){if(!t)return{};e[n]={}}return e[n]},_n:function(e){return"__"+this.context+"_"+e},_buildQueryFromConditions:function(e){if(e.length<=1)throw new Error("Violation of contract: first condition is always an operator");var t=e[0];return" "!=t&&(t=" "+t+" "),"("+e.slice(1).join(t)+")"},_modifyArrayReplaceString:function(t,n,i,r){var a=0;if(r||(r=-1),!n)throw new Error("Your search is empty, you fool");return e.each(t,function(e,s){r>0&&a>r||e.indexOf(n)>-1&&(t[s]=e.replace(n,i),a+=1)}),a},_modifyArrayAddString:function(e,t,n){if(!(0!=e.length&&""!=e[e.length-1].trim()||"NOT"!=n&&"NEAR"!=n))throw new Error("Invalid operation; cannot apply NOT/NEAR on single clause");var i=[n,e[e.length-1]].concat(t);return e[e.length-1]=this._buildQueryFromConditions(i),i},_getExistingVals:function(e,t,n){return e.has(t)?e.get(t):n},_closeExistingVals:function(e,t){e.unset(t)},_sanitizeMode:function(t){if(!t)return this.defaultMode;var n=e.indexOf(this.operationModes,t);if(-1==n)throw new Error("Unkwnown mode: "+t);return this.operationModes[n]},_sanitizeOperator:function(t){if(!t)return this.defaultOperator;if(!e.isString(t))throw new Error("Operator must be a string");if(""==t.trim())return this.defaultOperator;t=t.toUpperCase();var n=e.indexOf(this.operators,t);if(-1==n)throw new Error("Unknown operator: ",t);return this.operators[n]},_sanitizeConditionAsArray:function(t){if(!t)throw new Error("The condition must be set (string/array of strings)");if(e.isString(t))return[t];if(0==(t=e.without(e.flatten(t),"",!1,null,void 0,NaN)).length)throw new Error("After removing empty values, no condition was left");return t},clean:function(n){var i={};return n&&n.keys&&e.each(n.keys(),function(e){"__"!=e.substring(0,2)&&(i[e]=n.get(e))}),new t(i)}}),n}),define("router",["jquery","backbone","js/components/api_query","js/mixins/dependon","js/components/api_feedback","js/components/api_request","js/components/api_targets","js/mixins/api_access","js/components/api_query_updater"],function(e,t,n,i,r,a,s,o,l){"use strict";var c=t.Router.extend({initialize:function(e){e=e||{},this.queryUpdater=new l("Router")},activate:function(e){if(this.setBeeHive(e),!this.hasPubSub())throw new Exception("Ooops! Who configured this #@$%! There is no PubSub service!")},routerNavigate:function(e,t){var t=t||{};_.extend(t,{replace:!0}),this.getPubSub().publish(this.getPubSub().NAVIGATE,e,t)},routes:{"":"index","classic-form":"classicForm","paper-form":"paperForm","index/(:query)":"index","search/(:query)(/)(:widgetName)":"search","execute-query/(:query)":"executeQuery","abs/:bibcode(/)(:subView)":"view","user/orcid*(:subView)":"orcidPage","user/account(/)(:subView)":"authenticationPage","user/account/verify/(:subView)/(:token)":"routeToVerifyPage","user/settings(/)(:subView)(/)":"settingsPage","user/libraries(/)(:id)(/)(:subView)(/)(:subData)(/)":"librariesPage","user/home":"homePage","orcid-instructions":"orcidInstructions","public-libraries/(:id)(/)":"publicLibraryPage","*invalidRoute":"noPageFound"},index:function(e){this.routerNavigate("index-page")},classicForm:function(){this.routerNavigate("ClassicSearchForm")},paperForm:function(){this.routerNavigate("PaperSearchForm")},search:function(e,t){var i=["metrics","author-network","paper-network","concept-cloud","bubble-chart"];if(e)try{var a=(new n).load(e);this.getPubSub().publish(this.getPubSub().START_SEARCH,a)}catch(t){console.error("Error parsing query from a string: ",e,t),this.getPubSub().publish(this.getPubSub().BIG_FIRE,new r({code:r.CODES.CANNOT_ROUTE,reason:"Cannot parse query",query:e}))}else this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page");t&&i.indexOf(t)>-1?this.getPubSub().subscribeOnce(this.getPubSub().NAVIGATE,_.bind(function(e){"results-page"==e&&this.getPubSub().publish(this.getPubSub().NAVIGATE,"show-"+t)},this)):t&&-1==i.indexOf(t)&&console.error("Results page subpage not recognized:",t)},executeQuery:function(e){this.getPubSub().publish(this.getPubSub().NAVIGATE,"execute-query",e)},view:function(e,t){var i,r,o;o=this,i=new n({q:"identifier:"+this.queryUpdater.quoteIfNecessary(e),fl:"bibcode"}),r=new a({query:i,target:s.SEARCH,options:{done:function(r){var a,s;t?(a="Show"+t[0].toUpperCase()+t.slice(1),s="#abs/"+e+"/"+t):a="ShowAbstract",o.routerNavigate(a,{href:s}),r.response&&r.response.docs&&r.response.docs[0]?(e=r.response.docs[0].bibcode,o.getPubSub().publish(o.getPubSub().DISPLAY_DOCUMENTS,new n({q:"bibcode:"+e}))):r.response&&r.response.docs&&!r.response.docs.length&&console.error("the query  "+i.get("q")[0]+"  did not return any bibcodes")},fail:function(){console.log("Cannot identify page to load, bibcode: "+e),o.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page")}}}),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,r)},routeToVerifyPage:function(e,t){function n(e,t,n){this.getPubSub().publish(this.getPubSub().NAVIGATE,"index-page");var a=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown";this.getPubSub().publish(this.getPubSub().ALERT,new r({code:0,title:o,msg:" <b>"+a+"</b> <br/>"+i,modal:!0,type:"danger"}))}var i,o,l,c,u,d,h=this;"register"==e?(o="Registration failed.",i="<p>Please try again, or contact <b> adshelp@cfa.harvard.edu for support </b></p>",l=s.VERIFY+"/"+t,c=function(e){this.getApiAccess({reconnect:!0}).done(function(){h.getPubSub().publish(h.getPubSub().NAVIGATE,"index-page");var t="<p>You have been successfully registered with the username</p> <p><b>"+e.email+"</b></p>";h.getPubSub().publish(h.getPubSub().ALERT,new r({code:0,title:"Welcome to ADS",msg:t,modal:!0,type:"success"}))}).fail(function(){n()})}):"change-email"==e?(o="Attempt to change email failed",i="Please try again, or contact adshelp@cfa.harvard.edu for support",l=s.VERIFY+"/"+t,c=function(e){this.getApiAccess({reconnect:!0}).done(function(){h.getPubSub().publish(h.getPubSub().NAVIGATE,"index-page");var t="Your new ADS email is <b>"+e.email+"</b>";h.getPubSub().publish(h.getPubSub().ALERT,new r({code:0,title:"Email has been changed.",msg:t,modal:!0,type:"success"}))}).fail(function(){this.apply(n,arguments)})}):"reset-password"==e&&(c=function(){this.getBeeHive().getObject("Session").setChangeToken(t),this.getPubSub().publish(this.getPubSub().NAVIGATE,"authentication-page",{subView:"reset-password-2"})},i="Reset password token was invalid.",l=s.RESET_PASSWORD+"/"+t,d="GET"),u=new a({target:l,options:{type:d||"GET",context:this,done:c,fail:n}}),this.getBeeHive().getService("Api").request(u)},orcidPage:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"orcid-page")},orcidInstructions:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"orcid-instructions")},authenticationPage:function(e){if(e&&!_.contains(["login","register","reset-password-1","reset-password-2"],e))throw new Error("that isn't a subview that the authentication page knows about");this.routerNavigate("authentication-page",{subView:e})},settingsPage:function(e){_.contains(["token","password","email","delete"],e)?this.routerNavigate("UserSettings",{subView:e}):_.contains(["librarylink","orcid"],e)?this.routerNavigate("UserPreferences",{subView:e}):this.routerNavigate("UserPreferences",{subView:void 0})},librariesPage:function(e,t,n){if(e){var t=t||"library";if(_.contains(["library","admin"],t))this.routerNavigate("IndividualLibraryWidget",{subView:t,id:e});else{if(!_.contains(["export","metrics","visualization"],t))throw new Error("did not recognize subview for library view");"library-export"==(t="library-"+t)?this.routerNavigate(t,{subView:n||"bibtex",id:e}):"library-metrics"==t&&this.routerNavigate(t,{id:e})}}else this.routerNavigate("AllLibrariesWidget","libraries")},publicLibraryPage:function(e){this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{id:e,publicView:!0,subView:"library"})},homePage:function(e){this.routerNavigate("home-page",{subView:e})},noPageFound:function(){this.routerNavigate("404")},_extractParameters:function(e,t){return _.map(e.exec(t).slice(1),function(e){return/q\=/.test(e)?e:e?decodeURIComponent(e):e})}});return _.extend(c.prototype,i.BeeHive,o),c}),define("js/components/generic_module",["backbone","underscore"],function(e,t){var n=["className","activate"],i=function(e){e=e||{},this.mid=t.uniqueId("module"),t.extend(this,t.pick(e,n)),this.initialize.call(this,e)};return t.extend(i.prototype,e.Events,{className:"GenericModule",initialize:function(){},destroy:function(){},activate:function(e){t.extend(this,t.pick(e,n))}}),i.extend=e.Model.extend,i}),define("js/components/services_container",["js/components/facade","js/components/generic_module","js/mixins/hardened","underscore"],function(e,t,n,i){var r=t.extend({initialize:function(e){this._services=i.has(e,"services")?i.clone(e.services):{}},activate:function(){var e=arguments;i.each(i.values(this._services),function(t){i.isObject(t)&&"activate"in t&&t.activate.apply(t,e)})},destroy:function(){for(var e in this._services)this.remove(e)},add:function(e,t){if(this._services.hasOwnProperty(e))throw new Error("The service: "+e+" is already registered, remove it first!");if(!e||!t||!i.isString(e))throw new Error("The key must be a string and the service is an object");this._services[e]=t},remove:function(e,t){if(this._services.hasOwnProperty(e)){var n=this._services[e];return"destroy"in n&&n.destroy(),delete this._services[e],n}return null},has:function(e){return this._services.hasOwnProperty(e)},get:function(e){return this._services[e]},getAll:function(){return i.pairs(this._services)}});return i.extend(r.prototype,n,{getHardenedInstance:function(){var e,t={};for(service in this._services)e=this._services[service],i.isObject(e)&&"getHardenedInstance"in e&&(t[service]=!0);var n=new this.constructor({services:this._getHardenedInstance(t,this._services)});return this._getHardenedInstance({get:!0,has:!0},n)}}),r}),define("js/components/beehive",["backbone","underscore","js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/services_container"],function(e,t,n,i,r,a){var s=[],o=n.extend({initialize:function(e){t.extend(this,t.pick(e,s)),this.Services=new a,this.Objects=new a,this.debug=!1,this.active=!0},activate:function(){this.Services.activate.apply(this.Services,arguments),this.Objects.activate(this),this.active=!0},destroy:function(){this.Services.destroy(arguments),this.Objects.destroy(arguments),this.active=!1},getService:function(e){return this.Services.get(e)},hasService:function(e){return this.Services.has(e)},addService:function(e,t){return this.Services.add(e,t)},removeService:function(e){return this.Services.remove(e)},getObject:function(e){return this.Objects.get(e)},hasObject:function(e){return this.Objects.has(e)},addObject:function(e,t){return this.Objects.add(e,t)},removeObject:function(e){return this.Objects.remove(e)},getDebug:function(){return this.debug},getAllServices:function(){return this.Services.getAll()},getAllObjects:function(){return this.Objects.getAll()},hardenedInterface:{Services:"services container",Objects:"objects container",debug:"state of the app",active:"active or not",getHardenedInstance:"allow to create clone of the already hardened instance"}});return t.extend(o.prototype,r,{getHardenedInstance:function(e){(e=t.clone(e||this.hardenedInterface)).getService=function(e){return n.Services.get(e)},e.hasService=function(e){return n.Services.has(e)},e.getObject=function(e){return n.Objects.get(e)},e.hasObject=function(e){return n.Objects.has(e)};var n=this._getHardenedInstance(e,this);return n}}),o}),define("js/components/application",["underscore","jquery","backbone","module","js/components/beehive","js/mixins/api_access"],function(e,t,n,i,r,a){var s=function(t){t||(t={}),this.aid=e.uniqueId("application"),this.debug=!0,e.extend(this,e.pick(t,["timeout","debug"])),this.initialize.apply(this,arguments)},o=function(){this.container={}};return e.extend(o.prototype,{has:function(e){return this.container.hasOwnProperty(e)},get:function(e){return this.container[e]},remove:function(e){delete this.container[e]},add:function(e,t){this.container[e]=t}}),e.extend(s.prototype,{initialize:function(e,t){this.__beehive=new r,this.__modules=new o,this.__controllers=new o,this.__widgets=new o,this.__plugins=new o,this.__barbarianRegistry={},this.__barbarianInstances={}},shim:function(){window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))},loadModules:function(n,i){var r,a=[],s=this,o=n.core;o&&e.each(["controllers","modules","services","objects"],function(e){o[e]&&(r=s._loadModules(e,o[e]))&&a.push(r)});var l=n.plugins;l&&(r=s._loadModules("plugins",l))&&a.push(r);var c=n.widgets;return c&&(r=s._loadModules("widgets",c))&&a.push(r),1==a.length&&a.push(r),t.when.apply(t,a).then(function(){e.each(arguments,function(t,n){e.isArray(t)&&(s.debug&&console.log("application: registering "+t[0]),s._registerLoadedModules.apply(s,t))})}).fail(function(){console.error("Generic error - we were not successul in loading all modules for config",n),arguments.length&&console.error(arguments)})},getBeeHive:function(){return this.__beehive},_registerLoadedModules:function(t,n){var i,r,a,s,o,l,c=this.getBeeHive(),u=this;if(l=function(e,t){if(t)return u.debug&&console.log("Creating instance of: "+e),t.prototype?new t:t&&t.hasOwnProperty(e)?t[e]:t;console.warn("Object "+e+" is empty, cannot instantiate it!")},"controllers"==t)a=e.bind(this.hasController,this),o=e.bind(function(e){this.__controllers.remove(e)},this),s=e.bind(function(e,t){this.__controllers.add(e,t)},this);else if("services"==t)a=e.bind(c.hasService,c),o=e.bind(c.removeService,c),s=e.bind(c.addService,c);else if("objects"==t)a=e.bind(c.hasObject,c),o=e.bind(c.removeObject,c),s=e.bind(c.addObject,c);else if("modules"==t)l=function(e,t){return t},a=e.bind(this.hasModule,this),o=e.bind(function(e){this.__modules.remove(e)},this),s=e.bind(function(e,t){this.__modules.add(e,t)},this);else if("widgets"==t)a=e.bind(this.hasWidget,this),o=e.bind(function(e){this.__widgets.remove(e)},this),s=e.bind(function(e,t){this.__widgets.add(e,t)},this),l=function(e,t){return t};else{if("plugins"!=t)throw new Error("Unknown section: "+t);a=e.bind(this.hasPlugin,this),o=e.bind(function(e){this.__plugins.remove(e)},this),s=e.bind(function(e,t){this.__plugins.add(e,t)},this),l=function(e,t){return t}}e.each(e.pairs(n),function(e){i=e[0],r=e[1],a(i)&&(console.warn("Removing (existing) object into ["+t+"]: "+i),o(i));var n=l(i,r);n?s(i,n):console.warn("Removing "+i+"(because it is null!)")})},_checkPrescription:function(t){e.each(e.pairs(t),function(t,n,i){var r=t[0],a=t[1];if(!e.isString(r)||!e.isString(a))throw new Error("You are kidding me, the key/implementation must be string values")})},_loadModules:function(n,i,r){var a=this;this._checkPrescription(i),this.debug&&console.log("application: loading "+n,i);var s={},o=e.keys(i),l=e.values(i),c=t.Deferred();return a.debug&&console.time("startLoading"+n),require(l,function(){a.debug&&console.timeEnd("startLoading"+n);var t=arguments;e.each(o,function(e,n,i){s[e]=t[n]}),c.resolve(n,s),a.debug&&console.log("Loaded: type="+n+" state="+c.state(),s)},function(e){var t=e.requireModules&&e.requireModules[0];a.debug&&console.warn("Error loading impl="+t,e.requireMap),r?a.debug&&console.warn("Ignoring error"):c.reject(e)}),this._setTimeout(c).promise()},_setTimeout:function(e){return setTimeout(function(){"resolved"!=e.state()&&e.reject("Timeout, application is loading too long")},this.timeout||3e4),e},destroy:function(){this.getBeeHive().destroy()},activate:function(t){var n=this.getBeeHive(),i=this;i.debug&&console.log("application: beehive.activate()"),n.activate(n),e.each(this.getAllControllers(),function(e){i.debug&&console.log("application: controllers: "+e[0]+".activate(beehive, app)");var t=e[1];"activate"in t&&t.activate(n,i)}),e.each(this.getAllModules(),function(e){try{i.debug&&console.log("application: modules: "+e[0]+".activate(beehive)");var t=e[1];"activate"in t&&t.activate(n)}catch(t){console.error("Error activating:"+e[0]),console.error(t)}}),this.__activated=!0},isActivated:function(){return this.__activated||!1},hasService:function(e){return this.getBeeHive().hasService(e)},getService:function(e){return this.getBeeHive().getService(e)},hasObject:function(e){return this.getBeeHive().hasObject(e)},getObject:function(e){return this.getBeeHive().getObject(e)},hasController:function(e){return this.__controllers.has(e)},getController:function(e){return this.__controllers.get(e)},hasModule:function(e){return this.__modules.has(e)},getModule:function(e){return this.__modules.get(e)},hasWidget:function(e){return this.__widgets.has(e)},getWidgetRefCount:function(e,t){var n=this.__barbarianInstances[(t||"widget:")+e];return n?n.counter:-1},getWidget:function(n){var i=t.Deferred(),r=this,a={};return arguments.length>1?(a={},e.each(arguments,function(t){if(t)try{a[t]=r._getWidget(t)}catch(n){throw console.error("Error loading: "+t),e.each(a,function(e,t){r.returnWidget(t),delete a[t]}),n}})):n&&(a=this._getWidget(n)),setTimeout(function(){i.done(function(t){e.isArray(n)?e.each(n,function(e){r.returnWidget(e)}):r.returnWidget(n)})},1),i.resolve(a),i.promise()},_getWidget:function(e){var t=this._getOrCreateBarbarian("widget",e);return this.__barbarianInstances["widget:"+e].counter++,t},returnWidget:function(e){var t=this.__barbarianInstances["widget:"+e];if(!t||!t.parent.dontKillMe)return t?(t.counter--,this._killBarbarian("widget:"+e),t.counter):-1},hasPlugin:function(e){return this.__plugins.has(e)},getPlugin:function(n){var i=t.Deferred(),r=this,a={};return arguments.length>1?(a={},e.each(arguments,function(t){if(t)try{a[t]=r._getPlugin(t)}catch(n){throw console.error("Error loading: "+t),e.each(a,function(e,t){r.returnPlugin(t),delete a[t]}),n}})):n&&(a=this._getPlugin(n)),setTimeout(function(){i.done(function(t){e.isArray(n)?e.each(n,function(e){r.returnPlugin(e)}):r.returnPlugin(n)})},1),i.resolve(a),i.promise()},getPluginRefCount:function(e){return this.getWidgetRefCount(e,"plugin:")},_getPlugin:function(e){var t=this._getOrCreateBarbarian("plugin",e);return this.__barbarianInstances["plugin:"+e].counter++,t},returnPlugin:function(e){var t=this.__barbarianInstances["plugin:"+e];return t?(t.counter--,this._killBarbarian("plugin:"+e),t.counter):-1},getPluginOrWidgetName:function(t){if(!e.isString(t))throw Error("The psk argument must be a string");if(this.__barbarianRegistry[t])return this.__barbarianRegistry[t]},getPluginOrWidgetByPubSubKey:function(e){var t=this.getPluginOrWidgetName(e);if(void 0!==t){if(this._isBarbarianAlive(t))return this._getBarbarian(t);throw new Error("Eeeek, thisis unexpectEED bEhAvjor! Cant find barbarian with ID: "+e)}},getPskOfPluginOrWidget:function(e){e.split(":");if(this._isBarbarianAlive(e)){var t=this._getBarbarian(e);if(t.getPubSub&&t.getPubSub().getCurrentPubSubKey)return t.getPubSub().getCurrentPubSubKey().getId()}},_getOrCreateBarbarian:function(t,n){var i=t+":"+n;if("plugin"==t&&!this.hasPlugin(n)||"widget"==t&&!this.hasWidget(n))throw new Error("We cannot give you "+i+" (cause there is no constructor for it)");if(this._isBarbarianAlive(i))return this._getBarbarian(i);var r,a=new("plugin"==t?this.__plugins.get(n):this.__widgets.get(n)),s=this.getBeeHive().getHardenedInstance(),o=this.getService("PubSub");e.keys(o._issuedKeys);"activate"in a&&(this.debug&&console.log("application: "+i+".activate(beehive)"),r=a.activate(s));var l=e.without(e.keys(o._issuedKeys),e.keys(o._issuedKeys));return this._registerBarbarian(i,a,r,s,l),a},_isBarbarianAlive:function(e){return!!this.__barbarianInstances[e]},_getBarbarian:function(e){return this.__barbarianInstances[e].parent},_registerBarbarian:function(t,n,i,r,a){this._killBarbarian(t),"getBeeHive"in n?this.__barbarianRegistry[n.getBeeHive().getService("PubSub").getCurrentPubSubKey().getId()]=t:this.__barbarianRegistry[r.getService("PubSub").getCurrentPubSubKey().getId()]=t;var s=[];i&&(s=this._registerBarbarianChildren(t,i)),a&&e.each(a,function(e){this.__barbarianRegistry[e]&&delete a[e]},this),this.__barbarianInstances[t]={parent:n,children:s,beehive:r,counter:0,psk:r.getService("PubSub").getCurrentPubSubKey(),bastards:a}},_registerBarbarianChildren:function(t,n){var i=[];return e.each(n,function(e,n){var r=t+"-"+(e.name||n);if(this.debug&&console.log("adding child object to registry: "+r),this._isBarbarianAlive(r))throw new Error("Contract breach, there already exists instance with a name: "+r);if("getBeeHive"in e){var a=e.getBeeHive().getService("PubSub").getCurrentPubSubKey().getId();if(this.__barbarianRegistry[a])throw new Error("Contract breach, the child of "+t+"is using the same pub-sub-key");this.__barbarianRegistry[a]=r}i.unshift(r)},this),i},_killBarbarian:function(t,n){var i=this.__barbarianInstances[t];if(i&&!(i.counter>0&&!0!==n)){i.children&&e.each(i.children,function(e){this._killBarbarian(e,!0)},this),e.each(this.__barbarianRegistry,function(e,n){e==t&&delete this.__barbarianRegistry[n]},this);var r=this.getService("PubSub");if(i.psk&&r.unsubscribe(i.psk),i.bastards,!1){var a={};e.each(i.bastards,function(e){a[e]=1},this),e.each(r._events,function(t,n){e.each(t,function(e){e.ctx.getId&&a[e.ctx.getId()]&&r.unsubscribe(e.ctx)},this)},this)}i.parent.destroy(),delete this.__barbarianInstances[t],"setBeeHive"in i.parent&&i.parent.setBeeHive({fake:"one"}),delete i,this.debug&&console.log("Destroyed: "+t)}},getAllControllers:function(){return e.pairs(this.__controllers.container)},getAllModules:function(){return e.pairs(this.__modules.container)},getAllPlugins:function(n){n=n||"plugin:";var i=t.Deferred(),r=[];return e.each(this.__barbarianInstances,function(e,t){t.indexOf(n)>-1&&r.unshift(t.replace(n,""))}),(n.indexOf("plugin:")>-1?this.getPlugin:this.getWidget).apply(this,r).done(function(t){var n=[];r.length>1?n=e.pairs(t):1==r.length&&(n=[[r[0],t]]),i.resolve(n)}),i.promise()},getAllWidgets:function(){return this.getAllPlugins("widget:")},getAllServices:function(){return this.getBeeHive().getAllServices()},getAllObjects:function(){return this.getBeeHive().getAllObjects()},triggerMethodOnAll:function(e,t){this.triggerMethod(this.getAllControllers(),"controllers",e,t),this.triggerMethod(this.getAllModules(),"modules",e,t);var n=this;this.getAllPlugins().done(function(i){i.length&&n.triggerMethod(i,"plugins",e,t)}),this.getAllWidgets().done(function(i){i.length&&n.triggerMethod(i,"widgets",e,t)}),this.triggerMethod(this.getBeeHive().getAllServices(),"BeeHive:services",e,t),this.triggerMethod(this.getBeeHive().getAllObjects(),"BeeHive:objects",e,t)},triggerMethod:function(t,n,i,r){var a=this;return e.map(t,function(t){var s=t[1];i in s?(a.debug&&console.log("application.triggerMethod: "+n+": "+t[0]+"."+i+"()"),s[i].call(s,r)):e.isFunction(i)&&(a.debug&&console.log("application.triggerMethod: "+n+": "+t[0]+" customCallback()"),i.call(s,n+":"+t[0],r))})}}),s.extend=n.Model.extend,s.extend(a)}),define("hbs/underscore",[],function(){function e(t,n,i){if(t===n)return 0!==t||1/t==1/n;if(null==t||null==n)return t===n;if(t._chain&&(t=t._wrapped),n._chain&&(n=n._wrapped),t.isEqual&&_.isFunction(t.isEqual))return t.isEqual(n);if(n.isEqual&&_.isFunction(n.isEqual))return n.isEqual(t);var r=o.call(t);if(r!=o.call(n))return!1;switch(r){case"[object String]":return t==String(n);case"[object Number]":return t!=+t?n!=+n:0==t?1/t==1/n:t==+n;case"[object Date]":case"[object Boolean]":return+t==+n;case"[object RegExp]":return t.source==n.source&&t.global==n.global&&t.multiline==n.multiline&&t.ignoreCase==n.ignoreCase}if("object"!=typeof t||"object"!=typeof n)return!1;for(var a=i.length;a--;)if(i[a]==t)return!0;i.push(t);var s=0,l=!0;if("[object Array]"==r){if(s=t.length,l=s==n.length)for(;s--&&(l=s in t==s in n&&e(t[s],n[s],i)););}else{if("constructor"in t!="constructor"in n||t.constructor!=n.constructor)return!1;for(var c in t)if(_.has(t,c)&&(s++,!(l=_.has(n,c)&&e(t[c],n[c],i))))break;if(l){for(c in n)if(_.has(n,c)&&!s--)break;l=!s}}return i.pop(),l}var t={},n=Array.prototype,i=Object.prototype,r=Function.prototype,a=n.slice,s=n.unshift,o=i.toString,l=i.hasOwnProperty,c=n.forEach,u=n.map,d=n.reduce,h=n.reduceRight,p=n.filter,f=n.every,g=n.some,m=n.indexOf,b=n.lastIndexOf,v=Array.isArray,y=Object.keys,w=r.bind,_=function(e){return new R(e)};_.VERSION="1.3.3";var x=_.each=_.forEach=function(e,n,i){if(null!=e)if(c&&e.forEach===c)e.forEach(n,i);else if(e.length===+e.length){for(var r=0,a=e.length;r<a;r++)if(r in e&&n.call(i,e[r],r,e)===t)return}else for(var s in e)if(_.has(e,s)&&n.call(i,e[s],s,e)===t)return};_.map=_.collect=function(e,t,n){var i=[];return null==e?i:u&&e.map===u?e.map(t,n):(x(e,function(e,r,a){i[i.length]=t.call(n,e,r,a)}),e.length===+e.length&&(i.length=e.length),i)},_.reduce=_.foldl=_.inject=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),d&&e.reduce===d)return i&&(t=_.bind(t,i)),r?e.reduce(t,n):e.reduce(t);if(x(e,function(e,a,s){r?n=t.call(i,n,e,a,s):(n=e,r=!0)}),!r)throw new TypeError("Reduce of empty array with no initial value");return n},_.reduceRight=_.foldr=function(e,t,n,i){var r=arguments.length>2;if(null==e&&(e=[]),h&&e.reduceRight===h)return i&&(t=_.bind(t,i)),r?e.reduceRight(t,n):e.reduceRight(t);var a=_.toArray(e).reverse();return i&&!r&&(t=_.bind(t,i)),r?_.reduce(a,t,n,i):_.reduce(a,t)},_.find=_.detect=function(e,t,n){var i;return S(e,function(e,r,a){if(t.call(n,e,r,a))return i=e,!0}),i},_.filter=_.select=function(e,t,n){var i=[];return null==e?i:p&&e.filter===p?e.filter(t,n):(x(e,function(e,r,a){t.call(n,e,r,a)&&(i[i.length]=e)}),i)},_.reject=function(e,t,n){var i=[];return null==e?i:(x(e,function(e,r,a){t.call(n,e,r,a)||(i[i.length]=e)}),i)},_.every=_.all=function(e,n,i){var r=!0;return null==e?r:f&&e.every===f?e.every(n,i):(x(e,function(e,a,s){if(!(r=r&&n.call(i,e,a,s)))return t}),!!r)};var S=_.some=_.any=function(e,n,i){n||(n=_.identity);var r=!1;return null==e?r:g&&e.some===g?e.some(n,i):(x(e,function(e,a,s){if(r||(r=n.call(i,e,a,s)))return t}),!!r)};_.include=_.contains=function(e,t){var n=!1;return null==e?n:m&&e.indexOf===m?-1!=e.indexOf(t):n=S(e,function(e){return e===t})},_.invoke=function(e,t){var n=a.call(arguments,2);return _.map(e,function(e){return(_.isFunction(t)?t||e:e[t]).apply(e,n)})},_.pluck=function(e,t){return _.map(e,function(e){return e[t]})},_.max=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.max.apply(Math,e);if(!t&&_.isEmpty(e))return-1/0;var i={computed:-1/0};return x(e,function(e,r,a){var s=t?t.call(n,e,r,a):e;s>=i.computed&&(i={value:e,computed:s})}),i.value},_.min=function(e,t,n){if(!t&&_.isArray(e)&&e[0]===+e[0])return Math.min.apply(Math,e);if(!t&&_.isEmpty(e))return 1/0;var i={computed:1/0};return x(e,function(e,r,a){var s=t?t.call(n,e,r,a):e;s<i.computed&&(i={value:e,computed:s})}),i.value},_.shuffle=function(e){var t,n=[];return x(e,function(e,i,r){t=Math.floor(Math.random()*(i+1)),n[i]=n[t],n[t]=e}),n},_.sortBy=function(e,t,n){var i=_.isFunction(t)?t:function(e){return e[t]};return _.pluck(_.map(e,function(e,t,r){return{value:e,criteria:i.call(n,e,t,r)}}).sort(function(e,t){var n=e.criteria,i=t.criteria;return void 0===n?1:void 0===i?-1:n<i?-1:n>i?1:0}),"value")},_.groupBy=function(e,t){var n={},i=_.isFunction(t)?t:function(e){return e[t]};return x(e,function(e,t){var r=i(e,t);(n[r]||(n[r]=[])).push(e)}),n},_.sortedIndex=function(e,t,n){n||(n=_.identity);for(var i=0,r=e.length;i<r;){var a=i+r>>1;n(e[a])<n(t)?i=a+1:r=a}return i},_.toArray=function(e){return e?_.isArray(e)?a.call(e):_.isArguments(e)?a.call(e):e.toArray&&_.isFunction(e.toArray)?e.toArray():_.values(e):[]},_.size=function(e){return _.isArray(e)?e.length:_.keys(e).length},_.first=_.head=_.take=function(e,t,n){return null==t||n?e[0]:a.call(e,0,t)},_.initial=function(e,t,n){return a.call(e,0,e.length-(null==t||n?1:t))},_.last=function(e,t,n){return null==t||n?e[e.length-1]:a.call(e,Math.max(e.length-t,0))},_.rest=_.tail=function(e,t,n){return a.call(e,null==t||n?1:t)},_.compact=function(e){return _.filter(e,function(e){return!!e})},_.flatten=function(e,t){return _.reduce(e,function(e,n){return _.isArray(n)?e.concat(t?n:_.flatten(n)):(e[e.length]=n,e)},[])},_.without=function(e){return _.difference(e,a.call(arguments,1))},_.uniq=_.unique=function(e,t,n){var i=n?_.map(e,n):e,r=[];return e.length<3&&(t=!0),_.reduce(i,function(n,i,a){return(t?_.last(n)===i&&n.length:_.include(n,i))||(n.push(i),r.push(e[a])),n},[]),r},_.union=function(){return _.uniq(_.flatten(arguments,!0))},_.intersection=_.intersect=function(e){var t=a.call(arguments,1);return _.filter(_.uniq(e),function(e){return _.every(t,function(t){return _.indexOf(t,e)>=0})})},_.difference=function(e){var t=_.flatten(a.call(arguments,1),!0);return _.filter(e,function(e){return!_.include(t,e)})},_.zip=function(){for(var e=a.call(arguments),t=_.max(_.pluck(e,"length")),n=new Array(t),i=0;i<t;i++)n[i]=_.pluck(e,""+i);return n},_.indexOf=function(e,t,n){if(null==e)return-1;var i,r;if(n)return i=_.sortedIndex(e,t),e[i]===t?i:-1;if(m&&e.indexOf===m)return e.indexOf(t);for(i=0,r=e.length;i<r;i++)if(i in e&&e[i]===t)return i;return-1},_.lastIndexOf=function(e,t){if(null==e)return-1;if(b&&e.lastIndexOf===b)return e.lastIndexOf(t);for(var n=e.length;n--;)if(n in e&&e[n]===t)return n;return-1},_.range=function(e,t,n){arguments.length<=1&&(t=e||0,e=0),n=arguments[2]||1;for(var i=Math.max(Math.ceil((t-e)/n),0),r=0,a=new Array(i);r<i;)a[r++]=e,e+=n;return a};var E=function(){};_.bind=function(e,t){var n,i;if(e.bind===w&&w)return w.apply(e,a.call(arguments,1));if(!_.isFunction(e))throw new TypeError;return i=a.call(arguments,2),n=function(){if(!(this instanceof n))return e.apply(t,i.concat(a.call(arguments)));E.prototype=e.prototype;var r=new E,s=e.apply(r,i.concat(a.call(arguments)));return Object(s)===s?s:r}},_.bindAll=function(e){var t=a.call(arguments,1);return 0==t.length&&(t=_.functions(e)),x(t,function(t){e[t]=_.bind(e[t],e)}),e},_.memoize=function(e,t){var n={};return t||(t=_.identity),function(){var i=t.apply(this,arguments);return _.has(n,i)?n[i]:n[i]=e.apply(this,arguments)}},_.delay=function(e,t){var n=a.call(arguments,2);return setTimeout(function(){return e.apply(null,n)},t)},_.defer=function(e){return _.delay.apply(_,[e,1].concat(a.call(arguments,1)))},_.throttle=function(e,t){var n,i,r,a,s,o,l=_.debounce(function(){s=a=!1},t);return function(){n=this,i=arguments;return r||(r=setTimeout(function(){r=null,s&&e.apply(n,i),l()},t)),a?s=!0:o=e.apply(n,i),l(),a=!0,o}},_.debounce=function(e,t,n){var i;return function(){var r=this,a=arguments;n&&!i&&e.apply(r,a),clearTimeout(i),i=setTimeout(function(){i=null,n||e.apply(r,a)},t)}},_.once=function(e){var t,n=!1;return function(){return n?t:(n=!0,t=e.apply(this,arguments))}},_.wrap=function(e,t){return function(){var n=[e].concat(a.call(arguments,0));return t.apply(this,n)}},_.compose=function(){var e=arguments;return function(){for(var t=arguments,n=e.length-1;n>=0;n--)t=[e[n].apply(this,t)];return t[0]}},_.after=function(e,t){return e<=0?t():function(){if(--e<1)return t.apply(this,arguments)}},_.keys=y||function(e){if(e!==Object(e))throw new TypeError("Invalid object");var t=[];for(var n in e)_.has(e,n)&&(t[t.length]=n);return t},_.values=function(e){return _.map(e,_.identity)},_.functions=_.methods=function(e){var t=[];for(var n in e)_.isFunction(e[n])&&t.push(n);return t.sort()},_.extend=function(e){return x(a.call(arguments,1),function(t){for(var n in t)e[n]=t[n]}),e},_.pick=function(e){var t={};return x(_.flatten(a.call(arguments,1)),function(n){n in e&&(t[n]=e[n])}),t},_.defaults=function(e){return x(a.call(arguments,1),function(t){for(var n in t)null==e[n]&&(e[n]=t[n])}),e},_.clone=function(e){return _.isObject(e)?_.isArray(e)?e.slice():_.extend({},e):e},_.tap=function(e,t){return t(e),e},_.isEqual=function(t,n){return e(t,n,[])},_.isEmpty=function(e){if(null==e)return!0;if(_.isArray(e)||_.isString(e))return 0===e.length;for(var t in e)if(_.has(e,t))return!1;return!0},_.isElement=function(e){return!(!e||1!=e.nodeType)},_.isArray=v||function(e){return"[object Array]"==o.call(e)},_.isObject=function(e){return e===Object(e)},_.isArguments=function(e){return"[object Arguments]"==o.call(e)},_.isArguments(arguments)||(_.isArguments=function(e){return!(!e||!_.has(e,"callee"))}),_.isFunction=function(e){return"[object Function]"==o.call(e)},_.isString=function(e){return"[object String]"==o.call(e)},_.isNumber=function(e){return"[object Number]"==o.call(e)},_.isFinite=function(e){return _.isNumber(e)&&isFinite(e)},_.isNaN=function(e){return e!==e},_.isBoolean=function(e){return!0===e||!1===e||"[object Boolean]"==o.call(e)},_.isDate=function(e){return"[object Date]"==o.call(e)},_.isRegExp=function(e){return"[object RegExp]"==o.call(e)},_.isNull=function(e){return null===e},_.isUndefined=function(e){return void 0===e},_.has=function(e,t){return l.call(e,t)},_.noConflict=function(){return root._=previousUnderscore,this},_.identity=function(e){return e},_.times=function(e,t,n){for(var i=0;i<e;i++)t.call(n,i)},_.escape=function(e){return(""+e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},_.result=function(e,t){if(null==e)return null;var n=e[t];return _.isFunction(n)?n.call(e):n},_.mixin=function(e){x(_.functions(e),function(t){I(t,_[t]=e[t])})};var A=0;_.uniqueId=function(e){var t=A++;return e?e+t:t},_.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var k=/.^/,C={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"};for(var P in C)C[C[P]]=P;var M=/\\|'|\r|\n|\t|\u2028|\u2029/g,O=/\\(\\|'|r|n|t|u2028|u2029)/g,T=function(e){return e.replace(O,function(e,t){return C[t]})};_.template=function(e,t,n){n=_.defaults(n||{},_.templateSettings);var i="__p+='"+e.replace(M,function(e){return"\\"+C[e]}).replace(n.escape||k,function(e,t){return"'+\n_.escape("+T(t)+")+\n'"}).replace(n.interpolate||k,function(e,t){return"'+\n("+T(t)+")+\n'"}).replace(n.evaluate||k,function(e,t){return"';\n"+T(t)+"\n;__p+='"})+"';\n";n.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+i+"return __p;\n";var r=new Function(n.variable||"obj","_",i);if(t)return r(t,_);var a=function(e){return r.call(this,e,_)};return a.source="function("+(n.variable||"obj")+"){\n"+i+"}",a},_.chain=function(e){return _(e).chain()};var R=function(e){this._wrapped=e};_.prototype=R.prototype;var D=function(e,t){return t?_(e).chain():e},I=function(e,t){R.prototype[e]=function(){var e=a.call(arguments);return s.call(e,this._wrapped),D(t.apply(_,e),this._chain)}};return _.mixin(_),x(["pop","push","reverse","shift","sort","splice","unshift"],function(e){var t=n[e];R.prototype[e]=function(){var n=this._wrapped;t.apply(n,arguments);var i=n.length;return"shift"!=e&&"splice"!=e||0!==i||delete n[0],D(n,this._chain)}}),x(["concat","join","slice"],function(e){var t=n[e];R.prototype[e]=function(){return D(t.apply(this._wrapped,arguments),this._chain)}}),R.prototype.chain=function(){return this._chain=!0,this},R.prototype.value=function(){return this._wrapped},_}),function(window){var JSON=window.JSON||{};!function(){"use strict";function f(e){return e<10?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,i,r,a,s,o=gap,l=t[e];switch(l&&"object"==typeof l&&"function"==typeof l.toJSON&&(l=l.toJSON(e)),"function"==typeof rep&&(l=rep.call(t,e,l)),typeof l){case"string":return quote(l);case"number":return isFinite(l)?String(l):"null";case"boolean":case"null":return String(l);case"object":if(!l)return"null";if(gap+=indent,s=[],"[object Array]"===Object.prototype.toString.apply(l)){for(a=l.length,n=0;n<a;n+=1)s[n]=str(n,l)||"null";return r=0===s.length?"[]":gap?"[\n"+gap+s.join(",\n"+gap)+"\n"+o+"]":"["+s.join(",")+"]",gap=o,r}if(rep&&"object"==typeof rep)for(a=rep.length,n=0;n<a;n+=1)"string"==typeof rep[n]&&(r=str(i=rep[n],l))&&s.push(quote(i)+(gap?": ":":")+r);else for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(r=str(i,l))&&s.push(quote(i)+(gap?": ":":")+r);return r=0===s.length?"{}":gap?"{\n"+gap+s.join(",\n"+gap)+"\n"+o+"}":"{"+s.join(",")+"}",gap=o,r}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(e){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(e){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var i;if(gap="",indent="","number"==typeof n)for(i=0;i<n;i+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,t&&"function"!=typeof t&&("object"!=typeof t||"number"!=typeof t.length))throw new Error("JSON.stringify");return str("",{"":e})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,i,r=e[t];if(r&&"object"==typeof r)for(n in r)Object.prototype.hasOwnProperty.call(r,n)&&(void 0!==(i=walk(r,n))?r[n]=i:delete r[n]);return reviver.call(e,t,r)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),define("hbs/json2",[],function(){return JSON})}.call(this,this),define("hbs",["hbs/handlebars","hbs/underscore","hbs/json2"],function(e,t,n){function i(t,n,i){var r,a;return"data"in(i=i||{})||(i.data=!0),i.compat&&(i.useDepths=!0),r=e.parse(t),a=(new e.Compiler).compile(r,i),(new e.JavaScriptCompiler).compile(a,i)}var r,a,s=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],o=function(){throw new Error("Environment unsupported.")},l=[],c="w+",u="hbs",d="/styles/",h="/demo-build/styles/",p="templates/helpers/",f="screen.build.css",g="onHbsRead";e.registerHelper("$",function(){}),"undefined"!=typeof window&&window.navigator&&window.document&&!window.navigator.userAgent.match(/Node.js/)?(a=function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return!0===arguments[0]?new XDomainRequest:new XMLHttpRequest;for(t=0;t<3;t++){n=s[t];try{e=new ActiveXObject(n)}catch(e){}if(e){s=[n];break}}if(!e)throw new Error("getXhr(): XMLHttpRequest not available");return e},getIEVersion=function(){var e=-1;if("Microsoft Internet Explorer"==navigator.appName){var t=navigator.userAgent;null!=new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(t)&&(e=parseFloat(RegExp.$1))}return e},o=function(e,t){var n=!1;if(0!=e.indexOf("http"))n=!1;else{var i="https"===e.substr(0,5)?8:7,r="https"===window.location.href.substr(0,5)?8:7,s=e.substr(i).split("/").shift(),o=getIEVersion();n=s!=window.location.href.substr(r).split("/").shift()&&o>=7}if(n){var l=a(!0);l.open("GET",e),l.onload=function(){t(l.responseText,e)},l.onprogress=function(){},l.ontimeout=function(){},l.onerror=function(){},setTimeout(function(){l.send()},0)}else{var c=a();c.open("GET",e,!0),c.onreadystatechange=function(n){4===c.readyState&&t(c.responseText,e)},c.send(null)}}):"undefined"!=typeof process&&process.versions&&process.versions.node?(r=require.nodeRequire("fs"),o=function(e,t){var n=r.readFileSync(e,"utf8")||"";t(n=n.replace(/^\uFEFF/,""),e)}):"undefined"!=typeof java&&void 0!==java.io&&(o=function(e,t){for(var n,i=new java.io.FileInputStream(e),r=new java.io.InputStreamReader(i,"UTF-8"),a=new java.io.BufferedReader(r),s="";null!==(n=a.readLine());)s+=new String(n)+"\n";a.close(),t(s,e)});var m,b=[],v={},y=[];return{get:function(){return e},write:function(e,t,n){if(t+"@hbs"in l){var i=l[t+"@hbs"];n.asModule(e+"!"+t,i)}},version:"3.0.3",load:function(r,a,s,w){function _(e,n){return t(e).forEach(function(e){e&&e.type&&"PartialStatement"===e.type&&"SubExpression"!==e.name.type&&n.push(e.name.original),e&&e.program&&e.program.body&&_(e.program.body,n),e&&e.inverse&&e.inverse.body&&_(e.inverse.body,n)}),n}function x(e,n){var i=[];return e&&e.body&&(i=_(e.body,[])),n&&n.partials&&n.partials.length&&t(n.partials).forEach(function(e){i.push(e)}),t.unique(i)}function S(e){var t,i;if(e&&e.body&&(t=e.body[0])&&"CommentStatement"===t.type)try{return i=t.value.replace(new RegExp("^[\\s]+|[\\s]+$","g"),""),n.parse(i),i}catch(e){return n.stringify({description:i})}return"{}"}function E(e){return!!("SubExpression"===e.type||e.params&&e.params.length||e.hash)}function A(e,n){E(e)&&void 0!==e.path&&k(e.path.original,n),e&&e.params&&e.params.forEach(function(e){A(e,n)}),e&&e.hash&&e.hash.pairs&&t(e.hash.pairs).forEach(function(e){A(e.value,n)})}function k(t,n){void 0===e.helpers[t]&&n.push(t)}function C(e,n,i,r){i=i?i+".":"";return t(e).forEach(function(e){var t;(E(e)||"MustacheStatement"===e.type)&&A(e,r),e&&e.mustache&&C([e.mustache],n,i+"",r),e&&e.program&&e.program.body&&(t=C([e.path],[],"",r)[0]||"",e.inverse&&e.inverse.body&&C(e.inverse.body,n,i+""+(t?i+""?"."+t:t:""),r),C(e.program.body,n,i+""+(t?i+""?"."+t:t:""),r))}),n}function P(e){var n=[],i=[];e&&e.body&&(n=C(e.body,[],void 0,i));var r=["helperMissing","blockHelperMissing","each","if","unless","with","log","lookup"];return{vars:t(n).chain().unique().map(function(e){return""===e?".":e.length&&"."===e[e.length-1]?e.substr(0,e.length-1)+"[]":e}).value(),helpers:t(i).chain().unique().map(function(e){if(!t(r).contains(e))return e}).compact().value()}}function M(e){for(var t=e.split("/"),n=0;n<t.length;n++)".."===t[n]?(delete t[n-1],delete t[n]):"."===t[n]&&delete t[n];return t.join("/").replace(/\/\/+/g,"/")}var O=r+"@hbs";(m=m||w).hbs=m.hbs||{};var T=0==m.hbs.helpers,R="";m.hbs.partialsUrl&&((R=m.hbs.partialsUrl).match(/\/$/)||(R+="/")),m.hbs.fetchText&&(o=m.hbs.fetchText);var D,I=m.hbs&&!1===m.hbs.templateExtension;D=I?a.toUrl(r):a.toUrl(r+"."+(m.hbs&&m.hbs.templateExtension?m.hbs.templateExtension:u)),o(D,function(o,w){var _,E,A,k,C,D=m.isBuild&&m[g]?m[g]:function(e,t,n){return n},j=e.parse(D(r,w,o)),N=S(j),q=P(j),L=q.vars,F=q.helpers||[],B="",V=[],$=r.substr(0,r.lastIndexOf("/")+1);if("{}"!==N)try{A=n.parse(N)}catch(e){console.log("couldn't parse meta for %s",w)}var U=x(j,A);m.hbs=m.hbs||{},m.hbs._partials=m.hbs._partials||{};for(var H in U)if(U.hasOwnProperty(H)&&"string"==typeof U[H]){var z,G=U[H];if(z=M(G.match(/^(\.|\/)+/)?$+G:R+G),I){if(w===a.toUrl(z))continue}else if(w===a.toUrl(z+"."+(m.hbs&&m.hbs.templateExtension?m.hbs.templateExtension:u)))continue;m.hbs._partials[z]=m.hbs._partials[z]||[],m.hbs._partials[z].references=m.hbs._partials[z].references||[],m.hbs._partials[z].references.push(G),m.hbs._loadedDeps=m.hbs._loadedDeps||{},V[H]="hbs!"+z}if(_=V.join("', '"),F=F.concat(A&&A.helpers?A.helpers:[]),(E=T?"":function(){var e,t=[],n=m.hbs&&m.hbs.helperPathCallback?m.hbs.helperPathCallback:function(e){return(m.hbs&&m.hbs.helperDirectory?m.hbs.helperDirectory:p)+e};for(e=0;e<F.length;e++)t[e]="'"+n(F[e],w)+"'";return t}().join(","))&&(E=","+E),A)try{A.styles&&(b=t.union(b,A.styles),require.isBrowser&&!m.isBuild?(k=document.head||document.getElementsByTagName("head")[0],t(A.styles).forEach(function(e){v[e]||((C=document.createElement("link")).href=m.baseUrl+d+e+".css",C.media="all",C.rel="stylesheet",C.type="text/css",k.appendChild(C),v[e]=C)})):m.isBuild&&function(){var e=require.nodeRequire("fs"),n=t(A.styles).map(function(e){return v[e]?"":(v[e]=!0,"@import url("+e+".css);\n")}).join("\n");e.open(__dirname+h+f,c,"0666",function(t,i){e.writeSync(i,n,null,encoding="utf8"),e.close(i)}),c="a"}())}catch(e){console.log("error injecting styles")}m.isBuild||m.serverRender||(B="t.meta = "+N+";\nt.helpers = "+n.stringify(F)+";\nt.deps = "+n.stringify(V)+";\nt.vars = "+n.stringify(L)+";\n");var J=m.hbs||{},W=t.extend(J.compileOptions||{},{originalKeyFallback:J.originalKeyFallback}),Q=i(o,!1,W),Y="'hbs!"+r+"',";_&&(_=", '"+_+"'");var K=[];m.hbs._partials[r]&&(K=m.hbs._partials[r].references);var Z=m.hbs&&m.hbs.handlebarsPath?m.hbs.handlebarsPath:"hbs/handlebars";for(o="/* START_TEMPLATE */\ndefine("+Y+"['hbs','"+Z+"'"+_+E+"], function( hbs, Handlebars ){ \nvar t = Handlebars.template("+Q+");\nHandlebars.registerPartial('"+r+"', t);\n",H=0;H<K.length;H++)o+="Handlebars.registerPartial('"+K[H]+"', t);\n";o+=B+"return t;\n});\n/* END_TEMPLATE */\n",m.isBuild&&(l[O]=o),m.isBuild||(o+="\r\n//# sourceURL="+w),m.isBuild?(s.fromText(r,o),a([r],function(e){s(e)})):a(V,function(){s.fromText(o),a([r],function(e){s(e)})}),m.removeCombined&&w&&y.push(w)})},onLayerEnd:function(){m.removeCombined&&r&&y.forEach(function(e){r.existsSync(e)&&r.unlinkSync(e)})}}}),define("js/mixins/discovery_bootstrap",["underscore","backbone","js/components/api_query","js/components/api_request","js/components/pubsub_events","hbs","js/components/api_targets"],function(e,t,n,i,r,a,s){return{configure:function(){var e=this.getObject("DynamicConfig");if(e){var t=this.getBeeHive(),n=t.getService("Api");e.root&&(n.url=e.root+"/"+n.url,this.root=e.root),void 0!==e.debug&&(t.debug=e.debug,this.getController("QueryMediator").debug=e.debug),e.apiRoot&&(n.url=e.apiRoot),e.version&&(n.clientVersion=e.version),n.modifyRequestOptions=function(e,t){-1==s._doesntNeedCredentials.indexOf(t.get("target"))&&(e.xhrFields={withCredentials:!0})};var i=t.getService("OrcidApi");e.orcidProxy&&(i.orcidProxyUri=location.origin+e.orcidProxy),this.bootstrapUrls=e.bootstrapUrls,e.useCache&&this.triggerMethodOnAll("activateCache")}},bootstrap:function(){this.getBeeHive(),this.getObject("DynamicConfig");var t=$.Deferred(),r=this.getBeeHive().getService("Api");if(this.bootstrapUrls){var a=this.bootstrapUrls.length,s={},o={done:function(n){a--,e.extend(s,n),a<=0&&t.resolve(s)},fail:function(){--a<=0&&t.resolve(s)},type:"GET",timeout:2999},l=location.origin+location.pathname;e.each(this.bootstrapUrls,function(e){e.indexOf("http")>-1?(o.u=e,r.request(new i({query:new n({redirect_uri:l}),target:""}),o)):(delete o.u,r.request(new i({query:new n({redirect_uri:l}),target:e}),o))}),setTimeout(function(){"resolved"!==t.state()&&t.reject()},3e3)}else setTimeout(function(){t.resolve({})},1);return t},reload:function(e){if(!(location.search.indexOf("debug")>-1))return location.search&&location.search.indexOf("bbbRedirect=1")>-1?this.redirect(e):void(location.search=location.search?location.search+"&bbbRedirect=1":"bbbRedirect=1");console.warn("Debug stop, normally would reload to: "+e)},redirect:function(e){this.router&&(location.pathname=this.router.root+e),location.href=location.protocol+"//"+location.hostname+":"+location.port+location.pathname.substring(0,location.pathname.lastIndexOf("/"))+"/"+e},start:function(e){var n=this,i=this.getBeeHive(),r=(i.getService("Api"),this.getObject("DynamicConfig"));this.getBeeHive().getObject("AppStorage").setConfig(r);var a=function(e){throw new Error("Ooops. Check you config! There is no "+e+" component @#!")},s=n.getBeeHive().Services.get("Navigator");s||a("services.Navigator");var o=n.getObject("MasterPageManager");o||a("objects.MasterPageManager"),o.assemble(n),$("div#body-template-container").empty().append(o.view.el),n.router=new e,n.router.activate(i.getHardenedInstance()),s.start(this),s.router=n.router,t.history.start(r?r.routerConf:{}),$(document).on("scroll",function(){$("#landing-page-layout").length>0||($(window).scrollTop()>50?($(".s-quick-add").addClass("hidden"),$(".s-search-bar-full-width-container").addClass("s-search-bar-motion")):($(".s-search-bar-full-width-container").removeClass("s-search-bar-motion"),$(".s-quick-add").removeClass("hidden")))})}}}),function(e,t){"use strict";"function"==typeof define&&define.amd?define("es5-shim",t):"object"==typeof exports?module.exports=t():e.returnExports=t()}(this,function(){var e,t=Array,n=t.prototype,i=Object,r=i.prototype,a=Function,s=a.prototype,o=String,l=o.prototype,c=Number,u=c.prototype,d=n.slice,h=n.splice,p=n.push,f=n.unshift,g=n.concat,m=n.join,b=s.call,v=s.apply,y=Math.max,w=Math.min,_=r.toString,x="function"==typeof Symbol&&"symbol"==typeof Symbol.toStringTag,S=Function.prototype.toString,E=/^\s*class /,A=function(e){try{var t=S.call(e).replace(/\/\/.*\n/g,"").replace(/\/\*[.\s\S]*\*\//g,"").replace(/\n/gm," ").replace(/ {2}/g," ");return E.test(t)}catch(e){return!1}},k=function(e){try{return!A(e)&&(S.call(e),!0)}catch(e){return!1}},C=function(e){if(!e)return!1;if("function"!=typeof e&&"object"!=typeof e)return!1;if(x)return k(e);if(A(e))return!1;var t=_.call(e);return"[object Function]"===t||"[object GeneratorFunction]"===t},P=RegExp.prototype.exec,M=function(e){try{return P.call(e),!0}catch(e){return!1}};e=function(e){return"object"==typeof e&&(x?M(e):"[object RegExp]"===_.call(e))};var O,T=String.prototype.valueOf,R=function(e){try{return T.call(e),!0}catch(e){return!1}};O=function(e){return"string"==typeof e||"object"==typeof e&&(x?R(e):"[object String]"===_.call(e))};var D=i.defineProperty&&function(){try{var e={};i.defineProperty(e,"x",{enumerable:!1,value:e});for(var t in e)return!1;return e.x===e}catch(e){return!1}}(),I=function(e){var t;return t=D?function(e,t,n,r){!r&&t in e||i.defineProperty(e,t,{configurable:!0,enumerable:!1,writable:!0,value:n})}:function(e,t,n,i){!i&&t in e||(e[t]=n)},function(n,i,r){for(var a in i)e.call(i,a)&&t(n,a,i[a],r)}}(r.hasOwnProperty),j=function(e){var t=typeof e;return null===e||"object"!==t&&"function"!==t},N=c.isNaN||function(e){return e!==e},q={ToInteger:function(e){var t=+e;return N(t)?t=0:0!==t&&t!==1/0&&t!==-1/0&&(t=(t>0||-1)*Math.floor(Math.abs(t))),t},ToPrimitive:function(e){var t,n,i;if(j(e))return e;if(n=e.valueOf,C(n)&&(t=n.call(e),j(t)))return t;if(i=e.toString,C(i)&&(t=i.call(e),j(t)))return t;throw new TypeError},ToObject:function(e){if(null==e)throw new TypeError("can't convert "+e+" to object");return i(e)},ToUint32:function(e){return e>>>0}},L=function(){};I(s,{bind:function(e){var t=this;if(!C(t))throw new TypeError("Function.prototype.bind called on incompatible "+t);for(var n,r=d.call(arguments,1),s=y(0,t.length-r.length),o=[],l=0;l<s;l++)p.call(o,"$"+l);return n=a("binder","return function ("+m.call(o,",")+"){ return binder.apply(this, arguments); }")(function(){if(this instanceof n){var a=v.call(t,this,g.call(r,d.call(arguments)));return i(a)===a?a:this}return v.call(t,e,g.call(r,d.call(arguments)))}),t.prototype&&(L.prototype=t.prototype,n.prototype=new L,L.prototype=null),n}});var F=b.bind(r.hasOwnProperty),B=b.bind(r.toString),V=b.bind(d),$=v.bind(d),U=b.bind(l.slice),H=b.bind(l.split),z=b.bind(l.indexOf),G=b.bind(p),J=b.bind(r.propertyIsEnumerable),W=b.bind(n.sort),Q=t.isArray||function(e){return"[object Array]"===B(e)},Y=1!==[].unshift(0);I(n,{unshift:function(){return f.apply(this,arguments),this.length}},Y),I(t,{isArray:Q});var K=i("a"),Z="a"!==K[0]||!(0 in K),X=function(e){var t=!0,n=!0,i=!1;if(e)try{e.call("foo",function(e,n,i){"object"!=typeof i&&(t=!1)}),e.call([1],function(){"use strict";n="string"==typeof this},"x")}catch(e){i=!0}return!!e&&!i&&t&&n};I(n,{forEach:function(e){var t,n=q.ToObject(this),i=Z&&O(this)?H(this,""):n,r=-1,a=q.ToUint32(i.length);if(arguments.length>1&&(t=arguments[1]),!C(e))throw new TypeError("Array.prototype.forEach callback must be a function");for(;++r<a;)r in i&&(void 0===t?e(i[r],r,n):e.call(t,i[r],r,n))}},!X(n.forEach)),I(n,{map:function(e){var n,i=q.ToObject(this),r=Z&&O(this)?H(this,""):i,a=q.ToUint32(r.length),s=t(a);if(arguments.length>1&&(n=arguments[1]),!C(e))throw new TypeError("Array.prototype.map callback must be a function");for(var o=0;o<a;o++)o in r&&(s[o]=void 0===n?e(r[o],o,i):e.call(n,r[o],o,i));return s}},!X(n.map)),I(n,{filter:function(e){var t,n,i=q.ToObject(this),r=Z&&O(this)?H(this,""):i,a=q.ToUint32(r.length),s=[];if(arguments.length>1&&(n=arguments[1]),!C(e))throw new TypeError("Array.prototype.filter callback must be a function");for(var o=0;o<a;o++)o in r&&(t=r[o],(void 0===n?e(t,o,i):e.call(n,t,o,i))&&G(s,t));return s}},!X(n.filter)),I(n,{every:function(e){var t,n=q.ToObject(this),i=Z&&O(this)?H(this,""):n,r=q.ToUint32(i.length);if(arguments.length>1&&(t=arguments[1]),!C(e))throw new TypeError("Array.prototype.every callback must be a function");for(var a=0;a<r;a++)if(a in i&&!(void 0===t?e(i[a],a,n):e.call(t,i[a],a,n)))return!1;return!0}},!X(n.every)),I(n,{some:function(e){var t,n=q.ToObject(this),i=Z&&O(this)?H(this,""):n,r=q.ToUint32(i.length);if(arguments.length>1&&(t=arguments[1]),!C(e))throw new TypeError("Array.prototype.some callback must be a function");for(var a=0;a<r;a++)if(a in i&&(void 0===t?e(i[a],a,n):e.call(t,i[a],a,n)))return!0;return!1}},!X(n.some));var ee=!1;n.reduce&&(ee="object"==typeof n.reduce.call("es5",function(e,t,n,i){return i})),I(n,{reduce:function(e){var t=q.ToObject(this),n=Z&&O(this)?H(this,""):t,i=q.ToUint32(n.length);if(!C(e))throw new TypeError("Array.prototype.reduce callback must be a function");if(0===i&&1===arguments.length)throw new TypeError("reduce of empty array with no initial value");var r,a=0;if(arguments.length>=2)r=arguments[1];else for(;;){if(a in n){r=n[a++];break}if(++a>=i)throw new TypeError("reduce of empty array with no initial value")}for(;a<i;a++)a in n&&(r=e(r,n[a],a,t));return r}},!ee);var te=!1;n.reduceRight&&(te="object"==typeof n.reduceRight.call("es5",function(e,t,n,i){return i})),I(n,{reduceRight:function(e){var t=q.ToObject(this),n=Z&&O(this)?H(this,""):t,i=q.ToUint32(n.length);if(!C(e))throw new TypeError("Array.prototype.reduceRight callback must be a function");if(0===i&&1===arguments.length)throw new TypeError("reduceRight of empty array with no initial value");var r,a=i-1;if(arguments.length>=2)r=arguments[1];else for(;;){if(a in n){r=n[a--];break}if(--a<0)throw new TypeError("reduceRight of empty array with no initial value")}if(a<0)return r;do{a in n&&(r=e(r,n[a],a,t))}while(a--);return r}},!te);var ne=n.indexOf&&-1!==[0,1].indexOf(1,2);I(n,{indexOf:function(e){var t=Z&&O(this)?H(this,""):q.ToObject(this),n=q.ToUint32(t.length);if(0===n)return-1;var i=0;for(arguments.length>1&&(i=q.ToInteger(arguments[1])),i=i>=0?i:y(0,n+i);i<n;i++)if(i in t&&t[i]===e)return i;return-1}},ne);var ie=n.lastIndexOf&&-1!==[0,1].lastIndexOf(0,-3);I(n,{lastIndexOf:function(e){var t=Z&&O(this)?H(this,""):q.ToObject(this),n=q.ToUint32(t.length);if(0===n)return-1;var i=n-1;for(arguments.length>1&&(i=w(i,q.ToInteger(arguments[1]))),i=i>=0?i:n-Math.abs(i);i>=0;i--)if(i in t&&e===t[i])return i;return-1}},ie);var re=function(){var e=[1,2],t=e.splice();return 2===e.length&&Q(t)&&0===t.length}();I(n,{splice:function(e,t){return 0===arguments.length?[]:h.apply(this,arguments)}},!re);var ae=function(){var e={};return n.splice.call(e,0,0,1),1===e.length}();I(n,{splice:function(e,t){if(0===arguments.length)return[];var n=arguments;return this.length=y(q.ToInteger(this.length),0),arguments.length>0&&"number"!=typeof t&&((n=V(arguments)).length<2?G(n,this.length-e):n[1]=q.ToInteger(t)),h.apply(this,n)}},!ae);var se=function(){var e=new t(1e5);return e[8]="x",e.splice(1,1),7===e.indexOf("x")}(),oe=function(){var e=[];return e[256]="a",e.splice(257,0,"b"),"a"===e[256]}();I(n,{splice:function(e,t){for(var n,i=q.ToObject(this),r=[],a=q.ToUint32(i.length),s=q.ToInteger(e),l=s<0?y(a+s,0):w(s,a),c=w(y(q.ToInteger(t),0),a-l),u=0;u<c;)n=o(l+u),F(i,n)&&(r[u]=i[n]),u+=1;var d,h=V(arguments,2),p=h.length;if(p<c){u=l;for(var f=a-c;u<f;)n=o(u+c),d=o(u+p),F(i,n)?i[d]=i[n]:delete i[d],u+=1;u=a;for(var g=a-c+p;u>g;)delete i[u-1],u-=1}else if(p>c)for(u=a-c;u>l;)n=o(u+c-1),d=o(u+p-1),F(i,n)?i[d]=i[n]:delete i[d],u-=1;u=l;for(var m=0;m<h.length;++m)i[u]=h[m],u+=1;return i.length=a-c+p,r}},!se||!oe);var le,ce=n.join;try{le="1,2,3"!==Array.prototype.join.call("123",",")}catch(e){le=!0}le&&I(n,{join:function(e){var t=void 0===e?",":e;return ce.call(O(this)?H(this,""):this,t)}},le);var ue="1,2"!==[1,2].join(void 0);ue&&I(n,{join:function(e){var t=void 0===e?",":e;return ce.call(this,t)}},ue);var de=function(e){for(var t=q.ToObject(this),n=q.ToUint32(t.length),i=0;i<arguments.length;)t[n+i]=arguments[i],i+=1;return t.length=n+i,n+i},he=function(){var e={};return 1!==Array.prototype.push.call(e,void 0)||1!==e.length||void 0!==e[0]||!F(e,0)}();I(n,{push:function(e){return Q(this)?p.apply(this,arguments):de.apply(this,arguments)}},he);var pe=function(){var e=[];return 1!==e.push(void 0)||1!==e.length||void 0!==e[0]||!F(e,0)}();I(n,{push:de},pe),I(n,{slice:function(e,t){var n=O(this)?H(this,""):this;return $(n,arguments)}},Z);var fe=function(){try{return[1,2].sort(null),[1,2].sort({}),!0}catch(e){}return!1}(),ge=function(){try{return[1,2].sort(/a/),!1}catch(e){}return!0}(),me=function(){try{return[1,2].sort(void 0),!0}catch(e){}return!1}();I(n,{sort:function(e){if(void 0===e)return W(this);if(!C(e))throw new TypeError("Array.prototype.sort callback must be a function");return W(this,e)}},fe||!me||!ge);var be=!J({toString:null},"toString"),ve=J(function(){},"prototype"),ye=!F("x","0"),we=function(e){var t=e.constructor;return t&&t.prototype===e},_e={$window:!0,$console:!0,$parent:!0,$self:!0,$frame:!0,$frames:!0,$frameElement:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$external:!0},xe=function(){if("undefined"==typeof window)return!1;for(var e in window)try{!_e["$"+e]&&F(window,e)&&null!==window[e]&&"object"==typeof window[e]&&we(window[e])}catch(e){return!0}return!1}(),Se=function(e){if("undefined"==typeof window||!xe)return we(e);try{return we(e)}catch(e){return!1}},Ee=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],Ae=Ee.length,ke=function(e){return"[object Arguments]"===B(e)},Ce=ke(arguments)?ke:function(e){return null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&!Q(e)&&C(e.callee)};I(i,{keys:function(e){var t=C(e),n=Ce(e),i=null!==e&&"object"==typeof e,r=i&&O(e);if(!i&&!t&&!n)throw new TypeError("Object.keys called on a non-object");var a=[],s=ve&&t;if(r&&ye||n)for(var l=0;l<e.length;++l)G(a,o(l));if(!n)for(var c in e)s&&"prototype"===c||!F(e,c)||G(a,o(c));if(be)for(var u=Se(e),d=0;d<Ae;d++){var h=Ee[d];u&&"constructor"===h||!F(e,h)||G(a,h)}return a}});var Pe=i.keys&&function(){return 2===i.keys(arguments).length}(1,2),Me=i.keys&&function(){var e=i.keys(arguments);return 1!==arguments.length||1!==e.length||1!==e[0]}(1),Oe=i.keys;I(i,{keys:function(e){return Oe(Ce(e)?V(e):e)}},!Pe||Me);var Te,Re,De=0!==new Date(-0xc782b5b342b24).getUTCMonth(),Ie=new Date(-0x55d318d56a724),je=new Date(14496624e5),Ne="Mon, 01 Jan -45875 11:59:59 GMT"!==Ie.toUTCString();Ie.getTimezoneOffset()<-720?(Te="Tue Jan 02 -45875"!==Ie.toDateString(),Re=!/^Thu Dec 10 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(je.toString())):(Te="Mon Jan 01 -45875"!==Ie.toDateString(),Re=!/^Wed Dec 09 2015 \d\d:\d\d:\d\d GMT[-\+]\d\d\d\d(?: |$)/.test(je.toString()));var qe=b.bind(Date.prototype.getFullYear),Le=b.bind(Date.prototype.getMonth),Fe=b.bind(Date.prototype.getDate),Be=b.bind(Date.prototype.getUTCFullYear),Ve=b.bind(Date.prototype.getUTCMonth),$e=b.bind(Date.prototype.getUTCDate),Ue=b.bind(Date.prototype.getUTCDay),He=b.bind(Date.prototype.getUTCHours),ze=b.bind(Date.prototype.getUTCMinutes),Ge=b.bind(Date.prototype.getUTCSeconds),Je=b.bind(Date.prototype.getUTCMilliseconds),We=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],Qe=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],Ye=function(e,t){return Fe(new Date(t,e,0))};I(Date.prototype,{getFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=qe(this);return e<0&&Le(this)>11?e+1:e},getMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=qe(this),t=Le(this);return e<0&&t>11?0:t},getDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=qe(this),t=Le(this),n=Fe(this);return e<0&&t>11?12===t?n:Ye(0,e+1)-n+1:n},getUTCFullYear:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=Be(this);return e<0&&Ve(this)>11?e+1:e},getUTCMonth:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=Be(this),t=Ve(this);return e<0&&t>11?0:t},getUTCDate:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=Be(this),t=Ve(this),n=$e(this);return e<0&&t>11?12===t?n:Ye(0,e+1)-n+1:n}},De),I(Date.prototype,{toUTCString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=Ue(this),t=$e(this),n=Ve(this),i=Be(this),r=He(this),a=ze(this),s=Ge(this);return We[e]+", "+(t<10?"0"+t:t)+" "+Qe[n]+" "+i+" "+(r<10?"0"+r:r)+":"+(a<10?"0"+a:a)+":"+(s<10?"0"+s:s)+" GMT"}},De||Ne),I(Date.prototype,{toDateString:function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=this.getDay(),t=this.getDate(),n=this.getMonth(),i=this.getFullYear();return We[e]+" "+Qe[n]+" "+(t<10?"0"+t:t)+" "+i}},De||Te),(De||Re)&&(Date.prototype.toString=function(){if(!(this&&this instanceof Date))throw new TypeError("this is not a Date object.");var e=this.getDay(),t=this.getDate(),n=this.getMonth(),i=this.getFullYear(),r=this.getHours(),a=this.getMinutes(),s=this.getSeconds(),o=this.getTimezoneOffset(),l=Math.floor(Math.abs(o)/60),c=Math.floor(Math.abs(o)%60);return We[e]+" "+Qe[n]+" "+(t<10?"0"+t:t)+" "+i+" "+(r<10?"0"+r:r)+":"+(a<10?"0"+a:a)+":"+(s<10?"0"+s:s)+" GMT"+(o>0?"-":"+")+(l<10?"0"+l:l)+(c<10?"0"+c:c)},D&&i.defineProperty(Date.prototype,"toString",{configurable:!0,enumerable:!1,writable:!0}));var Ke=Date.prototype.toISOString&&-1===new Date(-621987552e5).toISOString().indexOf("-000001"),Ze=Date.prototype.toISOString&&"1969-12-31T23:59:59.999Z"!==new Date(-1).toISOString(),Xe=b.bind(Date.prototype.getTime);I(Date.prototype,{toISOString:function(){if(!isFinite(this)||!isFinite(Xe(this)))throw new RangeError("Date.prototype.toISOString called on non-finite value.");var e=Be(this),t=Ve(this);e+=Math.floor(t/12);var n=[(t=(t%12+12)%12)+1,$e(this),He(this),ze(this),Ge(this)];e=(e<0?"-":e>9999?"+":"")+U("00000"+Math.abs(e),0<=e&&e<=9999?-4:-6);for(var i=0;i<n.length;++i)n[i]=U("00"+n[i],-2);return e+"-"+V(n,0,2).join("-")+"T"+V(n,2).join(":")+"."+U("000"+Je(this),-3)+"Z"}},Ke||Ze),function(){try{return Date.prototype.toJSON&&null===new Date(NaN).toJSON()&&-1!==new Date(-621987552e5).toJSON().indexOf("-000001")&&Date.prototype.toJSON.call({toISOString:function(){return!0}})}catch(e){return!1}}()||(Date.prototype.toJSON=function(e){var t=i(this),n=q.ToPrimitive(t);if("number"==typeof n&&!isFinite(n))return null;var r=t.toISOString;if(!C(r))throw new TypeError("toISOString property is not callable");return r.call(t)});var et=1e15===Date.parse("+033658-09-27T01:46:40.000Z"),tt=!isNaN(Date.parse("2012-04-04T24:00:00.500Z"))||!isNaN(Date.parse("2012-11-31T23:59:59.000Z"))||!isNaN(Date.parse("2012-12-31T23:59:60.000Z"));if(isNaN(Date.parse("2000-01-01T00:00:00.000Z"))||tt||!et){var nt=Math.pow(2,31)-1,it=N(new Date(1970,0,1,0,0,0,nt+1).getTime());Date=function(e){var t=function(n,i,r,a,s,l,c){var u,d=arguments.length;if(this instanceof e){var h=l,p=c;if(it&&d>=7&&c>nt){var f=Math.floor(c/nt)*nt,g=Math.floor(f/1e3);h+=g,p-=1e3*g}u=1===d&&o(n)===n?new e(t.parse(n)):d>=7?new e(n,i,r,a,s,h,p):d>=6?new e(n,i,r,a,s,h):d>=5?new e(n,i,r,a,s):d>=4?new e(n,i,r,a):d>=3?new e(n,i,r):d>=2?new e(n,i):d>=1?new e(n instanceof e?+n:n):new e}else u=e.apply(this,arguments);return j(u)||I(u,{constructor:t},!0),u},n=new RegExp("^(\\d{4}|[+-]\\d{6})(?:-(\\d{2})(?:-(\\d{2})(?:T(\\d{2}):(\\d{2})(?::(\\d{2})(?:(\\.\\d{1,}))?)?(Z|(?:([-+])(\\d{2}):(\\d{2})))?)?)?)?$"),i=[0,31,59,90,120,151,181,212,243,273,304,334,365],r=function(e,t){var n=t>1?1:0;return i[t]+Math.floor((e-1969+n)/4)-Math.floor((e-1901+n)/100)+Math.floor((e-1601+n)/400)+365*(e-1970)},a=function(t){var n=0,i=t;if(it&&i>nt){var r=Math.floor(i/nt)*nt,a=Math.floor(r/1e3);n+=a,i-=1e3*a}return c(new e(1970,0,1,0,0,n,i))};for(var s in e)F(e,s)&&(t[s]=e[s]);I(t,{now:e.now,UTC:e.UTC},!0),t.prototype=e.prototype,I(t.prototype,{constructor:t},!0);return I(t,{parse:function(t){var i=n.exec(t);if(i){var s,o=c(i[1]),l=c(i[2]||1)-1,u=c(i[3]||1)-1,d=c(i[4]||0),h=c(i[5]||0),p=c(i[6]||0),f=Math.floor(1e3*c(i[7]||0)),g=Boolean(i[4]&&!i[8]),m="-"===i[9]?1:-1,b=c(i[10]||0),v=c(i[11]||0);return d<(h>0||p>0||f>0?24:25)&&h<60&&p<60&&f<1e3&&l>-1&&l<12&&b<24&&v<60&&u>-1&&u<r(o,l+1)-r(o,l)&&(s=60*(24*(r(o,l)+u)+d+b*m),s=1e3*(60*(s+h+v*m)+p)+f,g&&(s=a(s)),-864e13<=s&&s<=864e13)?s:NaN}return e.parse.apply(this,arguments)}}),t}(Date)}Date.now||(Date.now=function(){return(new Date).getTime()});var rt=u.toFixed&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0)),at={base:1e7,size:6,data:[0,0,0,0,0,0],multiply:function(e,t){for(var n=-1,i=t;++n<at.size;)i+=e*at.data[n],at.data[n]=i%at.base,i=Math.floor(i/at.base)},divide:function(e){for(var t=at.size,n=0;--t>=0;)n+=at.data[t],at.data[t]=Math.floor(n/e),n=n%e*at.base},numToString:function(){for(var e=at.size,t="";--e>=0;)if(""!==t||0===e||0!==at.data[e]){var n=o(at.data[e]);""===t?t=n:t+=U("0000000",0,7-n.length)+n}return t},pow:function e(t,n,i){return 0===n?i:n%2==1?e(t,n-1,i*t):e(t*t,n/2,i)},log:function(e){for(var t=0,n=e;n>=4096;)t+=12,n/=4096;for(;n>=2;)t+=1,n/=2;return t}};I(u,{toFixed:function(e){var t,n,i,r,a,s,l,u;if(t=c(e),(t=N(t)?0:Math.floor(t))<0||t>20)throw new RangeError("Number.toFixed called with invalid number of decimals");if(n=c(this),N(n))return"NaN";if(n<=-1e21||n>=1e21)return o(n);if(i="",n<0&&(i="-",n=-n),r="0",n>1e-21)if(a=at.log(n*at.pow(2,69,1))-69,s=a<0?n*at.pow(2,-a,1):n/at.pow(2,a,1),s*=4503599627370496,(a=52-a)>0){for(at.multiply(0,s),l=t;l>=7;)at.multiply(1e7,0),l-=7;for(at.multiply(at.pow(10,l,1),0),l=a-1;l>=23;)at.divide(1<<23),l-=23;at.divide(1<<l),at.multiply(1,1),at.divide(2),r=at.numToString()}else at.multiply(0,s),at.multiply(1<<-a,0),r=at.numToString()+U("0.00000000000000000000",2,2+t);return r=t>0?(u=r.length)<=t?i+U("0.0000000000000000000",0,t-u+2)+r:i+U(r,0,u-t)+"."+U(r,u-t):i+r}},rt);var st=function(){try{return"1"===1..toPrecision(void 0)}catch(e){return!0}}(),ot=u.toPrecision;I(u,{toPrecision:function(e){return void 0===e?ot.call(this):ot.call(this,e)}},st),2!=="ab".split(/(?:ab)*/).length||4!==".".split(/(.?)(.?)/).length||"t"==="tesst".split(/(s)*/)[1]||4!=="test".split(/(?:)/,-1).length||"".split(/.?/).length||".".split(/()()/).length>1?function(){var t=void 0===/()??/.exec("")[1],n=Math.pow(2,32)-1;l.split=function(i,r){var a=String(this);if(void 0===i&&0===r)return[];if(!e(i))return H(this,i,r);var s,o,l,c,u=[],d=(i.ignoreCase?"i":"")+(i.multiline?"m":"")+(i.unicode?"u":"")+(i.sticky?"y":""),h=0,f=new RegExp(i.source,d+"g");t||(s=new RegExp("^"+f.source+"$(?!\\s)",d));var g=void 0===r?n:q.ToUint32(r);for(o=f.exec(a);o&&!((l=o.index+o[0].length)>h&&(G(u,U(a,h,o.index)),!t&&o.length>1&&o[0].replace(s,function(){for(var e=1;e<arguments.length-2;e++)void 0===arguments[e]&&(o[e]=void 0)}),o.length>1&&o.index<a.length&&p.apply(u,V(o,1)),c=o[0].length,h=l,u.length>=g));)f.lastIndex===o.index&&f.lastIndex++,o=f.exec(a);return h===a.length?!c&&f.test("")||G(u,""):G(u,U(a,h)),u.length>g?V(u,0,g):u}}():"0".split(void 0,0).length&&(l.split=function(e,t){return void 0===e&&0===t?[]:H(this,e,t)});var lt=l.replace;(function(){var e=[];return"x".replace(/x(.)?/g,function(t,n){G(e,n)}),1===e.length&&void 0===e[0]})()||(l.replace=function(t,n){var i=C(n),r=e(t)&&/\)[*?]/.test(t.source);if(i&&r){return lt.call(this,t,function(e){var i=arguments.length,r=t.lastIndex;t.lastIndex=0;var a=t.exec(e)||[];return t.lastIndex=r,G(a,arguments[i-2],arguments[i-1]),n.apply(this,a)})}return lt.call(this,t,n)});var ct=l.substr,ut="".substr&&"b"!=="0b".substr(-1);I(l,{substr:function(e,t){var n=e;return e<0&&(n=y(this.length+e,0)),ct.call(this,n,t)}},ut);var dt="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff",ht="["+dt+"]",pt=new RegExp("^"+ht+ht+"*"),ft=new RegExp(ht+ht+"*$"),gt=l.trim&&(dt.trim()||!"​".trim());I(l,{trim:function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");return o(this).replace(pt,"").replace(ft,"")}},gt);var mt=b.bind(String.prototype.trim),bt=l.lastIndexOf&&-1!=="abcあい".lastIndexOf("あい",2);I(l,{lastIndexOf:function(e){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");for(var t=o(this),n=o(e),i=arguments.length>1?c(arguments[1]):NaN,r=N(i)?1/0:q.ToInteger(i),a=w(y(r,0),t.length),s=n.length,l=a+s;l>0;){l=y(0,l-s);var u=z(U(t,l,a+s),n);if(-1!==u)return l+u}return-1}},bt);var vt=l.lastIndexOf;if(I(l,{lastIndexOf:function(e){return vt.apply(this,arguments)}},1!==l.lastIndexOf.length),8===parseInt(dt+"08")&&22===parseInt(dt+"0x16")||(parseInt=function(e){var t=/^[\-+]?0[xX]/;return function(n,i){var r=mt(String(n)),a=c(i)||(t.test(r)?16:10);return e(r,a)}}(parseInt)),1/parseFloat("-0")!=-1/0&&(parseFloat=function(e){return function(t){var n=mt(String(t)),i=e(n);return 0===i&&"-"===U(n,0,1)?-0:i}}(parseFloat)),"RangeError: test"!==String(new RangeError("test"))){Error.prototype.toString=function(){if(void 0===this||null===this)throw new TypeError("can't convert "+this+" to object");var e=this.name;void 0===e?e="Error":"string"!=typeof e&&(e=o(e));var t=this.message;return void 0===t?t="":"string"!=typeof t&&(t=o(t)),e?t?e+": "+t:e:t}}if(D){var yt=function(e,t){if(J(e,t)){var n=Object.getOwnPropertyDescriptor(e,t);n.configurable&&(n.enumerable=!1,Object.defineProperty(e,t,n))}};yt(Error.prototype,"message"),""!==Error.prototype.message&&(Error.prototype.message=""),yt(Error.prototype,"name")}if("/a/gim"!==String(/a/gim)){RegExp.prototype.toString=function(){var e="/"+this.source+"/";return this.global&&(e+="g"),this.ignoreCase&&(e+="i"),this.multiline&&(e+="m"),e}}}),define("js/apps/discovery/main",["config","module"],function(e,t){require(["router","js/components/application","js/mixins/discovery_bootstrap","js/mixins/api_access","es5-shim"],function(e,n,i,r){n.prototype.shim();var a=window.location.href.indexOf("debug=true")>-1,s=new(n.extend(i))({debug:a,timeout:3e4});s.loadModules(t.config()).done(function(){s.activate();var t=s.getService("PubSub");t.publish(t.getCurrentPubSubKey(),t.APP_LOADED),s.configure(),s.bootstrap().done(function(n){s.onBootstrap(n),t.publish(t.getCurrentPubSubKey(),t.APP_BOOTSTRAPPED),t.publish(t.getCurrentPubSubKey(),t.APP_STARTING),s.start(e),t.publish(t.getCurrentPubSubKey(),t.APP_STARTED),$("body").on("click","button.toggle-menu",function(e){var t=$(e.target),n=t.parents().eq(1).find(".nav-container");n.toggleClass("show");var i=n.hasClass("show")?'  <i class="fa fa-close"></i> Close Menu':' <i class="fa fa-bars"></i> Show Menu';t.html(i)}),$("body").on("click","#skip-to-main-content",function(e){e.preventDefault()});var i=s.getObject("DynamicConfig");i&&i.debugExportBBB&&(console.log("Exposing Bumblebee as global object: window.bbb"),window.bbb=s)}).fail(function(){s.redirect("500.html")})}).fail(function(){a||s.reload("404.html")})})}),define("cache",["require","exports","module"],function(e,t,n){!function(){"use strict";function e(e){var t=this;!function(e){var n=e.maximumWeight,i=e.weigherFunction,r=e.maximumSize,a="number"==typeof n&&n>-1,s="function"==typeof i;if(!a&&s||a&&!s)throw new Error("Maximum weight or weight function has illegal values");if(a&&s&&"number"==typeof r&&r>-1)throw new Error("Both max weight and size can't be configured");t._spec={loaderFn:"function"==typeof e.loaderFunction&&e.loaderFunction,expiresAfterWrite:"number"==typeof e.expiresAfterWrite?1e3*e.expiresAfterWrite:null,recordStats:e.recordStats,maxSize:r,maxWeight:n,weighFn:i,onRemove:"function"==typeof e.onRemove&&e.onRemove}}(e),s.apply(this)}function t(e){this.tail=this.head=Object.create(i.prototype),this.type=e}function i(e,t,n,i){this.key=e,this.loading=n,n||this.setValue(t),this.onLoad=i?[i]:[],this.writeTime=Date.now()}function r(e,t){var n=this,i=this._cache[e];if(i){if(i.loading)return n.stats.missCount++,void i.onLoad.push(t);this.isExpired(i)?(n.stats.missCount++,n._notify(i,n._REMOVAL_CAUSE_E),i.loading=!0,i.onLoad.push(t),o(n,l.bind(i),e)):(i.promote(this._accessQueue),n.stats.hitCount++,t.apply(null,[null,i.value]))}else n.stats.missCount++,i=n._createEntry(e,null,!0,t),o(n,l.bind(i),e)}function a(e,t,n){var i,r=null,a=e._spec.loaderFn;return a&&(a.apply(null,[n,function(e,t){i=e,r=t}]),t(i,r)),r}e.prototype._REMOVAL_CAUSE_I="explicit",e.prototype._REMOVAL_CAUSE_C="capacity",e.prototype._REMOVAL_CAUSE_E="expired";var s=function(){function e(e,t,n,i){return n?function(r){if(r)for(var a=n.tail.prev(n),s=null;a&&t.apply(i,[a]);)a&&(s=a.prev(n),i._rmEntry(a,e),a=s)}.bind(n):function(){}}this._accessQueue=new t("A"),this._writeQueue=this._spec.expiresAfterWrite?new t("W"):null;var n=e(this._REMOVAL_CAUSE_C,this._canReap,this._accessQueue,this),i=e(this._REMOVAL_CAUSE_E,this.isExpired,this._writeQueue,this);this._cleanup=function(e){n(e),i(this._writeQueue)},this.size=0,this.weight=0,this._cache=Object.create(null),Object.defineProperty(this,"stats",{value:{hitCount:0,missCount:0,requestCount:0},configurable:!0})};i.prototype.setValue=function(e){if(void 0===e||null===e)throw new Error("Illegal value for key "+e);this.value=e,this.writeTime=Date.now()},i.prototype.moveToHead=function(e){var t=this;e.forEach(function(e){if(e){var n=e.head;t.next(e,n),n.prev(e,t),e.head=t}})},i.prototype.next=function(e,t){var n="next"+e.type;return void 0!==t&&(this[n]=t),this[n]},i.prototype.prev=function(e,t){var n="prev"+e.type;return void 0!==t&&(this[n]=t),this[n]},i.prototype.remove=function(e){if(e){var t=this.prev(e),n=this.next(e);t?(t.next(e,n),n.prev(e,t)):(n.prev(e,null),e.head=n),n.next(e)||(e.tail=n),this.next(e,null),this.prev(e,null)}},i.prototype.promote=function(){var e=this;Array.prototype.slice.call(arguments).forEach(function(t){t&&e.prev(t)&&(e.remove(t),e.moveToHead([t]))})},i.prototype.forEach=function(e,t){for(var n=this;n;)e.call(this,n),n=n.next(t)},e.prototype.put=function(e,t){var n=this._cache[e];n?(n.setValue(t),n.writeTime=Date.now(),n.promote(this._accessQueue,this._writeQueue),this._cleanup(!1)):this._createEntry(e,t)},e.prototype._createEntry=function(e,t,n,r){var a=new i(e,t,n,r);return this._cleanup(!0),this._cache[e]=a,this._updateCacheSize(a,!0),a.moveToHead([this._accessQueue,this._writeQueue]),a},e.prototype.isExpired=function(e){var t=this._spec.expiresAfterWrite,n=Date.now();return!e.loading&&t&&t>0&&n-e.writeTime>t},e.prototype._updateCacheSize=function(e,t){var n;this._spec.maxWeight&&(n=this._spec.weighFn.apply(this,[e.key,e.value]),this.weight+=t?n:-n),this.size+=t?1:-1},e.prototype.get=function(e,t){t=t||function(){},this.stats.requestCount++;var n=this;process.nextTick(function(){r.call(n,e,t)})};var o=function(e,t,n){var i=e._spec.loaderFn;i&&i.apply(null,[n,function(n,i){t(e,n,i)}])},l=function(e,t,n){if(!t)try{this.setValue(n),this.promote(e._accessQueue,e._writeQueue),this.onLoad.forEach(function(e){e.apply(null,[t,n])}),this.onLoad=[],this.loading=!1}catch(e){t=e}t&&(this.onLoad.forEach(function(e){e.apply(null,[t,n])}),e._rmEntry(this))};e.prototype.getSync=function(e){var t=arguments.length>2&&arguments[2];this.stats.requestCount++;var n,i=this._cache[e],r=this;return i?this.isExpired(i)?(this.stats.missCount++,t?this._rmEntry(i,this._REMOVAL_CAUSE_E):n=a(r,function(e,t){if(e)throw e;r._notify(i,r._REMOVAL_CAUSE_E),i.setValue(t),i.promote(r._accessQueue,r._writeQueue)},e)):(i.promote(this._accessQueue),n=i.value,this.stats.hitCount++):(this.stats.missCount++,t||(n=a(r,function(t,n){if(t)throw t;r._createEntry(e,n)},e))),n},e.prototype.getIfPresent=function(e){return this.getSync(e,null,!0)},e.prototype.invalidate=function(e){var t=this._cache[e];this._rmEntry(t,this._REMOVAL_CAUSE_I)},e.prototype._notify=function(e,t){this._spec.onRemove&&this._spec.onRemove.apply(null,[e.key,e.value,t])},e.prototype._rmEntry=function(e,t){e.remove(this._accessQueue),e.remove(this._writeQueue),this._updateCacheSize(e,!1),delete this._cache[e.key],t&&this._notify(e,t)},e.prototype.invalidateAll=function(){var e=this;Object.keys(this._cache).forEach(function(t){e.invalidate(t)})},e.prototype._canReap=function(){return this._spec.maxSize&&this.size>=this._spec.maxSize||this._spec.maxWeight&&this.weight>this._spec.maxWeight},n.exports=e}()}),define("js/components/json_response",["underscore","backbone","js/components/api_query"],function(e,t,n){var i=function(t,n){var i,r=t||{};n||(n={}),this.rid=e.uniqueId("r"),this.readOnly=!n.hasOwnProperty("readOnly")||n.readOnly,this._url=n.hasOwnProperty("url")?n.url:null,n.parse&&(r=this.parse(r,n)||{}),(i=e.result(this,"defaults"))&&(r=e.defaults({},r,i)),this.attributes=r,this.initialize.apply(this,arguments)};return e.extend(i.prototype,{initialize:function(){},getApiQuery:function(){return this.apiQuery},setApiQuery:function(e){if(e){if(!(e instanceof n))throw new Error("Only ApiQuery instances accepted");this.apiQuery=e}},toJSON:function(e){return this._clone(this.attributes)},url:function(){return this._url?this._url:this.rid},set:function(e,t,n){if(this.readOnly)throw Error("You can't change read-only response object");var i=this._split(e);if(1==i.length)this.attributes[i[0]]=t;else{this.get(e);t}},_split:function(e){for(var t=[],n=0,i=e.length,r=0,a=[];n<i;)e[n]==a[a.length-1]?a.pop():'"'==e[n]||"'"==e[n]?a.push(e[n]):"."==e[n]&&0==a.length?(t.push(e.substring(r,n)),r=n+1):"["==e[n]&&0==a.length&&(t.push(e.substring(r,n)),t.push(e.substring(n,e.indexOf("]",n+1)+1)),r=n=e.indexOf("]",n+1)+1),n+=1;return r<i&&t.push(e.substring(r)),t},has:function(e){return this.get(e,!0)},get:function(t,n){if(!t)return this._clone(this.attributes);for(var i=this._split(t),r=[],a=this.attributes;i.length>0;){var s=i.shift();if(a.hasOwnProperty(s))a=a[s],r.push(s);else{if(!(s.indexOf("[")>-1)){if(n)return!1;throw new Error("Can't find: "+t+(r.length>0?" (worked up to: "+r.join(".")+")":""))}var o=s.trim().substring(1,s.length-1);if((o.indexOf('"')>-1||o.indexOf("'")>-1)&&a.hasOwnProperty(o.substring(1,o.length-1)))a=a[o.substring(1,o.length-1)],r.push(o);else{if(!e.isArray(a)){if(n)return!1;throw new Error("Can't find: "+t+(r.length>0?" (worked up to: "+r.join(".")+")":""))}var l=null;try{if(l=parseInt(o),e.isNaN(l)||a.length<=l||l<0){if(n)return!1;throw new Error}a=a[l],r.push(o)}catch(e){if(n)return!1;throw new Error("Can't find: "+t+(r.length>0?" (worked up to: "+r.join(".")+")":""))}}}}return!!n||this._clone(a)},clone:function(){return new this.constructor(this.attributes)},_clone:function(t){return this.readOnly&&e.isObject(t)?e.cloneDeep?e.cloneDeep(t):JSON.parse(JSON.stringify(t)):t},isLocked:function(){return this.readOnly},lock:function(){return this.readOnly=!0},unlock:function(){return this.readOnly=!1}}),i.extend=t.Model.extend,i}),define("js/components/solr_response",["js/components/json_response","js/components/solr_params","backbone","underscore","jquery"],function(e,t,n,i,r){return e.extend({initialize:function(){if(!this.has("responseHeader.params"))throw new Error("SOLR data error - missing: responseHeader.params");if(i.isString(this._url)){var e=new t;this._url=new t(e.parse(this._url)).url()}else{var n=this.get("responseHeader.params");this._url=new t(n).url()}},url:function(e,t){return this._url}})}),define("js/components/api_response",["underscore","backbone","js/components/solr_response","js/components/facade"],function(e,t,n,i){var r={set:"set (replace existing)",get:"get values",has:"has a key",toJSON:"values back as JSON object",clone:"make a copy",url:"url string of the params",isLocked:!0,lock:!0,unlock:!0,setApiQuery:"sets the ApiQuery",getApiQuery:"gets the query"},a=function(e,t){this.innerResponse=e instanceof n?new i(r,e):new i(r,new n(e,t))},s={};return e.each(e.keys(r),function(e,t,n){s[e]=function(){return this.innerResponse[e].apply(this.innerResponse,arguments)}}),e.extend(a.prototype,s,{clone:function(){var e=this.innerResponse.clone.apply(this.innerResponse,arguments);return new a(e)}}),a}),define("js/components/feedback_mediator",["underscore","jquery","cache","js/components/generic_module","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/pubsub_key","js/mixins/dependon"],function(e,t,n,i,r,a,s,o,l,c){var u=i.extend({initialize:function(e){this._cache=this._getNewCache(e.cache),this.debug=e.debug||!1,this._handlers={},this.app=null},_getNewCache:function(t){return new n(e.extend({maximumSize:150,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){if(!n)throw new Error("This controller absolutely needs access to the app");this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.FEEDBACK,e.bind(this.receiveFeedback,this))},receiveFeedback:function(e,t){this.debug&&console.log("[EM]: received feedback:",e.toJSON(),t?t.getId():null);var n=this._getCacheKey(e,t),i=this._retrieveCacheEntry(n);i||(i=this.createNewCacheEntry(n),this._cache.put(n,i));var r=this.getFeedbackHandler(e,i);if(r){if(r.execute&&r.execute(e,i))return;if(r.call(this,e,i))return}this.handleFeedback(e,i)},removeFeedbackHandler:function(e){e.toString()in this._handlers&&delete this._handlers[e.toString()]},addFeedbackHandler:function(t,n){if(!t&&!e.isNumber(t))throw new Error("first argument must be code or code:string or string");if(!e.isFunction(n))throw new Error("second argument must be executable");this._handlers[t.toString()]=n},getFeedbackHandler:function(e,t){for(var n=[e.code+":"+t.id,t.id,e.code?e.code.toString():Date.now()],i=0;i<n.length;i++)if(n[i]in this._handlers)return this._handlers[n[i]]},_retrieveCacheEntry:function(e){return this._cache.getSync(e)},_getCacheKey:function(t,n){if(!t)throw new Error("ApiFeedback cannot be empty");if(t.getSenderKey())return t.getSenderKey();if(n){if(n instanceof l)return n.getId();if(e.isString(n))return n}var i=t.getApiRequest();if(i)return i.url();throw new Error("We cannot identify the origin (recipient) of this feedback")},createNewCacheEntry:function(e){return{waiting:0,max:0,errors:0,counter:0,created:Date.now(),id:e}},handleFeedback:function(e,t){var n=o.CODES;switch(t.counter+=1,e.code){case n.ALL_FINE:t.errors=0;break;case n.KEEP_WAITING:t.waiting+=t.started;break;case n.SERVER_ERROR:break;case n.ALERT:this.getApp().getController("AlertsController").onAlert(e,t)}}});return e.extend(u.prototype,c.BeeHive,c.App),u}),define("js/widgets/widget_states",[],function(){return{RESET:0,WAITING:1,ERRORED:2,ENABLED:3,DISABLED:4}}),define("js/components/alerts",["backbone","js/mixins/hardened"],function(e,t){return{TYPE:{ERROR:"error",INFO:"info",WARNING:"warning",SUCCESS:"success",DANGER:"danger"},ACTION:{CALL_PUBSUB:2,TRIGGER_FEEDBACK:1}}}),define("discovery.vars",[],function(){"use strict";return{apiRoot:"//api.adsabs.harvard.edu/v1/",bootstrapUrls:["accounts/bootstrap"],routerConf:{pushState:!1,root:"/"},debugExportBBB:!0,debug:!1,useCache:!1,googleTrackingCode:"UA-37369750-6",googleTrackingOptions:"auto",orcidClientId:"APP-BA5POB6F5D7CTHX2",orcidLoginEndpoint:"https://orcid.org/oauth/authorize",orcidApiEndpoint:"//api.adsabs.harvard.edu/v1/orcid",recaptchaKey:"6Lf__gITAAAAAMjwyJnzWfuJi9NTbecK5p_2K4Hk"}}),define("analytics",["require","analytics_config","jquery"],function(e,t,n){if(window.GoogleAnalyticsObject)return function(){window[window.GoogleAnalyticsObject].apply(this,arguments)};if(!t)return console.error('Analytics will not work because require.config["js/components/analytics"]["require"] does not tells where to find config'),function(){};var i;window.GoogleAnalyticsObject="ga",window.ga=function(){(window.ga.q=window.ga.q||[]).push(arguments),window.ga.q.length>100&&(window.ga.q=window.ga.q.slice(0,50))},window.ga.l=1*new Date,i=function(){window.ga.apply(this,arguments)},window.ga("create",t.googleTrackingCode,t.googleTrackingOptions);var r=n.Deferred();return e(["google-analytics"],function(e){r.resolve()},function(e){console.warn("google-analytics could not be loaded; we will work just fine without it",e),r.reject()}),i.promise=r.promise(),i}),define("js/wraps/discovery_mediator",["underscore","jquery","js/components/feedback_mediator","js/components/api_feedback","js/widgets/widget_states","js/components/alerts","js/components/api_response","analytics"],function(e,t,n,i,r,a,s,o){var l='<h4><strong>Something went wrong</strong></h4>Please <a onclick="window.location.reload()" href="'+window.location.href+'">reload</a> to try again',c={};return c[i.CODES.MAKE_SPACE]=function(t){var n=this.getApp().getObject("MasterPageManager");if(n){var i=n.getCurrentActiveChild();i.view&&i.view.showCols&&(i.view.showCols({right:!1,left:!1}),this.getBeeHive().getService("PubSub").once(this.getPubSub().START_SEARCH,e.once(function(){i.view.showCols({right:!0})})))}this.getBeeHive().getService("PubSub").once(this.getPubSub().DELIVERING_REQUEST,e.bind(function(e,t){this._tmp.callOnce[t.getId()]||(this._tmp.callOnce[t.getId()]=!0)},this))},c[i.CODES.UNMAKE_SPACE]=function(e){var t=this.getApp().getObject("MasterPageManager");if(t){var n=t.getCurrentActiveChild();n.view&&n.view.showCols&&n.view.showCols({right:!0,left:!0})}},c[i.CODES.SEARCH_CYCLE_STARTED]=function(t){this._tmp.cycle_started=!0;var n=this.getApp();if(t.query?(n.getObject("AppStorage").setCurrentQuery(t.query),n.getObject("AppStorage").setCurrentNumFound(t.numFound)):n.getObject("AppStorage").setCurrentQuery(null),this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page"),t.request&&t.request.get("target").indexOf("search")>-1&&t.query&&!t.numFound){var r=t.query.clone();this.getAlerter().alert(new i({type:a.TYPE.ALERT,msg:'Your query returned 0 results.&nbsp;<b><a href="#">&nbsp;&nbsp;Try looking at the search examples on the home page</a></b>  or <b><a href="https://adsabs.github.io/help/search/search-syntax" target="_blank">reading our help page</a>.</b>',events:{"click a#query-assistant":"query-assistant"}})).done(function(e){if("query-assistant"==e){var t=r.get("q").join(" ");n.getWidget("SearchWidget").done(function(e){t?e.openQueryAssistant(t):e.openQueryAssistant("ooops, the query is complex (we are not yet ready for that)")})}})}else{t.numFound>1e3&&n.getWidget("SearchWidget").done(function(e){e.view&&e.view.highlightFields&&search.view.highlightFields()});e.keys(t.cycle.waiting);this.getAlerter().alert(new i({type:a.TYPE.INFO,msg:null}))}},c[i.CODES.SEARCH_CYCLE_FAILED_TO_START]=function(t){var n=t.request,r=t.error.jqXHR||{},a=this.getApp(),c=this.getAlerter(),u=this,d={target:"",msg:r.statusText};if(o("send","event","error","search",r.statusText),r&&n){var h=n.get("target");switch(d.target=h,d.query=n.get("query").toJSON(),r.status){case 401:case 404:return void a.getApiAccess({reconnect:!0}).done(function(){a.getService("Api").request(n,{done:function(){a.getController("QueryMediator").resetFailures(),u.getPubSub().publish(u.getPubSub().START_SEARCH,n.get("query"))},fail:function(){c.alert(new i({msg:l,modal:!0,type:"danger"}))}})}).fail(function(){c.alert(new i({code:i.CODES.DANGER,msg:l,modal:!0}))})}if(h.indexOf("search")>-1){if(400==r.status){var p=n.get("query"),f="";return r.responseJSON&&r.responseJSON.error&&r.responseJSON.error.msg&&(f=r.responseJSON.error.msg).indexOf("SyntaxError")>-1&&(f=(f=(f=(f=(f=(f=f.replace("org.apache.solr.search.SyntaxError:","")).replace("org.apache.solr.common.SolrException:","")).replace("INVALID_SYNTAX_CANNOT_PARSE:","")).replace(": The parser reported a syntax error, antlrqueryparser hates errors!","")).trim()).replace("Syntax Error, cannot parse","Syntax Error, cannot parse<b>")+"</b>"),void c.alert(new i({msg:(f||"There is something wrong with the query:")+'<b><a href="#">&nbsp;&nbsp;Try looking at the search examples on the home page</a></b>  or <b><a href="https://adsabs.github.io/help/search/search-syntax" target="_blank">reading our help page</a>.</b>',events:{"click a#query-assistant":"query-assistant"}})).done(function(e){"query-assistant"==e&&u.getApp().getWidget("SearchWidget").done(function(e){var t=p.get("q").join(" ");t?e.openQueryAssistant(t):e.openQueryAssistant("ooops, the query is complex (we are not yet ready for that)")})})}if(500==r.status&&r.responseJSON){var g=r.responseJSON;if(g.error&&g.error.msg&&g.error.msg.indexOf("maxClauseCount")>-1){var m=new s(g),b=t.cycle,v=e.keys(b.inprogress)[0],y=b.inprogress[v];return m.setApiQuery(y.request.get("query")),b.done[v]=b.inprogress[v],delete b.inprogress[v],u.getPubSub().publish(u.getPubSub().DELIVERING_RESPONSE+v,m),b.running=!1,void a.getController("QueryMediator").startExecutingQueries()}}}}c.alert(new i({code:i.CODES.ALERT,msg:l,modal:!0}))},c[i.CODES.API_REQUEST_ERROR]=function(e){var t=e.request,n=t.get("query"),r=t.get("target"),a=e.psk,s={error:e.errorThrown,errorCode:e.error.status,destination:r,query:n?n.toJSON():void 0},l=this.getApp(),c=this.getAlerter();if(o("send","event","error","api-request",JSON.stringify(s)),a){var u=l.getPluginOrWidgetName(a.getId());if(u){if(console.error("Query failed for widget: "+u,s),/orcid/.exec(r)&&401==e.error.status){c.alert(new i({code:i.CODES.ALERT,msg:"Your connection with Orcid is no longer valid, it may be that you revoked your token. To continue using this feature, please log back in to Orcid.",modal:!0}));var d=l.getService("OrcidApi"),h=l.getObject("User");return d.signOut(),void h.setOrcidMode(0)}this._tmp.api_failures=this._tmp.api_failures||{},this._tmp.api_failures[u]=this._tmp.api_failures[u]||0,this._tmp.api_failures[u]+=1;this._tmp.api_failures[u]}else if(!e.beVerbose)return;this._tmp.cycle_started}else console.error("We are not going to handle the error (PSK is empty, can't identify the component")},c[i.CODES.QUERY_ASSISTANT]=function(e){this.getApp().getWidget("SearchWidget").done(function(t){var n=null;e.query&&(n=e.query.get("q").join(" ")),t.openQueryAssistant(n)})},function(){var t=new(n.extend({_tmp:{},activate:function(){n.prototype.activate.apply(this,arguments);var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,e.bind(this.onNewCycle,this)),t.subscribe(t.ARIA_ANNOUNCEMENT,e.bind(this.onPageChange,this)),t.subscribe(t.APP_EXIT,e.bind(this.onAppExit,this)),t.subscribeOnce(t.APP_STARTING,e.bind(this.onAppStarting,this))},onAppStarting:function(){var t=this.getBeeHive().getService("PubSub"),n=this.getApp().getController("QueryMediator");t.unsubscribe(n.getPubSub().getCurrentPubSubKey(),t.START_SEARCH),this.getPubSub().subscribe(t.START_SEARCH,e.bind(function(e,t){var n,i,r=this.getPubSub(),a=this.getApp();if(r&&(n=a.getController("QueryMediator"))){if((i=a.getObject("AppStorage"))&&i.getCurrentQuery())try{console.log("URL: ",i.getCurrentQuery().url())}catch(e){}i&&i.hasCurrentQuery()&&e.url()==i.getCurrentQuery().url()&&"widget:SearchWidget"!=a.getPluginOrWidgetName(t.getId())&&a.getWidgetRefCount("Results")>=1&&a.hasService("Navigator")?a.getService("Navigator").navigate("results-page",{replace:!0}):("SearchPage"!==this.getCurrentPage()&&a.getWidgetRefCount("Results")<=0&&a.getService("Navigator").navigate("results-page",{replace:!1}),n.getQueryAndStartSearchCycle.apply(n,arguments))}},this))},onNewCycle:function(){this.reset()},onPageChange:function(e){e=e.replace("Switching to: ",""),this._currentPage=e,o("send","pageview",{page:e})},getCurrentPage:function(){return this._currentPage||"LandingPage"},onAppExit:function(e){console.log("App exit requested to: "+e);var t=this.getAlerter();e&&e.url&&("orcid"==e.type?t.alert(new i({code:i.CODES.WARNING,msg:'<p>You will be redirected to ORCID.</p> <p>Please sign in with your ORCID credentials and click on the "authorize" button.</p><p><b>This service is experimental. Should you have any suggestions, please let us know at <a href="mailto:adshelp@cfa.harvard.edu">adshelp@cfa.harvard.edu</a></b></p><button class="btn btn-success" id="okOrcid">Take me to ORCID</button>',modal:!0,events:{"click button#okOrcid":"OK"}})).done(function(t){"OK"==t&&(window.location=e.url)}):window.location=e.url)},getAlerter:function(){return this.getApp().getController(this.alertsController||"AlertsController")},createFeedback:function(e){return new i(e)},reset:function(){this._tmp={callOnce:{}}}}));return e.each(e.pairs(c),function(e){t.addFeedbackHandler(e[0],e[1])}),t}}),define("js/mixins/add_secondary_sort",[],function(){return{addSecondarySort:function(e){if(e.get("sort")){var t=e.get("sort")[0].split(",")[0],n=t.indexOf(" asc")>-1?"bibcode asc":"bibcode desc";e.set("sort",t+", "+n)}}}}),define("js/components/query_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/mixins/add_secondary_sort","js/components/api_request","js/components/api_response","js/components/api_query_updater","js/components/api_feedback","js/components/json_response","js/components/api_targets","js/components/api_query"],function(e,t,n,i,r,a,s,o,l,c,u,d,h){var p=i.extend({initialize:function(t){t=t||{},this._cache=null,this.debug=t.debug||!1,this.queryUpdater=new l("QueryMediator"),this.failedRequestsCache=this._getNewCache(),this.maxRetries=t.maxRetries||3,this.recoveryDelayInMs=e.isNumber(t.recoveryDelayInMs)?t.recoveryDelayInMs:700,this.__searchCycle={waiting:{},inprogress:{},done:{},failed:{}},this.shortDelayInMs=e.isNumber(t.shortDelayInMs)?t.shortDelayInMs:10,this.longDelayInMs=e.isNumber(t.longDelayInMs)?t.longDelayInMs:100,this.monitoringDelayInMs=e.isNumber(t.monitoringDelayInMs)?t.monitoringDelayInMs:200,this.mostRecentQuery=new h},activateCache:function(e){this._cache=this._getNewCache((e||{}).cache)},_getNewCache:function(t){return new n(e.extend({maximumSize:100,expiresAfterWrite:1800},e.isObject(t)?t:{}))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();i.subscribe(i.START_SEARCH,e.bind(this.getQueryAndStartSearchCycle,this)),i.subscribe(i.DELIVERING_REQUEST,e.bind(this.receiveRequests,this)),i.subscribe(i.EXECUTE_REQUEST,e.bind(this.executeRequest,this)),i.subscribe(i.GET_QTREE,e.bind(this.getQTree,this))},getQTree:function(e,t){var n=new s({query:e,target:d.QTREE});this._executeRequest(n,t)},doQueryTranslation:function(e){var n=t.Deferred(),i=this.getPubSub(),r={type:"POST",contentType:"application/json"},a=new s({target:d.SERVICE_OBJECTS_QUERY,query:new h({query:e}),options:r});return i.subscribeOnce(i.DELIVERING_RESPONSE,function(e){n.resolve(e.toJSON())}),i.publish(i.EXECUTE_REQUEST,a),n.promise()},getQueryAndStartSearchCycle:function(e,t){var n=this,i=this.getPubSub();if(a.addSecondarySort(e),this.original_url&&e.get("q")&&-1!==e.get("q")[0].indexOf("simbid")){var r=e.clone(),o=e.get("q")[0];e.has("__original_query")&&(o=e.get("__original_query")[0]),r.set("q",o),this.original_url=this.queryUpdater.clean(r).url()}else this.original_url=this.queryUpdater.clean(e).url();if(this.original_query=e.get("q"),e.get("__bigquery")){e.set("bigquery","bibcode\n"+e.get("__bigquery").join("\n")),e.unset("__bigquery"),e.get("q")||e.set("q","*:*"),e.add("fq","{!bitset}");var l=new s({target:d.MYADS_STORAGE+"/query",query:e,options:{type:"POST",contentType:"application/json",done:function(i){var r=new h({q:e.get("q"),__qid:i.qid}),a=e.get("__bigquerySource");a&&r.set("__bigquerySource",a[0]),e.get("sort")&&r.set("sort",e.get("sort")),n.startSearchCycle(r,t)},fail:function(e,t,n){console.warn("bigquery failed:",[].slice.apply(arguments).join(",")),i.publish(i.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FAILED_TO_START,error:{jqXHR:e,textStatus:t,errorThrown:n}}))}}});this.getBeeHive().getService("Api").request(l)}else if(e.get("q")[0].indexOf("object:")>-1){var u=function(n){e.set({q:n.query}),this.startSearchCycle(e,t)}.bind(this);this.doQueryTranslation(e.get("q")[0]).done(u)}else this.startSearchCycle.apply(this,arguments)},startSearchCycle:function(t,n){if(this.getBeeHive().getObject("AppStorage")&&this.getBeeHive().getObject("AppStorage").clearSelectedPapers(),!this.mostRecentQuery.get("__qid")||t.get("__qid")||t.get("__clearBiqQuery")||(this.mostRecentQuery.set("q",t.get("q")),t=this.mostRecentQuery),this.mostRecentQuery=t,this.debug&&console.log("[QM]: received query:",this.hasApp()?this.getApp().getPluginOrWidgetName(n.getId())||n.getId():n.getId(),t.url()),t.keys().length<=0)console.error("[QM] : received empty query (huh?!)");else{t.get("q")[0].indexOf("simbid")>-1&&(t.add("__original_url",this.original_url),t.add("__original_query",this.original_query));var i=this.getPubSub();this.__searchCycle.running&&this.__searchCycle.waiting&&e.keys(this.__searchCycle.waiting)&&console.error("The previous search cycle did not finish, and there already comes the next!"),this.reset(),this.__searchCycle.initiator=n.getId(),this.__searchCycle.collectingRequests=!0,this.__searchCycle.query=t.clone();var r=t.clone();r.unset("fl"),r.lock(),i.publish(i.INVITING_REQUEST,r);var a=this;this.shortDelayInMs?setTimeout(function(){a.__searchCycle.collectingRequests=!1,a.startExecutingQueries()&&a.monitorExecution()},this.shortDelayInMs):(this.__searchCycle.collectingRequests=!1,a.startExecutingQueries()&&setTimeout(function(){a.monitorExecution()},this.shortDelayInMs))}},startExecutingQueries:function(t){var n=this,i=this.__searchCycle;if(!i.running&&!e.isEmpty(i.waiting)&&this.hasBeeHive()){i.running=!0;var r,a=this.getBeeHive().getService("Api"),s=this.getPubSub();if(s&&a){var o;if((o=this.getApp().getPskOfPluginOrWidget("widget:Results"))&&i.waiting[o]&&(r=i.waiting[o],delete i.waiting[o]),!r&&i.waiting[i.initiator]&&(r=i.waiting[i.initiator],delete i.waiting[i.initiator]),!r){this.debug&&console.warn("DynamicConfig does not tell us which request to execute first (grabbing random one).");var l;r=i.waiting[l=e.keys(i.waiting)[0]],delete i.waiting[l]}var u=r.key.getId();return i.inprogress[u]=r,this._executeRequest(r.request,r.key).done(function(t,a,o){i.done[u]=r,delete i.inprogress[u];var l=void 0;t.response&&t.response.numFound&&(l=t.response.numFound),s.publish(s.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_STARTED,query:i.query,request:r.request,numFound:l,cycle:i,response:t}));var d=function(){e.each(e.keys(i.waiting),function(t){r=i.waiting[t],delete i.waiting[t],i.inprogress[t]=r;var a=t;n._executeRequest.call(n,r.request,r.key).done(function(){i.done[a]=i.inprogress[a],delete i.inprogress[a]}).fail(function(){i.failed[a]=i.inprogress[a],delete i.inprogress[a]}).always(function(){i.finished||e.isEmpty(i.inprogress)&&(s.publish(s.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FINISHED,cycle:i})),i.finished=!0)})})};n.longDelayInMs&&n.longDelayInMs>0?setTimeout(function(){d()},n.longDelayInMs):d()}).fail(function(e,t,r){n.__searchCycle.error=!0,s.publish(s.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FAILED_TO_START,cycle:i,request:this.request,error:{jqXHR:e,textStatus:t,errorThrown:r}}))}),!0}}},monitorExecution:function(){if(this.hasBeeHive()){var t=this,n=this.getPubSub();if(n){if(this.__searchCycle.monitor+=1,this.__searchCycle.monitor>100)return console.warn("Stopping monitoring of queries, it is running too long"),void n.publish(n.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_STOP_MONITORING,cycle:this.__searchCycle}));if(this.__searchCycle.inprogress&&e.isEmpty(this.__searchCycle.inprogress)){if(this.__searchCycle.finished)return;n.publish(n.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_FINISHED,cycle:this.__searchCycle}))}else{var i=e.keys(this.__searchCycle.waiting).length,r=i+e.keys(this.__searchCycle.done).length+e.keys(this.__searchCycle.inprogress).length+e.keys(this.__searchCycle.failed).length;n.publish(n.FEEDBACK,new c({code:c.CODES.SEARCH_CYCLE_PROGRESS,msg:i/r,total:r,todo:i,cycle:this.__searchCycle})),setTimeout(function(){t.monitorExecution()},t.monitoringDelayInMs)}}}},receiveRequests:function(e,t){this.debug&&console.log("[QM]: received request:",this.hasApp()?this.getApp().getPluginOrWidgetName(t.getId())||t.getId():t.getId(),e.url()),this.__searchCycle.collectingRequests?this.__searchCycle.waiting[t.getId()]={request:e,key:t}:this.executeRequest(e,t)},executeRequest:function(e,t){if(!(e instanceof s))throw new Error("Sir, I belive you forgot to send me a valid ApiRequest!");if(!t)throw new Error("Request executed, but no widget id provided!");return this._executeRequest(e,t)},_executeRequest:function(e,n){if(e.get("query")&&e.get("query").get("__qid")){var i=e.get("query").get("__qid")[0];e.set("target",d.MYADS_STORAGE+"/execute_query/"+i)}var r=this.getPubSub(),a=this.getBeeHive().getService("Api"),s=this._getCacheKey(e);if((this.failedRequestsCache.getSync(s)||0)>=this.maxRetries)return this.onApiRequestFailure.apply({request:e,key:n,requestKey:s,qm:this},[{status:c.CODES.TOO_MANY_FAILURES},"Error","This request has reached maximum number of failures (wait before retrying)"]),t.Deferred().reject();if(this._cache){var o=this._cache.getSync(s),l=this;if(o&&o.promise)return o.done(function(){l._cache.put(s,arguments),l.onApiResponse.apply({request:e,key:n,requestKey:s,qm:l},arguments)}),o.fail(function(){l._cache.invalidate(s),l.onApiRequestFailure.apply({request:e,pubsub:r,key:n,requestKey:s,qm:l},arguments)}),o;if(o){var u=t.Deferred();return u.done(function(){l.onApiResponse.apply({request:e,key:n,requestKey:s,qm:l},o)}),u.resolve(),u.promise()}var h=a.request(e,{done:function(){l._cache.put(s,arguments),l.onApiResponse.apply(this,arguments)},fail:function(){l._cache.invalidate(s),l.onApiRequestFailure.apply(this,arguments)},context:{request:e,key:n,requestKey:s,qm:l}});return this._cache.put(s,h),h}return a.request(e,{done:this.onApiResponse,fail:this.onApiRequestFailure,context:{request:e,key:n,requestKey:s,qm:this}})},onApiResponse:function(e,t,n){var i=this.qm,r=e.responseHeader&&e.responseHeader.params?new o(e):new u(e);r.setApiQuery(this.request.get("query")),i.debug&&console.log("[QM]: sending response:",i.hasApp()?i.getApp().getPluginOrWidgetName(this.key.getId())||this.key.getId():this.key.getId(),e);var a=i.getBeeHive().getService("PubSub");a&&a.publish(this.key,a.DELIVERING_RESPONSE+this.key.getId(),r),i.failedRequestsCache.getIfPresent(this.requestKey)&&i.failedRequestsCache.invalidate(this.requestKey)},onApiRequestFailure:function(e,t,n){var i=this.qm;this.request.get("query");i.debug&&console.warn("[QM]: request failed",e,t,n);var r=i.failedRequestsCache.getSync(this.requestKey)||0;if(i.failedRequestsCache.put(this.requestKey,r+1),i.tryToRecover.apply(this,arguments))return console.warn("[QM]: attempting recovery"),!0;var a=new c({code:c.CODES.API_REQUEST_ERROR,msg:t,request:this.request,error:e,psk:this.key,errorThrown:n,text:t}),s=i.getBeeHive().getService("PubSub");return s&&s.publish(this.key,s.FEEDBACK,a),!1},tryToRecover:function(e,t,n){var i=this.qm,r=this.key,a=this.request,s=this.requestKey,o=e.status;if(o)switch(o){case 408:case 504:case 503:return setTimeout(function(){if(i._cache){var e=i._cache.getSync(s);if(e&&e.promise)i._cache.invalidate(s);else if(e)return}i._executeRequest.call(i,a,r)},i.recoveryDelayInMs),!0}},_getCacheKey:function(e){var t=e.get("query"),n=this.queryUpdater.clean(t);e.set("query",n);var i=e.url();return e.set("query",t),i},reset:function(){this.__searchCycle={waiting:{},inprogress:{},done:{},failed:{}},this._cache&&this._cache.invalidateAll()},resetFailures:function(){this.failedRequestsCache.invalidateAll()}});return e.extend(p.prototype,r.BeeHive,r.App),p}),function(e){function t(){var e=arguments[0],n=t.cache;return n[e]&&n.hasOwnProperty(e)||(n[e]=t.parse(e)),t.format.call(null,n[e],arguments)}function n(e){return Object.prototype.toString.call(e).slice(8,-1).toLowerCase()}function i(e,t){return Array(t+1).join(e)}var r={not_string:/[^s]/,number:/[diefg]/,json:/[j]/,not_json:/[^j]/,text:/^[^\x25]+/,modulo:/^\x25{2}/,placeholder:/^\x25(?:([1-9]\d*)\$|\(([^\)]+)\))?(\+)?(0|'[^$])?(-)?(\d+)?(?:\.(\d+))?([b-gijosuxX])/,key:/^([a-z_][a-z_\d]*)/i,key_access:/^\.([a-z_][a-z_\d]*)/i,index_access:/^\[(\d+)\]/,sign:/^[\+\-]/};t.format=function(e,a){var s,o,l,c,u,d,h,p=1,f=e.length,g="",m=[],b=!0,v="";for(o=0;o<f;o++)if("string"===(g=n(e[o])))m[m.length]=e[o];else if("array"===g){if((c=e[o])[2])for(s=a[p],l=0;l<c[2].length;l++){if(!s.hasOwnProperty(c[2][l]))throw new Error(t("[sprintf] property '%s' does not exist",c[2][l]));s=s[c[2][l]]}else s=c[1]?a[c[1]]:a[p++];if("function"==n(s)&&(s=s()),r.not_string.test(c[8])&&r.not_json.test(c[8])&&"number"!=n(s)&&isNaN(s))throw new TypeError(t("[sprintf] expecting number but found %s",n(s)));switch(r.number.test(c[8])&&(b=s>=0),c[8]){case"b":s=s.toString(2);break;case"c":s=String.fromCharCode(s);break;case"d":case"i":s=parseInt(s,10);break;case"j":s=JSON.stringify(s,null,c[6]?parseInt(c[6]):0);break;case"e":s=c[7]?s.toExponential(c[7]):s.toExponential();break;case"f":s=c[7]?parseFloat(s).toFixed(c[7]):parseFloat(s);break;case"g":s=c[7]?parseFloat(s).toPrecision(c[7]):parseFloat(s);break;case"o":s=s.toString(8);break;case"s":s=(s=String(s))&&c[7]?s.substring(0,c[7]):s;break;case"u":s>>>=0;break;case"x":s=s.toString(16);break;case"X":s=s.toString(16).toUpperCase()}r.json.test(c[8])?m[m.length]=s:(!r.number.test(c[8])||b&&!c[3]?v="":(v=b?"+":"-",s=s.toString().replace(r.sign,"")),d=c[4]?"0"===c[4]?"0":c[4].charAt(1):" ",h=c[6]-(v+s).length,u=c[6]&&h>0?i(d,h):"",m[m.length]=c[5]?v+s+u:"0"===d?v+u+s:u+v+s)}return m.join("")},t.cache={},t.parse=function(e){for(var t=e,n=[],i=[],a=0;t;){if(null!==(n=r.text.exec(t)))i[i.length]=n[0];else if(null!==(n=r.modulo.exec(t)))i[i.length]="%";else{if(null===(n=r.placeholder.exec(t)))throw new SyntaxError("[sprintf] unexpected placeholder");if(n[2]){a|=1;var s=[],o=n[2],l=[];if(null===(l=r.key.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");for(s[s.length]=l[1];""!==(o=o.substring(l[0].length));)if(null!==(l=r.key_access.exec(o)))s[s.length]=l[1];else{if(null===(l=r.index_access.exec(o)))throw new SyntaxError("[sprintf] failed to parse named argument key");s[s.length]=l[1]}n[2]=s}else a|=2;if(3===a)throw new Error("[sprintf] mixing positional and named placeholders is not (yet) supported");i[i.length]=n}t=t.substring(n[0].length)}return i};var a=function(e,n,i){return(i=(n||[]).slice(0)).splice(0,0,e),t.apply(null,i)};"undefined"!=typeof exports?(exports.sprintf=t,exports.vsprintf=a):(e.sprintf=t,e.vsprintf=a,"function"==typeof define&&define.amd&&define("sprintf",[],function(){return{sprintf:t,vsprintf:a}}))}("undefined"==typeof window?this:window),define("js/bugutils/diagnostics",["jquery","underscore","js/components/api_query","js/components/api_request","js/components/api_response","js/mixins/dependon","js/components/generic_module","sprintf","js/components/api_targets"],function(e,t,n,i,r,a,s,o,l){var c=s.extend({activate:function(e,t){this.setApp(t),this.setBeeHive(e)},getFirstDoc:function(n,i){var r={query:{q:n,fl:"title,abstract,bibcode,id,author"},target:l.SEARCH};i&&t.extend(r,i);var a=e.Deferred();return this.apiRequest(r).done(function(e){a.resolve(e.response.docs[0])}),a.promise()},apiRequest:function(e,t){var r=this.getApp().getService("Api");if(!(e=e||{}).query)throw Error('You must pass in "query"');e.query instanceof n||(e.query=new n(e.query));var a=new i({target:e.target||l.SEARCH,query:e.query});return r.request(a,t)},ajax:function(t){var n=this.getApp().getService("Api");return t.headers=t.header||{},t.headers.Authorization=n.access_token,e.ajax(t)},jsonp:function(e,n){return e.dataType="jsonp",e.beforeSend=function(e,i){var r=i.url.split("&");t.each(r,function(e){e.startsWith("callback=")&&(i.url+="&"+(n||"json.wrf")+"="+e.replace("callback=",""))})},this.ajax(e)},printComparison:function(e){var t=[],n="%40s %40s %40s %10s";t.push(o.sprintf(n,"field",e.first,e.second,"diff")),t.push("------------------------------------------------------------------------------------------------------------------------------------");for(var i in e.fields){var r=e.fields[i];t.push(o.sprintf(n,i,r.first,r.second,r.diff))}return console.log(t.join("\n")),t},compareTwoSearchInstances:function(n,i,r,a){var s=this,o=e.Deferred();if(r&&a){var l=this.countDocsInFields(n,r),c=this.countDocsInFields(i,a);e.when(l,c).done(function(e,r){var a=t.keys(e.fields),s=t.keys(r.fields),l=t.unique(a.concat(s)).sort(),c={};for(var u in l){u=l[u];var d=e.fields[u],h=r.fields[u];c[u]={first:d?d.numFound:"--",second:h?h.numFound:"--",diff:d&&h?h.numFound-d.numFound:"--"}}o.resolve({first:n,second:i,fields:c})})}else{var u=this.getListOfFields(n),d=this.getListOfFields(i);e.when(u,d).done(function(e,t){s.compareTwoSearchInstances(n,i,e,t).done(function(e){o.resolve(e)})})}return o},getListOfFields:function(t){var n=e.Deferred();return this.jsonp({url:t+"/solr/collection1/admin/luke?numTerms=0&wt=json&indent=true",timeout:6e4}).done(function(e){var t=[];for(var i in e.fields)i.startsWith("_")||t.push(i);n.resolve(t)}),n},countDocsInFields:function(t,n){var i=e.Deferred(),r=this,a=[],s={},o={fields:{}};for(var l in n){var c=n[l],u=(e.Deferred(),"{!lucene}"+c+":*");console.log("Getting num docs for: "+u);var d=r.jsonp({url:t+"/solr/collection1/select?q="+u+"&fl=id&wt=json&indent=true",context:{field:c,finalResult:o,cycleR:s},timeout:3e5}).done(function(e){this.finalResult.fields[this.field]={numFound:e.response.numFound};var n=0,r=[];for(var a in this.cycleR)"pending"==this.cycleR[a].state()&&(n+=1,r.push(a));console.log(t+" Got response for: "+this.field+" numFound: "+e.response.numFound+" requests to go: "+n+" "+(r.length<5?r.join(", "):"")),0==n&&i.resolve(this.finalResult)});s[c]=d,a.push(d)}return i},request:function(t){return e.ajax(t)},testOrcidLogin:function(){var e=this.getApp().getService("OrcidApi");e.signOut(),window.location=e.config.loginUrl},testOrcidSendingData:function(){var e=this.getApp();this.getFirstDoc("bibcode:1978yCat.1072....0C").done(function(t){e.getService("OrcidApi").addWorks([t]).done(function(e){console.log("result:",e,"expected: {}")})})},printPubSubSubscribers:function(e){var n=this.getApp().getService("PubSub"),i={};this.getApp().triggerMethodOnAll(function(e,t){if(this===n)i[n.pubSubKey.getId()]=e;else if(this.hasPubSub&&this.hasPubSub()){var r=this.getPubSub();r.getCurrentPubSubKey&&(i[r.getCurrentPubSubKey().getId()]&&console.warn("Redefining key that already exists: "+r.getCurrentPubSubKey().getId()+" "+i[r.getCurrentPubSubKey().getId()]),i[r.getCurrentPubSubKey().getId()]=e)}else console.warn("Instance without active PubSub: "+e,this)}),e&&(console.log("Printing list of all issued keys to PubSub"),t.each(t.keys(n._issuedKeys),function(e){var t;n._issuedKeys[e].getId&&i[n._issuedKeys[e].getId()]&&(t=i[n._issuedKeys[e].getId()]),t?console.log(e+"(parent:"+t+") -> "+i[e]):console.log(e+" -> "+i[e])}));var r={};console.log("Printing active subscribers to PubSub"),t.each(n._events,function(e,n,a){console.log(n+" ("+e.length+")"),t.each(e,function(e){var t=e.ctx.getId?i[e.ctx.getId()]:"unknown object";console.log("\t"+t),r[t]=r[t]?r[t]+1:1,void 0==t&&(r["undefined keys"]||(r["undefined keys"]=[]),r["undefined keys"].push(n+(e.ctx.getId?e.ctx.getId():"X")))})}),console.log(JSON.stringify(r,null," "))}});return t.extend(c.prototype,a.App,a.BeeHive),c}),define("js/components/alerts_mediator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/api_feedback","js/mixins/hardened","js/components/alerts"],function(e,t,n,i,r,a,s,o){var l=i.extend({initialize:function(t){e.extend(this,e.pick(t,["debug","widgetName"]))},activate:function(t,n){this.setBeeHive(t),this.setApp(n);var i=this.getPubSub();if(i.subscribe(i.ALERT,e.bind(this.onAlert,this)),i.subscribe(i.NAVIGATE,e.bind(this.onNavigate,this)),!this.getWidget())throw new Error("If you want to use AlertController, you also need to have a Widget capable of displaying the messages (default: AlertsWidget)")},onNavigate:function(e){var t=this,n=this.getPubSub();"authentication-page"===e&&n.subscribeOnce(n.NAVIGATE,function(){var e=t.getWidget();e&&e.closeView&&e.closeView()})},onAlert:function(t,n){var i=this;return this.alert(t).done(function(t){if(e.isFunction(t))t();else if(e.isObject(t)&&t.action){switch(t.action){case o.ACTION.TRIGGER_FEEDBACK:i.getPubSub().publish(i.getPubSub().FEEDBACK,new a(t.arguments));break;case o.ACTION.CALL_PUBSUB:i.getPubSub().publish(t.signal,t.arguments);break;default:throw new Exception("Unknown action type:"+t)}var n=i.getWidget();n&&n.closeView&&n.closeView()}})},getWidget:function(){return this._widget?this._widget:(this._widget=this.getApp()._getWidget(this.widgetName||"AlertsWidget"),this._widget)},alert:function(e){var n=this.getWidget();if(!n){console.warn('"AlertsWidget" has disappeared, we cant display messages to the user');var i=t.Deferred();return i.reject("AlertsWidget has disappeared"),i.promise()}return n.alert(e)},hardenedInterface:{debug:"state of the alerts",getHardenedInstance:"allow to create clone of the already hardened instance"}});return e.extend(l.prototype,r.BeeHive,r.App),e.extend(l.prototype,s),l}),define("js/wraps/alerts_mediator",["underscore","jquery","js/components/alerts_mediator","js/components/api_feedback","js/widgets/widget_states","js/components/alerts","js/components/api_response"],function(e,t,n,i,r,a,s){return n.extend({activate:function(t,i){n.prototype.activate.apply(this,arguments);var r=this.getPubSub();r.subscribe(r.APP_STARTED,e.bind(this.displaySiteMessageWithDelay,this))},onAlert:function(e,t){this._dirty=!0,n.prototype.onAlert.apply(this,arguments)},displaySiteMessageWithDelay:function(){var e=this;setTimeout(function(){e.checkAndDisplaySiteMessage()},500)},onDestroy:function(){clearInterval(this.timerId)},onStartSearch:function(){this._dirty=!1},checkAndDisplaySiteMessage:function(){var t=this,n=t.getBeeHive().getObject("User");n&&n.getSiteConfig("site_wide_message").done(function(r){if(r&&e.isString(r)&&!(t._dirty||n.isLoggedIn()&&n.getUserData().last_seen_message==r)){var a=t.getBeeHive().getService("PersistentStorage");if(a){var s=a.get("last_seen_message");if(s&&s==r)return}t.alert(new i({msg:r,events:{"click button.close":"dismissed"}})).done(function(e){"dismissed"==e&&(n&&n.isLoggedIn()&&n.setMyADSData({last_seen_message:r}),a&&a.set("last_seen_message",r))})}})}})}),function(e){define("bootstrap",["jquery","jquery-ui"],function(){return function(){if("undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function(e){"use strict";var t=jQuery.fn.jquery.split(" ")[0].split(".");if(t[0]<2&&t[1]<9||1==t[0]&&9==t[1]&&t[2]<1||t[0]>3)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher, but lower than version 4")}(),function(e){"use strict";function t(){var e=document.createElement("bootstrap"),t={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var n in t)if(void 0!==e.style[n])return{end:t[n]};return!1}e.fn.emulateTransitionEnd=function(t){var n=!1,i=this;e(this).one("bsTransitionEnd",function(){n=!0});return setTimeout(function(){n||e(i).trigger(e.support.transition.end)},t),this},e(function(){e.support.transition=t(),e.support.transition&&(e.event.special.bsTransitionEnd={bindType:e.support.transition.end,delegateType:e.support.transition.end,handle:function(t){if(e(t.target).is(this))return t.handleObj.handler.apply(this,arguments)}})})}(jQuery),function(e){"use strict";var t='[data-dismiss="alert"]',n=function(n){e(n).on("click",t,this.close)};n.VERSION="3.3.7",n.TRANSITION_DURATION=150,n.prototype.close=function(t){function i(){s.detach().trigger("closed.bs.alert").remove()}var r=e(this),a=r.attr("data-target");a||(a=(a=r.attr("href"))&&a.replace(/.*(?=#[^\s]*$)/,""));var s=e("#"===a?[]:a);t&&t.preventDefault(),s.length||(s=r.closest(".alert")),s.trigger(t=e.Event("close.bs.alert")),t.isDefaultPrevented()||(s.removeClass("in"),e.support.transition&&s.hasClass("fade")?s.one("bsTransitionEnd",i).emulateTransitionEnd(n.TRANSITION_DURATION):i())};var i=e.fn.alert;e.fn.alert=function(t){return this.each(function(){var i=e(this),r=i.data("bs.alert");r||i.data("bs.alert",r=new n(this)),"string"==typeof t&&r[t].call(i)})},e.fn.alert.Constructor=n,e.fn.alert.noConflict=function(){return e.fn.alert=i,this},e(document).on("click.bs.alert.data-api",t,n.prototype.close)}(jQuery),function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.button"),a="object"==typeof t&&t;r||i.data("bs.button",r=new n(this,a)),"toggle"==t?r.toggle():t&&r.setState(t)})}var n=function(t,i){this.$element=e(t),this.options=e.extend({},n.DEFAULTS,i),this.isLoading=!1};n.VERSION="3.3.7",n.DEFAULTS={loadingText:"loading..."},n.prototype.setState=function(t){var n="disabled",i=this.$element,r=i.is("input")?"val":"html",a=i.data();t+="Text",null==a.resetText&&i.data("resetText",i[r]()),setTimeout(e.proxy(function(){i[r](null==a[t]?this.options[t]:a[t]),"loadingText"==t?(this.isLoading=!0,i.addClass(n).attr(n,n).prop(n,!0)):this.isLoading&&(this.isLoading=!1,i.removeClass(n).removeAttr(n).prop(n,!1))},this),0)},n.prototype.toggle=function(){var e=!0,t=this.$element.closest('[data-toggle="buttons"]');if(t.length){var n=this.$element.find("input");"radio"==n.prop("type")?(n.prop("checked")&&(e=!1),t.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==n.prop("type")&&(n.prop("checked")!==this.$element.hasClass("active")&&(e=!1),this.$element.toggleClass("active")),n.prop("checked",this.$element.hasClass("active")),e&&n.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var i=e.fn.button;e.fn.button=t,e.fn.button.Constructor=n,e.fn.button.noConflict=function(){return e.fn.button=i,this},e(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(n){var i=e(n.target).closest(".btn");t.call(i,"toggle"),e(n.target).is('input[type="radio"], input[type="checkbox"]')||(n.preventDefault(),i.is("input,button")?i.trigger("focus"):i.find("input:visible,button:visible").first().trigger("focus"))}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(t){e(t.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(t.type))})}(jQuery),function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.carousel"),a=e.extend({},n.DEFAULTS,i.data(),"object"==typeof t&&t),s="string"==typeof t?t:a.slide;r||i.data("bs.carousel",r=new n(this,a)),"number"==typeof t?r.to(t):s?r[s]():a.interval&&r.pause().cycle()})}var n=function(t,n){this.$element=e(t),this.$indicators=this.$element.find(".carousel-indicators"),this.options=n,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",e.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",e.proxy(this.pause,this)).on("mouseleave.bs.carousel",e.proxy(this.cycle,this))};n.VERSION="3.3.7",n.TRANSITION_DURATION=600,n.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},n.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},n.prototype.cycle=function(t){return t||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval(e.proxy(this.next,this),this.options.interval)),this},n.prototype.getItemIndex=function(e){return this.$items=e.parent().children(".item"),this.$items.index(e||this.$active)},n.prototype.getItemForDirection=function(e,t){var n=this.getItemIndex(t);if(("prev"==e&&0===n||"next"==e&&n==this.$items.length-1)&&!this.options.wrap)return t;var i=(n+("prev"==e?-1:1))%this.$items.length;return this.$items.eq(i)},n.prototype.to=function(e){var t=this,n=this.getItemIndex(this.$active=this.$element.find(".item.active"));if(!(e>this.$items.length-1||e<0))return this.sliding?this.$element.one("slid.bs.carousel",function(){t.to(e)}):n==e?this.pause().cycle():this.slide(e>n?"next":"prev",this.$items.eq(e))},n.prototype.pause=function(t){return t||(this.paused=!0),this.$element.find(".next, .prev").length&&e.support.transition&&(this.$element.trigger(e.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},n.prototype.next=function(){if(!this.sliding)return this.slide("next")},n.prototype.prev=function(){if(!this.sliding)return this.slide("prev")},n.prototype.slide=function(t,i){var r=this.$element.find(".item.active"),a=i||this.getItemForDirection(t,r),s=this.interval,o="next"==t?"left":"right",l=this;if(a.hasClass("active"))return this.sliding=!1;var c=a[0],u=e.Event("slide.bs.carousel",{relatedTarget:c,direction:o});if(this.$element.trigger(u),!u.isDefaultPrevented()){if(this.sliding=!0,s&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var d=e(this.$indicators.children()[this.getItemIndex(a)]);d&&d.addClass("active")}var h=e.Event("slid.bs.carousel",{relatedTarget:c,direction:o});return e.support.transition&&this.$element.hasClass("slide")?(a.addClass(t),a[0].offsetWidth,r.addClass(o),a.addClass(o),r.one("bsTransitionEnd",function(){a.removeClass([t,o].join(" ")).addClass("active"),r.removeClass(["active",o].join(" ")),l.sliding=!1,setTimeout(function(){l.$element.trigger(h)},0)}).emulateTransitionEnd(n.TRANSITION_DURATION)):(r.removeClass("active"),a.addClass("active"),this.sliding=!1,this.$element.trigger(h)),s&&this.cycle(),this}};var i=e.fn.carousel;e.fn.carousel=t,e.fn.carousel.Constructor=n,e.fn.carousel.noConflict=function(){return e.fn.carousel=i,this};var r=function(n){var i,r=e(this),a=e(r.attr("data-target")||(i=r.attr("href"))&&i.replace(/.*(?=#[^\s]+$)/,""));if(a.hasClass("carousel")){var s=e.extend({},a.data(),r.data()),o=r.attr("data-slide-to");o&&(s.interval=!1),t.call(a,s),o&&a.data("bs.carousel").to(o),n.preventDefault()}};e(document).on("click.bs.carousel.data-api","[data-slide]",r).on("click.bs.carousel.data-api","[data-slide-to]",r),e(window).on("load",function(){e('[data-ride="carousel"]').each(function(){var n=e(this);t.call(n,n.data())})})}(jQuery),function(e){"use strict";function t(t){var n,i=t.attr("data-target")||(n=t.attr("href"))&&n.replace(/.*(?=#[^\s]+$)/,"");return e(i)}function n(t){return this.each(function(){var n=e(this),r=n.data("bs.collapse"),a=e.extend({},i.DEFAULTS,n.data(),"object"==typeof t&&t);!r&&a.toggle&&/show|hide/.test(t)&&(a.toggle=!1),r||n.data("bs.collapse",r=new i(this,a)),"string"==typeof t&&r[t]()})}var i=function(t,n){this.$element=e(t),this.options=e.extend({},i.DEFAULTS,n),this.$trigger=e('[data-toggle="collapse"][href="#'+t.id+'"],[data-toggle="collapse"][data-target="#'+t.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};i.VERSION="3.3.7",i.TRANSITION_DURATION=350,i.DEFAULTS={toggle:!0},i.prototype.dimension=function(){return this.$element.hasClass("width")?"width":"height"},i.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var t,r=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(r&&r.length&&(t=r.data("bs.collapse"))&&t.transitioning)){var a=e.Event("show.bs.collapse");if(this.$element.trigger(a),!a.isDefaultPrevented()){r&&r.length&&(n.call(r,"hide"),t||r.data("bs.collapse",null));var s=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[s](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var o=function(){this.$element.removeClass("collapsing").addClass("collapse in")[s](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!e.support.transition)return o.call(this);var l=e.camelCase(["scroll",s].join("-"));this.$element.one("bsTransitionEnd",e.proxy(o,this)).emulateTransitionEnd(i.TRANSITION_DURATION)[s](this.$element[0][l])}}}},i.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var t=e.Event("hide.bs.collapse");if(this.$element.trigger(t),!t.isDefaultPrevented()){var n=this.dimension();this.$element[n](this.$element[n]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var r=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};if(!e.support.transition)return r.call(this);this.$element[n](0).one("bsTransitionEnd",e.proxy(r,this)).emulateTransitionEnd(i.TRANSITION_DURATION)}}},i.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},i.prototype.getParent=function(){return e(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each(e.proxy(function(n,i){var r=e(i);this.addAriaAndCollapsedClass(t(r),r)},this)).end()},i.prototype.addAriaAndCollapsedClass=function(e,t){var n=e.hasClass("in");e.attr("aria-expanded",n),t.toggleClass("collapsed",!n).attr("aria-expanded",n)};var r=e.fn.collapse;e.fn.collapse=n,e.fn.collapse.Constructor=i,e.fn.collapse.noConflict=function(){return e.fn.collapse=r,this},e(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(i){var r=e(this);r.attr("data-target")||i.preventDefault();var a=t(r),s=a.data("bs.collapse")?"toggle":r.data();n.call(a,s)})}(jQuery),function(e){"use strict";function t(t){var n=t.attr("data-target");n||(n=(n=t.attr("href"))&&/#[A-Za-z]/.test(n)&&n.replace(/.*(?=#[^\s]*$)/,""));var i=n&&e(n);return i&&i.length?i:t.parent()}function n(n){n&&3===n.which||(e(i).remove(),e(r).each(function(){var i=e(this),r=t(i),a={relatedTarget:this};r.hasClass("open")&&(n&&"click"==n.type&&/input|textarea/i.test(n.target.tagName)&&e.contains(r[0],n.target)||(r.trigger(n=e.Event("hide.bs.dropdown",a)),n.isDefaultPrevented()||(i.attr("aria-expanded","false"),r.removeClass("open").trigger(e.Event("hidden.bs.dropdown",a)))))}))}var i=".dropdown-backdrop",r='[data-toggle="dropdown"]',a=function(t){e(t).on("click.bs.dropdown",this.toggle)};a.VERSION="3.3.7",a.prototype.toggle=function(i){var r=e(this);if(!r.is(".disabled, :disabled")){var a=t(r),s=a.hasClass("open");if(n(),!s){"ontouchstart"in document.documentElement&&!a.closest(".navbar-nav").length&&e(document.createElement("div")).addClass("dropdown-backdrop").insertAfter(e(this)).on("click",n);var o={relatedTarget:this};if(a.trigger(i=e.Event("show.bs.dropdown",o)),i.isDefaultPrevented())return;r.trigger("focus").attr("aria-expanded","true"),a.toggleClass("open").trigger(e.Event("shown.bs.dropdown",o))}return!1}},a.prototype.keydown=function(n){if(/(38|40|27|32)/.test(n.which)&&!/input|textarea/i.test(n.target.tagName)){var i=e(this);if(n.preventDefault(),n.stopPropagation(),!i.is(".disabled, :disabled")){var a=t(i),s=a.hasClass("open");if(!s&&27!=n.which||s&&27==n.which)return 27==n.which&&a.find(r).trigger("focus"),i.trigger("click");var o=a.find(".dropdown-menu li:not(.disabled):visible a");if(o.length){var l=o.index(n.target);38==n.which&&l>0&&l--,40==n.which&&l<o.length-1&&l++,~l||(l=0),o.eq(l).trigger("focus")}}}};var s=e.fn.dropdown;e.fn.dropdown=function(t){return this.each(function(){var n=e(this),i=n.data("bs.dropdown");i||n.data("bs.dropdown",i=new a(this)),"string"==typeof t&&i[t].call(n)})},e.fn.dropdown.Constructor=a,e.fn.dropdown.noConflict=function(){return e.fn.dropdown=s,this},e(document).on("click.bs.dropdown.data-api",n).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",r,a.prototype.toggle).on("keydown.bs.dropdown.data-api",r,a.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",a.prototype.keydown)}(jQuery),function(e){"use strict";function t(t,i){return this.each(function(){var r=e(this),a=r.data("bs.modal"),s=e.extend({},n.DEFAULTS,r.data(),"object"==typeof t&&t);a||r.data("bs.modal",a=new n(this,s)),"string"==typeof t?a[t](i):s.show&&a.show(i)})}var n=function(t,n){this.options=n,this.$body=e(document.body),this.$element=e(t),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,e.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};n.VERSION="3.3.7",n.TRANSITION_DURATION=300,n.BACKDROP_TRANSITION_DURATION=150,n.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},n.prototype.toggle=function(e){return this.isShown?this.hide():this.show(e)},n.prototype.show=function(t){var i=this,r=e.Event("show.bs.modal",{relatedTarget:t});this.$element.trigger(r),this.isShown||r.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',e.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){i.$element.one("mouseup.dismiss.bs.modal",function(t){e(t.target).is(i.$element)&&(i.ignoreBackdropClick=!0)})}),this.backdrop(function(){var r=e.support.transition&&i.$element.hasClass("fade");i.$element.parent().length||i.$element.appendTo(i.$body),i.$element.show().scrollTop(0),i.adjustDialog(),r&&i.$element[0].offsetWidth,i.$element.addClass("in"),i.enforceFocus();var a=e.Event("shown.bs.modal",{relatedTarget:t});r?i.$dialog.one("bsTransitionEnd",function(){i.$element.trigger("focus").trigger(a)}).emulateTransitionEnd(n.TRANSITION_DURATION):i.$element.trigger("focus").trigger(a)}))},n.prototype.hide=function(t){t&&t.preventDefault(),t=e.Event("hide.bs.modal"),this.$element.trigger(t),this.isShown&&!t.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),e(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),e.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",e.proxy(this.hideModal,this)).emulateTransitionEnd(n.TRANSITION_DURATION):this.hideModal())},n.prototype.enforceFocus=function(){e(document).off("focusin.bs.modal").on("focusin.bs.modal",e.proxy(function(e){document===e.target||this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},n.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",e.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},n.prototype.resize=function(){this.isShown?e(window).on("resize.bs.modal",e.proxy(this.handleUpdate,this)):e(window).off("resize.bs.modal")},n.prototype.hideModal=function(){var e=this;this.$element.hide(),this.backdrop(function(){e.$body.removeClass("modal-open"),e.resetAdjustments(),e.resetScrollbar(),e.$element.trigger("hidden.bs.modal")})},n.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},n.prototype.backdrop=function(t){var i=this,r=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var a=e.support.transition&&r;if(this.$backdrop=e(document.createElement("div")).addClass("modal-backdrop "+r).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",e.proxy(function(e){this.ignoreBackdropClick?this.ignoreBackdropClick=!1:e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide())},this)),a&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!t)return;a?this.$backdrop.one("bsTransitionEnd",t).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):t()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var s=function(){i.removeBackdrop(),t&&t()};e.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",s).emulateTransitionEnd(n.BACKDROP_TRANSITION_DURATION):s()}else t&&t()},n.prototype.handleUpdate=function(){this.adjustDialog()},n.prototype.adjustDialog=function(){var e=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&e?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!e?this.scrollbarWidth:""})},n.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},n.prototype.checkScrollbar=function(){var e=window.innerWidth;if(!e){var t=document.documentElement.getBoundingClientRect();e=t.right-Math.abs(t.left)}this.bodyIsOverflowing=document.body.clientWidth<e,this.scrollbarWidth=this.measureScrollbar()},n.prototype.setScrollbar=function(){var e=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",e+this.scrollbarWidth)},n.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},n.prototype.measureScrollbar=function(){var e=document.createElement("div");e.className="modal-scrollbar-measure",this.$body.append(e);var t=e.offsetWidth-e.clientWidth;return this.$body[0].removeChild(e),t};var i=e.fn.modal;e.fn.modal=t,e.fn.modal.Constructor=n,e.fn.modal.noConflict=function(){return e.fn.modal=i,this},e(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(n){var i=e(this),r=i.attr("href"),a=e(i.attr("data-target")||r&&r.replace(/.*(?=#[^\s]+$)/,"")),s=a.data("bs.modal")?"toggle":e.extend({remote:!/#/.test(r)&&r},a.data(),i.data());i.is("a")&&n.preventDefault(),a.one("show.bs.modal",function(e){e.isDefaultPrevented()||a.one("hidden.bs.modal",function(){i.is(":visible")&&i.trigger("focus")})}),t.call(a,s,this)})}(jQuery),function(e){"use strict";var t=function(e,t){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",e,t)};t.VERSION="3.3.7",t.TRANSITION_DURATION=150,t.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},t.prototype.init=function(t,n,i){if(this.enabled=!0,this.type=t,this.$element=e(n),this.options=this.getOptions(i),this.$viewport=this.options.viewport&&e(e.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var r=this.options.trigger.split(" "),a=r.length;a--;){var s=r[a];if("click"==s)this.$element.on("click."+this.type,this.options.selector,e.proxy(this.toggle,this));else if("manual"!=s){var o="hover"==s?"mouseenter":"focusin",l="hover"==s?"mouseleave":"focusout";this.$element.on(o+"."+this.type,this.options.selector,e.proxy(this.enter,this)),this.$element.on(l+"."+this.type,this.options.selector,e.proxy(this.leave,this))}}this.options.selector?this._options=e.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.getOptions=function(t){return(t=e.extend({},this.getDefaults(),this.$element.data(),t)).delay&&"number"==typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),t},t.prototype.getDelegateOptions=function(){var t={},n=this.getDefaults();return this._options&&e.each(this._options,function(e,i){n[e]!=i&&(t[e]=i)}),t},t.prototype.enter=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);if(n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusin"==t.type?"focus":"hover"]=!0),n.tip().hasClass("in")||"in"==n.hoverState)n.hoverState="in";else{if(clearTimeout(n.timeout),n.hoverState="in",!n.options.delay||!n.options.delay.show)return n.show();n.timeout=setTimeout(function(){"in"==n.hoverState&&n.show()},n.options.delay.show)}},t.prototype.isInStateTrue=function(){for(var e in this.inState)if(this.inState[e])return!0;return!1},t.prototype.leave=function(t){var n=t instanceof this.constructor?t:e(t.currentTarget).data("bs."+this.type);if(n||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n)),t instanceof e.Event&&(n.inState["focusout"==t.type?"focus":"hover"]=!1),!n.isInStateTrue()){if(clearTimeout(n.timeout),n.hoverState="out",!n.options.delay||!n.options.delay.hide)return n.hide();n.timeout=setTimeout(function(){"out"==n.hoverState&&n.hide()},n.options.delay.hide)}},t.prototype.show=function(){var n=e.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(n);var i=e.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(n.isDefaultPrevented()||!i)return;var r=this,a=this.tip(),s=this.getUID(this.type);this.setContent(),a.attr("id",s),this.$element.attr("aria-describedby",s),this.options.animation&&a.addClass("fade");var o="function"==typeof this.options.placement?this.options.placement.call(this,a[0],this.$element[0]):this.options.placement,l=/\s?auto?\s?/i,c=l.test(o);c&&(o=o.replace(l,"")||"top"),a.detach().css({top:0,left:0,display:"block"}).addClass(o).data("bs."+this.type,this),this.options.container?a.appendTo(this.options.container):a.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var u=this.getPosition(),d=a[0].offsetWidth,h=a[0].offsetHeight;if(c){var p=o,f=this.getPosition(this.$viewport);o="bottom"==o&&u.bottom+h>f.bottom?"top":"top"==o&&u.top-h<f.top?"bottom":"right"==o&&u.right+d>f.width?"left":"left"==o&&u.left-d<f.left?"right":o,a.removeClass(p).addClass(o)}var g=this.getCalculatedOffset(o,u,d,h);this.applyPlacement(g,o);var m=function(){var e=r.hoverState;r.$element.trigger("shown.bs."+r.type),r.hoverState=null,"out"==e&&r.leave(r)};e.support.transition&&this.$tip.hasClass("fade")?a.one("bsTransitionEnd",m).emulateTransitionEnd(t.TRANSITION_DURATION):m()}},t.prototype.applyPlacement=function(t,n){var i=this.tip(),r=i[0].offsetWidth,a=i[0].offsetHeight,s=parseInt(i.css("margin-top"),10),o=parseInt(i.css("margin-left"),10);isNaN(s)&&(s=0),isNaN(o)&&(o=0),t.top+=s,t.left+=o,e.offset.setOffset(i[0],e.extend({using:function(e){i.css({top:Math.round(e.top),left:Math.round(e.left)})}},t),0),i.addClass("in");var l=i[0].offsetWidth,c=i[0].offsetHeight;"top"==n&&c!=a&&(t.top=t.top+a-c);var u=this.getViewportAdjustedDelta(n,t,l,c);u.left?t.left+=u.left:t.top+=u.top;var d=/top|bottom/.test(n),h=d?2*u.left-r+l:2*u.top-a+c,p=d?"offsetWidth":"offsetHeight";i.offset(t),this.replaceArrow(h,i[0][p],d)},t.prototype.replaceArrow=function(e,t,n){this.arrow().css(n?"left":"top",50*(1-e/t)+"%").css(n?"top":"left","")},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle();e.find(".tooltip-inner")[this.options.html?"html":"text"](t),e.removeClass("fade in top bottom left right")},t.prototype.hide=function(n){function i(){"in"!=r.hoverState&&a.detach(),r.$element&&r.$element.removeAttr("aria-describedby").trigger("hidden.bs."+r.type),n&&n()}var r=this,a=e(this.$tip),s=e.Event("hide.bs."+this.type);if(this.$element.trigger(s),!s.isDefaultPrevented())return a.removeClass("in"),e.support.transition&&a.hasClass("fade")?a.one("bsTransitionEnd",i).emulateTransitionEnd(t.TRANSITION_DURATION):i(),this.hoverState=null,this},t.prototype.fixTitle=function(){var e=this.$element;(e.attr("title")||"string"!=typeof e.attr("data-original-title"))&&e.attr("data-original-title",e.attr("title")||"").attr("title","")},t.prototype.hasContent=function(){return this.getTitle()},t.prototype.getPosition=function(t){var n=(t=t||this.$element)[0],i="BODY"==n.tagName,r=n.getBoundingClientRect();null==r.width&&(r=e.extend({},r,{width:r.right-r.left,height:r.bottom-r.top}));var a=window.SVGElement&&n instanceof window.SVGElement,s=i?{top:0,left:0}:a?null:t.offset(),o={scroll:i?document.documentElement.scrollTop||document.body.scrollTop:t.scrollTop()},l=i?{width:e(window).width(),height:e(window).height()}:null;return e.extend({},r,o,l,s)},t.prototype.getCalculatedOffset=function(e,t,n,i){return"bottom"==e?{top:t.top+t.height,left:t.left+t.width/2-n/2}:"top"==e?{top:t.top-i,left:t.left+t.width/2-n/2}:"left"==e?{top:t.top+t.height/2-i/2,left:t.left-n}:{top:t.top+t.height/2-i/2,left:t.left+t.width}},t.prototype.getViewportAdjustedDelta=function(e,t,n,i){var r={top:0,left:0};if(!this.$viewport)return r;var a=this.options.viewport&&this.options.viewport.padding||0,s=this.getPosition(this.$viewport);if(/right|left/.test(e)){var o=t.top-a-s.scroll,l=t.top+a-s.scroll+i;o<s.top?r.top=s.top-o:l>s.top+s.height&&(r.top=s.top+s.height-l)}else{var c=t.left-a,u=t.left+a+n;c<s.left?r.left=s.left-c:u>s.right&&(r.left=s.left+s.width-u)}return r},t.prototype.getTitle=function(){var e=this.$element,t=this.options;return e.attr("data-original-title")||("function"==typeof t.title?t.title.call(e[0]):t.title)},t.prototype.getUID=function(e){do{e+=~~(1e6*Math.random())}while(document.getElementById(e));return e},t.prototype.tip=function(){if(!this.$tip&&(this.$tip=e(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},t.prototype.enable=function(){this.enabled=!0},t.prototype.disable=function(){this.enabled=!1},t.prototype.toggleEnabled=function(){this.enabled=!this.enabled},t.prototype.toggle=function(t){var n=this;t&&((n=e(t.currentTarget).data("bs."+this.type))||(n=new this.constructor(t.currentTarget,this.getDelegateOptions()),e(t.currentTarget).data("bs."+this.type,n))),t?(n.inState.click=!n.inState.click,n.isInStateTrue()?n.enter(n):n.leave(n)):n.tip().hasClass("in")?n.leave(n):n.enter(n)},t.prototype.destroy=function(){var e=this;clearTimeout(this.timeout),this.hide(function(){e.$element.off("."+e.type).removeData("bs."+e.type),e.$tip&&e.$tip.detach(),e.$tip=null,e.$arrow=null,e.$viewport=null,e.$element=null})};var n=e.fn.tooltip;e.fn.tooltip=function(n){return this.each(function(){var i=e(this),r=i.data("bs.tooltip"),a="object"==typeof n&&n;!r&&/destroy|hide/.test(n)||(r||i.data("bs.tooltip",r=new t(this,a)),"string"==typeof n&&r[n]())})},e.fn.tooltip.Constructor=t,e.fn.tooltip.noConflict=function(){return e.fn.tooltip=n,this}}(jQuery),function(e){"use strict";var t=function(e,t){this.init("popover",e,t)};if(!e.fn.tooltip)throw new Error("Popover requires tooltip.js");t.VERSION="3.3.7",t.DEFAULTS=e.extend({},e.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),t.prototype=e.extend({},e.fn.tooltip.Constructor.prototype),t.prototype.constructor=t,t.prototype.getDefaults=function(){return t.DEFAULTS},t.prototype.setContent=function(){var e=this.tip(),t=this.getTitle(),n=this.getContent();e.find(".popover-title")[this.options.html?"html":"text"](t),e.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof n?"html":"append":"text"](n),e.removeClass("fade top bottom left right in"),e.find(".popover-title").html()||e.find(".popover-title").hide()},t.prototype.hasContent=function(){return this.getTitle()||this.getContent()},t.prototype.getContent=function(){var e=this.$element,t=this.options;return e.attr("data-content")||("function"==typeof t.content?t.content.call(e[0]):t.content)},t.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var n=e.fn.popover;e.fn.popover=function(n){return this.each(function(){var i=e(this),r=i.data("bs.popover"),a="object"==typeof n&&n;!r&&/destroy|hide/.test(n)||(r||i.data("bs.popover",r=new t(this,a)),"string"==typeof n&&r[n]())})},e.fn.popover.Constructor=t,e.fn.popover.noConflict=function(){return e.fn.popover=n,this}}(jQuery),function(e){"use strict";function t(n,i){this.$body=e(document.body),this.$scrollElement=e(e(n).is(document.body)?window:n),this.options=e.extend({},t.DEFAULTS,i),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",e.proxy(this.process,this)),this.refresh(),this.process()}function n(n){return this.each(function(){var i=e(this),r=i.data("bs.scrollspy"),a="object"==typeof n&&n;r||i.data("bs.scrollspy",r=new t(this,a)),"string"==typeof n&&r[n]()})}t.VERSION="3.3.7",t.DEFAULTS={offset:10},t.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},t.prototype.refresh=function(){var t=this,n="offset",i=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),e.isWindow(this.$scrollElement[0])||(n="position",i=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var t=e(this),r=t.data("target")||t.attr("href"),a=/^#./.test(r)&&e(r);return a&&a.length&&a.is(":visible")&&[[a[n]().top+i,r]]||null}).sort(function(e,t){return e[0]-t[0]}).each(function(){t.offsets.push(this[0]),t.targets.push(this[1])})},t.prototype.process=function(){var e,t=this.$scrollElement.scrollTop()+this.options.offset,n=this.getScrollHeight(),i=this.options.offset+n-this.$scrollElement.height(),r=this.offsets,a=this.targets,s=this.activeTarget;if(this.scrollHeight!=n&&this.refresh(),t>=i)return s!=(e=a[a.length-1])&&this.activate(e);if(s&&t<r[0])return this.activeTarget=null,this.clear();for(e=r.length;e--;)s!=a[e]&&t>=r[e]&&(void 0===r[e+1]||t<r[e+1])&&this.activate(a[e])},t.prototype.activate=function(t){this.activeTarget=t,this.clear();var n=this.selector+'[data-target="'+t+'"],'+this.selector+'[href="'+t+'"]',i=e(n).parents("li").addClass("active");i.parent(".dropdown-menu").length&&(i=i.closest("li.dropdown").addClass("active")),i.trigger("activate.bs.scrollspy")},t.prototype.clear=function(){e(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var i=e.fn.scrollspy;e.fn.scrollspy=n,e.fn.scrollspy.Constructor=t,e.fn.scrollspy.noConflict=function(){return e.fn.scrollspy=i,this},e(window).on("load.bs.scrollspy.data-api",function(){e('[data-spy="scroll"]').each(function(){var t=e(this);n.call(t,t.data())})})}(jQuery),function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.tab");r||i.data("bs.tab",r=new n(this)),"string"==typeof t&&r[t]()})}var n=function(t){this.element=e(t)};n.VERSION="3.3.7",n.TRANSITION_DURATION=150,n.prototype.show=function(){var t=this.element,n=t.closest("ul:not(.dropdown-menu)"),i=t.data("target");if(i||(i=(i=t.attr("href"))&&i.replace(/.*(?=#[^\s]*$)/,"")),!t.parent("li").hasClass("active")){var r=n.find(".active:last a"),a=e.Event("hide.bs.tab",{relatedTarget:t[0]}),s=e.Event("show.bs.tab",{relatedTarget:r[0]});if(r.trigger(a),t.trigger(s),!s.isDefaultPrevented()&&!a.isDefaultPrevented()){var o=e(i);this.activate(t.closest("li"),n),this.activate(o,o.parent(),function(){r.trigger({type:"hidden.bs.tab",relatedTarget:t[0]}),t.trigger({type:"shown.bs.tab",relatedTarget:r[0]})})}}},n.prototype.activate=function(t,i,r){function a(){s.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),t.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),o?(t[0].offsetWidth,t.addClass("in")):t.removeClass("fade"),t.parent(".dropdown-menu").length&&t.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),r&&r()}var s=i.find("> .active"),o=r&&e.support.transition&&(s.length&&s.hasClass("fade")||!!i.find("> .fade").length);s.length&&o?s.one("bsTransitionEnd",a).emulateTransitionEnd(n.TRANSITION_DURATION):a(),s.removeClass("in")};var i=e.fn.tab;e.fn.tab=t,e.fn.tab.Constructor=n,e.fn.tab.noConflict=function(){return e.fn.tab=i,this};var r=function(n){n.preventDefault(),t.call(e(this),"show")};e(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',r).on("click.bs.tab.data-api",'[data-toggle="pill"]',r)}(jQuery),function(e){"use strict";function t(t){return this.each(function(){var i=e(this),r=i.data("bs.affix"),a="object"==typeof t&&t;r||i.data("bs.affix",r=new n(this,a)),"string"==typeof t&&r[t]()})}var n=function(t,i){this.options=e.extend({},n.DEFAULTS,i),this.$target=e(this.options.target).on("scroll.bs.affix.data-api",e.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",e.proxy(this.checkPositionWithEventLoop,this)),this.$element=e(t),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};n.VERSION="3.3.7",n.RESET="affix affix-top affix-bottom",n.DEFAULTS={offset:0,target:window},n.prototype.getState=function(e,t,n,i){var r=this.$target.scrollTop(),a=this.$element.offset(),s=this.$target.height();if(null!=n&&"top"==this.affixed)return r<n&&"top";if("bottom"==this.affixed)return null!=n?!(r+this.unpin<=a.top)&&"bottom":!(r+s<=e-i)&&"bottom";var o=null==this.affixed,l=o?r:a.top,c=o?s:t;return null!=n&&r<=n?"top":null!=i&&l+c>=e-i&&"bottom"},n.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(n.RESET).addClass("affix");var e=this.$target.scrollTop(),t=this.$element.offset();return this.pinnedOffset=t.top-e},n.prototype.checkPositionWithEventLoop=function(){setTimeout(e.proxy(this.checkPosition,this),1)},n.prototype.checkPosition=function(){if(this.$element.is(":visible")){var t=this.$element.height(),i=this.options.offset,r=i.top,a=i.bottom,s=Math.max(e(document).height(),e(document.body).height());"object"!=typeof i&&(a=r=i),"function"==typeof r&&(r=i.top(this.$element)),"function"==typeof a&&(a=i.bottom(this.$element));var o=this.getState(s,t,r,a);if(this.affixed!=o){null!=this.unpin&&this.$element.css("top","");var l="affix"+(o?"-"+o:""),c=e.Event(l+".bs.affix");if(this.$element.trigger(c),c.isDefaultPrevented())return;this.affixed=o,this.unpin="bottom"==o?this.getPinnedOffset():null,this.$element.removeClass(n.RESET).addClass(l).trigger(l.replace("affix","affixed")+".bs.affix")}"bottom"==o&&this.$element.offset({top:s-t-a})}};var i=e.fn.affix;e.fn.affix=t,e.fn.affix.Constructor=n,e.fn.affix.noConflict=function(){return e.fn.affix=i,this},e(window).on("load",function(){e('[data-spy="affix"]').each(function(){var n=e(this),i=n.data();i.offset=i.offset||{},null!=i.offsetBottom&&(i.offset.bottom=i.offsetBottom),null!=i.offsetTop&&(i.offset.top=i.offsetTop),t.call(n,i)})})}(jQuery)}.apply(e,arguments)})}(this),define("js/mixins/openurl_generator",[],function(){return function(e,t){this.baseURL=t,this.metadata=void 0!==e?this.metadata=e:{},this.url_ver="Z39.88-2004",this.rft_val_fmt="info:ofi/fmt:kev:mtx:",this.rfr_id="info:sid/ADS",this.sid="ADS",this.parseAuthor=function(e){return void 0===e?{firstnames:!1,lastname:!1}:{firstnames:e.split(", ")[1],lastname:e.split(", ")[0]}},this.parseFirstPage=function(e){return void 0!==e&&e[0].split("-")[0]},this.parseRFTInfo=function(e){return[void 0!==e.doi&&"info:doi/"+e.doi[0],void 0!==e.bibcode&&"info:bibcode/"+e.bibcode]},this.parseID=function(e){return void 0!==e&&"doi:"+e[0]},this.parseGenre=function(e){return void 0!==e?e:"article"},this.parseDegree=function(e){return-1!=(e=void 0!==e?e:"").indexOf("PhDT")?"PhD":-1!=e.indexOf("MsT")&&"Masters"},this.parseContent=function(){this.rft_spage=this.parseFirstPage(this.metadata.page),this.id=this.parseID(this.metadata.doi),this.genre=this.parseGenre(this.metadata.doctype),this.rft_degree=this.parseDegree(this.metadata.bibcode),this.rft_id=this.parseRFTInfo(this.metadata);var e=this.parseAuthor(this.metadata.first_author);this.rft_aulast=e.lastname,this.rft_aufirst=e.firstnames,this.rft_issue=void 0!==this.metadata.issue&&this.metadata.issue,this.rft_vol=void 0!==this.metadata.volume&&this.metadata.volume,this.rft_jtitle=void 0!==this.metadata.pub&&this.metadata.pub,this.rft_date=void 0!==this.metadata.year&&this.metadata.year,this.rft_atitle=void 0!==this.metadata.title&&this.metadata.title[0],this.rft_issn=void 0!==this.metadata.issn&&this.metadata.issn[0],this.rft_isbn=void 0!==this.metadata.isbn&&this.metadata.isbn[0],this.rft_val_fmt+=this.genre},this.createContextObject=function(){this.parseContent(),this.contextObject={url_ver:this.url_ver,rfr_id:this.rfr_id,rft_val_fmt:this.rft_val_fmt,rft_id:this.rft_id,issn:this.rft_issn,id:this.id,isbn:this.rft_isbn,"rft.spage":this.rft_spage,"rft.issue":this.rft_issue,"rft.volume":this.rft_vol,"rft.jtitle":this.rft_jtitle,"rft.atitle":this.rft_atitle,"rft.aulast":this.rft_aulast,"rft.aufirst":this.rft_aufirst,"rft.date":this.rft_date,"rft.issn":this.rft_issn,"rft.isbn":this.rft_isbn,"rft.genre":this.genre,"rft.degree":this.rft_degree,sid:this.sid,spage:this.rft_spage,volume:this.rft_vol,title:this.rft_jtitle,atitle:this.rft_atitle,aulast:this.rft_aulast,aufirst:this.rft_aufirst,date:this.rft_date,genre:this.genre}},this.createOpenURL=function(){this.createContextObject(),this.openURL=this.baseURL+"?";for(var e in this.contextObject)if(this.contextObject.hasOwnProperty(e)){if(!1===this.contextObject[e])continue;if(this.contextObject[e]instanceof Array)for(var t=0;t<this.contextObject[e].length;t++)!1!==this.contextObject[e][t]&&(this.openURL+="&"+e+"="+this.contextObject[e][t]);else this.openURL+="&"+e+"="+this.contextObject[e]}this.openURL=encodeURI(this.openURL)}}}),define("js/mixins/link_generator_mixin",["underscore","js/mixins/openurl_generator"],function(e,t){return{adsUrlRedirect:function(e,t){var n="http://adsabs.harvard.edu/";switch(e){case"webrecord":return"https://ui.adsabs.harvard.edu/#abs/"+t;case"doi":return n+"cgi-bin/nph-abs_connect?fforward=http://dx.doi.org/"+t;case"data":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=DATA";case"electr":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=EJOURNAL";case"gif":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=GIF";case"article":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=ARTICLE";case"preprint":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=PREPRINT";case"arXiv":return n+"cgi-bin/nph-abs_connect?fforward=http://arxiv.org/abs/"+t;case"simbad":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=SIMBAD";case"ned":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=NED";case"openurl":return n+"cgi-bin/nph-data_query?bibcode="+t+"&link_type=OPENURL";default:throw new Exception("Unknown type: "+e)}},parseLinksData:function(t){return e.map(t,function(e){return this.parseLinksDataForModel(e)},this)},getTextAndDataLinks:function(n,i,r){var a,s,o,l,c,u,d,h,p={text:[],data:[]};return a=e.filter(e.map(n,function(e){try{return JSON.parse(e)}catch(t){console.error("Error parsing links_data value",i,e)}})),e.each(a,function(n){var c="open"===n.access;switch(n.type){case"preprint":p.text.push({openAccess:c,title:"arXiv e-print",link:this.adsUrlRedirect("preprint",i)});break;case"electr":s=e.where(a,{type:"gif"}).length>0,o=(r=r||{}).doi||r.issn||r.isbn,!n.access&&!s&&r.link_server&&o&&((l=new t(r,r.link_server)).createOpenURL(),p.text.push({openAccess:c,title:"Find it at your institution",link:l.openURL,openUrl:!0})),p.text.push({openAccess:c,title:"Publisher Article",link:this.adsUrlRedirect("electr",i)});break;case"pdf":p.text.push({openAccess:c,title:"Publisher PDF",link:this.adsUrlRedirect("article",i)});break;case"article":p.text.push({openAccess:c,title:"ADS PDF",link:this.adsUrlRedirect("article",i)});break;case"gif":p.text.push({openAccess:c,title:"ADS Scanned Article",link:this.adsUrlRedirect("gif",i)});break;case"data":u=n.instances?"Archival Data ("+n.instances+")":"Archival Data";p.data.push({title:u,link:this.adsUrlRedirect("data",i)});break;case"simbad":u=n.instances?"SIMBAD objects ("+n.instances+")":"SIMBAD objects";p.data.push({title:u,link:this.adsUrlRedirect("simbad",i)});break;case"ned":var u=n.instances?"NED objects ("+n.instances+")":"NED objects";p.data.push({title:u,link:this.adsUrlRedirect("ned",i)})}},this),(c=e.where(p.data,{link:this.adsUrlRedirect("data",i)})).length>1&&(u={title:"Archival Data ("+c.length+")",link:this.adsUrlRedirect("data",i)},p.data=e.filter(p.data,function(e){if(!e.title.match("Archival Data"))return!0}),p.data.push(u)),d=e.groupBy(p.text,"title"),e.each(d,function(t,n){var i;t.length>1&&(p.text=e.filter(p.text,function(e){return e.title!==n}),i=e.findWhere(t,{openAccess:!0})||t[0],p.text.push(i))}),h=["ADS PDF","ADS Scanned Article","Find it at your institution","Publisher Article","Publisher PDF","arXiv e-print"],p.text=e.sortBy(p.text,function(e){return h.indexOf(e.title)}),p},parseLinksDataForModel:function(t){var n={list:[],data:[],text:[]};if(t.links_data&&e.extend(n,this.getTextAndDataLinks(t.links_data,t.bibcode,t)),t["[citations]"]){var i=t["[citations]"].num_citations,r=t["[citations]"].num_references;i>=1&&n.list.push({letter:"C",title:"Citations ("+i+")",link:"#abs/"+t.bibcode+"/citations"}),r>=1&&n.list.push({letter:"R",title:"References ("+r+")",link:"#abs/"+t.bibcode+"/references"})}return t.property&&e.contains(t.property,"TOC")&&n.list.push({letter:"T",title:"Table of Contents",link:"#abs/"+t.bibcode+"/tableofcontents"}),t.links=n,t},parseResourcesData:function(e){if(e.links_data){var t=this.getTextAndDataLinks(e.links_data,e.bibcode,e);e.fullTextSources=t.text,e.dataProducts=t.data}return e}}}),define("js/modules/orcid/orcid_api",["underscore","bootstrap","jquery","backbone","js/components/generic_module","js/mixins/dependon","js/components/pubsub_events","js/mixins/link_generator_mixin","js/components/api_query","js/components/api_request","js/mixins/hardened","js/components/api_targets","js/components/api_query_updater","js/components/api_feedback"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p){var f=r.extend({initialize:function(){this.orcidProxyUri="",this.userData={},this.authData=null,this.db={},this.profile={},this.checkInterval=36e5,this.virgin=!0,this.maxQuerySize=100,this.queryUpdater=new h("orcid_api"),this.orcidApiTimeout=3e4},activate:function(t){this.setBeeHive(t);var n=t.getObject("DynamicConfig");this.config={},e.extend(this.config,n.Orcid);var i=t.getService("PersistentStorage");if(i){var r=i.get("Orcid");r&&r.authData&&this.saveAccessData(r.authData)}},checkAccessOrcidApiAccess:function(e){e=e||this.authData;var t=n.Deferred();return this.sendData(this.config.apiEndpoint+"/"+e.orcid+"/orcid-profile",null,{fail:function(){t.reject(arguments)},done:function(e){t.resolve(e)},headers:{"Orcid-Authorization":"Bearer "+e.access_token}}),t.promise()},hasAccess:function(){return!!this.authData&&!(this.authData.expires&&this.authData.expires<=(new Date).getTime())},signIn:function(e){this.getPubSub().publish(this.getPubSub().APP_EXIT,{type:"orcid",url:this.config.loginUrl+"&redirect_uri="+encodeURIComponent(this.config.redirectUrlBase+(e||"/#/user/orcid"))}),this.getPubSub().publish(this.getPubSub().ORCID_ANNOUNCEMENT,"login")},setADSUserData:function(e){var t=this,i=n.Deferred();return this.sendData(this.getBeeHive().getService("Api").url+d.ORCID_PREFERENCES+"/"+this.authData.orcid,e,{type:"POST",fail:function(e){t.getPubSub().publish(t.getPubSub().ALERT,new p({code:0,msg:"ADS ORCID preferences could not be set",type:"danger",fade:!0})),i.reject(e)},done:function(e){i.resolve(e)}}),i.promise()},getADSUserData:function(){var e=n.Deferred(),t=this;return this.sendData(this.getBeeHive().getService("Api").url+d.ORCID_PREFERENCES+"/"+this.authData.orcid,null,{fail:function(n){t.getPubSub().publish(t.getPubSub().ALERT,new p({code:0,msg:"ADS ORCID preferences could not be retrieved",type:"danger",fade:!0})),e.reject(n)},done:function(t){e.resolve(t)},headers:{"Orcid-Authorization":"Bearer "+this.authData.access_token}}),e.promise()},signOut:function(){this.saveAccessData(null),this.getPubSub().publish(this.getPubSub().ORCID_ANNOUNCEMENT,"logout")},hasExchangeCode:function(e){if(this.getUrlParameter("code",e||window.location.search))return!0},getExchangeCode:function(e){return this.getUrlParameter("code",e||window.location.search)},getUrlParameter:function(e,t){for(var n=t.substring(1).split("&"),i=0;i<n.length;i++){var r=n[i].split("=");if(r[0]==e)return decodeURIComponent(r[1])}},getAccessData:function(e){var t=this.getBeeHive().getService("Api"),i=n.Deferred();return t.request(new c({target:this.config.exchangeTokenUrl,query:new l({code:e})}),{url:this.config.exchangeTokenUrl,done:function(e,t,n){i.resolve(e)},headers:{Accept:"application/json",Authorization:t.access_token}}).fail(function(e,t,n){i.reject(e)}),i.promise()},saveAccessData:function(e){var t=this.getBeeHive();e&&!e.expires&&e.expires_in&&(e.expires=(new Date).getTime()+(1e3*e.expires_in-1e3)),this.authData=e;var n=t.getService("PersistentStorage");if(n){var i=n.get("Orcid")||{};i.authData=e,n.set("Orcid",i)}},checkAccess:function(){var e=this.getPubSub();this.hasAccess()||e.publish(e.ALERT,new p({code:p.CODES.ALERT,msg:" No access_token found",type:"danger",title:"Unable to contact ORCID API",modal:!0})),this.config.apiEndpoint||e.publish(e.ALERT,new p({code:p.CODES.ALERT,msg:"The config variable apiEndpoint is missing",type:"danger",title:"Unable to contact ORCID API",modal:!0}))},getUserProfile:function(){this.checkAccess();var e=n.Deferred();return this.sendData(this.config.apiEndpoint+"/"+this.authData.orcid+"/orcid-profile").done(function(t){e.resolve(t["orcid-profile"])}).fail(function(){e.reject(arguments)}),e.promise()},getWorks:function(){this.checkAccess();var e=n.Deferred();return this.sendData(this.config.apiEndpoint+"/"+this.authData.orcid+"/orcid-works").done(function(t){e.resolve(t["orcid-profile"]["orcid-activities"]?t["orcid-profile"]["orcid-activities"]["orcid-works"]:{})}).fail(function(){e.reject(arguments)}),e.promise()},getExternalIds:function(t){var n={};return t?(t&&t["orcid-work"]?t=t["orcid-work"]:e.isArray(t)||(t=[t]),e.each(t,function(t,i){t["work-external-identifiers"]&&t["work-external-identifiers"]["work-external-identifier"]&&e.each(t["work-external-identifiers"]["work-external-identifier"],function(e){e["work-external-identifier-id"]&&e["work-external-identifier-id"].value&&(n[e["work-external-identifier-id"].value]={idx:i,type:e["work-external-identifier-type"],"put-code":t["put-code"]})})}),n):n},isWorkCreatedByUs:function(e){return!!(e.source&&e.source["source-client-id"]&&e.source["source-client-id"].path&&e.source["source-client-id"].path==this.config.clientId)},formatOrcidWork:function(t,n){var i=this,r={"work-type":i._getOrcidWorkType(t),url:o.adsUrlRedirect("webrecord",t.bibcode)},a=["bibcode","id","doi"];if(e.each(a,function(n){t[n]&&(r["work-external-identifiers"]||(r["work-external-identifiers"]={"work-external-identifier":[]}),e.isArray(t[n])?e.each(t[n],function(e){r["work-external-identifiers"]["work-external-identifier"].push({"work-external-identifier-type":i._getOrcidIdentifierType(n),"work-external-identifier-id":{value:e}})}):r["work-external-identifiers"]["work-external-identifier"].push({"work-external-identifier-type":i._getOrcidIdentifierType(n),"work-external-identifier-id":{value:t[n]}}))}),t.title&&(r["work-title"]={title:e.isArray(t.title)?t.title.join(" "):t.title}),t.abstract&&e.isString(t.abstract)&&(r["short-description"]=t.abstract.substring(0,5e3)),t.author&&(r["work-contributors"]=function(t){var n=[];return e.each(t,function(e){n.push({"credit-name":e,"contributor-attributes":{"contributor-role":"AUTHOR"}})}),{contributor:n}}(t.author)),t.pubdate&&t.pubdate.length>3){var s,l,c=t.pubdate.split(/\s|-/);s=parseInt(c[0]),l=parseInt(c[1]),s>999&&s<2050&&(r["publication-date"]={year:s},l>0&&l<=12&&(r["publication-date"].month=l))}return n&&(r["put-code"]=n),r},_getOrcidWorkType:function(e){return"JOURNAL_ARTICLE"},_getOrcidIdentifierType:function(e){switch(e.toLowerCase()){case"doi":return"DOI";case"bibcode":return"BIBCODE";default:return"OTHER_ID"}},formatOrcidWorks:function(t){if(!e.isArray(t))throw new Exception("Input to formatOrcidWorks must be an array of objects");var n=this,i=[];return e.each(t,function(e){i.push(n.formatOrcidWork(e))}),this._createOrcidMessage(i)},_createOrcidMessage:function(e){return{"message-version":"1.2","orcid-profile":{"orcid-activities":{"orcid-works":{"orcid-work":e}}}}},addWorks:function(e){return this.dirty=!0,this.sendData(this.config.apiEndpoint+"/"+this.authData.orcid+"/orcid-works",this.formatOrcidWorks(e),{type:"POST"})},updateWorks:function(e){return this.deleteWorks(this._extractIdentifiers(e),e)},_extractIdentifiers:function(t){var n=[];return e.each(t,function(e){if(e.bibcode&&n.push(e.bibcode),e.doi&&n.push(e.doi),e.alternate_bibcode)for(var t in e.alternate_bibcode)n.push(t)}),n},deleteWorks:function(t,i){var r=this,a=n.Deferred();return this.getWorks().done(function(n){var s=n["orcid-work"].filter(function(e){return r.isWorkCreatedByUs(e)});if(0!=s.length){var o=[],l=r.getExternalIds(s);e.each(t,function(e){l[e]&&o.push(l[e].idx)});var c=[];if(i&&e.each(i,function(e){c.push(r.formatOrcidWork(e))}),0!=o.length||0!=c.length){e.each(s,function(e,t,n){-1==o.indexOf(t)&&c.push(e)});var u={deleted:o.length,added:0,msg:"Attempting removal",adsTotal:c.length,totalRecs:n["orcid-work"].length};r.sendData(r.config.apiEndpoint+"/"+r.authData.orcid+"/orcid-works",r._createOrcidMessage(c),{type:"PUT"}).done(function(e){r.dirty=!0,u.response=e,a.resolve(u)})}else a.resolve({deleted:0,added:0,msg:"No ADS rec found that could be deleted/added",totalRecs:n["orcid-work"].length,adsTotal:s.length})}else a.resolve({deleted:0,added:0,msg:"No ADS records found",totalRecs:n["orcid-work"].length,adsTotal:0})}).fail(function(e){a.reject({msg:"Error getting list of Orcid records (we cant delete anything)"})}),a.promise()},setWorks:function(e,t){return this.sendData(this.config.apiEndpoint+"/"+this.authData.orcid+"/orcid-works",t?e:this.formatOrcidWorks(e),{type:"PUT"})},sendData:function(t,i,r){var a=n.Deferred();r=r||{};var s={type:"GET",url:t,cache:!!this.updateDatabasePromise,timeout:this.orcidApiTimeout,done:function(e){a.resolve(e)}};i?(s.dataType="json",s.data=JSON.stringify(i),s.converters={"* text":window.String,"text html":!0,"text json":function(e){return e=e||"{}",n.parseJSON(e)},"text xml":n.parseXML}):s.data=null,e.extend(s,r);var o=this.getBeeHive().getService("Api");return s.headers||(s.headers={}),s.headers.Authorization=o.access_token,!s.headers["Orcid-Authorization"]&&this.authData&&(s.headers["Orcid-Authorization"]="Bearer "+this.authData.access_token),s.headers["Content-Type"]||(s.headers["Content-Type"]="application/json"),s.headers.Accept||(s.headers.Accept="application/json"),o.request(new c({target:t,query:new l,options:s})).fail(function(){a.reject(arguments)}),a.promise()},_checkOrcidIdsInAds:function(t){var i=this.getBeeHive().getService("Api"),r=new n.Deferred;if(!i){var a=r.promise();return r.resolve({}),a}return t.set("fl","bibcode,doi,alternate_bibcode"),t.set("rows","5000"),i.request(new c({target:d.SEARCH,query:t,options:{done:function(t,n,i){var a,s,o={};if(!t||!t.response||!t.response.docs)return r.resolve(o);e.each(t.response.docs,function(t){s=t.bibcode.toLowerCase(),o[a="bibcode:"+s]=s,e.each(t.doi,function(e){o["doi:"+e.toLowerCase().replace("doi:","")]=s}),e.each(t.alternate_bibcode,function(e){o["bibcode:"+e.toLowerCase()]=s})}),r.resolve(o)},fail:function(){r.resolve({})}}})),r.promise()},getRecordInfo:function(e){if(!e)throw new Error("Empty input");var t=n.Deferred(),i=this;return this.needsUpdate()||this.updateDatabasePromise&&"resolved"!==this.updateDatabasePromise.state()?this.updateDatabase().done(function(){t.resolve(i._getRecInfo(e))}).fail(function(){t.reject(arguments)}):t.resolve(i._getRecInfo(e)),t.promise()},_getRecInfo:function(t){var n={isCreatedByUs:!1,isCreatedByOthers:!1,isKnownToAds:!1,provenance:null},i=this;return e.each(e.pick(t,"bibcode","doi","alternate_bibcode"),function(t,r,a){if(e.isArray(t))for(var s in t)i._updateRec(r+":"+s,n);else i._updateRec(r+":"+t,n)}),n},_updateRec:function(e,t){if(e=e.toLowerCase(),this.db[e]){var n=this.db[e];n.isAds?t.isCreatedByUs=!0:t.isCreatedByOthers=!0,n.idx>-1&&(t.isKnownToAds=!0),t.putcode=n.putcode,t.bibcode=n.bibcode}},updateDatabase:function(t){function i(){setTimeout(function(){r.updateDatebasePromise=null},3e4)}t&&t["orcid-profile"]&&(t=t["orcid-profile"]);var r=this,a=n.Deferred();if(this.updateDatabasePromise)return this.updateDatabasePromise.promise();this.updateDatabasePromise=a,r.virgin=!1;var s;return t&&t.orcid?(s=n.Deferred()).resolve(t):s=this.getUserProfile(),s.done(function(t){r.dirty=!1;var s,o,l,c=t["orcid-activities"]?t["orcid-activities"]["orcid-works"]:[],u=r.getExternalIds(c),d={},h=[];if(e.each(u,function(e,t,n){o=e.type.toLowerCase().trim(),l=t.toLowerCase().trim(),t=o+":"+l,"bibcode"==o?(h.push(t),h.push("alternate_bibcode:"+l)):"doi"==o&&h.push(t),s=r.isWorkCreatedByUs(c["orcid-work"][e.idx]),d[t]={isAds:s,idx:e.idx,putcode:e["put-code"]}}),h.length&&r.maxQuerySize>0){var p=[];h=h.sort();for(var f=e.range(0,h.length,r.maxQuerySize),g=0;g<f.length;g++){for(var m={},b=f[g];b<f[g]+r.maxQuerySize&&!(b>=h.length);b++){var v=h[b].split(":");m[v[0]]||(m[v[0]]=[]),m[v[0]].push(r.queryUpdater.quoteIfNecessary(v[1]))}p.push(r._checkOrcidIdsInAds(r._buildQuery(m)))}n.when.apply(n,p).then(function(){e.each(arguments,function(t,n){e.each(t,function(t,n){var i=d["bibcode:"+t];i||(i={idx:-1,putcode:-1}),-1==i.idx&&d[n]&&d[n].idx>-1&&e.extend(i,d[n]),i.bibcode=t,d[n]=i})}),r.db=d,r.profile=t,a.resolve()},function(){console.error("Error processing response from ADS",arguments),r.db=d,r.profile=t,a.resolve(),i()})}else r.db=d,r.profile=t,a.resolve(),i()}).fail(function(){a.reject(arguments),i()}),a},_buildQuery:function(t){var n=e.map(t,function(t,n){return 0==t.length?"":"doi"==n?"("+e.map(t,function(e){return"doi:"+e}).join(" OR ")+")":n+":("+t.join(" OR ")+")"}).filter(function(e){return e.length});return new l({q:n.join(" OR ")})},needsUpdate:function(){return!!this.virgin||(this.dirtyThrottle||(this.dirtyThrottle=e.throttle(function(e){e.checkAccessOrcidApiAccess().done(function(t){e.updateDatabase(t)}).fail(function(){console.log("We have lost access to ORCID Api (maybe the user revoked the token?)"),e.authData={}})},this.checkInterval||36e5,this)),this.dirtyThrottle(this),this.dirty)},updateOrcid:function(t,i){if(!e.isObject(i))throw new Error("You are supposed to send simple object");var r=n.Deferred(),a=this;if("update"==t)this.updateWorks([i]).done(function(e){a.getRecordInfo(i).done(function(e){r.resolve(e)}).fail(function(){r.reject(arguments)})}).fail(function(){r.reject(arguments)});else if("delete"==t)this.deleteWorks(this._extractIdentifiers([i])).done(function(e){a.getRecordInfo(i).done(function(e){r.resolve(e)}).fail(function(){r.reject(arguments)})}).fail(function(){r.reject(arguments)});else{if("add"!=t)throw new Error("Unknown action: "+t);this.getRecordInfo(i).done(function(e){if(e.isCreatedByUs||e.isCreatedByOthers)return a.updateOrcid("update",i);a.addWorks([i]).done(function(){e.isCreatedByUs=!0,r.resolve(e)}).fail(function(){r.reject(arguments)})}).fail(function(){r.fail(arguments)})}return r.promise()},getOrcidVal:function(e,t,n){for(var i=t.split("/"),r=e,a=0;a<i.length;a++){if(!r[i[a]])return n;r=r[i[a]]}return r},transformOrcidProfile:function(t){function n(e){return e?e.value?e.value:e:null}function i(e){return e?(n(e.year)||"????")+"/"+(n(e.month)||"??"):null}function r(e,t){return e.bibcode?e.bibcode:e.doi?e.doi:t.length?t[0]:"unknown"}function a(t){if(!t)return[];var i=[];return t.contributor&&e.each(t.contributor,function(e){e["credit-name"]&&i.push(n(e["credit-name"]))}),i}var s,o=[],l=this;s=this.getOrcidVal(t,"orcid-activities/orcid-works/orcid-work",[]);var c=t["orcid-identifier"].path,u=this.getOrcidVal(t,"orcid-bio/personal-details/given-names/value",null),d=this.getOrcidVal(t,"orcid-bio/personal-details/family-name/value",null);return e.each(s,function(t){var s={},c=l.getExternalIds(t);e.each(c,function(e,t,n){s[e.type.toLowerCase()]=t}),s.putcode=n(t["put-code"]),s.title=n(t["work-title"]?t["work-title"].title:null),s.visibility=n(t.visibility),s.formattedDate=i(t["publication-date"]),s.pub=n(t["journal-title"]),s.abstract=n(t["short-description"]),s.author=a(t["work-contributors"]),s.identifier=r(s,c),s.source_name=n(t.source?t.source["source-name"]:"unknown"),s.source_date=n(t.source?t.source["source-date"]:0),o.push(s)}),o=e.sortBy(o,function(e){return e.title}),{responseHeader:{params:{orcid:c,firstName:u,lastName:d}},response:{numFound:o.length,start:0,docs:o}}},getOrcidProfileInAdsFormat:function(){var e=n.Deferred(),t=this;return this.getUserProfile().done(function(n){t.updateDatabase(n).done(function(){e.resolve(t.transformOrcidProfile(n))}).fail(function(){e.reject(arguments)})}).fail(function(){e.reject(arguments)}),e.promise()},hardenedInterface:{hasAccess:"boolean indicating access to ORCID Api",getUserProfile:"get user profile",signIn:"login",signOut:"logout",getADSUserData:"",setADSUserData:"",getRecordInfo:"provides info about a document",updateOrcid:"the main access point for widgets",getOrcidProfileInAdsFormat:"retrieves the Orcid profile in ADS format",getOrcidVal:"value getter"}});return e.extend(f.prototype,a.BeeHive),e.extend(f.prototype,u),f}),define("js/modules/orcid/module",["backbone","underscore","js/components/generic_module","./orcid_api"],function(e,t,n,i){var r=n.extend({activate:function(e){var n=e.getObject("DynamicConfig");if(!n)throw new Error("DynamicConfig is not available to Orcid module");var i=n.orcidRedirectUrlBase||location.protocol+"//"+location.host,r=n.orcidClientId,a=n.orcidApiEndpoint,s=n.orcidLoginEndpoint;if(!r||!a)throw new Error("Missing configuration for ORCID module: orcidApiEndpoint, orcidClientId");var o={redirectUrlBase:i,apiEndpoint:a,clientId:r,worksUrl:a+"/{0}/orcid-works",loginUrl:s+"?scope=/orcid-profile/read-limited%20/orcid-works/create%20/orcid-works/update&response_type=code&access_type=offline&show_login=true&client_id="+r,exchangeTokenUrl:a+"/exchangeOAuthCode"};t.extend(n,{Orcid:o}),this.activateDependencies(e)},activateDependencies:function(e){var t=e.getService("OrcidApi");t||((t=new i).activate(e),e.addService("OrcidApi",t))}});return function(){return{activate:function(e){(new r).activate(e)}}}}),function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define("moment",t):e.moment=t()}(this,function(){"use strict";function e(){return At.apply(null,arguments)}function t(e){return e instanceof Array||"[object Array]"===Object.prototype.toString.call(e)}function n(e){return null!=e&&"[object Object]"===Object.prototype.toString.call(e)}function i(e){if(Object.getOwnPropertyNames)return 0===Object.getOwnPropertyNames(e).length;var t;for(t in e)if(e.hasOwnProperty(t))return!1;return!0}function r(e){return void 0===e}function a(e){return"number"==typeof e||"[object Number]"===Object.prototype.toString.call(e)}function s(e){return e instanceof Date||"[object Date]"===Object.prototype.toString.call(e)}function o(e,t){var n,i=[];for(n=0;n<e.length;++n)i.push(t(e[n],n));return i}function l(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function c(e,t){for(var n in t)l(t,n)&&(e[n]=t[n]);return l(t,"toString")&&(e.toString=t.toString),l(t,"valueOf")&&(e.valueOf=t.valueOf),e}function u(e,t,n,i){return Ve(e,t,n,i,!0).utc()}function d(){return{empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1,parsedDateParts:[],meridiem:null,rfc2822:!1,weekdayMismatch:!1}}function h(e){return null==e._pf&&(e._pf=d()),e._pf}function p(e){if(null==e._isValid){var t=h(e),n=kt.call(t.parsedDateParts,function(e){return null!=e}),i=!isNaN(e._d.getTime())&&t.overflow<0&&!t.empty&&!t.invalidMonth&&!t.invalidWeekday&&!t.weekdayMismatch&&!t.nullInput&&!t.invalidFormat&&!t.userInvalidated&&(!t.meridiem||t.meridiem&&n);if(e._strict&&(i=i&&0===t.charsLeftOver&&0===t.unusedTokens.length&&void 0===t.bigHour),null!=Object.isFrozen&&Object.isFrozen(e))return i;e._isValid=i}return e._isValid}function f(e){var t=u(NaN);return null!=e?c(h(t),e):h(t).userInvalidated=!0,t}function g(e,t){var n,i,a;if(r(t._isAMomentObject)||(e._isAMomentObject=t._isAMomentObject),r(t._i)||(e._i=t._i),r(t._f)||(e._f=t._f),r(t._l)||(e._l=t._l),r(t._strict)||(e._strict=t._strict),r(t._tzm)||(e._tzm=t._tzm),r(t._isUTC)||(e._isUTC=t._isUTC),r(t._offset)||(e._offset=t._offset),r(t._pf)||(e._pf=h(t)),r(t._locale)||(e._locale=t._locale),Ct.length>0)for(n=0;n<Ct.length;n++)r(a=t[i=Ct[n]])||(e[i]=a);return e}function m(t){g(this,t),this._d=new Date(null!=t._d?t._d.getTime():NaN),this.isValid()||(this._d=new Date(NaN)),!1===Pt&&(Pt=!0,e.updateOffset(this),Pt=!1)}function b(e){return e instanceof m||null!=e&&null!=e._isAMomentObject}function v(e){return e<0?Math.ceil(e)||0:Math.floor(e)}function y(e){var t=+e,n=0;return 0!==t&&isFinite(t)&&(n=v(t)),n}function w(e,t,n){var i,r=Math.min(e.length,t.length),a=Math.abs(e.length-t.length),s=0;for(i=0;i<r;i++)(n&&e[i]!==t[i]||!n&&y(e[i])!==y(t[i]))&&s++;return s+a}function _(t){!1===e.suppressDeprecationWarnings&&"undefined"!=typeof console&&console.warn&&console.warn("Deprecation warning: "+t)}function x(t,n){var i=!0;return c(function(){if(null!=e.deprecationHandler&&e.deprecationHandler(null,t),i){for(var r,a=[],s=0;s<arguments.length;s++){if(r="","object"==typeof arguments[s]){r+="\n["+s+"] ";for(var o in arguments[0])r+=o+": "+arguments[0][o]+", ";r=r.slice(0,-2)}else r=arguments[s];a.push(r)}_(t+"\nArguments: "+Array.prototype.slice.call(a).join("")+"\n"+(new Error).stack),i=!1}return n.apply(this,arguments)},n)}function S(t,n){null!=e.deprecationHandler&&e.deprecationHandler(t,n),Mt[t]||(_(n),Mt[t]=!0)}function E(e){return e instanceof Function||"[object Function]"===Object.prototype.toString.call(e)}function A(e,t){var i,r=c({},e);for(i in t)l(t,i)&&(n(e[i])&&n(t[i])?(r[i]={},c(r[i],e[i]),c(r[i],t[i])):null!=t[i]?r[i]=t[i]:delete r[i]);for(i in e)l(e,i)&&!l(t,i)&&n(e[i])&&(r[i]=c({},r[i]));return r}function k(e){null!=e&&this.set(e)}function C(e,t){var n=e.toLowerCase();jt[n]=jt[n+"s"]=jt[t]=e}function P(e){return"string"==typeof e?jt[e]||jt[e.toLowerCase()]:void 0}function M(e){var t,n,i={};for(n in e)l(e,n)&&(t=P(n))&&(i[t]=e[n]);return i}function O(e,t){Nt[e]=t}function T(e){var t=[];for(var n in e)t.push({unit:n,priority:Nt[n]});return t.sort(function(e,t){return e.priority-t.priority}),t}function R(e,t,n){var i=""+Math.abs(e),r=t-i.length;return(e>=0?n?"+":"":"-")+Math.pow(10,Math.max(0,r)).toString().substr(1)+i}function D(e,t,n,i){var r=i;"string"==typeof i&&(r=function(){return this[i]()}),e&&(Bt[e]=r),t&&(Bt[t[0]]=function(){return R(r.apply(this,arguments),t[1],t[2])}),n&&(Bt[n]=function(){return this.localeData().ordinal(r.apply(this,arguments),e)})}function I(e){return e.match(/\[[\s\S]/)?e.replace(/^\[|\]$/g,""):e.replace(/\\/g,"")}function j(e){var t,n,i=e.match(qt);for(t=0,n=i.length;t<n;t++)Bt[i[t]]?i[t]=Bt[i[t]]:i[t]=I(i[t]);return function(t){var r,a="";for(r=0;r<n;r++)a+=E(i[r])?i[r].call(t,e):i[r];return a}}function N(e,t){return e.isValid()?(t=q(t,e.localeData()),Ft[t]=Ft[t]||j(t),Ft[t](e)):e.localeData().invalidDate()}function q(e,t){var n=5;for(Lt.lastIndex=0;n>=0&&Lt.test(e);)e=e.replace(Lt,function(e){return t.longDateFormat(e)||e}),Lt.lastIndex=0,n-=1;return e}function L(e,t,n){an[e]=E(t)?t:function(e,i){return e&&n?n:t}}function F(e,t){return l(an,e)?an[e](t._strict,t._locale):new RegExp(B(e))}function B(e){return V(e.replace("\\","").replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(e,t,n,i,r){return t||n||i||r}))}function V(e){return e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function $(e,t){var n,i=t;for("string"==typeof e&&(e=[e]),a(t)&&(i=function(e,n){n[t]=y(e)}),n=0;n<e.length;n++)sn[e[n]]=i}function U(e,t){$(e,function(e,n,i,r){i._w=i._w||{},t(e,i._w,i,r)})}function H(e,t,n){null!=t&&l(sn,e)&&sn[e](t,n._a,n,e)}function z(e){return G(e)?366:365}function G(e){return e%4==0&&e%100!=0||e%400==0}function J(t,n){return function(i){return null!=i?(Q(this,t,i),e.updateOffset(this,n),this):W(this,t)}}function W(e,t){return e.isValid()?e._d["get"+(e._isUTC?"UTC":"")+t]():NaN}function Q(e,t,n){e.isValid()&&!isNaN(n)&&("FullYear"===t&&G(e.year())?e._d["set"+(e._isUTC?"UTC":"")+t](n,e.month(),K(n,e.month())):e._d["set"+(e._isUTC?"UTC":"")+t](n))}function Y(e,t){return(e%t+t)%t}function K(e,t){if(isNaN(e)||isNaN(t))return NaN;var n=Y(t,12);return e+=(t-n)/12,1===n?G(e)?29:28:31-n%7%2}function Z(e,t,n){var i,r,a,s=e.toLocaleLowerCase();if(!this._monthsParse)for(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[],i=0;i<12;++i)a=u([2e3,i]),this._shortMonthsParse[i]=this.monthsShort(a,"").toLocaleLowerCase(),this._longMonthsParse[i]=this.months(a,"").toLocaleLowerCase();return n?"MMM"===t?-1!==(r=mn.call(this._shortMonthsParse,s))?r:null:-1!==(r=mn.call(this._longMonthsParse,s))?r:null:"MMM"===t?-1!==(r=mn.call(this._shortMonthsParse,s))?r:-1!==(r=mn.call(this._longMonthsParse,s))?r:null:-1!==(r=mn.call(this._longMonthsParse,s))?r:-1!==(r=mn.call(this._shortMonthsParse,s))?r:null}function X(e,t){var n;if(!e.isValid())return e;if("string"==typeof t)if(/^\d+$/.test(t))t=y(t);else if(t=e.localeData().monthsParse(t),!a(t))return e;return n=Math.min(e.date(),K(e.year(),t)),e._d["set"+(e._isUTC?"UTC":"")+"Month"](t,n),e}function ee(t){return null!=t?(X(this,t),e.updateOffset(this,!0),this):W(this,"Month")}function te(){function e(e,t){return t.length-e.length}var t,n,i=[],r=[],a=[];for(t=0;t<12;t++)n=u([2e3,t]),i.push(this.monthsShort(n,"")),r.push(this.months(n,"")),a.push(this.months(n,"")),a.push(this.monthsShort(n,""));for(i.sort(e),r.sort(e),a.sort(e),t=0;t<12;t++)i[t]=V(i[t]),r[t]=V(r[t]);for(t=0;t<24;t++)a[t]=V(a[t]);this._monthsRegex=new RegExp("^("+a.join("|")+")","i"),this._monthsShortRegex=this._monthsRegex,this._monthsStrictRegex=new RegExp("^("+r.join("|")+")","i"),this._monthsShortStrictRegex=new RegExp("^("+i.join("|")+")","i")}function ne(e,t,n,i,r,a,s){var o=new Date(e,t,n,i,r,a,s);return e<100&&e>=0&&isFinite(o.getFullYear())&&o.setFullYear(e),o}function ie(e){var t=new Date(Date.UTC.apply(null,arguments));return e<100&&e>=0&&isFinite(t.getUTCFullYear())&&t.setUTCFullYear(e),t}function re(e,t,n){var i=7+t-n;return-((7+ie(e,0,i).getUTCDay()-t)%7)+i-1}function ae(e,t,n,i,r){var a,s,o=1+7*(t-1)+(7+n-i)%7+re(e,i,r);return o<=0?s=z(a=e-1)+o:o>z(e)?(a=e+1,s=o-z(e)):(a=e,s=o),{year:a,dayOfYear:s}}function se(e,t,n){var i,r,a=re(e.year(),t,n),s=Math.floor((e.dayOfYear()-a-1)/7)+1;return s<1?i=s+oe(r=e.year()-1,t,n):s>oe(e.year(),t,n)?(i=s-oe(e.year(),t,n),r=e.year()+1):(r=e.year(),i=s),{week:i,year:r}}function oe(e,t,n){var i=re(e,t,n),r=re(e+1,t,n);return(z(e)-i+r)/7}function le(e,t){return"string"!=typeof e?e:isNaN(e)?"number"==typeof(e=t.weekdaysParse(e))?e:null:parseInt(e,10)}function ce(e,t){return"string"==typeof e?t.weekdaysParse(e)%7||7:isNaN(e)?null:e}function ue(e,t,n){var i,r,a,s=e.toLocaleLowerCase();if(!this._weekdaysParse)for(this._weekdaysParse=[],this._shortWeekdaysParse=[],this._minWeekdaysParse=[],i=0;i<7;++i)a=u([2e3,1]).day(i),this._minWeekdaysParse[i]=this.weekdaysMin(a,"").toLocaleLowerCase(),this._shortWeekdaysParse[i]=this.weekdaysShort(a,"").toLocaleLowerCase(),this._weekdaysParse[i]=this.weekdays(a,"").toLocaleLowerCase();return n?"dddd"===t?-1!==(r=mn.call(this._weekdaysParse,s))?r:null:"ddd"===t?-1!==(r=mn.call(this._shortWeekdaysParse,s))?r:null:-1!==(r=mn.call(this._minWeekdaysParse,s))?r:null:"dddd"===t?-1!==(r=mn.call(this._weekdaysParse,s))?r:-1!==(r=mn.call(this._shortWeekdaysParse,s))?r:-1!==(r=mn.call(this._minWeekdaysParse,s))?r:null:"ddd"===t?-1!==(r=mn.call(this._shortWeekdaysParse,s))?r:-1!==(r=mn.call(this._weekdaysParse,s))?r:-1!==(r=mn.call(this._minWeekdaysParse,s))?r:null:-1!==(r=mn.call(this._minWeekdaysParse,s))?r:-1!==(r=mn.call(this._weekdaysParse,s))?r:-1!==(r=mn.call(this._shortWeekdaysParse,s))?r:null}function de(){function e(e,t){return t.length-e.length}var t,n,i,r,a,s=[],o=[],l=[],c=[];for(t=0;t<7;t++)n=u([2e3,1]).day(t),i=this.weekdaysMin(n,""),r=this.weekdaysShort(n,""),a=this.weekdays(n,""),s.push(i),o.push(r),l.push(a),c.push(i),c.push(r),c.push(a);for(s.sort(e),o.sort(e),l.sort(e),c.sort(e),t=0;t<7;t++)o[t]=V(o[t]),l[t]=V(l[t]),c[t]=V(c[t]);this._weekdaysRegex=new RegExp("^("+c.join("|")+")","i"),this._weekdaysShortRegex=this._weekdaysRegex,this._weekdaysMinRegex=this._weekdaysRegex,this._weekdaysStrictRegex=new RegExp("^("+l.join("|")+")","i"),this._weekdaysShortStrictRegex=new RegExp("^("+o.join("|")+")","i"),this._weekdaysMinStrictRegex=new RegExp("^("+s.join("|")+")","i")}function he(){return this.hours()%12||12}function pe(e,t){D(e,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),t)})}function fe(e,t){return t._meridiemParse}function ge(e){return e?e.toLowerCase().replace("_","-"):e}function me(e){for(var t,n,i,r,a=0;a<e.length;){for(t=(r=ge(e[a]).split("-")).length,n=(n=ge(e[a+1]))?n.split("-"):null;t>0;){if(i=be(r.slice(0,t).join("-")))return i;if(n&&n.length>=t&&w(r,n,!0)>=t-1)break;t--}a++}return null}function be(e){var t=null;if(!In[e]&&"undefined"!=typeof module&&module&&module.exports)try{t=On._abbr,require("./locale/"+e),ve(t)}catch(e){}return In[e]}function ve(e,t){var n;return e&&(n=r(t)?we(e):ye(e,t))&&(On=n),On._abbr}function ye(e,t){if(null!==t){var n=Dn;if(t.abbr=e,null!=In[e])S("defineLocaleOverride","use moment.updateLocale(localeName, config) to change an existing locale. moment.defineLocale(localeName, config) should only be used for creating a new locale See http://momentjs.com/guides/#/warnings/define-locale/ for more info."),n=In[e]._config;else if(null!=t.parentLocale){if(null==In[t.parentLocale])return jn[t.parentLocale]||(jn[t.parentLocale]=[]),jn[t.parentLocale].push({name:e,config:t}),null;n=In[t.parentLocale]._config}return In[e]=new k(A(n,t)),jn[e]&&jn[e].forEach(function(e){ye(e.name,e.config)}),ve(e),In[e]}return delete In[e],null}function we(e){var n;if(e&&e._locale&&e._locale._abbr&&(e=e._locale._abbr),!e)return On;if(!t(e)){if(n=be(e))return n;e=[e]}return me(e)}function _e(e){var t,n=e._a;return n&&-2===h(e).overflow&&(t=n[ln]<0||n[ln]>11?ln:n[cn]<1||n[cn]>K(n[on],n[ln])?cn:n[un]<0||n[un]>24||24===n[un]&&(0!==n[dn]||0!==n[hn]||0!==n[pn])?un:n[dn]<0||n[dn]>59?dn:n[hn]<0||n[hn]>59?hn:n[pn]<0||n[pn]>999?pn:-1,h(e)._overflowDayOfYear&&(t<on||t>cn)&&(t=cn),h(e)._overflowWeeks&&-1===t&&(t=fn),h(e)._overflowWeekday&&-1===t&&(t=gn),h(e).overflow=t),e}function xe(e,t,n){return null!=e?e:null!=t?t:n}function Se(t){var n=new Date(e.now());return t._useUTC?[n.getUTCFullYear(),n.getUTCMonth(),n.getUTCDate()]:[n.getFullYear(),n.getMonth(),n.getDate()]}function Ee(e){var t,n,i,r,a=[];if(!e._d){for(i=Se(e),e._w&&null==e._a[cn]&&null==e._a[ln]&&Ae(e),null!=e._dayOfYear&&(r=xe(e._a[on],i[on]),(e._dayOfYear>z(r)||0===e._dayOfYear)&&(h(e)._overflowDayOfYear=!0),n=ie(r,0,e._dayOfYear),e._a[ln]=n.getUTCMonth(),e._a[cn]=n.getUTCDate()),t=0;t<3&&null==e._a[t];++t)e._a[t]=a[t]=i[t];for(;t<7;t++)e._a[t]=a[t]=null==e._a[t]?2===t?1:0:e._a[t];24===e._a[un]&&0===e._a[dn]&&0===e._a[hn]&&0===e._a[pn]&&(e._nextDay=!0,e._a[un]=0),e._d=(e._useUTC?ie:ne).apply(null,a),null!=e._tzm&&e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),e._nextDay&&(e._a[un]=24),e._w&&void 0!==e._w.d&&e._w.d!==e._d.getDay()&&(h(e).weekdayMismatch=!0)}}function Ae(e){var t,n,i,r,a,s,o,l;if(null!=(t=e._w).GG||null!=t.W||null!=t.E)a=1,s=4,n=xe(t.GG,e._a[on],se($e(),1,4).year),i=xe(t.W,1),((r=xe(t.E,1))<1||r>7)&&(l=!0);else{a=e._locale._week.dow,s=e._locale._week.doy;var c=se($e(),a,s);n=xe(t.gg,e._a[on],c.year),i=xe(t.w,c.week),null!=t.d?((r=t.d)<0||r>6)&&(l=!0):null!=t.e?(r=t.e+a,(t.e<0||t.e>6)&&(l=!0)):r=a}i<1||i>oe(n,a,s)?h(e)._overflowWeeks=!0:null!=l?h(e)._overflowWeekday=!0:(o=ae(n,i,r,a,s),e._a[on]=o.year,e._dayOfYear=o.dayOfYear)}function ke(e){var t,n,i,r,a,s,o=e._i,l=Nn.exec(o)||qn.exec(o);if(l){for(h(e).iso=!0,t=0,n=Fn.length;t<n;t++)if(Fn[t][1].exec(l[1])){r=Fn[t][0],i=!1!==Fn[t][2];break}if(null==r)return void(e._isValid=!1);if(l[3]){for(t=0,n=Bn.length;t<n;t++)if(Bn[t][1].exec(l[3])){a=(l[2]||" ")+Bn[t][0];break}if(null==a)return void(e._isValid=!1)}if(!i&&null!=a)return void(e._isValid=!1);if(l[4]){if(!Ln.exec(l[4]))return void(e._isValid=!1);s="Z"}e._f=r+(a||"")+(s||""),Ie(e)}else e._isValid=!1}function Ce(e,t,n,i,r,a){var s=[Pe(e),wn.indexOf(t),parseInt(n,10),parseInt(i,10),parseInt(r,10)];return a&&s.push(parseInt(a,10)),s}function Pe(e){var t=parseInt(e,10);return t<=49?2e3+t:t<=999?1900+t:t}function Me(e){return e.replace(/\([^)]*\)|[\n\t]/g," ").replace(/(\s\s+)/g," ").trim()}function Oe(e,t,n){return!e||An.indexOf(e)===new Date(t[0],t[1],t[2]).getDay()||(h(n).weekdayMismatch=!0,n._isValid=!1,!1)}function Te(e,t,n){if(e)return Un[e];if(t)return 0;var i=parseInt(n,10),r=i%100;return 60*((i-r)/100)+r}function Re(e){var t=$n.exec(Me(e._i));if(t){var n=Ce(t[4],t[3],t[2],t[5],t[6],t[7]);if(!Oe(t[1],n,e))return;e._a=n,e._tzm=Te(t[8],t[9],t[10]),e._d=ie.apply(null,e._a),e._d.setUTCMinutes(e._d.getUTCMinutes()-e._tzm),h(e).rfc2822=!0}else e._isValid=!1}function De(t){var n=Vn.exec(t._i);null===n?(ke(t),!1===t._isValid&&(delete t._isValid,Re(t),!1===t._isValid&&(delete t._isValid,e.createFromInputFallback(t)))):t._d=new Date(+n[1])}function Ie(t){if(t._f!==e.ISO_8601)if(t._f!==e.RFC_2822){t._a=[],h(t).empty=!0;var n,i,r,a,s,o=""+t._i,l=o.length,c=0;for(r=q(t._f,t._locale).match(qt)||[],n=0;n<r.length;n++)a=r[n],(i=(o.match(F(a,t))||[])[0])&&((s=o.substr(0,o.indexOf(i))).length>0&&h(t).unusedInput.push(s),o=o.slice(o.indexOf(i)+i.length),c+=i.length),Bt[a]?(i?h(t).empty=!1:h(t).unusedTokens.push(a),H(a,i,t)):t._strict&&!i&&h(t).unusedTokens.push(a);h(t).charsLeftOver=l-c,o.length>0&&h(t).unusedInput.push(o),t._a[un]<=12&&!0===h(t).bigHour&&t._a[un]>0&&(h(t).bigHour=void 0),h(t).parsedDateParts=t._a.slice(0),h(t).meridiem=t._meridiem,t._a[un]=je(t._locale,t._a[un],t._meridiem),Ee(t),_e(t)}else Re(t);else ke(t)}function je(e,t,n){var i;return null==n?t:null!=e.meridiemHour?e.meridiemHour(t,n):null!=e.isPM?((i=e.isPM(n))&&t<12&&(t+=12),i||12!==t||(t=0),t):t}function Ne(e){var t,n,i,r,a;if(0===e._f.length)return h(e).invalidFormat=!0,void(e._d=new Date(NaN));for(r=0;r<e._f.length;r++)a=0,t=g({},e),null!=e._useUTC&&(t._useUTC=e._useUTC),t._f=e._f[r],Ie(t),p(t)&&(a+=h(t).charsLeftOver,a+=10*h(t).unusedTokens.length,h(t).score=a,(null==i||a<i)&&(i=a,n=t));c(e,n||t)}function qe(e){if(!e._d){var t=M(e._i);e._a=o([t.year,t.month,t.day||t.date,t.hour,t.minute,t.second,t.millisecond],function(e){return e&&parseInt(e,10)}),Ee(e)}}function Le(e){var t=new m(_e(Fe(e)));return t._nextDay&&(t.add(1,"d"),t._nextDay=void 0),t}function Fe(e){var n=e._i,i=e._f;return e._locale=e._locale||we(e._l),null===n||void 0===i&&""===n?f({nullInput:!0}):("string"==typeof n&&(e._i=n=e._locale.preparse(n)),b(n)?new m(_e(n)):(s(n)?e._d=n:t(i)?Ne(e):i?Ie(e):Be(e),p(e)||(e._d=null),e))}function Be(i){var l=i._i;r(l)?i._d=new Date(e.now()):s(l)?i._d=new Date(l.valueOf()):"string"==typeof l?De(i):t(l)?(i._a=o(l.slice(0),function(e){return parseInt(e,10)}),Ee(i)):n(l)?qe(i):a(l)?i._d=new Date(l):e.createFromInputFallback(i)}function Ve(e,r,a,s,o){var l={};return!0!==a&&!1!==a||(s=a,a=void 0),(n(e)&&i(e)||t(e)&&0===e.length)&&(e=void 0),l._isAMomentObject=!0,l._useUTC=l._isUTC=o,l._l=a,l._i=e,l._f=r,l._strict=s,Le(l)}function $e(e,t,n,i){return Ve(e,t,n,i,!1)}function Ue(e,n){var i,r;if(1===n.length&&t(n[0])&&(n=n[0]),!n.length)return $e();for(i=n[0],r=1;r<n.length;++r)n[r].isValid()&&!n[r][e](i)||(i=n[r]);return i}function He(e){for(var t in e)if(-1===mn.call(Gn,t)||null!=e[t]&&isNaN(e[t]))return!1;for(var n=!1,i=0;i<Gn.length;++i)if(e[Gn[i]]){if(n)return!1;parseFloat(e[Gn[i]])!==y(e[Gn[i]])&&(n=!0)}return!0}function ze(e){var t=M(e),n=t.year||0,i=t.quarter||0,r=t.month||0,a=t.week||0,s=t.day||0,o=t.hour||0,l=t.minute||0,c=t.second||0,u=t.millisecond||0;this._isValid=He(t),this._milliseconds=+u+1e3*c+6e4*l+1e3*o*60*60,this._days=+s+7*a,this._months=+r+3*i+12*n,this._data={},this._locale=we(),this._bubble()}function Ge(e){return e instanceof ze}function Je(e){return e<0?-1*Math.round(-1*e):Math.round(e)}function We(e,t){D(e,0,0,function(){var e=this.utcOffset(),n="+";return e<0&&(e=-e,n="-"),n+R(~~(e/60),2)+t+R(~~e%60,2)})}function Qe(e,t){var n=(t||"").match(e);if(null===n)return null;var i=((n[n.length-1]||[])+"").match(Jn)||["-",0,0],r=60*i[1]+y(i[2]);return 0===r?0:"+"===i[0]?r:-r}function Ye(t,n){var i,r;return n._isUTC?(i=n.clone(),r=(b(t)||s(t)?t.valueOf():$e(t).valueOf())-i.valueOf(),i._d.setTime(i._d.valueOf()+r),e.updateOffset(i,!1),i):$e(t).local()}function Ke(e){return 15*-Math.round(e._d.getTimezoneOffset()/15)}function Ze(){return!!this.isValid()&&(this._isUTC&&0===this._offset)}function Xe(e,t){var n,i,r,s=e,o=null;return Ge(e)?s={ms:e._milliseconds,d:e._days,M:e._months}:a(e)?(s={},t?s[t]=e:s.milliseconds=e):(o=Wn.exec(e))?(n="-"===o[1]?-1:1,s={y:0,d:y(o[cn])*n,h:y(o[un])*n,m:y(o[dn])*n,s:y(o[hn])*n,ms:y(Je(1e3*o[pn]))*n}):(o=Qn.exec(e))?(n="-"===o[1]?-1:(o[1],1),s={y:et(o[2],n),M:et(o[3],n),w:et(o[4],n),d:et(o[5],n),h:et(o[6],n),m:et(o[7],n),s:et(o[8],n)}):null==s?s={}:"object"==typeof s&&("from"in s||"to"in s)&&(r=nt($e(s.from),$e(s.to)),(s={}).ms=r.milliseconds,s.M=r.months),i=new ze(s),Ge(e)&&l(e,"_locale")&&(i._locale=e._locale),i}function et(e,t){var n=e&&parseFloat(e.replace(",","."));return(isNaN(n)?0:n)*t}function tt(e,t){var n={milliseconds:0,months:0};return n.months=t.month()-e.month()+12*(t.year()-e.year()),e.clone().add(n.months,"M").isAfter(t)&&--n.months,n.milliseconds=+t-+e.clone().add(n.months,"M"),n}function nt(e,t){var n;return e.isValid()&&t.isValid()?(t=Ye(t,e),e.isBefore(t)?n=tt(e,t):((n=tt(t,e)).milliseconds=-n.milliseconds,n.months=-n.months),n):{milliseconds:0,months:0}}function it(e,t){return function(n,i){var r,a;return null===i||isNaN(+i)||(S(t,"moment()."+t+"(period, number) is deprecated. Please use moment()."+t+"(number, period). See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info."),a=n,n=i,i=a),n="string"==typeof n?+n:n,r=Xe(n,i),rt(this,r,e),this}}function rt(t,n,i,r){var a=n._milliseconds,s=Je(n._days),o=Je(n._months);t.isValid()&&(r=null==r||r,o&&X(t,W(t,"Month")+o*i),s&&Q(t,"Date",W(t,"Date")+s*i),a&&t._d.setTime(t._d.valueOf()+a*i),r&&e.updateOffset(t,s||o))}function at(e,t){var n,i=12*(t.year()-e.year())+(t.month()-e.month()),r=e.clone().add(i,"months");return n=t-r<0?(t-r)/(r-e.clone().add(i-1,"months")):(t-r)/(e.clone().add(i+1,"months")-r),-(i+n)||0}function st(e){var t;return void 0===e?this._locale._abbr:(null!=(t=we(e))&&(this._locale=t),this)}function ot(){return this._locale}function lt(e,t){D(0,[e,e.length],0,t)}function ct(e,t,n,i,r){var a;return null==e?se(this,i,r).year:(a=oe(e,i,r),t>a&&(t=a),ut.call(this,e,t,n,i,r))}function ut(e,t,n,i,r){var a=ae(e,t,n,i,r),s=ie(a.year,0,a.dayOfYear);return this.year(s.getUTCFullYear()),this.month(s.getUTCMonth()),this.date(s.getUTCDate()),this}function dt(e){return e}function ht(e,t,n,i){var r=we(),a=u().set(i,t);return r[n](a,e)}function pt(e,t,n){if(a(e)&&(t=e,e=void 0),e=e||"",null!=t)return ht(e,t,n,"month");var i,r=[];for(i=0;i<12;i++)r[i]=ht(e,i,n,"month");return r}function ft(e,t,n,i){"boolean"==typeof e?(a(t)&&(n=t,t=void 0),t=t||""):(n=t=e,e=!1,a(t)&&(n=t,t=void 0),t=t||"");var r=we(),s=e?r._week.dow:0;if(null!=n)return ht(t,(n+s)%7,i,"day");var o,l=[];for(o=0;o<7;o++)l[o]=ht(t,(o+s)%7,i,"day");return l}function gt(e,t,n,i){var r=Xe(t,n);return e._milliseconds+=i*r._milliseconds,e._days+=i*r._days,e._months+=i*r._months,e._bubble()}function mt(e){return e<0?Math.floor(e):Math.ceil(e)}function bt(e){return 4800*e/146097}function vt(e){return 146097*e/4800}function yt(e){return function(){return this.as(e)}}function wt(e){return function(){return this.isValid()?this._data[e]:NaN}}function _t(e,t,n,i,r){return r.relativeTime(t||1,!!n,e,i)}function xt(e,t,n){var i=Xe(e).abs(),r=xi(i.as("s")),a=xi(i.as("m")),s=xi(i.as("h")),o=xi(i.as("d")),l=xi(i.as("M")),c=xi(i.as("y")),u=r<=Si.ss&&["s",r]||r<Si.s&&["ss",r]||a<=1&&["m"]||a<Si.m&&["mm",a]||s<=1&&["h"]||s<Si.h&&["hh",s]||o<=1&&["d"]||o<Si.d&&["dd",o]||l<=1&&["M"]||l<Si.M&&["MM",l]||c<=1&&["y"]||["yy",c];return u[2]=t,u[3]=+e>0,u[4]=n,_t.apply(null,u)}function St(e){return(e>0)-(e<0)||+e}function Et(){if(!this.isValid())return this.localeData().invalidDate();var e,t,n,i=Ei(this._milliseconds)/1e3,r=Ei(this._days),a=Ei(this._months);t=v((e=v(i/60))/60),i%=60,e%=60;var s=n=v(a/12),o=a%=12,l=r,c=t,u=e,d=i?i.toFixed(3).replace(/\.?0+$/,""):"",h=this.asSeconds();if(!h)return"P0D";var p=h<0?"-":"",f=St(this._months)!==St(h)?"-":"",g=St(this._days)!==St(h)?"-":"",m=St(this._milliseconds)!==St(h)?"-":"";return p+"P"+(s?f+s+"Y":"")+(o?f+o+"M":"")+(l?g+l+"D":"")+(c||u||d?"T":"")+(c?m+c+"H":"")+(u?m+u+"M":"")+(d?m+d+"S":"")}var At,kt;kt=Array.prototype.some?Array.prototype.some:function(e){for(var t=Object(this),n=t.length>>>0,i=0;i<n;i++)if(i in t&&e.call(this,t[i],i,t))return!0;return!1};var Ct=e.momentProperties=[],Pt=!1,Mt={};e.suppressDeprecationWarnings=!1,e.deprecationHandler=null;var Ot;Ot=Object.keys?Object.keys:function(e){var t,n=[];for(t in e)l(e,t)&&n.push(t);return n};var Tt={sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},Rt={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"},Dt=/\d{1,2}/,It={future:"in %s",past:"%s ago",s:"a few seconds",ss:"%d seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},jt={},Nt={},qt=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g,Lt=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g,Ft={},Bt={},Vt=/\d/,$t=/\d\d/,Ut=/\d{3}/,Ht=/\d{4}/,zt=/[+-]?\d{6}/,Gt=/\d\d?/,Jt=/\d\d\d\d?/,Wt=/\d\d\d\d\d\d?/,Qt=/\d{1,3}/,Yt=/\d{1,4}/,Kt=/[+-]?\d{1,6}/,Zt=/\d+/,Xt=/[+-]?\d+/,en=/Z|[+-]\d\d:?\d\d/gi,tn=/Z|[+-]\d\d(?::?\d\d)?/gi,nn=/[+-]?\d+(\.\d{1,3})?/,rn=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,an={},sn={},on=0,ln=1,cn=2,un=3,dn=4,hn=5,pn=6,fn=7,gn=8;D("Y",0,0,function(){var e=this.year();return e<=9999?""+e:"+"+e}),D(0,["YY",2],0,function(){return this.year()%100}),D(0,["YYYY",4],0,"year"),D(0,["YYYYY",5],0,"year"),D(0,["YYYYYY",6,!0],0,"year"),C("year","y"),O("year",1),L("Y",Xt),L("YY",Gt,$t),L("YYYY",Yt,Ht),L("YYYYY",Kt,zt),L("YYYYYY",Kt,zt),$(["YYYYY","YYYYYY"],on),$("YYYY",function(t,n){n[on]=2===t.length?e.parseTwoDigitYear(t):y(t)}),$("YY",function(t,n){n[on]=e.parseTwoDigitYear(t)}),$("Y",function(e,t){t[on]=parseInt(e,10)}),e.parseTwoDigitYear=function(e){return y(e)+(y(e)>68?1900:2e3)};var mn,bn=J("FullYear",!0);mn=Array.prototype.indexOf?Array.prototype.indexOf:function(e){var t;for(t=0;t<this.length;++t)if(this[t]===e)return t;return-1},D("M",["MM",2],"Mo",function(){return this.month()+1}),D("MMM",0,0,function(e){return this.localeData().monthsShort(this,e)}),D("MMMM",0,0,function(e){return this.localeData().months(this,e)}),C("month","M"),O("month",8),L("M",Gt),L("MM",Gt,$t),L("MMM",function(e,t){return t.monthsShortRegex(e)}),L("MMMM",function(e,t){return t.monthsRegex(e)}),$(["M","MM"],function(e,t){t[ln]=y(e)-1}),$(["MMM","MMMM"],function(e,t,n,i){var r=n._locale.monthsParse(e,i,n._strict);null!=r?t[ln]=r:h(n).invalidMonth=e});var vn=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/,yn="January_February_March_April_May_June_July_August_September_October_November_December".split("_"),wn="Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),_n=rn,xn=rn;D("w",["ww",2],"wo","week"),D("W",["WW",2],"Wo","isoWeek"),C("week","w"),C("isoWeek","W"),O("week",5),O("isoWeek",5),L("w",Gt),L("ww",Gt,$t),L("W",Gt),L("WW",Gt,$t),U(["w","ww","W","WW"],function(e,t,n,i){t[i.substr(0,1)]=y(e)});var Sn={dow:0,doy:6};D("d",0,"do","day"),D("dd",0,0,function(e){return this.localeData().weekdaysMin(this,e)}),D("ddd",0,0,function(e){return this.localeData().weekdaysShort(this,e)}),D("dddd",0,0,function(e){return this.localeData().weekdays(this,e)}),D("e",0,0,"weekday"),D("E",0,0,"isoWeekday"),C("day","d"),C("weekday","e"),C("isoWeekday","E"),O("day",11),O("weekday",11),O("isoWeekday",11),L("d",Gt),L("e",Gt),L("E",Gt),L("dd",function(e,t){return t.weekdaysMinRegex(e)}),L("ddd",function(e,t){return t.weekdaysShortRegex(e)}),L("dddd",function(e,t){return t.weekdaysRegex(e)}),U(["dd","ddd","dddd"],function(e,t,n,i){var r=n._locale.weekdaysParse(e,i,n._strict);null!=r?t.d=r:h(n).invalidWeekday=e}),U(["d","e","E"],function(e,t,n,i){t[i]=y(e)});var En="Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),An="Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),kn="Su_Mo_Tu_We_Th_Fr_Sa".split("_"),Cn=rn,Pn=rn,Mn=rn;D("H",["HH",2],0,"hour"),D("h",["hh",2],0,he),D("k",["kk",2],0,function(){return this.hours()||24}),D("hmm",0,0,function(){return""+he.apply(this)+R(this.minutes(),2)}),D("hmmss",0,0,function(){return""+he.apply(this)+R(this.minutes(),2)+R(this.seconds(),2)}),D("Hmm",0,0,function(){return""+this.hours()+R(this.minutes(),2)}),D("Hmmss",0,0,function(){return""+this.hours()+R(this.minutes(),2)+R(this.seconds(),2)}),pe("a",!0),pe("A",!1),C("hour","h"),O("hour",13),L("a",fe),L("A",fe),L("H",Gt),L("h",Gt),L("k",Gt),L("HH",Gt,$t),L("hh",Gt,$t),L("kk",Gt,$t),L("hmm",Jt),L("hmmss",Wt),L("Hmm",Jt),L("Hmmss",Wt),$(["H","HH"],un),$(["k","kk"],function(e,t,n){var i=y(e);t[un]=24===i?0:i}),$(["a","A"],function(e,t,n){n._isPm=n._locale.isPM(e),n._meridiem=e}),$(["h","hh"],function(e,t,n){t[un]=y(e),h(n).bigHour=!0}),$("hmm",function(e,t,n){var i=e.length-2;t[un]=y(e.substr(0,i)),t[dn]=y(e.substr(i)),h(n).bigHour=!0}),$("hmmss",function(e,t,n){var i=e.length-4,r=e.length-2;t[un]=y(e.substr(0,i)),t[dn]=y(e.substr(i,2)),t[hn]=y(e.substr(r)),h(n).bigHour=!0}),$("Hmm",function(e,t,n){var i=e.length-2;t[un]=y(e.substr(0,i)),t[dn]=y(e.substr(i))}),$("Hmmss",function(e,t,n){var i=e.length-4,r=e.length-2;t[un]=y(e.substr(0,i)),t[dn]=y(e.substr(i,2)),t[hn]=y(e.substr(r))});var On,Tn=/[ap]\.?m?\.?/i,Rn=J("Hours",!0),Dn={calendar:Tt,longDateFormat:Rt,invalidDate:"Invalid date",ordinal:"%d",dayOfMonthOrdinalParse:Dt,relativeTime:It,months:yn,monthsShort:wn,week:Sn,weekdays:En,weekdaysMin:kn,weekdaysShort:An,meridiemParse:Tn},In={},jn={},Nn=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,qn=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/,Ln=/Z|[+-]\d\d(?::?\d\d)?/,Fn=[["YYYYYY-MM-DD",/[+-]\d{6}-\d\d-\d\d/],["YYYY-MM-DD",/\d{4}-\d\d-\d\d/],["GGGG-[W]WW-E",/\d{4}-W\d\d-\d/],["GGGG-[W]WW",/\d{4}-W\d\d/,!1],["YYYY-DDD",/\d{4}-\d{3}/],["YYYY-MM",/\d{4}-\d\d/,!1],["YYYYYYMMDD",/[+-]\d{10}/],["YYYYMMDD",/\d{8}/],["GGGG[W]WWE",/\d{4}W\d{3}/],["GGGG[W]WW",/\d{4}W\d{2}/,!1],["YYYYDDD",/\d{7}/]],Bn=[["HH:mm:ss.SSSS",/\d\d:\d\d:\d\d\.\d+/],["HH:mm:ss,SSSS",/\d\d:\d\d:\d\d,\d+/],["HH:mm:ss",/\d\d:\d\d:\d\d/],["HH:mm",/\d\d:\d\d/],["HHmmss.SSSS",/\d\d\d\d\d\d\.\d+/],["HHmmss,SSSS",/\d\d\d\d\d\d,\d+/],["HHmmss",/\d\d\d\d\d\d/],["HHmm",/\d\d\d\d/],["HH",/\d\d/]],Vn=/^\/?Date\((\-?\d+)/i,$n=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/,Un={UT:0,GMT:0,EDT:-240,EST:-300,CDT:-300,CST:-360,MDT:-360,MST:-420,PDT:-420,PST:-480};e.createFromInputFallback=x("value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are discouraged and will be removed in an upcoming major release. Please refer to http://momentjs.com/guides/#/warnings/js-date/ for more info.",function(e){e._d=new Date(e._i+(e._useUTC?" UTC":""))}),e.ISO_8601=function(){},e.RFC_2822=function(){};var Hn=x("moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=$e.apply(null,arguments);return this.isValid()&&e.isValid()?e<this?this:e:f()}),zn=x("moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/",function(){var e=$e.apply(null,arguments);return this.isValid()&&e.isValid()?e>this?this:e:f()}),Gn=["year","quarter","month","week","day","hour","minute","second","millisecond"];We("Z",":"),We("ZZ",""),L("Z",tn),L("ZZ",tn),$(["Z","ZZ"],function(e,t,n){n._useUTC=!0,n._tzm=Qe(tn,e)});var Jn=/([\+\-]|\d\d)/gi;e.updateOffset=function(){};var Wn=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/,Qn=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;Xe.fn=ze.prototype,Xe.invalid=function(){return Xe(NaN)};var Yn=it(1,"add"),Kn=it(-1,"subtract");e.defaultFormat="YYYY-MM-DDTHH:mm:ssZ",e.defaultFormatUtc="YYYY-MM-DDTHH:mm:ss[Z]";var Zn=x("moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.",function(e){return void 0===e?this.localeData():this.locale(e)});D(0,["gg",2],0,function(){return this.weekYear()%100}),D(0,["GG",2],0,function(){return this.isoWeekYear()%100}),lt("gggg","weekYear"),lt("ggggg","weekYear"),lt("GGGG","isoWeekYear"),lt("GGGGG","isoWeekYear"),C("weekYear","gg"),C("isoWeekYear","GG"),O("weekYear",1),O("isoWeekYear",1),L("G",Xt),L("g",Xt),L("GG",Gt,$t),L("gg",Gt,$t),L("GGGG",Yt,Ht),L("gggg",Yt,Ht),L("GGGGG",Kt,zt),L("ggggg",Kt,zt),U(["gggg","ggggg","GGGG","GGGGG"],function(e,t,n,i){t[i.substr(0,2)]=y(e)}),U(["gg","GG"],function(t,n,i,r){n[r]=e.parseTwoDigitYear(t)}),D("Q",0,"Qo","quarter"),C("quarter","Q"),O("quarter",7),L("Q",Vt),$("Q",function(e,t){t[ln]=3*(y(e)-1)}),D("D",["DD",2],"Do","date"),C("date","D"),O("date",9),L("D",Gt),L("DD",Gt,$t),L("Do",function(e,t){return e?t._dayOfMonthOrdinalParse||t._ordinalParse:t._dayOfMonthOrdinalParseLenient}),$(["D","DD"],cn),$("Do",function(e,t){t[cn]=y(e.match(Gt)[0],10)});var Xn=J("Date",!0);D("DDD",["DDDD",3],"DDDo","dayOfYear"),C("dayOfYear","DDD"),O("dayOfYear",4),L("DDD",Qt),L("DDDD",Ut),$(["DDD","DDDD"],function(e,t,n){n._dayOfYear=y(e)}),D("m",["mm",2],0,"minute"),C("minute","m"),O("minute",14),L("m",Gt),L("mm",Gt,$t),$(["m","mm"],dn);var ei=J("Minutes",!1);D("s",["ss",2],0,"second"),C("second","s"),O("second",15),L("s",Gt),L("ss",Gt,$t),$(["s","ss"],hn);var ti=J("Seconds",!1);D("S",0,0,function(){return~~(this.millisecond()/100)}),D(0,["SS",2],0,function(){return~~(this.millisecond()/10)}),D(0,["SSS",3],0,"millisecond"),D(0,["SSSS",4],0,function(){return 10*this.millisecond()}),D(0,["SSSSS",5],0,function(){return 100*this.millisecond()}),D(0,["SSSSSS",6],0,function(){return 1e3*this.millisecond()}),D(0,["SSSSSSS",7],0,function(){return 1e4*this.millisecond()}),D(0,["SSSSSSSS",8],0,function(){return 1e5*this.millisecond()}),D(0,["SSSSSSSSS",9],0,function(){return 1e6*this.millisecond()}),C("millisecond","ms"),O("millisecond",16),L("S",Qt,Vt),L("SS",Qt,$t),L("SSS",Qt,Ut);var ni;for(ni="SSSS";ni.length<=9;ni+="S")L(ni,Zt);for(ni="S";ni.length<=9;ni+="S")$(ni,function(e,t){t[pn]=y(1e3*("0."+e))});var ii=J("Milliseconds",!1);D("z",0,0,"zoneAbbr"),D("zz",0,0,"zoneName");var ri=m.prototype;ri.add=Yn,ri.calendar=function(t,n){var i=t||$e(),r=Ye(i,this).startOf("day"),a=e.calendarFormat(this,r)||"sameElse",s=n&&(E(n[a])?n[a].call(this,i):n[a]);return this.format(s||this.localeData().calendar(a,this,$e(i)))},ri.clone=function(){return new m(this)},ri.diff=function(e,t,n){var i,r,a;if(!this.isValid())return NaN;if(!(i=Ye(e,this)).isValid())return NaN;switch(r=6e4*(i.utcOffset()-this.utcOffset()),t=P(t)){case"year":a=at(this,i)/12;break;case"month":a=at(this,i);break;case"quarter":a=at(this,i)/3;break;case"second":a=(this-i)/1e3;break;case"minute":a=(this-i)/6e4;break;case"hour":a=(this-i)/36e5;break;case"day":a=(this-i-r)/864e5;break;case"week":a=(this-i-r)/6048e5;break;default:a=this-i}return n?a:v(a)},ri.endOf=function(e){return void 0===(e=P(e))||"millisecond"===e?this:("date"===e&&(e="day"),this.startOf(e).add(1,"isoWeek"===e?"week":e).subtract(1,"ms"))},ri.format=function(t){t||(t=this.isUtc()?e.defaultFormatUtc:e.defaultFormat);var n=N(this,t);return this.localeData().postformat(n)},ri.from=function(e,t){return this.isValid()&&(b(e)&&e.isValid()||$e(e).isValid())?Xe({to:this,from:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ri.fromNow=function(e){return this.from($e(),e)},ri.to=function(e,t){return this.isValid()&&(b(e)&&e.isValid()||$e(e).isValid())?Xe({from:this,to:e}).locale(this.locale()).humanize(!t):this.localeData().invalidDate()},ri.toNow=function(e){return this.to($e(),e)},ri.get=function(e){return e=P(e),E(this[e])?this[e]():this},ri.invalidAt=function(){return h(this).overflow},ri.isAfter=function(e,t){var n=b(e)?e:$e(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=P(r(t)?"millisecond":t))?this.valueOf()>n.valueOf():n.valueOf()<this.clone().startOf(t).valueOf())},ri.isBefore=function(e,t){var n=b(e)?e:$e(e);return!(!this.isValid()||!n.isValid())&&("millisecond"===(t=P(r(t)?"millisecond":t))?this.valueOf()<n.valueOf():this.clone().endOf(t).valueOf()<n.valueOf())},ri.isBetween=function(e,t,n,i){return("("===(i=i||"()")[0]?this.isAfter(e,n):!this.isBefore(e,n))&&(")"===i[1]?this.isBefore(t,n):!this.isAfter(t,n))},ri.isSame=function(e,t){var n,i=b(e)?e:$e(e);return!(!this.isValid()||!i.isValid())&&("millisecond"===(t=P(t||"millisecond"))?this.valueOf()===i.valueOf():(n=i.valueOf(),this.clone().startOf(t).valueOf()<=n&&n<=this.clone().endOf(t).valueOf()))},ri.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)},ri.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)},ri.isValid=function(){return p(this)},ri.lang=Zn,ri.locale=st,ri.localeData=ot,ri.max=zn,ri.min=Hn,ri.parsingFlags=function(){return c({},h(this))},ri.set=function(e,t){if("object"==typeof e)for(var n=T(e=M(e)),i=0;i<n.length;i++)this[n[i].unit](e[n[i].unit]);else if(e=P(e),E(this[e]))return this[e](t);return this},ri.startOf=function(e){switch(e=P(e)){case"year":this.month(0);case"quarter":case"month":this.date(1);case"week":case"isoWeek":case"day":case"date":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===e&&this.weekday(0),"isoWeek"===e&&this.isoWeekday(1),"quarter"===e&&this.month(3*Math.floor(this.month()/3)),this},ri.subtract=Kn,ri.toArray=function(){var e=this;return[e.year(),e.month(),e.date(),e.hour(),e.minute(),e.second(),e.millisecond()]},ri.toObject=function(){var e=this;return{years:e.year(),months:e.month(),date:e.date(),hours:e.hours(),minutes:e.minutes(),seconds:e.seconds(),milliseconds:e.milliseconds()}},ri.toDate=function(){return new Date(this.valueOf())},ri.toISOString=function(){if(!this.isValid())return null;var e=this.clone().utc();return e.year()<0||e.year()>9999?N(e,"YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]"):E(Date.prototype.toISOString)?this.toDate().toISOString():N(e,"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},ri.inspect=function(){if(!this.isValid())return"moment.invalid(/* "+this._i+" */)";var e="moment",t="";this.isLocal()||(e=0===this.utcOffset()?"moment.utc":"moment.parseZone",t="Z");var n="["+e+'("]',i=0<=this.year()&&this.year()<=9999?"YYYY":"YYYYYY",r=t+'[")]';return this.format(n+i+"-MM-DD[T]HH:mm:ss.SSS"+r)},ri.toJSON=function(){return this.isValid()?this.toISOString():null},ri.toString=function(){return this.clone().locale("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},ri.unix=function(){return Math.floor(this.valueOf()/1e3)},ri.valueOf=function(){return this._d.valueOf()-6e4*(this._offset||0)},ri.creationData=function(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}},ri.year=bn,ri.isLeapYear=function(){return G(this.year())},ri.weekYear=function(e){return ct.call(this,e,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)},ri.isoWeekYear=function(e){return ct.call(this,e,this.isoWeek(),this.isoWeekday(),1,4)},ri.quarter=ri.quarters=function(e){return null==e?Math.ceil((this.month()+1)/3):this.month(3*(e-1)+this.month()%3)},ri.month=ee,ri.daysInMonth=function(){return K(this.year(),this.month())},ri.week=ri.weeks=function(e){var t=this.localeData().week(this);return null==e?t:this.add(7*(e-t),"d")},ri.isoWeek=ri.isoWeeks=function(e){var t=se(this,1,4).week;return null==e?t:this.add(7*(e-t),"d")},ri.weeksInYear=function(){var e=this.localeData()._week;return oe(this.year(),e.dow,e.doy)},ri.isoWeeksInYear=function(){return oe(this.year(),1,4)},ri.date=Xn,ri.day=ri.days=function(e){if(!this.isValid())return null!=e?this:NaN;var t=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=e?(e=le(e,this.localeData()),this.add(e-t,"d")):t},ri.weekday=function(e){if(!this.isValid())return null!=e?this:NaN;var t=(this.day()+7-this.localeData()._week.dow)%7;return null==e?t:this.add(e-t,"d")},ri.isoWeekday=function(e){if(!this.isValid())return null!=e?this:NaN;if(null!=e){var t=ce(e,this.localeData());return this.day(this.day()%7?t:t-7)}return this.day()||7},ri.dayOfYear=function(e){var t=Math.round((this.clone().startOf("day")-this.clone().startOf("year"))/864e5)+1;return null==e?t:this.add(e-t,"d")},ri.hour=ri.hours=Rn,ri.minute=ri.minutes=ei,ri.second=ri.seconds=ti,ri.millisecond=ri.milliseconds=ii,ri.utcOffset=function(t,n,i){var r,a=this._offset||0;if(!this.isValid())return null!=t?this:NaN;if(null!=t){if("string"==typeof t){if(null===(t=Qe(tn,t)))return this}else Math.abs(t)<16&&!i&&(t*=60);return!this._isUTC&&n&&(r=Ke(this)),this._offset=t,this._isUTC=!0,null!=r&&this.add(r,"m"),a!==t&&(!n||this._changeInProgress?rt(this,Xe(t-a,"m"),1,!1):this._changeInProgress||(this._changeInProgress=!0,e.updateOffset(this,!0),this._changeInProgress=null)),this}return this._isUTC?a:Ke(this)},ri.utc=function(e){return this.utcOffset(0,e)},ri.local=function(e){return this._isUTC&&(this.utcOffset(0,e),this._isUTC=!1,e&&this.subtract(Ke(this),"m")),this},ri.parseZone=function(){if(null!=this._tzm)this.utcOffset(this._tzm,!1,!0);else if("string"==typeof this._i){var e=Qe(en,this._i);null!=e?this.utcOffset(e):this.utcOffset(0,!0)}return this},ri.hasAlignedHourOffset=function(e){return!!this.isValid()&&(e=e?$e(e).utcOffset():0,(this.utcOffset()-e)%60==0)},ri.isDST=function(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()},ri.isLocal=function(){return!!this.isValid()&&!this._isUTC},ri.isUtcOffset=function(){return!!this.isValid()&&this._isUTC},ri.isUtc=Ze,ri.isUTC=Ze,ri.zoneAbbr=function(){return this._isUTC?"UTC":""},ri.zoneName=function(){return this._isUTC?"Coordinated Universal Time":""},ri.dates=x("dates accessor is deprecated. Use date instead.",Xn),ri.months=x("months accessor is deprecated. Use month instead",ee),ri.years=x("years accessor is deprecated. Use year instead",bn),ri.zone=x("moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/",function(e,t){return null!=e?("string"!=typeof e&&(e=-e),this.utcOffset(e,t),this):-this.utcOffset()}),ri.isDSTShifted=x("isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information",function(){if(!r(this._isDSTShifted))return this._isDSTShifted;var e={};if(g(e,this),(e=Fe(e))._a){var t=e._isUTC?u(e._a):$e(e._a);this._isDSTShifted=this.isValid()&&w(e._a,t.toArray())>0}else this._isDSTShifted=!1;return this._isDSTShifted});var ai=k.prototype;ai.calendar=function(e,t,n){var i=this._calendar[e]||this._calendar.sameElse;return E(i)?i.call(t,n):i},ai.longDateFormat=function(e){var t=this._longDateFormat[e],n=this._longDateFormat[e.toUpperCase()];return t||!n?t:(this._longDateFormat[e]=n.replace(/MMMM|MM|DD|dddd/g,function(e){return e.slice(1)}),this._longDateFormat[e])},ai.invalidDate=function(){return this._invalidDate},ai.ordinal=function(e){return this._ordinal.replace("%d",e)},ai.preparse=dt,ai.postformat=dt,ai.relativeTime=function(e,t,n,i){var r=this._relativeTime[n];return E(r)?r(e,t,n,i):r.replace(/%d/i,e)},ai.pastFuture=function(e,t){var n=this._relativeTime[e>0?"future":"past"];return E(n)?n(t):n.replace(/%s/i,t)},ai.set=function(e){var t,n;for(n in e)E(t=e[n])?this[n]=t:this["_"+n]=t;this._config=e,this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+"|"+/\d{1,2}/.source)},ai.months=function(e,n){return e?t(this._months)?this._months[e.month()]:this._months[(this._months.isFormat||vn).test(n)?"format":"standalone"][e.month()]:t(this._months)?this._months:this._months.standalone},ai.monthsShort=function(e,n){return e?t(this._monthsShort)?this._monthsShort[e.month()]:this._monthsShort[vn.test(n)?"format":"standalone"][e.month()]:t(this._monthsShort)?this._monthsShort:this._monthsShort.standalone},ai.monthsParse=function(e,t,n){var i,r,a;if(this._monthsParseExact)return Z.call(this,e,t,n);for(this._monthsParse||(this._monthsParse=[],this._longMonthsParse=[],this._shortMonthsParse=[]),i=0;i<12;i++){if(r=u([2e3,i]),n&&!this._longMonthsParse[i]&&(this._longMonthsParse[i]=new RegExp("^"+this.months(r,"").replace(".","")+"$","i"),this._shortMonthsParse[i]=new RegExp("^"+this.monthsShort(r,"").replace(".","")+"$","i")),n||this._monthsParse[i]||(a="^"+this.months(r,"")+"|^"+this.monthsShort(r,""),this._monthsParse[i]=new RegExp(a.replace(".",""),"i")),n&&"MMMM"===t&&this._longMonthsParse[i].test(e))return i;if(n&&"MMM"===t&&this._shortMonthsParse[i].test(e))return i;if(!n&&this._monthsParse[i].test(e))return i}},ai.monthsRegex=function(e){return this._monthsParseExact?(l(this,"_monthsRegex")||te.call(this),e?this._monthsStrictRegex:this._monthsRegex):(l(this,"_monthsRegex")||(this._monthsRegex=xn),this._monthsStrictRegex&&e?this._monthsStrictRegex:this._monthsRegex)},ai.monthsShortRegex=function(e){return this._monthsParseExact?(l(this,"_monthsRegex")||te.call(this),e?this._monthsShortStrictRegex:this._monthsShortRegex):(l(this,"_monthsShortRegex")||(this._monthsShortRegex=_n),this._monthsShortStrictRegex&&e?this._monthsShortStrictRegex:this._monthsShortRegex)},ai.week=function(e){return se(e,this._week.dow,this._week.doy).week},ai.firstDayOfYear=function(){return this._week.doy},ai.firstDayOfWeek=function(){return this._week.dow},ai.weekdays=function(e,n){return e?t(this._weekdays)?this._weekdays[e.day()]:this._weekdays[this._weekdays.isFormat.test(n)?"format":"standalone"][e.day()]:t(this._weekdays)?this._weekdays:this._weekdays.standalone},ai.weekdaysMin=function(e){return e?this._weekdaysMin[e.day()]:this._weekdaysMin},ai.weekdaysShort=function(e){return e?this._weekdaysShort[e.day()]:this._weekdaysShort},ai.weekdaysParse=function(e,t,n){var i,r,a;if(this._weekdaysParseExact)return ue.call(this,e,t,n);for(this._weekdaysParse||(this._weekdaysParse=[],this._minWeekdaysParse=[],this._shortWeekdaysParse=[],this._fullWeekdaysParse=[]),i=0;i<7;i++){if(r=u([2e3,1]).day(i),n&&!this._fullWeekdaysParse[i]&&(this._fullWeekdaysParse[i]=new RegExp("^"+this.weekdays(r,"").replace(".",".?")+"$","i"),this._shortWeekdaysParse[i]=new RegExp("^"+this.weekdaysShort(r,"").replace(".",".?")+"$","i"),this._minWeekdaysParse[i]=new RegExp("^"+this.weekdaysMin(r,"").replace(".",".?")+"$","i")),this._weekdaysParse[i]||(a="^"+this.weekdays(r,"")+"|^"+this.weekdaysShort(r,"")+"|^"+this.weekdaysMin(r,""),this._weekdaysParse[i]=new RegExp(a.replace(".",""),"i")),n&&"dddd"===t&&this._fullWeekdaysParse[i].test(e))return i;if(n&&"ddd"===t&&this._shortWeekdaysParse[i].test(e))return i;if(n&&"dd"===t&&this._minWeekdaysParse[i].test(e))return i;if(!n&&this._weekdaysParse[i].test(e))return i}},ai.weekdaysRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||de.call(this),e?this._weekdaysStrictRegex:this._weekdaysRegex):(l(this,"_weekdaysRegex")||(this._weekdaysRegex=Cn),this._weekdaysStrictRegex&&e?this._weekdaysStrictRegex:this._weekdaysRegex)},ai.weekdaysShortRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||de.call(this),e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex):(l(this,"_weekdaysShortRegex")||(this._weekdaysShortRegex=Pn),this._weekdaysShortStrictRegex&&e?this._weekdaysShortStrictRegex:this._weekdaysShortRegex)},ai.weekdaysMinRegex=function(e){return this._weekdaysParseExact?(l(this,"_weekdaysRegex")||de.call(this),e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex):(l(this,"_weekdaysMinRegex")||(this._weekdaysMinRegex=Mn),this._weekdaysMinStrictRegex&&e?this._weekdaysMinStrictRegex:this._weekdaysMinRegex)},ai.isPM=function(e){return"p"===(e+"").toLowerCase().charAt(0)},ai.meridiem=function(e,t,n){return e>11?n?"pm":"PM":n?"am":"AM"},ve("en",{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(e){var t=e%10;return e+(1===y(e%100/10)?"th":1===t?"st":2===t?"nd":3===t?"rd":"th")}}),e.lang=x("moment.lang is deprecated. Use moment.locale instead.",ve),e.langData=x("moment.langData is deprecated. Use moment.localeData instead.",we);var si=Math.abs,oi=yt("ms"),li=yt("s"),ci=yt("m"),ui=yt("h"),di=yt("d"),hi=yt("w"),pi=yt("M"),fi=yt("y"),gi=wt("milliseconds"),mi=wt("seconds"),bi=wt("minutes"),vi=wt("hours"),yi=wt("days"),wi=wt("months"),_i=wt("years"),xi=Math.round,Si={ss:44,s:45,m:45,h:22,d:26,M:11},Ei=Math.abs,Ai=ze.prototype;return Ai.isValid=function(){return this._isValid},Ai.abs=function(){var e=this._data;return this._milliseconds=si(this._milliseconds),this._days=si(this._days),this._months=si(this._months),e.milliseconds=si(e.milliseconds),e.seconds=si(e.seconds),e.minutes=si(e.minutes),e.hours=si(e.hours),e.months=si(e.months),e.years=si(e.years),this},Ai.add=function(e,t){return gt(this,e,t,1)},Ai.subtract=function(e,t){return gt(this,e,t,-1)},Ai.as=function(e){if(!this.isValid())return NaN;var t,n,i=this._milliseconds;if("month"===(e=P(e))||"year"===e)return t=this._days+i/864e5,n=this._months+bt(t),"month"===e?n:n/12;switch(t=this._days+Math.round(vt(this._months)),e){case"week":return t/7+i/6048e5;case"day":return t+i/864e5;case"hour":return 24*t+i/36e5;case"minute":return 1440*t+i/6e4;case"second":return 86400*t+i/1e3;case"millisecond":return Math.floor(864e5*t)+i;default:throw new Error("Unknown unit "+e)}},Ai.asMilliseconds=oi,Ai.asSeconds=li,Ai.asMinutes=ci,Ai.asHours=ui,Ai.asDays=di,Ai.asWeeks=hi,Ai.asMonths=pi,Ai.asYears=fi,Ai.valueOf=function(){return this.isValid()?this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*y(this._months/12):NaN},Ai._bubble=function(){var e,t,n,i,r,a=this._milliseconds,s=this._days,o=this._months,l=this._data;return a>=0&&s>=0&&o>=0||a<=0&&s<=0&&o<=0||(a+=864e5*mt(vt(o)+s),s=0,o=0),l.milliseconds=a%1e3,e=v(a/1e3),l.seconds=e%60,t=v(e/60),l.minutes=t%60,n=v(t/60),l.hours=n%24,s+=v(n/24),r=v(bt(s)),o+=r,s-=mt(vt(r)),i=v(o/12),o%=12,l.days=s,l.months=o,l.years=i,this},Ai.clone=function(){return Xe(this)},Ai.get=function(e){return e=P(e),this.isValid()?this[e+"s"]():NaN},Ai.milliseconds=gi,Ai.seconds=mi,Ai.minutes=bi,Ai.hours=vi,Ai.days=yi,Ai.weeks=function(){return v(this.days()/7)},Ai.months=wi,Ai.years=_i,Ai.humanize=function(e){if(!this.isValid())return this.localeData().invalidDate();var t=this.localeData(),n=xt(this,!e,t);return e&&(n=t.pastFuture(+this,n)),t.postformat(n)},Ai.toISOString=Et,Ai.toString=Et,Ai.toJSON=Et,Ai.locale=st,Ai.localeData=ot,Ai.toIsoString=x("toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)",Et),Ai.lang=Zn,D("X",0,0,"unix"),D("x",0,0,"valueOf"),L("x",Xt),L("X",nn),$("X",function(e,t,n){n._d=new Date(1e3*parseFloat(e,10))}),$("x",function(e,t,n){n._d=new Date(y(e))}),e.version="2.19.1",function(e){At=e}($e),e.fn=ri,e.min=function(){return Ue("isBefore",[].slice.call(arguments,0))},e.max=function(){return Ue("isAfter",[].slice.call(arguments,0))},e.now=function(){return Date.now?Date.now():+new Date},e.utc=u,e.unix=function(e){return $e(1e3*e)},e.months=function(e,t){return pt(e,t,"months")},e.isDate=s,e.locale=ve,e.invalid=f,e.duration=Xe,e.isMoment=b,e.weekdays=function(e,t,n){return ft(e,t,n,"weekdays")},e.parseZone=function(){return $e.apply(null,arguments).parseZone()},e.localeData=we,e.isDuration=Ge,e.monthsShort=function(e,t){return pt(e,t,"monthsShort")},e.weekdaysMin=function(e,t,n){return ft(e,t,n,"weekdaysMin")},e.defineLocale=ye,e.updateLocale=function(e,t){if(null!=t){var n,i=Dn;null!=In[e]&&(i=In[e]._config),(n=new k(t=A(i,t))).parentLocale=In[e],In[e]=n,ve(e)}else null!=In[e]&&(null!=In[e].parentLocale?In[e]=In[e].parentLocale:null!=In[e]&&delete In[e]);return In[e]},e.locales=function(){return Ot(In)},e.weekdaysShort=function(e,t,n){return ft(e,t,n,"weekdaysShort")},e.normalizeUnits=P,e.relativeTimeRounding=function(e){return void 0===e?xi:"function"==typeof e&&(xi=e,!0)},e.relativeTimeThreshold=function(e,t){return void 0!==Si[e]&&(void 0===t?Si[e]:(Si[e]=t,"s"===e&&(Si.ss=t-1),!0))},e.calendarFormat=function(e,t){var n=e.diff(t,"days",!0);return n<-6?"sameElse":n<-1?"lastWeek":n<0?"lastDay":n<1?"sameDay":n<2?"nextDay":n<7?"nextWeek":"sameElse"},e.prototype=ri,e}),define("js/services/api",["underscore","jquery","js/components/generic_module","js/components/api_request","js/mixins/dependon","js/components/api_response","js/components/api_query","js/components/api_feedback","js/mixins/hardened","js/mixins/api_access","moment"],function(e,t,n,i,r,a,s,o,l,c,u){var d=n.extend({url:"/api/1/",clientVersion:null,outstandingRequests:0,access_token:null,refresh_token:null,expire_in:null,defaultTimeoutInMs:6e4,activate:function(e){this.setBeeHive(e)},done:function(e,t,n){var i=new a(e);i.setApiQuery(this.request.get("query")),this.api.trigger("api-response",i)},fail:function(e,t,n){console.error("API call failed:",JSON.stringify(this.request.url()),e.status,n);var i=this.api.hasBeeHive()?this.api.getPubSub():null;if(i){var r=new o({code:o.CODES.API_REQUEST_ERROR,msg:t,request:this.request,error:e,psk:this.key||this.api.getPubSub().getCurrentPubSubKey(),errorThrown:n,text:t,beVerbose:!0});i.publish(i.FEEDBACK,r)}else this.api&&this.api.trigger("api-error",this,e,t,n)},initialize:function(){this.always=e.bind(function(){this.outstandingRequests--},this)},getNumOutstandingRequests:function(){return this.outstandingRequests},setVals:function(t){e.each(t,function(e,t){this[t]=e},this)},modifyRequestOptions:function(e){},hardenedInterface:{request:"make a request to the API",setVals:"set a value on API (such as new access token)"}});return d.prototype._request=function(n,i){i=e.extend({},i,n.get("options"));var r,a=this,o=n.get("query");if(o&&!(o instanceof s))throw Error("Api.query must be instance of ApiQuery");o&&(r="application/json"===i.contentType?JSON.stringify(o.toJSON()):o.url());var l,c=n.get("target")||"";if(l=c.indexOf("http")>-1?c:this.url+(c.length>0&&0==c.indexOf("/")?c:c?"/"+c:c),!(l=l.substring(0,this.url.length-2)+l.substring(this.url.length-2,l.length).replace("//","/")))throw Error("Sorry, you can't use api without url");var u={type:"GET",url:l,dataType:"json",data:r,contentType:"application/x-www-form-urlencoded",context:{request:n,api:a},timeout:this.defaultTimeoutInMs,headers:{},cache:!0};i.timeout&&(u.timeout=i.timeout),this.clientVersion&&(u.headers["X-BB-Api-Client-Version"]=this.clientVersion),this.access_token&&(u.headers.Authorization=this.access_token),e.extend(u.headers,i.headers),e.extend(u,e.omit(i,"headers")),this.outstandingRequests++,this.modifyRequestOptions(u,n);var d=t.ajax(u).always(u.always?[this.always,u.always]:this.always).done(u.done||this.done).fail(u.fail||this.fail);return d=d.promise(d)},d.prototype.getCurrentUTCMoment=function(){return u().utc()},d.prototype.request=function(e,n){var i=this;if(!this.expire_in)return i._request(e,n);var r=u.utc(this.expire_in);if(this.getCurrentUTCMoment().diff(r,"minutes")>-2){var a=t.Deferred();return this.getApiAccess({tokenRefresh:!0}).done(function(){a.resolve(i._request(e,n))}),a.promise()}return i._request(e,n)},e.extend(d.prototype,r.BeeHive),e.extend(d.prototype,l),e.extend(d.prototype,c),d}),define("js/services/default_pubsub",["backbone","underscore","js/components/generic_module","js/components/pubsub_key"],function(e,t,n,i){var r=/\s+/,a=function(e,t,n,i){if(!n)return!0;if("object"==typeof n){for(var a in n)e[t].apply(e,[a,n[a]].concat(i));return!1}if(r.test(n)){for(var s=n.split(r),o=0,l=s.length;o<l;o++)e[t].apply(e,[s[o]].concat(i));return!1}return!0};return n.extend({className:"PubSub",initialize:function(e){this._issuedKeys={},this.strict=!0,this.handleErrors=!0,this._errors={},this.errWarningCount=10,t.extend(this,t.pick(e,["strict","handleErrors","errWarningCount"])),this.pubSubKey=i.newInstance({creator:{}}),this._issuedKeys[this.pubSubKey.getId()]=this.pubSubKey.getCreator(),this.running=!0,this.debug=!1},start:function(){this.publish(this.pubSubKey,this.OPENING_GATES),this.publish(this.pubSubKey,this.OPEN_FOR_BUSINESS),this.running=!0},destroy:function(){this.publish(this.pubSubKey,this.CLOSING_GATES),this.off(),this.publish(this.pubSubKey,this.CLOSED_FOR_BUSINESS),this.running=!1,this._issuedKeys={}},subscribe:function(e,n,i){if(!this.isRunning())throw new Error("PubSub has been closed, ignoring futher requests");if(this._checkKey(e,n,i),t.isUndefined(n))throw new Error("You tried to subscribe to undefined event. Error between chair and keyboard?");this.on(n,i,e),-1==n.indexOf(e.getId())&&this.on(n+e.getId(),i,e)},subscribeOnce:function(e,n,i){if(this._checkKey(e,n,i),t.isUndefined(n))throw new Error("You tried to subscribe to undefined event. Error between chair and keyboard?");this.once(n,i,e),-1==n.indexOf(e.getId())&&this.once(n+e.getId(),i,e)},unsubscribe:function(e,n,i){this._checkKey(e,n,i);var r=e;if(n&&i)this.off(n,i,r),this.off(n+e.getId(),i,r);else if(n||i)this.off(n,i,r),this.off(n+e.getId(),i,r);else{var n,a,s,o,l,c,u,d=t.keys(this._events),h=[];for(o=0,l=d.length;o<l;o++)if(n=d[o],a=this._events[n])for(u=0,c=a.length;u<c;u++)(s=a[u]).context===r&&h.push({name:n,event:s});t.each(h,function(e){this.off(e.name,e.event.callback,e.event.context)},this)}},publish:function(){if(this.isRunning()){this._checkKey(arguments[0]);var e=Array.prototype.slice.call(arguments,1);if(0==e.length||t.isUndefined(e[0]))throw new Error("You tried to trigger undefined event. Error between chair and keyboard?");return e.push(arguments[0]),this.handleErrors?this.triggerHandleErrors.apply(this,e):this.trigger.apply(this,e)}console.error("PubSub has been closed, ignoring futher requests")},getCurrentPubSubKey:function(){return this.pubSubKey},getPubSubKey:function(){var e=i.newInstance({creator:this.pubSubKey});if(this.strict){if(this._issuedKeys[e.getId()])throw Error("The key with id",e.getId(),"has been already registered!");this._issuedKeys[e.getId()]=e.getCreator()}return e},isStrict:function(){return this.strict},_checkKey:function(e,n,r){if(this.strict){if(t.isUndefined(e))throw new Error("Every request must be accompanied by PubSubKey");if(!(e instanceof i))throw new Error("Key must be instance of PubSubKey. (If you are trying to pass context, you can't do that. Instead, wrap your callback into: _.bind(callback, context))\nPerhaps the PubSub you are using is the non-protected version?");if(!this._issuedKeys.hasOwnProperty(e.getId()))throw new Error("Your key is not known to us, sorry, you can't use this queue.");if(this._issuedKeys[e.getId()]!==e.getCreator())throw new Error("Your key has wrong identity, sorry, you can't use this queue.")}},triggerHandleErrors:function(e){if(!this._events)return this;var t=Array.prototype.slice.call(arguments,1);if(!a(this,"trigger",e,t))return this;var n=this._events[e],i=this._events.all;return n&&this.triggerEvents(n,t),i&&this.triggerEvents(i,arguments),this},triggerEvents:function(e,t){var n,i=-1,r=e.length,a=t[0],s=t[1],o=t[2];switch(t.length){case 0:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx)}catch(e){this.handleCallbackError(e,n,t)}return;case 1:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx,a)}catch(e){this.handleCallbackError(e,n,t)}return;case 2:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx,a,s)}catch(e){this.handleCallbackError(e,n,t)}return;case 3:for(;++i<r;)try{(n=e[i]).callback.call(n.ctx,a,s,o)}catch(e){this.handleCallbackError(e,n,t)}return;default:for(;++i<r;)try{(n=e[i]).callback.apply(n.ctx,t)}catch(e){this.handleCallbackError(e,n,t)}}},handleCallbackError:function(e,t,n){if(console.warn("[PubSub] Error: ",t,n),this.debug)throw e;console.warn(e.stack);var i=t.ctx.getId(),r=this._errors[i]=(this._errors[i]||0)+1;r%this.errWarningCount==0&&this.publish(this.pubSubKey,this.BIG_FIRE,r,e,t,n)},isRunning:function(){return this.running}})}),define("js/services/pubsub",["backbone","underscore","js/mixins/hardened","pubsub_service_impl","js/components/pubsub_events"],function(e,t,n,i,r){var a=i.extend({hardenedInterface:{subscribe:"register callback",unsubscribe:"deregister callback",publish:"send data to the queue",getPubSubKey:"get secret key"}});return t.extend(a.prototype,n,{getHardenedInstance:function(e){e=t.clone(e||this.hardenedInterface);var n={key:this.getPubSubKey()},i=this;e.publish=function(){(arguments=t.toArray(arguments)).unshift(n.key),i.publish.apply(i,arguments)},e.subscribe=function(){(arguments=t.toArray(arguments)).unshift(n.key),i.subscribe.apply(i,arguments)},e.unsubscribe=function(){(arguments=t.toArray(arguments)).unshift(n.key),i.unsubscribe.apply(i,arguments)},e.subscribeOnce=function(){(arguments=t.toArray(arguments)).unshift(n.key),i.subscribeOnce.apply(i,arguments)},e.getCurrentPubSubKey=function(){return n.key};var a=this._getHardenedInstance(e,this);return t.extend(a,r),a}}),t.extend(a.prototype,r),a}),define("js/components/transition",["underscore"],function(e){var t=function(t,n){if(!e.isString(t))throw new Exception("Endpoint name must be a string");this.endpoint=t,e.extend(this,n)};return e.extend(t.prototype,{route:!1,trigger:!1,replace:!1,execute:function(){throw new Exception("You must override this method")}}),t}),define("js/components/transition_catalog",["underscore","js/components/transition"],function(e,t){var n=function(e){this._catalog={}};return e.extend(n.prototype,{add:function(e){if(!(e instanceof t))throw new Error("You can add only Transition objects");return this._catalog[e.endpoint]=e,e},get:function(e){return this._catalog[e]},remove:function(e){delete this._catalog[e]}}),n}),define("js/components/navigator",["underscore","jquery","cache","js/components/generic_module","js/mixins/dependon","js/components/transition","js/components/transition_catalog","analytics"],function(e,t,n,i,r,a,s,o){var l=i.extend({initialize:function(e){e=e||{},this.router=e.router,this.catalog=new s},activate:function(t){this.setBeeHive(t);var n=this.getPubSub();n.subscribe(n.NAVIGATE,e.bind(this.navigate,this))},navigate:function(e,n,i){if(!(this.router&&this.router instanceof Backbone.Router))throw new Error("Navigator must be given 'router' instance");o("send","pageview",{page:e});var r=this.catalog.get(e);if(r){if(r.execute){try{r.execute.apply(r,arguments)}catch(e){this.handleTransitionError(r,e,arguments)}var a=!!(r.replace||n&&n.replace);(decodeURI(window.location.hash)!==r.route&&r.route||""===r.route)&&this.router.navigate(r.route,{trigger:r.trigger||!1,replace:a}),t("head").find("meta[data-highwire]").remove(),document.title="ADS Search"}}else this.handleMissingTransition(arguments)},handleMissingTransition:function(){console.error("Cannot handle 'navigate' event: "+JSON.stringify(arguments)),this.getPubSub().publish(this.getPubSub().BIG_FIRE,"navigation-error",arguments)},handleTransitionError:function(e,t,n){console.error("Error while executing transition",e,n),console.error(t.stack),this.getPubSub().publish(this.getPubSub().CITY_BURNING,"navigation-error",arguments)},set:function(){if(1==arguments.length){if(arguments[1]instanceof a)return this.catalog.add(arguments[1]);throw new Exception("You must be kiddin' sir!")}if(2==arguments.length){var t=arguments[0];if(e.isFunction(arguments[1]))return this.catalog.add(new a(t,{execute:arguments[1]}));if(e.isObject(arguments[1])&&arguments[1].execute)return this.catalog.add(new a(t,arguments[1]));throw new Exception("Himmm, I dont know how to create a catalog rule with this input:",arguments)}throw new Exception("Himmm, I dont know how to create a catalog rule with this input:",arguments)},get:function(e){return this.catalog.get(e)}});return e.extend(l.prototype,r.BeeHive),l}),define("hbs!404",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return"<!doctype html>\n<html>\n<head>\n    <link rel=\"stylesheet\" href=\"./styles/css/styles.css\" />\n    <script src=\"./libs/requirejs/require.js\"><\/script>\n    <script>\n        require.config({\n            paths: {\n                'google-analytics': '//www.google-analytics.com/analytics',\n                'analytics': 'js/components/analytics',\n                'jquery': '//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min'\n            },\n            map: {\n                'analytics': {\n                    'analytics_config': 'discovery.vars'\n                }\n            }\n        });\n        require(['analytics'], function(analytics) {\n            analytics('send', 'pageview');\n            analytics('send', 'event', 'error', 'automatic_redirection', '404.html');\n        });\n    <\/script>\n\n</head>\n<body>\n\n<div >\n    <p> Bumblebee failed to load. Please try again.</p>\n</div>\n</body>\n</html>\n"},useData:!0});return t.registerPartial("404",n),n}),define("hbs!js/apps/discovery/templates/orcid-modal-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n    <p>\n        If you <strong>wish for your ORCID claims to be accessible in the ADS,</strong> please first\n        <a href="#user/settings/orcid">fill out this brief form. </a>\n    </p>\n\n    <p>\n        After you have completed the form, you can immediately begin claiming papers.\n    </p>\n\n\n'},3:function(e,t,n,i){return'\n    <p>\n        If you <strong>want your ORCID claims to be accessible in the ADS,</strong>\n        please sign in to ADS or create an account and provide us with your permission to\n        make your claims public, along with a few other key pieces of information.\n\n    </p>\n    <p>\n        <a href="#user/account/login" class="btn btn-primary">log in to ADS </a>\n        or\n        <a href="#user/account/register" class="btn btn-primary">create a new account</a>\n\n    </p>\n    <p>\n        After you are signed in to your account, go to the "User Preferences" page,\n        click on the "ORCID Settings" tab, and fill in the brief form.\n    </p>\n\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n\n"+(null!=(r=t.if.call(e,null!=e?e.adsLoggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"\n<p>\n    <b>If you don't care about your information being searchable in the ADS, just close this message and continue.</b>\n</p>"},useData:!0});return t.registerPartial("js/apps/discovery/templates/orcid-modal-template",n),n}),define("js/apps/discovery/navigator",["jquery","backbone","underscore","js/components/navigator","js/components/api_feedback","js/components/api_query_updater","js/components/json_response","js/components/api_query","js/components/api_request","js/components/api_targets","hbs!404","hbs!js/apps/discovery/templates/orcid-modal-template"],function(e,t,n,i,r,a,s,o,l,c,u,d){"use strict";return i.extend({start:function(e){function t(){return!e.getBeeHive().getObject("User").isLoggedIn()&&(e.getService("Navigator").navigate("authentication-page",{subView:"login"}),!0)}function i(n,i){return function(r,a){if(!t()){var s=a.subView||i;s||console.error("no subview or default view provided /to the navigator function!"),e.getObject("MasterPageManager").show("SettingsPage",[n,"UserNavbarWidget"]),e.getWidget("SettingsPage").done(function(e){e.setActive(n,s)}),this.route="#user/settings/"+s,g("settings-page")}}}function s(t,n){var i=n.widgetName,r=n.additional,a=n.subView,s=n.id,o=n.publicView;e.getWidget(i).done(function(e){e.reset?e.reset():e.resetWidget&&e.resetWidget()}),o?(e.getObject("MasterPageManager").show("PublicLibrariesPage",["IndividualLibraryWidget",i]),this.route="#/public-libraries/"+n.id):(e.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","UserNavbarWidget",i]),this.route="#user/libraries/"+n.id,g("libraries-page")),function(t){e.getObject("LibraryController").getLibraryBibcodes(t).done(function(n){e.getWidget(i).done(function(e){e.renderWidgetForListOfBibcodes(n,r)}),e.getWidget("IndividualLibraryWidget").done(function(e){e.setSubView({subView:a,publicView:o,id:t})})})}(s)}function u(t,i){var a=e.getObject("AppStorage").getCurrentQuery();f({code:r.CODES.MAKE_SPACE});var s=n.map(t.split("-").slice(1),function(e){return e[0].toUpperCase()+e.slice(1)}).join("");e.getObject("MasterPageManager").show("SearchPage",[s].concat(m.slice(1))),this.route="#search/"+p.clean(a.clone()).url()+"/"+t.split("-").slice(1).join("-"),i&&i.onlySelected?e.getWidget(s).done(function(t){var n=e.getObject("AppStorage").getSelectedPapers();t.renderWidgetForListOfBibcodes(n)}):e.getWidget(s).done(function(e){e.renderWidgetForCurrentQuery({currentQuery:a})})}var h=this,p=new a("navigator"),f=function(e){h.getPubSub().publish(h.getPubSub().FEEDBACK,new r(e))},g=function(e){h.getPubSub().publish(h.getPubSub().PAGE_CHANGE,e)},m=["Results","QueryInfo","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","ObjectFacet","VizierFacet","GrantsFacet","GraphTabs","QueryDebugInfo","ExportDropdown","VisualizationDropdown","SearchWidget","Sort","BreadcrumbsWidget","PubtypeFacet"],b=["TOCWidget","SearchWidget","ShowResources","ShowRecommender","ShowGraphicsSidebar","ShowLibraryAdd","MetaTagsWidget"];this.set("index-page",function(){e.getObject("MasterPageManager").show("LandingPage",["SearchWidget"]),e.getWidget("LandingPage").done(function(e){e.setActive("SearchWidget")}),this.route=""}),this.set("SearchWidget",function(){this.route="",h.get("index-page").execute()}),this.set("404",function(){e.getObject("MasterPageManager").show("ErrorPage")}),this.set("ClassicSearchForm",function(){e.getObject("MasterPageManager").show("LandingPage",["ClassicSearchForm"]),e.getWidget("LandingPage").done(function(e){e.setActive("ClassicSearchForm")}),this.route="#classic-form"}),this.set("PaperSearchForm",function(){e.getObject("MasterPageManager").show("LandingPage",["PaperSearchForm"]),e.getWidget("LandingPage").done(function(e){e.setActive("PaperSearchForm")}),this.route="#paper-form"}),this.set("LibraryImport",function(n,i){t()||(e.getObject("MasterPageManager").show("SettingsPage",["LibraryImport","UserNavbarWidget"]),e.getWidget("SettingsPage").done(function(e){e.setActive("LibraryImport")}),this.route="#user/settings/libraryimport",g("settings-page"))}),this.set("UserSettings",i("UserSettings",void 0)),this.set("UserPreferences",i("UserPreferences","librarylink")),this.set("AllLibrariesWidget",function(n,i){if(!t()){var i=i||"libraries";e.getObject("MasterPageManager").show("LibrariesPage",["AllLibrariesWidget","UserNavbarWidget"]),e.getWidget("AllLibrariesWidget").done(function(e){e.setSubView({view:i})}),this.route="#user/libraries/",g("libraries-page")}}),this.set("LibraryAdminView",function(t){e.getWidget("IndividualLibraryWidget").done(function(t){t.setSubView({subView:"admin"}),e.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","UserNavbarWidget"]),g("libraries-page")})}),this.set("IndividualLibraryWidget",function(i,r){r.publicView=!!r.publicView&&r.publicView,this.route=r.publicView?"#/public-libraries/"+r.id:"#user/libraries/"+r.id,e.getObject("LibraryController").getLibraryMetadata(r.id).done(function(i){r.editRecords=n.contains(["write","admin","owner"],i.permission)&&!r.publicView,e.getWidget("LibraryListWidget").done(function(n){n.setData(r),r.publicView?e.getWidget("IndividualLibraryWidget").done(function(t){t.setSubView(r),e.getObject("MasterPageManager").show("PublicLibrariesPage",["IndividualLibraryWidget","LibraryListWidget"])}):t()||e.getWidget("IndividualLibraryWidget").done(function(t){t.setSubView(r),e.getObject("MasterPageManager").show("LibrariesPage",["IndividualLibraryWidget","LibraryListWidget","UserNavbarWidget"]),g("libraries-page")})})})}),this.set("library-export",s),this.set("library-visualization",s),this.set("library-metrics",s),this.set("library-citation_helper",s),this.set("home-page",function(){e.getObject("MasterPageManager").show("HomePage",[]),g("home-page")}),this.set("authentication-page",function(t,n){var i=(n=n||{}).subView||"login";e.getBeeHive().getObject("User").isLoggedIn()?h.get("index-page").execute():(this.route="#user/account/"+i,e.getObject("MasterPageManager").show("AuthenticationPage",["Authentication"]),e.getWidget("Authentication").done(function(e){e.setSubView(i)}))}),this.set("results-page",function(t,n){e.getObject("MasterPageManager").show("SearchPage",m);var i=e.getObject("AppStorage").getCurrentQuery();if(i&&i.get("__original_url")){a="#search/"+i.get("__original_url");i.unset("__original_url")}else var a="#search/"+p.clean(i).url();i&&i.get("__qid")&&(a+="&__qid="+i.get("__qid")[0]),this.route=a,f({code:r.CODES.UNMAKE_SPACE})}),this.set("export",function(t,n){var i=n.format||"bibtex",a=e.getObject("AppStorage");e.getObject("MasterPageManager").show("SearchPage",["ExportWidget"].concat(m.slice(1))),e.getWidget("ExportWidget").done(function(t){if("classic"!=i)if(f({code:r.CODES.MAKE_SPACE}),n.onlySelected&&a.hasSelectedPapers())t.renderWidgetForListOfBibcodes(a.getSelectedPapers(),{format:i});else if(!1===n.onlySelected&&a.hasCurrentQuery())t.renderWidgetForCurrentQuery({format:i,currentQuery:a.getCurrentQuery(),numFound:a.get("numFound")});else if(void 0===n.onlySelected&&a.hasSelectedPapers())t.renderWidgetForListOfBibcodes(a.getSelectedPapers(),{format:i});else{if(!a.hasCurrentQuery())return e.getController("AlertsController").alert({msg:"There are no records to export yet (please search or select some)"}),void this.get("results-page")();t.exportQuery({format:i,currentQuery:a.getCurrentQuery(),numFound:a.get("numFound")})}else n.onlySelected&&a.hasSelectedPapers()?t.openClassicExports({bibcodes:a.getSelectedPapers()}):t.openClassicExports({currentQuery:a.getCurrentQuery()})})}),this.set("export-query",function(){var t=e.getService("Api"),n=e.getObject("AppStorage").getCurrentQuery(),i=e.getController("AlertsController");n=new o({query:n.url()}),t.request(new l({query:n,target:c.MYADS_STORAGE+"/query",options:{done:function(){},type:"POST",xhrFields:{withCredentials:!1}}})).done(function(e){i.alert(new r({code:r.CODES.ALERT,msg:'The query has been saved. You can insert the following snippet in a webpage: <br/><img src="'+c.MYADS_STORAGE+"/query2svg/"+e.qid+'"></img><br/><br/><textarea rows="10" cols="50"><a href="'+location.protocol+"//"+location.host+location.pathname+"#execute-query/"+e.qid+'"><img src="'+c.MYADS_STORAGE+"/query2svg/"+e.qid+'"></img></a></textarea>',modal:!0}))})}),this.set("execute-query",function(t,n){e.getService("Api").request(new l({target:c.MYADS_STORAGE+"/query/"+n,options:{done:function(e){var t=(new o).load(JSON.parse(e.query).query);h.getPubSub().publish(h.getPubSub().START_SEARCH,t)},fail:function(){e.getController("AlertsController").alert(new r({code:r.CODES.ERROR,msg:"The query with the given UUID cannot be found"})),h.get("index-page").execute()},type:"GET",xhrFields:{withCredentials:!1}}}))}),this.set("orcid-instructions",function(){this.route="#orcid-instructions",e.getObject("MasterPageManager").show("OrcidInstructionsPage")}),this.set("orcid-page",function(t,i){var a=e.getService("OrcidApi"),s=e.getService("PersistentStorage"),o=e.getObject("AppStorage");if(!a.hasAccess()&&a.hasExchangeCode())return s?s.set("orcidAuthenticating",!0):console.warn("no persistent storage service available"),void a.getAccessData(a.getExchangeCode()).done(function(e){a.saveAccessData(e),h.getPubSub().publish(h.getPubSub().APP_EXIT,{url:window.location.pathname+(i&&n.isString(i)?i:window.location.hash)})}).fail(function(){console.warn("Unsuccessful login to ORCID"),h.get("index-page").execute(),e.getController("AlertsController").alert(new r({code:r.CODES.ALERT,msg:"Error getting OAuth code to access ORCID",modal:!0}))});a.hasAccess()?(s.get("orcidAuthenticating")&&(s.remove("orcidAuthenticating"),a.getADSUserData().done(function(t){t.hasOwnProperty("authorizedUser")||'["UserPreferences",{"subView":"orcid"}]'===JSON.stringify(o.get("stashedNav"))||e.getController("AlertsController").alert(new r({code:r.CODES.ALERT,msg:d({adsLoggedIn:e.getObject("User").isLoggedIn()}),type:"success",title:"You are now logged in to ORCID",modal:!0}))}).fail(function(e){console.warn(e)})),this.route="#user/orcid",e.getObject("MasterPageManager").show("OrcidPage",["OrcidBigWidget","SearchWidget"])):(this.route="",h.get("index-page").execute())}),this.set("show-author-network",function(e,t){u.apply(this,arguments)}),this.set("show-concept-cloud",function(e,t){u.apply(this,arguments)}),this.set("show-paper-network",function(e,t){u.apply(this,arguments)}),this.set("show-bubble-chart",function(e,t){u.apply(this,arguments)}),this.set("show-metrics",function(e,t){u.apply(this,arguments)}),this.set("visualization-closed",this.get("results-page"));var v=function(t,n){e.getObject("MasterPageManager").show("DetailsPage",t),e.getWidget("DetailsPage").done(function(e){e.setActive(n)})};this.set("ShowAbstract",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowCitations",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowReferences",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowCoreads",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowTableOfContents",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowSimilar",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowMetrics",function(e,t){v([e].concat(b),e),this.route=t.href}),this.set("ShowPaperExport",function(t,n){var i=n.subView;e.getObject("MasterPageManager").show("DetailsPage",[t].concat(b)),e.getWidget("DetailsPage").done(function(e){e.setActive(t,i)})}),this.set("ShowGraphics",function(e,t){v([e].concat(b),e),this.route=t.href})}})}),function(e){define("persist-js",[],function(){return function(){return function(){if(!window.google||!google.gears){var e=null;if("undefined"!=typeof GearsFactory)e=new GearsFactory;else try{-1!=(e=new ActiveXObject("Gears.Factory")).getBuildInfo().indexOf("ie_mobile")&&e.privateSetGlobalObject(this)}catch(t){void 0!==navigator.mimeTypes&&navigator.mimeTypes["application/x-googlegears"]&&((e=document.createElement("object")).style.display="none",e.width=0,e.height=0,e.type="application/x-googlegears",document.documentElement.appendChild(e))}e&&(window.google||(google={}),google.gears||(google.gears={factory:e}))}}(),Persist=function(){var e,t,n,a,s,o;o=function(){var e,t=["expires","path","domain"],n=escape,i=unescape,r=document,a=function(){var e=new Date;return e.setTime(e.getTime()),e},s=function(e,i){var r,a,s=[],o=arguments.length>2?arguments[2]:{};s.push(n(e)+"="+n(i));for(var l=0;l<t.length;l++)(a=o[r=t[l]])&&s.push(r+"="+a);return o.secure&&s.push("secure"),s.join("; ")};return e={set:function(e,t){var n=arguments.length>2?arguments[2]:{},i=a(),o={};if(n.expires){var l=864e5*n.expires;o.expires=new Date(i.getTime()+l),o.expires=o.expires.toGMTString()}for(var c=["path","domain","secure"],u=0;u<c.length;u++)n[c[u]]&&(o[c[u]]=n[c[u]]);var d=s(e,t,o);return r.cookie=d,t},has:function(e){e=n(e);var t=r.cookie,i=t.indexOf(e+"="),a=(e.length,t.substring(0,e.length));return!(!i&&e!=a||i<0)},get:function(e){e=n(e);var t,a=r.cookie,s=a.indexOf(e+"="),o=s+e.length+1,l=a.substring(0,e.length);return!s&&e!=l||s<0?null:((t=a.indexOf(";",o))<0&&(t=a.length),i(a.substring(o,t)))},remove:function(t){var n=e.get(t),i={expires:"Thu, 01-Jan-1970 00:00:01 GMT"};return r.cookie=s(t,"",i),n},keys:function(){for(var e,t=r.cookie.split("; "),n=[],a=0;a<t.length;a++)e=t[a].split("="),n.push(i(e[0]));return n},all:function(){for(var e,t=r.cookie.split("; "),n=[],a=0;a<t.length;a++)e=t[a].split("="),n.push([i(e[0]),i(e[1])]);return n},version:"0.2.1",enabled:!1},e.enabled=function(){var e="__EC_TEST__",t=new Date;return t=t.toGMTString(),this.set(e,t),this.enabled=this.remove(e)==t,this.enabled}.call(e),e}();var l=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t)}:function(e,t){for(var n=0,i=e.length;n<i;n++)if(e[n]==t)return n;return-1};s=function(){},n=function(e){return"PS"+e.replace(/_/g,"__").replace(/ /g,"_s")};var c={search_order:["localstorage","globalstorage","gears","cookie","ie","flash"],name_re:/^[a-z][a-z0-9_ \-]+$/i,methods:["init","get","set","remove","load","save","iterate"],sql:{version:"1",create:"CREATE TABLE IF NOT EXISTS persist_data (k TEXT UNIQUE NOT NULL PRIMARY KEY, v TEXT NOT NULL)",get:"SELECT v FROM persist_data WHERE k = ?",set:"INSERT INTO persist_data(k, v) VALUES (?, ?)",remove:"DELETE FROM persist_data WHERE k = ?",keys:"SELECT * FROM persist_data"},flash:{div_id:"_persist_flash_wrap",id:"_persist_flash",path:"persist.swf",size:{w:1,h:1},args:{autostart:!0}}};return t={gears:{size:-1,test:function(){return!(!window.google||!window.google.gears)},methods:{init:function(){var e;(e=this.db=google.gears.factory.create("beta.database")).open(n(this.name)),e.execute(c.sql.create).close()},get:function(e){var t,n,i=c.sql.get,r=this.db;return r.execute("BEGIN").close(),t=r.execute(i,[e]),n=t.isValidRow()?t.field(0):null,t.close(),r.execute("COMMIT").close(),n},set:function(e,t){var n=c.sql.remove,i=c.sql.set,r=this.db;return r.execute("BEGIN").close(),r.execute(n,[e]).close(),r.execute(i,[e,t]).close(),r.execute("COMMIT").close(),t},remove:function(e){c.sql.get;sql=c.sql.remove,r,val=null,is_valid=!1;var t=this.db;return t.execute("BEGIN").close(),t.execute(sql,[e]).close(),t.execute("COMMIT").close(),!0},iterate:function(e,t){var n,i=c.sql.keys;for(n=this.db.execute(i);n.isValidRow();)e.call(t||this,n.field(0),n.field(1)),n.next();n.close()}}},globalstorage:{size:5242880,test:function(){if(!window.globalStorage)return!1;var e="127.0.0.1";this.o&&this.o.domain&&(e=this.o.domain);try{globalStorage[e];return!0}catch(t){return window.console&&window.console.warn&&console.warn("globalStorage exists, but couldn't use it because your browser is running on domain:",e),!1}},methods:{key:function(e){return n(this.name)+n(e)},init:function(){this.store=globalStorage[this.o.domain]},get:function(e){return e=this.key(e),this.store.getItem(e)},set:function(e,t){return e=this.key(e),this.store.setItem(e,t),t},remove:function(e){var t;return e=this.key(e),t=this.store.getItem[e],this.store.removeItem(e),t}}},localstorage:{size:-1,test:function(){return!!window.localStorage},methods:{key:function(e){return this.name+">"+e},init:function(){this.store=localStorage},get:function(e){return e=this.key(e),this.store.getItem(e)},set:function(e,t){return e=this.key(e),this.store.setItem(e,t),t},remove:function(e){var t;return e=this.key(e),t=this.store.getItem(e),this.store.removeItem(e),t},iterate:function(e,t){var n=this.store;for(i=0;i<n.length;i++)keys=n[i].split(">"),2==keys.length&&keys[0]==this.name&&e.call(t||this,keys[1],n[n[i]])}}},ie:{prefix:"_persist_data-",size:65536,test:function(){return!!window.ActiveXObject},make_userdata:function(e){var t=document.createElement("div");return t.id=e,t.style.display="none",t.addBehavior("#default#userdata"),document.body.appendChild(t),t},methods:{init:function(){var e=t.ie.prefix+n(this.name);this.el=t.ie.make_userdata(e),this.o.defer&&this.load()},get:function(e){return e=n(e),this.o.defer||this.load(),this.el.getAttribute(e)},set:function(e,t){return e=n(e),this.el.setAttribute(e,t),this.o.defer||this.save(),t},remove:function(e){var t;return e=n(e),this.o.defer||this.load(),t=this.el.getAttribute(e),this.el.removeAttribute(e),this.o.defer||this.save(),t},load:function(){this.el.load(n(this.name))},save:function(){this.el.save(n(this.name))}}},cookie:{delim:":",size:4e3,test:function(){return!!e.Cookie.enabled},methods:{key:function(e){return this.name+t.cookie.delim+e},get:function(e,t){return e=this.key(e),o.get(e)},set:function(e,t,n){return e=this.key(e),o.set(e,t,this.o),t},remove:function(e,t){return e=this.key(e),o.remove(e)}}},flash:{test:function(){return!(!deconcept||!deconcept.SWFObjectUtil)&&deconcept.SWFObjectUtil.getPlayerVersion().major>=8},methods:{init:function(){if(!t.flash.el){var e,n,i,r=c.flash;(i=document.createElement("div")).id=r.div_id,document.body.appendChild(i),e=new deconcept.SWFObject(this.o.swf_path||r.path,r.id,r.size.w,r.size.h,"8");for(n in r.args)"function"!=r.args[n]&&e.addVariable(n,r.args[n]);e.write(i),t.flash.el=document.getElementById(r.id)}this.el=t.flash.el},get:function(e){return e=n(e),this.el.get(this.name,e)},set:function(e,t){return e=n(e),this.el.set(this.name,e,t)},remove:function(e){return e=n(e),this.el.remove(this.name,e)}}}},a=function(){for(var n,i,r=c.methods,a=c.search_order,o=0,l=r.length;o<l;o++)e.Store.prototype[r[o]]=s;e.type=null,e.size=-1;for(var u=0,d=a.length;!e.type&&u<d;u++)if((n=t[a[u]]).test()){e.type=a[u],e.size=n.size;for(i in n.methods)e.Store.prototype[i]=n.methods[i]}e._init=!0},e={VERSION:"0.3.0",type:null,size:0,add:function(e){t[e.id]=e,c.search_order=[e.id].concat(c.search_order),a()},remove:function(e){var n=l(c.search_order,e);n<0||(c.search_order.splice(n,1),delete t[e],a())},Cookie:o,Store:function(t,n){if(!c.name_re.exec(t))throw new Error("Invalid name");if(!e.type)throw new Error("No suitable storage found");n=n||{},this.name=t,n.domain=n.domain||location.hostname||"localhost",n.domain=n.domain.replace(/:\d+$/,""),n.domain="localhost"==n.domain?"":n.domain,this.o=n,n.expires=n.expires||730,n.path=n.path||"/",this.init()}},a(),e}(),e.Persist=Persist}.apply(e,arguments)})}(this),define("js/components/persistent_storage",["underscore","js/components/generic_module","js/mixins/dependon","persist-js","module"],function(e,t,n,i,r){var a=r.config().namespace||"",s=t.extend({constructor:function(e){e=e||{},this._store=this.createStore(a+(e.name||""))},createStore:function(e){return this._createStore(e)},_createStore:function(t){var n=new i.Store(t,{about:"This is bumblebee persistent storage",defer:!0}),r=n.get("#keys");if(r)try{r=JSON.parse(r),e.isObject(r)||n.set("#keys","{}")}catch(e){n.set("#keys","{}")}else n.set("#keys","{}");return n},set:function(t,n){this._checkKey(t),e.isString(n)||(n=JSON.stringify(n)),this._store.set(t,n),this._setKey(t)},get:function(e){this._checkKey(e);var t=this._store.get(e);if(!t)return t;try{return JSON.parse(t)}catch(e){return t}},remove:function(e){this._checkKey(e),this._store.remove(e),this._delKey(e)},clear:function(){var e=this.get("#keys");for(var t in e)this._store.remove(t);this._store.set("#keys","{}")},keys:function(){return JSON.parse(this._store.get("#keys"))},_setKey:function(e){var t=this.keys();t[e]=1,this._store.set("#keys",JSON.stringify(t))},_delKey:function(e){var t=this.keys();delete t[e],this._store.set("#keys",JSON.stringify(t))},_checkKey:function(t){if(!e.isString(t))throw new Error("key must be string, received: "+t)}});return e.extend(s.prototype,n.BeeHive),s}),define("js/services/storage",["underscore","js/components/persistent_storage"],function(e,t){var n=t.extend({activate:function(e){},onAppBootstrapped:function(){var e=this.getBeeHive().getObject("DynamicConfig");if(!e)throw new Error("DynamicConfig is missing");var t=e.namespace;t||(console.warn("Application namespace not set; persistent storage will be created without it"),t=""),this._store=this._createStore(t)}});return function(){return new n({name:"storage-service"})}}),define("js/components/history_manager",["js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/pubsub_key"],function(e,t,n,i){var r=e.extend({initialize:function(){this._history=[]},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.NAVIGATE,_.bind(this.recordNav,this))},recordNav:function(){this._history.push([].slice.apply(arguments))},getCurrentNav:function(){return this._history[this._history.length-1]},getPreviousNav:function(){return this._history[this._history.length-2]},hardenedInterface:{getPreviousNav:"",getCurrentNav:""}});return _.extend(r.prototype,t.BeeHive,n),r}),define("js/components/user",["backbone","js/components/api_request","js/components/api_targets","js/components/generic_module","js/mixins/dependon","js/mixins/hardened","js/components/api_feedback","js/mixins/api_access"],function(e,t,n,i,r,a,s,o){var l,c,u;return l=e.Model.extend({defaults:function(){return{isOrcidModeOn:!1,perPage:void 0}}}),c=e.Model.extend({defaults:function(){return{user:void 0,link_server:void 0}}}),u=i.extend({initialize:function(e){this.localStorageModel=new l,this.listenTo(this.localStorageModel,"change",this.broadcastUserDataChange),this.userModel=new c,this.listenTo(this.userModel,"change:user",this.broadcastUserChange),this.listenTo(this.userModel,"change",function(e){"user"!==e&&this.broadcastUserDataChange.apply(this,arguments)}),_.bindAll(this,"completeLogIn","completeLogOut"),this.base_url=this.test?"location.origin":location.origin,this.buildAdditionalParameters()},activate:function(e){this.setBeeHive(e);this.getPubSub().subscribe(this.getPubSub().APP_STARTING,function(){var t=e.getService("OrcidApi"),n=e.getObject("User");null!==t.authData&&t.checkAccessOrcidApiAccess().fail(function(){401==arguments[0][0].status&&(t.signOut(),n.setOrcidMode(0))})});var t=e.getService("PersistentStorage");if(t){var n=t.get("UserPreferences");n&&this.localStorageModel.set(n)}},_persistModel:function(){var e=this.getBeeHive().getService("PersistentStorage");e&&e.set("UserPreferences",this.localStorageModel.toJSON())},setLocalStorage:function(e){this.localStorageModel.set(e),this._persistModel()},getLocalStorage:function(e){return this.localStorageModel.toJSON()},setOrcidMode:function(e){this.localStorageModel.set("isOrcidModeOn",e),this._persistModel()},isOrcidModeOn:function(){return this.localStorageModel.get("isOrcidModeOn")},broadcastUserDataChange:function(e){this.getPubSub().publish(this.getPubSub().USER_ANNOUNCEMENT,this.USER_INFO_CHANGE,e.changed)},broadcastUserChange:function(){var e=this.userModel.get("user")?this.USER_SIGNED_IN:this.USER_SIGNED_OUT;this.getPubSub().publish(this.getPubSub().USER_ANNOUNCEMENT,e,this.userModel.get("user")),this.redirectIfNecessary()},buildAdditionalParameters:function(){var e={};e.CHANGE_EMAIL={verify_url:this.base_url+"/#user/account/verify/change-email"},this.additionalParameters=e},handleFailedPOST:function(e,t,n,i){var r;this.getPubSub();r=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText?e.responseText:"error unknown",console.error("POST request failed for endpoint: ["+i+"]",r)},handleFailedGET:function(e,t,n,i){var r;this.getPubSub();r=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseText?e.responseText:"error unknown",console.error("GET request failed for endpoint: ["+i+"]",r)},fetchData:function(e){return this.composeRequest({target:e,method:"GET"})},postData:function(e,t){return this.additionalParameters[e]&&_.extend(t,this.additionalParameters[e]),this.composeRequest({target:e,method:"POST",data:t})},putData:function(e,t){return this.additionalParameters[e]&&_.extend(t,this.additionalParameters[e]),this.composeRequest({target:e,method:"PUT",data:t})},sendRequestWithNewCSRF:function(e){e=_.bind(e,this),this.getBeeHive().getObject("CSRFManager").getCSRF().done(e)},composeRequest:function(e){var i,r=e.target,a=e.method,s=(o=e.data||{}).csrf,o=_.omit(o,"csrf"),l=n[r],c=this,u=$.Deferred();return i={target:l,options:{context:this,type:a,data:_.isEmpty(o)?void 0:JSON.stringify(o),contentType:"application/json",done:function(){u.resolve.apply(void 0,arguments)},fail:function(){var e="GET"==a?c.handleFailedGET:c.handleFailedPOST,t=[].slice.apply(arguments);t.push(r),e.apply(c,t),u.fail.apply(void 0,arguments)}}},s?this.sendRequestWithNewCSRF(function(e){i.options.headers={"X-CSRFToken":e},this.getBeeHive().getService("Api").request(new t(i))}):this.getBeeHive().getService("Api").request(new t(i)),u},redirectIfNecessary:function(){var e=this.getPubSub();if("AuthenticationPage"===this.getBeeHive().getObject("MasterPageManager").currentChild&&this.isLoggedIn()){var t=this.getBeeHive().getService("HistoryManager").getPreviousNav();t||(t="index-page"),e.publish.apply(e,[e.NAVIGATE].concat(t))}else"SettingsPage"!==this.getBeeHive().getObject("MasterPageManager").currentChild||this.isLoggedIn()||e.publish(e.NAVIGATE,"authentication-page")},setUser:function(e){this.userModel.set("user",e),this.isLoggedIn()&&this.completeLogIn()},completeLogIn:function(){var e=this;this.fetchData("USER_DATA").done(function(t){e.userModel.set(t)})},completeLogOut:function(){this.userModel.clear()},deleteAccount:function(){var e=this;return this.postData("DELETE",{csrf:!0}).done(function(){e.getApiAccess({reconnect:!0}).done(function(){e.completeLogOut()})})},changeEmail:function(e){var t=e.email;return e=_.extend(e,{csrf:!0}),this.postData("CHANGE_EMAIL",e).done(_.bind(function(){this.getPubSub().subscribeOnce(this.getPubSub().NAVIGATE,_.bind(function(){var e="<p>Please check <b>"+t+"</b> for further instructions</p><p>(If you don't see the email, please <b>check your spam folder</b>)</p>";this.getPubSub().publish(this.getPubSub().ALERT,new s({code:0,msg:e,type:"success",title:"Success",modal:!0}))},this)),this.getBeeHive().getObject("Session").logout()},this))},changePassword:function(e){return e=_.extend(e,{csrf:!0}),this.postData("CHANGE_PASSWORD",e)},getToken:function(){return this.fetchData("TOKEN")},generateToken:function(){return this.putData("TOKEN",{csrf:!0})},getUserData:function(){return this.userModel.toJSON()},setUserData:function(e){var t=this;return this.postData("USER_DATA",e).done(function(e){t.userModel.set(e)})},getUserName:function(){return this.userModel.get("user")},isLoggedIn:function(){return!!this.userModel.get("user")},setMyADSData:function(e){return this.postData("USER_DATA",e)},getOpenURLConfig:function(){return this.getSiteConfig("link_servers")},getSiteConfig:function(e){var i=$.Deferred(),r=new t({target:e?n.SITE_CONFIGURATION+"/"+e:n.SITE_CONFIGURATION,options:{type:"GET",done:function(e){i.resolve(e)},fail:function(e){i.reject(e)}}});return this.getBeeHive().getService("Api").request(r),i.promise()},hardenedInterface:{setUser:"set username into user",isLoggedIn:"whether the user is logged in",getUserName:"get the user's email before the @",setLocalStorage:"sets an object in to user's local storage",getLocalStorage:"gives you a json object for user's local storage",isOrcidModeOn:"figure out if user has Orcid mode activated",setOrcidMode:"set orcid ui on or off",getOpenURLConfig:"get list of openurl endpoints",getUserData:"myads data",setUserData:"POST user data to myads endpoint",generateToken:"PUT to token endpoint to make a new token",getToken:"GET from token endpoint",deleteAccount:"POST to delete account endpoint",changePassword:"POST to change password endpoint",changeEmail:"POST to change email endpoint",setMyADSData:"",USER_SIGNED_IN:"constant",USER_SIGNED_OUT:"constant",USER_INFO_CHANGE:"constant"}}),_.extend(u.prototype,a,r.BeeHive,r.App,o,{USER_SIGNED_IN:"user_signed_in",USER_SIGNED_OUT:"user_signed_out",USER_INFO_CHANGE:"user_info_change"}),u}),define("js/components/session",["backbone","js/components/api_request","js/components/api_targets","js/mixins/hardened","js/components/generic_module","js/mixins/dependon","js/components/api_query","js/components/user","js/components/api_feedback","js/mixins/api_access"],function(e,t,n,i,r,a,s,o,l,c){var u=e.Model.extend({defaults:function(){return{resetPasswordToken:void 0}}}),d=r.extend({initialize:function(e){var e=e||{};this.model=new u,this.test=!!e.test||void 0,_.bindAll(this,["loginSuccess","loginFail","registerSuccess","registerFail","resetPassword1Success","resetPassword1Fail","resetPassword2Success","resetPassword2Fail"])},activate:function(e){this.setBeeHive(e)},login:function(e){var i=$.Deferred(),r=this;return this.sendRequestWithNewCSRF(function(a){var o=new t({target:n.USER,query:new s({}),options:{type:"POST",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":a},done:function(){i.resolve.apply(i,arguments),r.loginSuccess.apply(r,arguments)},fail:function(){i.reject.apply(i,arguments),r.loginFail.apply(r,arguments)},beforeSend:function(e,t){e.session=this}}});return this.getBeeHive().getService("Api").request(o)}),i.promise()},sendRequestWithNewCSRF:function(e){e=_.bind(e,this),this.getBeeHive().getObject("CSRFManager").getCSRF().done(e)},logout:function(){this.sendRequestWithNewCSRF(function(e){var i=new t({target:n.LOGOUT,query:new s({}),options:{context:this,type:"POST",headers:{"X-CSRFToken":e},contentType:"application/json",done:this.logoutSuccess}});return this.getBeeHive().getService("Api").request(i)})},register:function(e){var i=this.test?"location.origin":location.origin;_.extend(e,{verify_url:i+"/#user/account/verify/register"}),this.sendRequestWithNewCSRF(function(i){var r=new t({target:n.REGISTER,query:new s({}),options:{type:"POST",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":i},done:this.registerSuccess,fail:this.registerFail}});return this.getBeeHive().getService("Api").request(r)})},resetPassword1:function(e){var i=this.test?"location.origin":location.origin;_.extend(e,{reset_url:i+"/#user/account/verify/reset-password"});var r=e.email,e=_.omit(e,"email");this.sendRequestWithNewCSRF(function(i){var a=new t({target:n.RESET_PASSWORD+"/"+r,query:new s({}),options:{type:"POST",data:JSON.stringify(e),headers:{"X-CSRFToken":i},contentType:"application/json",done:this.resetPassword1Success,fail:this.resetPassword1Fail}});return this.getBeeHive().getService("Api").request(a)})},resetPassword2:function(e){this.sendRequestWithNewCSRF(function(i){var r=new t({target:n.RESET_PASSWORD+"/"+this.model.get("resetPasswordToken"),query:new s({}),options:{type:"PUT",data:JSON.stringify(e),contentType:"application/json",headers:{"X-CSRFToken":i},done:this.resetPassword2Success,fail:this.resetPassword2Fail}});return this.getBeeHive().getService("Api").request(r)})},setChangeToken:function(e){this.model.set("resetPasswordToken",e)},loginSuccess:function(e,t,n){this.getApiAccess({reconnect:!0}).done(function(){})},loginFail:function(e,t,n){var i,r=this.getPubSub(),a="Log in was unsuccessful ("+(i=e.responseJSON&&e.responseJSON.error?e.responseJSON.error:e.responseJSON&&e.responseJSON.message?e.responseJSON.message:"error unknown")+")";r.publish(r.ALERT,new l({code:0,msg:a,type:"danger",fade:!0})),r.publish(r.USER_ANNOUNCEMENT,"login_fail")},logoutSuccess:function(e,t,n){var i=this;this.getApiAccess({reconnect:!0}).done(function(){i.getBeeHive().getObject("User").completeLogOut()})},registerSuccess:function(e,t,n){var i=this.getPubSub();i.publish(i.USER_ANNOUNCEMENT,"register_success")},registerFail:function(e,t,n){var i=this.getPubSub(),r="Registration was unsuccessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:r,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"register_fail")},resetPassword1Success:function(e,t,n){var i=this.getPubSub();i.publish(i.USER_ANNOUNCEMENT,"reset_password_1_success")},resetPassword1Fail:function(e,t,n){var i=this.getPubSub(),r="password reset step 1 was unsucessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:r,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"reset_password_1_fail")},resetPassword2Success:function(e,t,n){var i,r;i=this.getApiAccess({reconnect:!0}),r=this.getPubSub(),i.done(function(){r.publish(r.USER_ANNOUNCEMENT,"reset_password_2_success"),r.publish(r.NAVIGATE,"index-page");r.publish(r.ALERT,new l({code:0,msg:"Your password has been successfully reset!",type:"success",modal:!0}))}),i.fail(function(){r.publish(r.USER_ANNOUNCEMENT,"reset_password_2_fail");r.publish(r.ALERT,new l({code:0,msg:"Your password was not successfully reset. Please try to follow the link from the email you received again.",type:"danger",modal:!0}))})},resetPassword2Fail:function(e,t,n){var i=this.getPubSub(),r="password reset step 2 was unsucessful ("+(e.responseJSON&&e.responseJSON.error?e.responseJSON.error:"error unknown")+")";i.publish(i.ALERT,new l({code:0,msg:r,type:"danger",fade:!0})),i.publish(i.USER_ANNOUNCEMENT,"reset_password_2_fail")},hardenedInterface:{login:"log the user in",logout:"log the user out",register:"registers a new user",resetPassword1:"sends an email to account",resetPassword2:"updates the password",setChangeToken:"the router stores the token to reset password here"}});return _.extend(d.prototype,a.BeeHive,i,c),d}),function(e,t){if("function"==typeof define&&define.amd)define("marionette",["backbone","underscore"],function(n,i){return e.Marionette=e.Mn=t(e,n,i)});else if("undefined"!=typeof exports){var n=require("backbone"),i=require("underscore");module.exports=t(e,n,i)}else e.Marionette=e.Mn=t(e,e.Backbone,e._)}(this,function(e,t,n){"use strict";!function(e,t){var n=e.ChildViewContainer;e.ChildViewContainer=function(e,t){var n=function(e){this._views={},this._indexByModel={},this._indexByCustom={},this._updateLength(),t.each(e,this.add,this)};t.extend(n.prototype,{add:function(e,t){var n=e.cid;return this._views[n]=e,e.model&&(this._indexByModel[e.model.cid]=n),t&&(this._indexByCustom[t]=n),this._updateLength(),this},findByModel:function(e){return this.findByModelCid(e.cid)},findByModelCid:function(e){var t=this._indexByModel[e];return this.findByCid(t)},findByCustom:function(e){var t=this._indexByCustom[e];return this.findByCid(t)},findByIndex:function(e){return t.values(this._views)[e]},findByCid:function(e){return this._views[e]},remove:function(e){var n=e.cid;return e.model&&delete this._indexByModel[e.model.cid],t.any(this._indexByCustom,function(e,t){if(e===n)return delete this._indexByCustom[t],!0},this),delete this._views[n],this._updateLength(),this},call:function(e){this.apply(e,t.tail(arguments))},apply:function(e,n){t.each(this._views,function(i){t.isFunction(i[e])&&i[e].apply(i,n||[])})},_updateLength:function(){this.length=t.size(this._views)}});var i=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck","reduce"];return t.each(i,function(e){n.prototype[e]=function(){var n=[t.values(this._views)].concat(t.toArray(arguments));return t[e].apply(t,n)}}),n}(0,t),e.ChildViewContainer.VERSION="0.1.11",e.ChildViewContainer.noConflict=function(){return e.ChildViewContainer=n,this},e.ChildViewContainer}(t,n),function(e,t){var n=e.Wreqr,i=e.Wreqr={};e.Wreqr.VERSION="1.3.6",e.Wreqr.noConflict=function(){return e.Wreqr=n,this},i.Handlers=function(e,t){var n=function(e){this.options=e,this._wreqrHandlers={},t.isFunction(this.initialize)&&this.initialize(e)};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events,{setHandlers:function(e){t.each(e,function(e,n){var i=null;t.isObject(e)&&!t.isFunction(e)&&(i=e.context,e=e.callback),this.setHandler(n,e,i)},this)},setHandler:function(e,t,n){var i={callback:t,context:n};this._wreqrHandlers[e]=i,this.trigger("handler:add",e,t,n)},hasHandler:function(e){return!!this._wreqrHandlers[e]},getHandler:function(e){var t=this._wreqrHandlers[e];if(t)return function(){return t.callback.apply(t.context,arguments)}},removeHandler:function(e){delete this._wreqrHandlers[e]},removeAllHandlers:function(){this._wreqrHandlers={}}}),n}(e,t),i.CommandStorage=function(){var n=function(e){this.options=e,this._commands={},t.isFunction(this.initialize)&&this.initialize(e)};return t.extend(n.prototype,e.Events,{getCommands:function(e){var t=this._commands[e];return t||(t={command:e,instances:[]},this._commands[e]=t),t},addCommand:function(e,t){this.getCommands(e).instances.push(t)},clearCommands:function(e){this.getCommands(e).instances=[]}}),n}(),i.Commands=function(e,t){return e.Handlers.extend({storageType:e.CommandStorage,constructor:function(t){this.options=t||{},this._initializeStorage(this.options),this.on("handler:add",this._executeCommands,this),e.Handlers.prototype.constructor.apply(this,arguments)},execute:function(e){e=arguments[0];var n=t.rest(arguments);this.hasHandler(e)?this.getHandler(e).apply(this,n):this.storage.addCommand(e,n)},_executeCommands:function(e,n,i){var r=this.storage.getCommands(e);t.each(r.instances,function(e){n.apply(i,e)}),this.storage.clearCommands(e)},_initializeStorage:function(e){var n,i=e.storageType||this.storageType;n=t.isFunction(i)?new i:i,this.storage=n}})}(i,t),i.RequestResponse=function(e,t){return e.Handlers.extend({request:function(e){if(this.hasHandler(e))return this.getHandler(e).apply(this,t.rest(arguments))}})}(i,t),i.EventAggregator=function(e,t){var n=function(){};return n.extend=e.Model.extend,t.extend(n.prototype,e.Events),n}(e,t),i.Channel=function(n){var i=function(t){this.vent=new e.Wreqr.EventAggregator,this.reqres=new e.Wreqr.RequestResponse,this.commands=new e.Wreqr.Commands,this.channelName=t};return t.extend(i.prototype,{reset:function(){return this.vent.off(),this.vent.stopListening(),this.reqres.removeAllHandlers(),this.commands.removeAllHandlers(),this},connectEvents:function(e,t){return this._connect("vent",e,t),this},connectCommands:function(e,t){return this._connect("commands",e,t),this},connectRequests:function(e,t){return this._connect("reqres",e,t),this},_connect:function(e,n,i){if(n){i=i||this;var r="vent"===e?"on":"setHandler";t.each(n,function(n,a){this[e][r](a,t.bind(n,i))},this)}}}),i}(),i.radio=function(e,t){var n=function(){this._channels={},this.vent={},this.commands={},this.reqres={},this._proxyMethods()};t.extend(n.prototype,{channel:function(e){if(!e)throw new Error("Channel must receive a name");return this._getChannel(e)},_getChannel:function(t){var n=this._channels[t];return n||(n=new e.Channel(t),this._channels[t]=n),n},_proxyMethods:function(){t.each(["vent","commands","reqres"],function(e){t.each(i[e],function(t){this[e][t]=r(this,e,t)},this)},this)}});var i={vent:["on","off","trigger","once","stopListening","listenTo","listenToOnce"],commands:["execute","setHandler","setHandlers","removeHandler","removeAllHandlers"],reqres:["request","setHandler","setHandlers","removeHandler","removeAllHandlers"]},r=function(e,n,i){return function(r){var a=e._getChannel(r)[n];return a[i].apply(a,t.rest(arguments))}};return new n}(i,t),e.Wreqr}(t,n);var i=e.Marionette,r=e.Mn,a=t.Marionette={};a.VERSION="2.4.5",a.noConflict=function(){return e.Marionette=i,e.Mn=r,this},t.Marionette=a,a.Deferred=t.$.Deferred,a.extend=t.Model.extend,a.isNodeAttached=function(e){return t.$.contains(document.documentElement,e)},a.mergeOptions=function(e,t){e&&n.extend(this,n.pick(e,t))},a.getOption=function(e,t){if(e&&t)return e.options&&void 0!==e.options[t]?e.options[t]:e[t]},a.proxyGetOption=function(e){return a.getOption(this,e)},a._getValue=function(e,t,i){return n.isFunction(e)&&(e=i?e.apply(t,i):e.call(t)),e},a.normalizeMethods=function(e){return n.reduce(e,function(e,t,i){return n.isFunction(t)||(t=this[t]),t&&(e[i]=t),e},{},this)},a.normalizeUIString=function(e,t){return e.replace(/@ui\.[a-zA-Z-_$0-9]*/g,function(e){return t[e.slice(4)]})},a.normalizeUIKeys=function(e,t){return n.reduce(e,function(e,n,i){return e[a.normalizeUIString(i,t)]=n,e},{})},a.normalizeUIValues=function(e,t,i){return n.each(e,function(r,s){n.isString(r)?e[s]=a.normalizeUIString(r,t):n.isObject(r)&&n.isArray(i)&&(n.extend(r,a.normalizeUIValues(n.pick(r,i),t)),n.each(i,function(e){var i=r[e];n.isString(i)&&(r[e]=a.normalizeUIString(i,t))}))}),e},a.actAsCollection=function(e,t){var i=["forEach","each","map","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","toArray","first","initial","rest","last","without","isEmpty","pluck"];n.each(i,function(i){e[i]=function(){var e=[n.values(n.result(this,t))].concat(n.toArray(arguments));return n[i].apply(n,e)}})};var s=a.deprecate=function(e,t){n.isObject(e)&&(e=e.prev+" is going to be removed in the future. Please use "+e.next+" instead."+(e.url?" See: "+e.url:"")),void 0!==t&&t||s._cache[e]||(s._warn("Deprecation warning: "+e),s._cache[e]=!0)};s._console="undefined"!=typeof console?console:{},s._warn=function(){return(s._console.warn||s._console.log||function(){}).apply(s._console,arguments)},s._cache={},a._triggerMethod=function(){function e(e,t,n){return n.toUpperCase()}var t=/(^|:)(\w)/gi;return function(i,r,a){var s=arguments.length<3;s&&(r=(a=r)[0]);var o,l=i["on"+r.replace(t,e)];return n.isFunction(l)&&(o=l.apply(i,s?n.rest(a):a)),n.isFunction(i.trigger)&&(s+a.length>1?i.trigger.apply(i,s?a:[r].concat(n.drop(a,0))):i.trigger(r)),o}}(),a.triggerMethod=function(e){return a._triggerMethod(this,arguments)},a.triggerMethodOn=function(e){return(n.isFunction(e.triggerMethod)?e.triggerMethod:a.triggerMethod).apply(e,n.rest(arguments))},a.MonitorDOMRefresh=function(e){function t(){e._isShown&&e._isRendered&&a.isNodeAttached(e.el)&&a.triggerMethodOn(e,"dom:refresh",e)}e._isDomRefreshMonitored||(e._isDomRefreshMonitored=!0,e.on({show:function(){e._isShown=!0,t()},render:function(){e._isRendered=!0,t()}}))},function(e){function t(t,i,r,a){var s=a.split(/\s+/);n.each(s,function(n){var a=t[n];if(!a)throw new e.Error('Method "'+n+'" was configured as an event handler, but does not exist.');t.listenTo(i,r,a)})}function i(e,t,n,i){e.listenTo(t,n,i)}function r(e,t,i,r){var a=r.split(/\s+/);n.each(a,function(n){var r=e[n];e.stopListening(t,i,r)})}function a(e,t,n,i){e.stopListening(t,n,i)}function s(t,i,r,a,s){if(i&&r){if(!n.isObject(r))throw new e.Error({message:"Bindings must be an object or function.",url:"marionette.functions.html#marionettebindentityevents"});r=e._getValue(r,t),n.each(r,function(e,r){n.isFunction(e)?a(t,i,r,e):s(t,i,r,e)})}}e.bindEntityEvents=function(e,n,r){s(e,n,r,i,t)},e.unbindEntityEvents=function(e,t,n){s(e,t,n,a,r)},e.proxyBindEntityEvents=function(t,n){return e.bindEntityEvents(this,t,n)},e.proxyUnbindEntityEvents=function(t,n){return e.unbindEntityEvents(this,t,n)}}(a);var o=["description","fileName","lineNumber","name","message","number"];return a.Error=a.extend.call(Error,{urlRoot:"http://marionettejs.com/docs/v"+a.VERSION+"/",constructor:function(e,t){n.isObject(e)?e=(t=e).message:t||(t={});var i=Error.call(this,e);n.extend(this,n.pick(i,o),n.pick(t,o)),this.captureStackTrace(),t.url&&(this.url=this.urlRoot+t.url)},captureStackTrace:function(){Error.captureStackTrace&&Error.captureStackTrace(this,a.Error)},toString:function(){return this.name+": "+this.message+(this.url?" See: "+this.url:"")}}),a.Error.extend=a.extend,a.Callbacks=function(){this._deferred=a.Deferred(),this._callbacks=[]},n.extend(a.Callbacks.prototype,{add:function(e,t){var i=n.result(this._deferred,"promise");this._callbacks.push({cb:e,ctx:t}),i.then(function(n){t&&(n.context=t),e.call(n.context,n.options)})},run:function(e,t){this._deferred.resolve({options:e,context:t})},reset:function(){var e=this._callbacks;this._deferred=a.Deferred(),this._callbacks=[],n.each(e,function(e){this.add(e.cb,e.ctx)},this)}}),a.Controller=function(e){this.options=e||{},n.isFunction(this.initialize)&&this.initialize(this.options)},a.Controller.extend=a.extend,n.extend(a.Controller.prototype,t.Events,{destroy:function(){return a._triggerMethod(this,"before:destroy",arguments),a._triggerMethod(this,"destroy",arguments),this.stopListening(),this.off(),this},triggerMethod:a.triggerMethod,mergeOptions:a.mergeOptions,getOption:a.proxyGetOption}),a.Object=function(e){this.options=n.extend({},n.result(this,"options"),e),this.initialize.apply(this,arguments)},a.Object.extend=a.extend,n.extend(a.Object.prototype,t.Events,{initialize:function(){},destroy:function(e){return e=e||{},this.triggerMethod("before:destroy",e),this.triggerMethod("destroy",e),this.stopListening(),this},triggerMethod:a.triggerMethod,mergeOptions:a.mergeOptions,getOption:a.proxyGetOption,bindEntityEvents:a.proxyBindEntityEvents,unbindEntityEvents:a.proxyUnbindEntityEvents}),a.Region=a.Object.extend({constructor:function(e){if(this.options=e||{},this.el=this.getOption("el"),this.el=this.el instanceof t.$?this.el[0]:this.el,!this.el)throw new a.Error({name:"NoElError",message:'An "el" must be specified for a region.'});this.$el=this.getEl(this.el),a.Object.call(this,e)},show:function(e,t){if(this._ensureElement()){this._ensureViewIsIntact(e),a.MonitorDOMRefresh(e);var i=t||{},r=e!==this.currentView,s=!!i.preventDestroy,o=!!i.forceShow,l=!!this.currentView,c=r&&!s,u=r||o;if(l&&this.triggerMethod("before:swapOut",this.currentView,this,t),this.currentView&&r&&delete this.currentView._parent,c?this.empty():l&&u&&this.currentView.off("destroy",this.empty,this),u){e.once("destroy",this.empty,this),e._parent=this,this._renderView(e),l&&this.triggerMethod("before:swap",e,this,t),this.triggerMethod("before:show",e,this,t),a.triggerMethodOn(e,"before:show",e,this,t),l&&this.triggerMethod("swapOut",this.currentView,this,t);var d=a.isNodeAttached(this.el),h=[],p=n.extend({triggerBeforeAttach:this.triggerBeforeAttach,triggerAttach:this.triggerAttach},i);return d&&p.triggerBeforeAttach&&(h=this._displayedViews(e),this._triggerAttach(h,"before:")),this.attachHtml(e),this.currentView=e,d&&p.triggerAttach&&(h=this._displayedViews(e),this._triggerAttach(h)),l&&this.triggerMethod("swap",e,this,t),this.triggerMethod("show",e,this,t),a.triggerMethodOn(e,"show",e,this,t),this}return this}},triggerBeforeAttach:!0,triggerAttach:!0,_triggerAttach:function(e,t){var i=(t||"")+"attach";n.each(e,function(e){a.triggerMethodOn(e,i,e,this)},this)},_displayedViews:function(e){return n.union([e],n.result(e,"_getNestedViews")||[])},_renderView:function(e){e.supportsRenderLifecycle||a.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||a.triggerMethodOn(e,"render",e)},_ensureElement:function(){if(n.isObject(this.el)||(this.$el=this.getEl(this.el),this.el=this.$el[0]),!this.$el||0===this.$el.length){if(this.getOption("allowMissingEl"))return!1;throw new a.Error('An "el" '+this.$el.selector+" must exist in DOM")}return!0},_ensureViewIsIntact:function(e){if(!e)throw new a.Error({name:"ViewNotValid",message:"The view passed is undefined and therefore invalid. You must pass a view instance to show."});if(e.isDestroyed)throw new a.Error({name:"ViewDestroyedError",message:'View (cid: "'+e.cid+'") has already been destroyed and cannot be used.'})},getEl:function(e){return t.$(e,a._getValue(this.options.parentEl,this))},attachHtml:function(e){this.$el.contents().detach(),this.el.appendChild(e.el)},empty:function(e){var t=this.currentView,n=!!(e||{}).preventDestroy;return t?(t.off("destroy",this.empty,this),this.triggerMethod("before:empty",t),n||this._destroyView(),this.triggerMethod("empty",t),delete this.currentView,n&&this.$el.contents().detach(),this):this},_destroyView:function(){var e=this.currentView;e.isDestroyed||(e.supportsDestroyLifecycle||a.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():(e.remove(),e.isDestroyed=!0),e.supportsDestroyLifecycle||a.triggerMethodOn(e,"destroy",e))},attachView:function(e){return this.currentView&&delete this.currentView._parent,e._parent=this,this.currentView=e,this},hasView:function(){return!!this.currentView},reset:function(){return this.empty(),this.$el&&(this.el=this.$el.selector),delete this.$el,this}},{buildRegion:function(e,t){if(n.isString(e))return this._buildRegionFromSelector(e,t);if(e.selector||e.el||e.regionClass)return this._buildRegionFromObject(e,t);if(n.isFunction(e))return this._buildRegionFromRegionClass(e);throw new a.Error({message:"Improper region configuration type.",url:"marionette.region.html#region-configuration-types"})},_buildRegionFromSelector:function(e,t){return new t({el:e})},_buildRegionFromObject:function(e,t){var i=e.regionClass||t,r=n.omit(e,"selector","regionClass");return e.selector&&!r.el&&(r.el=e.selector),new i(r)},_buildRegionFromRegionClass:function(e){return new e}}),a.RegionManager=a.Controller.extend({constructor:function(e){this._regions={},this.length=0,a.Controller.call(this,e),this.addRegions(this.getOption("regions"))},addRegions:function(e,t){return e=a._getValue(e,this,arguments),n.reduce(e,function(e,i,r){return n.isString(i)&&(i={selector:i}),i.selector&&(i=n.defaults({},i,t)),e[r]=this.addRegion(r,i),e},{},this)},addRegion:function(e,t){var n;return n=t instanceof a.Region?t:a.Region.buildRegion(t,a.Region),this.triggerMethod("before:add:region",e,n),n._parent=this,this._store(e,n),this.triggerMethod("add:region",e,n),n},get:function(e){return this._regions[e]},getRegions:function(){return n.clone(this._regions)},removeRegion:function(e){var t=this._regions[e];return this._remove(e,t),t},removeRegions:function(){var e=this.getRegions();return n.each(this._regions,function(e,t){this._remove(t,e)},this),e},emptyRegions:function(){var e=this.getRegions();return n.invoke(e,"empty"),e},destroy:function(){return this.removeRegions(),a.Controller.prototype.destroy.apply(this,arguments)},_store:function(e,t){this._regions[e]||this.length++,this._regions[e]=t},_remove:function(e,t){this.triggerMethod("before:remove:region",e,t),t.empty(),t.stopListening(),delete t._parent,delete this._regions[e],this.length--,this.triggerMethod("remove:region",e,t)}}),a.actAsCollection(a.RegionManager.prototype,"_regions"),a.TemplateCache=function(e){this.templateId=e},n.extend(a.TemplateCache,{templateCaches:{},get:function(e,t){var n=this.templateCaches[e];return n||(n=new a.TemplateCache(e),this.templateCaches[e]=n),n.load(t)},clear:function(){var e,t=n.toArray(arguments),i=t.length;if(i>0)for(e=0;e<i;e++)delete this.templateCaches[t[e]];else this.templateCaches={}}}),n.extend(a.TemplateCache.prototype,{load:function(e){if(this.compiledTemplate)return this.compiledTemplate;var t=this.loadTemplate(this.templateId,e);return this.compiledTemplate=this.compileTemplate(t,e),this.compiledTemplate},loadTemplate:function(e,n){var i=t.$(e);if(!i.length)throw new a.Error({name:"NoTemplateError",message:'Could not find template: "'+e+'"'});return i.html()},compileTemplate:function(e,t){return n.template(e,t)}}),a.Renderer={render:function(e,t){if(!e)throw new a.Error({name:"TemplateNotFoundError",message:"Cannot render the template since its false, null or undefined."});return(n.isFunction(e)?e:a.TemplateCache.get(e))(t)}},a.View=t.View.extend({isDestroyed:!1,supportsRenderLifecycle:!0,supportsDestroyLifecycle:!0,constructor:function(e){this.render=n.bind(this.render,this),e=a._getValue(e,this),this.options=n.extend({},n.result(this,"options"),e),this._behaviors=a.Behaviors(this),t.View.call(this,this.options),a.MonitorDOMRefresh(this)},getTemplate:function(){return this.getOption("template")},serializeModel:function(e){return e.toJSON.apply(e,n.rest(arguments))},mixinTemplateHelpers:function(e){e=e||{};var t=this.getOption("templateHelpers");return t=a._getValue(t,this),n.extend(e,t)},normalizeUIKeys:function(e){var t=n.result(this,"_uiBindings");return a.normalizeUIKeys(e,t||n.result(this,"ui"))},normalizeUIValues:function(e,t){var i=n.result(this,"ui"),r=n.result(this,"_uiBindings");return a.normalizeUIValues(e,r||i,t)},configureTriggers:function(){if(this.triggers){var e=this.normalizeUIKeys(n.result(this,"triggers"));return n.reduce(e,function(e,t,n){return e[n]=this._buildViewTrigger(t),e},{},this)}},delegateEvents:function(e){return this._delegateDOMEvents(e),this.bindEntityEvents(this.model,this.getOption("modelEvents")),this.bindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.bindEntityEvents(this.model,e.getOption("modelEvents")),e.bindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_delegateDOMEvents:function(e){var i=a._getValue(e||this.events,this);i=this.normalizeUIKeys(i),n.isUndefined(e)&&(this.events=i);var r={},s=n.result(this,"behaviorEvents")||{},o=this.configureTriggers(),l=n.result(this,"behaviorTriggers")||{};n.extend(r,s,i,o,l),t.View.prototype.delegateEvents.call(this,r)},undelegateEvents:function(){return t.View.prototype.undelegateEvents.apply(this,arguments),this.unbindEntityEvents(this.model,this.getOption("modelEvents")),this.unbindEntityEvents(this.collection,this.getOption("collectionEvents")),n.each(this._behaviors,function(e){e.unbindEntityEvents(this.model,e.getOption("modelEvents")),e.unbindEntityEvents(this.collection,e.getOption("collectionEvents"))},this),this},_ensureViewIsIntact:function(){if(this.isDestroyed)throw new a.Error({name:"ViewDestroyedError",message:'View (cid: "'+this.cid+'") has already been destroyed and cannot be used.'})},destroy:function(){if(this.isDestroyed)return this;var e=n.toArray(arguments);return this.triggerMethod.apply(this,["before:destroy"].concat(e)),this.isDestroyed=!0,this.triggerMethod.apply(this,["destroy"].concat(e)),this.unbindUIElements(),this.isRendered=!1,this.remove(),n.invoke(this._behaviors,"destroy",e),this},bindUIElements:function(){this._bindUIElements(),n.invoke(this._behaviors,this._bindUIElements)},_bindUIElements:function(){if(this.ui){this._uiBindings||(this._uiBindings=this.ui);var e=n.result(this,"_uiBindings");this.ui={},n.each(e,function(e,t){this.ui[t]=this.$(e)},this)}},unbindUIElements:function(){this._unbindUIElements(),n.invoke(this._behaviors,this._unbindUIElements)},_unbindUIElements:function(){this.ui&&this._uiBindings&&(n.each(this.ui,function(e,t){delete this.ui[t]},this),this.ui=this._uiBindings,delete this._uiBindings)},_buildViewTrigger:function(e){var t=n.defaults({},e,{preventDefault:!0,stopPropagation:!0}),i=n.isObject(e)?t.event:e;return function(e){e&&(e.preventDefault&&t.preventDefault&&e.preventDefault(),e.stopPropagation&&t.stopPropagation&&e.stopPropagation());var n={view:this,model:this.model,collection:this.collection};this.triggerMethod(i,n)}},setElement:function(){var e=t.View.prototype.setElement.apply(this,arguments);return n.invoke(this._behaviors,"proxyViewProperties",this),e},triggerMethod:function(){var e=a._triggerMethod(this,arguments);return this._triggerEventOnBehaviors(arguments),this._triggerEventOnParentLayout(arguments[0],n.rest(arguments)),e},_triggerEventOnBehaviors:function(e){for(var t=a._triggerMethod,n=this._behaviors,i=0,r=n&&n.length;i<r;i++)t(n[i],e)},_triggerEventOnParentLayout:function(e,t){var i=this._parentLayoutView();if(i){var r=a.getOption(i,"childViewEventPrefix")+":"+e,s=[this].concat(t);a._triggerMethod(i,r,s);var o=a.getOption(i,"childEvents");o=a._getValue(o,i);var l=i.normalizeMethods(o);l&&n.isFunction(l[e])&&l[e].apply(i,s)}},_getImmediateChildren:function(){return[]},_getNestedViews:function(){var e=this._getImmediateChildren();return e.length?n.reduce(e,function(e,t){return t._getNestedViews?e.concat(t._getNestedViews()):e},e):e},_parentLayoutView:function(){for(var e=this._parent;e;){if(e instanceof a.LayoutView)return e;e=e._parent}},normalizeMethods:a.normalizeMethods,mergeOptions:a.mergeOptions,getOption:a.proxyGetOption,bindEntityEvents:a.proxyBindEntityEvents,unbindEntityEvents:a.proxyUnbindEntityEvents}),a.ItemView=a.View.extend({constructor:function(){a.View.apply(this,arguments)},serializeData:function(){if(!this.model&&!this.collection)return{};var e=[this.model||this.collection];return arguments.length&&e.push.apply(e,arguments),this.model?this.serializeModel.apply(this,e):{items:this.serializeCollection.apply(this,e)}},serializeCollection:function(e){return e.toJSON.apply(e,n.rest(arguments))},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderTemplate(),this.isRendered=!0,this.bindUIElements(),this.triggerMethod("render",this),this},_renderTemplate:function(){var e=this.getTemplate();if(!1!==e){if(!e)throw new a.Error({name:"UndefinedTemplateError",message:"Cannot render the template since it is null or undefined."});var t=this.mixinTemplateHelpers(this.serializeData()),n=a.Renderer.render(e,t,this);return this.attachElContent(n),this}},attachElContent:function(e){return this.$el.html(e),this}}),a.CollectionView=a.View.extend({childViewEventPrefix:"childview",sort:!0,constructor:function(e){this.once("render",this._initialEvents),this._initChildViewStorage(),a.View.apply(this,arguments),this.on({"before:show":this._onBeforeShowCalled,show:this._onShowCalled,"before:attach":this._onBeforeAttachCalled,attach:this._onAttachCalled}),this.initRenderBuffer()},initRenderBuffer:function(){this._bufferedChildren=[]},startBuffering:function(){this.initRenderBuffer(),this.isBuffering=!0},endBuffering:function(){var e,t=this._isShown&&a.isNodeAttached(this.el);this.isBuffering=!1,this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"before:show"),t&&this._triggerBeforeAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"before:attach")),this.attachBuffer(this,this._createBuffer()),t&&this._triggerAttach&&(e=this._getNestedViews(),this._triggerMethodMany(e,this,"attach")),this._isShown&&this._triggerMethodMany(this._bufferedChildren,this,"show"),this.initRenderBuffer()},_triggerMethodMany:function(e,t,i){var r=n.drop(arguments,3);n.each(e,function(e){a.triggerMethodOn.apply(e,[e,i,e,t].concat(r))})},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this.render),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},_onCollectionAdd:function(e,t,i){var r=void 0!==i.at&&(i.index||t.indexOf(e));if((this.getOption("filter")||!1===r)&&(r=n.indexOf(this._filteredSortedModels(r),e)),this._shouldAddChild(e,r)){this.destroyEmptyView();var a=this.getChildView(e);this.addChild(e,a,r)}},_onCollectionRemove:function(e){var t=this.children.findByModel(e);this.removeChildView(t),this.checkEmpty()},_onBeforeShowCalled:function(){this._triggerBeforeAttach=this._triggerAttach=!1,this.children.each(function(e){a.triggerMethodOn(e,"before:show",e)})},_onShowCalled:function(){this.children.each(function(e){a.triggerMethodOn(e,"show",e)})},_onBeforeAttachCalled:function(){this._triggerBeforeAttach=!0},_onAttachCalled:function(){this._triggerAttach=!0},render:function(){return this._ensureViewIsIntact(),this.triggerMethod("before:render",this),this._renderChildren(),this.isRendered=!0,this.triggerMethod("render",this),this},reorder:function(){var e=this.children,t=this._filteredSortedModels();if(n.some(t,function(t){return!e.findByModel(t)}))this.render();else{var i=n.map(t,function(t,n){var i=e.findByModel(t);return i._index=n,i.el}),r=e.filter(function(e){return!n.contains(i,e.el)});this.triggerMethod("before:reorder"),this._appendReorderedChildren(i),n.each(r,this.removeChildView,this),this.checkEmpty(),this.triggerMethod("reorder")}},resortView:function(){a.getOption(this,"reorderOnSort")?this.reorder():this.render()},_sortViews:function(){var e=this._filteredSortedModels();n.find(e,function(e,t){var n=this.children.findByModel(e);return!n||n._index!==t},this)&&this.resortView()},_emptyViewIndex:-1,_appendReorderedChildren:function(e){this.$el.append(e)},_renderChildren:function(){this.destroyEmptyView(),this.destroyChildren({checkEmpty:!1}),this.isEmpty(this.collection)?this.showEmptyView():(this.triggerMethod("before:render:collection",this),this.startBuffering(),this.showCollection(),this.endBuffering(),this.triggerMethod("render:collection",this),this.children.isEmpty()&&this.getOption("filter")&&this.showEmptyView())},showCollection:function(){var e,t=this._filteredSortedModels();n.each(t,function(t,n){e=this.getChildView(t),this.addChild(t,e,n)},this)},_filteredSortedModels:function(e){var t=this.getViewComparator(),i=this.collection.models;if(e=Math.min(Math.max(e,0),i.length-1),t){var r;e&&(r=i[e],i=i.slice(0,e).concat(i.slice(e+1))),i=this._sortModelsBy(i,t),r&&i.splice(e,0,r)}return this.getOption("filter")&&(i=n.filter(i,function(e,t){return this._shouldAddChild(e,t)},this)),i},_sortModelsBy:function(e,t){return"string"==typeof t?n.sortBy(e,function(e){return e.get(t)},this):1===t.length?n.sortBy(e,t,this):e.sort(n.bind(t,this))},showEmptyView:function(){var e=this.getEmptyView();if(e&&!this._showingEmptyView){this.triggerMethod("before:render:empty"),this._showingEmptyView=!0;var n=new t.Model;this.addEmptyView(n,e),this.triggerMethod("render:empty")}},destroyEmptyView:function(){this._showingEmptyView&&(this.triggerMethod("before:remove:empty"),this.destroyChildren(),delete this._showingEmptyView,this.triggerMethod("remove:empty"))},getEmptyView:function(){return this.getOption("emptyView")},addEmptyView:function(e,t){var i,r=this._isShown&&!this.isBuffering&&a.isNodeAttached(this.el),s=this.getOption("emptyViewOptions")||this.getOption("childViewOptions");n.isFunction(s)&&(s=s.call(this,e,this._emptyViewIndex));var o=this.buildChildView(e,t,s);o._parent=this,this.proxyChildEvents(o),o.once("render",function(){this._isShown&&a.triggerMethodOn(o,"before:show",o),r&&this._triggerBeforeAttach&&(i=this._getViewAndNested(o),this._triggerMethodMany(i,this,"before:attach"))},this),this.children.add(o),this.renderChildView(o,this._emptyViewIndex),r&&this._triggerAttach&&(i=this._getViewAndNested(o),this._triggerMethodMany(i,this,"attach")),this._isShown&&a.triggerMethodOn(o,"show",o)},getChildView:function(e){var t=this.getOption("childView");if(!t)throw new a.Error({name:"NoChildViewError",message:'A "childView" must be specified'});return t},addChild:function(e,t,n){var i=this.getOption("childViewOptions");i=a._getValue(i,this,[e,n]);var r=this.buildChildView(e,t,i);return this._updateIndices(r,!0,n),this.triggerMethod("before:add:child",r),this._addChildView(r,n),this.triggerMethod("add:child",r),r._parent=this,r},_updateIndices:function(e,t,n){this.getOption("sort")&&(t&&(e._index=n),this.children.each(function(n){n._index>=e._index&&(n._index+=t?1:-1)}))},_addChildView:function(e,t){var n,i=this._isShown&&!this.isBuffering&&a.isNodeAttached(this.el);this.proxyChildEvents(e),e.once("render",function(){this._isShown&&!this.isBuffering&&a.triggerMethodOn(e,"before:show",e),i&&this._triggerBeforeAttach&&(n=this._getViewAndNested(e),this._triggerMethodMany(n,this,"before:attach"))},this),this.children.add(e),this.renderChildView(e,t),i&&this._triggerAttach&&(n=this._getViewAndNested(e),this._triggerMethodMany(n,this,"attach")),this._isShown&&!this.isBuffering&&a.triggerMethodOn(e,"show",e)},renderChildView:function(e,t){return e.supportsRenderLifecycle||a.triggerMethodOn(e,"before:render",e),e.render(),e.supportsRenderLifecycle||a.triggerMethodOn(e,"render",e),this.attachHtml(this,e,t),e},buildChildView:function(e,t,i){var r=new t(n.extend({model:e},i));return a.MonitorDOMRefresh(r),r},removeChildView:function(e){return e?(this.triggerMethod("before:remove:child",e),e.supportsDestroyLifecycle||a.triggerMethodOn(e,"before:destroy",e),e.destroy?e.destroy():e.remove(),e.supportsDestroyLifecycle||a.triggerMethodOn(e,"destroy",e),delete e._parent,this.stopListening(e),this.children.remove(e),this.triggerMethod("remove:child",e),this._updateIndices(e,!1),e):e},isEmpty:function(){return!this.collection||0===this.collection.length},checkEmpty:function(){this.isEmpty(this.collection)&&this.showEmptyView()},attachBuffer:function(e,t){e.$el.append(t)},_createBuffer:function(){var e=document.createDocumentFragment();return n.each(this._bufferedChildren,function(t){e.appendChild(t.el)}),e},attachHtml:function(e,t,n){e.isBuffering?e._bufferedChildren.splice(n,0,t):e._insertBefore(t,n)||e._insertAfter(t)},_insertBefore:function(e,t){var n;return this.getOption("sort")&&t<this.children.length-1&&(n=this.children.find(function(e){return e._index===t+1})),!!n&&(n.$el.before(e.el),!0)},_insertAfter:function(e){this.$el.append(e.el)},_initChildViewStorage:function(){this.children=new t.ChildViewContainer},destroy:function(){return this.isDestroyed?this:(this.triggerMethod("before:destroy:collection"),this.destroyChildren({checkEmpty:!1}),this.triggerMethod("destroy:collection"),a.View.prototype.destroy.apply(this,arguments))},destroyChildren:function(e){var t=e||{},i=!0,r=this.children.map(n.identity);return n.isUndefined(t.checkEmpty)||(i=t.checkEmpty),this.children.each(this.removeChildView,this),i&&this.checkEmpty(),r},_shouldAddChild:function(e,t){var i=this.getOption("filter");return!n.isFunction(i)||i.call(this,e,t,this.collection)},proxyChildEvents:function(e){var t=this.getOption("childViewEventPrefix");this.listenTo(e,"all",function(){var i=n.toArray(arguments),r=i[0],a=this.normalizeMethods(n.result(this,"childEvents"));i[0]=t+":"+r,i.splice(1,0,e),void 0!==a&&n.isFunction(a[r])&&a[r].apply(this,i.slice(1)),this.triggerMethod.apply(this,i)})},_getImmediateChildren:function(){return n.values(this.children._views)},_getViewAndNested:function(e){return[e].concat(n.result(e,"_getNestedViews")||[])},getViewComparator:function(){return this.getOption("viewComparator")}}),a.CompositeView=a.CollectionView.extend({constructor:function(){a.CollectionView.apply(this,arguments)},_initialEvents:function(){this.collection&&(this.listenTo(this.collection,"add",this._onCollectionAdd),this.listenTo(this.collection,"remove",this._onCollectionRemove),this.listenTo(this.collection,"reset",this._renderChildren),this.getOption("sort")&&this.listenTo(this.collection,"sort",this._sortViews))},getChildView:function(e){return this.getOption("childView")||this.constructor},serializeData:function(){var e={};return this.model&&(e=n.partial(this.serializeModel,this.model).apply(this,arguments)),e},render:function(){return this._ensureViewIsIntact(),this._isRendering=!0,this.resetChildViewContainer(),this.triggerMethod("before:render",this),this._renderTemplate(),this._renderChildren(),this._isRendering=!1,this.isRendered=!0,this.triggerMethod("render",this),this},_renderChildren:function(){(this.isRendered||this._isRendering)&&a.CollectionView.prototype._renderChildren.call(this)},_renderTemplate:function(){var e={};e=this.serializeData(),e=this.mixinTemplateHelpers(e),this.triggerMethod("before:render:template");var t=this.getTemplate(),n=a.Renderer.render(t,e,this);this.attachElContent(n),this.bindUIElements(),this.triggerMethod("render:template")},attachElContent:function(e){return this.$el.html(e),this},attachBuffer:function(e,t){this.getChildViewContainer(e).append(t)},_insertAfter:function(e){this.getChildViewContainer(this,e).append(e.el)},_appendReorderedChildren:function(e){this.getChildViewContainer(this).append(e)},getChildViewContainer:function(e,t){if(e.$childViewContainer)return e.$childViewContainer;var n,i=a.getOption(e,"childViewContainer");if(i){var r=a._getValue(i,e);if((n="@"===r.charAt(0)&&e.ui?e.ui[r.substr(4)]:e.$(r)).length<=0)throw new a.Error({name:"ChildViewContainerMissingError",message:'The specified "childViewContainer" was not found: '+e.childViewContainer})}else n=e.$el;return e.$childViewContainer=n,n},resetChildViewContainer:function(){this.$childViewContainer&&(this.$childViewContainer=void 0)}}),a.LayoutView=a.ItemView.extend({regionClass:a.Region,options:{destroyImmediate:!1},childViewEventPrefix:"childview",constructor:function(e){e=e||{},this._firstRender=!0,this._initializeRegions(e),a.ItemView.call(this,e)},render:function(){return this._ensureViewIsIntact(),this._firstRender?this._firstRender=!1:this._reInitializeRegions(),a.ItemView.prototype.render.apply(this,arguments)},destroy:function(){return this.isDestroyed?this:(!0===this.getOption("destroyImmediate")&&this.$el.remove(),this.regionManager.destroy(),a.ItemView.prototype.destroy.apply(this,arguments))},showChildView:function(e,t,i){var r=this.getRegion(e);return r.show.apply(r,n.rest(arguments))},getChildView:function(e){return this.getRegion(e).currentView},addRegion:function(e,t){var n={};return n[e]=t,this._buildRegions(n)[e]},addRegions:function(e){return this.regions=n.extend({},this.regions,e),this._buildRegions(e)},removeRegion:function(e){return delete this.regions[e],this.regionManager.removeRegion(e)},getRegion:function(e){return this.regionManager.get(e)},getRegions:function(){return this.regionManager.getRegions()},_buildRegions:function(e){var t={regionClass:this.getOption("regionClass"),parentEl:n.partial(n.result,this,"el")};return this.regionManager.addRegions(e,t)},_initializeRegions:function(e){var t;this._initRegionManager(),t=a._getValue(this.regions,this,[e])||{};var i=this.getOption.call(e,"regions");i=a._getValue(i,this,[e]),n.extend(t,i),t=this.normalizeUIValues(t,["selector","el"]),this.addRegions(t)},_reInitializeRegions:function(){this.regionManager.invoke("reset")},getRegionManager:function(){return new a.RegionManager},_initRegionManager:function(){this.regionManager=this.getRegionManager(),this.regionManager._parent=this,this.listenTo(this.regionManager,"before:add:region",function(e){this.triggerMethod("before:add:region",e)}),this.listenTo(this.regionManager,"add:region",function(e,t){this[e]=t,this.triggerMethod("add:region",e,t)}),this.listenTo(this.regionManager,"before:remove:region",function(e){this.triggerMethod("before:remove:region",e)}),this.listenTo(this.regionManager,"remove:region",function(e,t){delete this[e],this.triggerMethod("remove:region",e,t)})},_getImmediateChildren:function(){return n.chain(this.regionManager.getRegions()).pluck("currentView").compact().value()}}),a.Behavior=a.Object.extend({constructor:function(e,t){this.view=t,this.defaults=n.result(this,"defaults")||{},this.options=n.extend({},this.defaults,e),this.ui=n.extend({},n.result(t,"ui"),n.result(this,"ui")),a.Object.apply(this,arguments)},$:function(){return this.view.$.apply(this.view,arguments)},destroy:function(){return this.stopListening(),this},proxyViewProperties:function(e){this.$el=e.$el,this.el=e.el}}),a.Behaviors=function(e,t){function n(e,i){return t.isObject(e.behaviors)?(i=n.parseBehaviors(e,i||t.result(e,"behaviors")),n.wrap(e,i,t.keys(s)),i):{}}function i(e,t){this._view=e,this._behaviors=t,this._triggers={}}function r(e){return e._uiBindings||e.ui}var a=/^(\S+)\s*(.*)$/,s={behaviorTriggers:function(e,t){return new i(this,t).buildBehaviorTriggers()},behaviorEvents:function(n,i){var s={};return t.each(i,function(n,i){var o={},l=t.clone(t.result(n,"events"))||{};l=e.normalizeUIKeys(l,r(n));var c=0;t.each(l,function(e,r){var s=r.match(a),l=s[1]+"."+[this.cid,i,c++," "].join("")+s[2],u=t.isFunction(e)?e:n[e];u&&(o[l]=t.bind(u,n))},this),s=t.extend(s,o)},this),s}};return t.extend(n,{behaviorsLookup:function(){throw new e.Error({message:"You must define where your behaviors are stored.",url:"marionette.behaviors.html#behaviorslookup"})},getBehaviorClass:function(t,i){return t.behaviorClass?t.behaviorClass:e._getValue(n.behaviorsLookup,this,[t,i])[i]},parseBehaviors:function(e,i){return t.chain(i).map(function(i,r){var a=new(n.getBehaviorClass(i,r))(i,e),s=n.parseBehaviors(e,t.result(a,"behaviors"));return[a].concat(s)}).flatten().value()},wrap:function(e,n,i){t.each(i,function(i){e[i]=t.partial(s[i],e[i],n)})}}),t.extend(i.prototype,{buildBehaviorTriggers:function(){return t.each(this._behaviors,this._buildTriggerHandlersForBehavior,this),this._triggers},_buildTriggerHandlersForBehavior:function(n,i){var a=t.clone(t.result(n,"triggers"))||{};a=e.normalizeUIKeys(a,r(n)),t.each(a,t.bind(this._setHandlerForBehavior,this,n,i))},_setHandlerForBehavior:function(e,t,n,i){var r=i.replace(/^\S+/,function(e){return e+".behaviortriggers"+t});this._triggers[r]=this._view._buildViewTrigger(n)}}),n}(a,n),a.AppRouter=t.Router.extend({constructor:function(e){this.options=e||{},t.Router.apply(this,arguments);var n=this.getOption("appRoutes"),i=this._getController();this.processAppRoutes(i,n),this.on("route",this._processOnRoute,this)},appRoute:function(e,t){var n=this._getController();this._addAppRoute(n,e,t)},_processOnRoute:function(e,t){if(n.isFunction(this.onRoute)){var i=n.invert(this.getOption("appRoutes"))[e];this.onRoute(e,i,t)}},processAppRoutes:function(e,t){if(t){var i=n.keys(t).reverse();n.each(i,function(n){this._addAppRoute(e,n,t[n])},this)}},_getController:function(){return this.getOption("controller")},_addAppRoute:function(e,t,i){var r=e[i];if(!r)throw new a.Error('Method "'+i+'" was not found on the controller');this.route(t,i,n.bind(r,e))},mergeOptions:a.mergeOptions,getOption:a.proxyGetOption,triggerMethod:a.triggerMethod,bindEntityEvents:a.proxyBindEntityEvents,unbindEntityEvents:a.proxyUnbindEntityEvents}),a.Application=a.Object.extend({constructor:function(e){this._initializeRegions(e),this._initCallbacks=new a.Callbacks,this.submodules={},n.extend(this,e),this._initChannel(),a.Object.apply(this,arguments)},execute:function(){this.commands.execute.apply(this.commands,arguments)},request:function(){return this.reqres.request.apply(this.reqres,arguments)},addInitializer:function(e){this._initCallbacks.add(e)},start:function(e){this.triggerMethod("before:start",e),this._initCallbacks.run(e,this),this.triggerMethod("start",e)},addRegions:function(e){return this._regionManager.addRegions(e)},emptyRegions:function(){return this._regionManager.emptyRegions()},removeRegion:function(e){return this._regionManager.removeRegion(e)},getRegion:function(e){return this._regionManager.get(e)},getRegions:function(){return this._regionManager.getRegions()},module:function(e,t){var i=a.Module.getClass(t),r=n.toArray(arguments);return r.unshift(this),i.create.apply(i,r)},getRegionManager:function(){return new a.RegionManager},_initializeRegions:function(e){var t=n.isFunction(this.regions)?this.regions(e):this.regions||{};this._initRegionManager();var i=a.getOption(e,"regions");return n.isFunction(i)&&(i=i.call(this,e)),n.extend(t,i),this.addRegions(t),this},_initRegionManager:function(){this._regionManager=this.getRegionManager(),this._regionManager._parent=this,this.listenTo(this._regionManager,"before:add:region",function(){a._triggerMethod(this,"before:add:region",arguments)}),this.listenTo(this._regionManager,"add:region",function(e,t){this[e]=t,a._triggerMethod(this,"add:region",arguments)}),this.listenTo(this._regionManager,"before:remove:region",function(){a._triggerMethod(this,"before:remove:region",arguments)}),this.listenTo(this._regionManager,"remove:region",function(e){delete this[e],a._triggerMethod(this,"remove:region",arguments)})},_initChannel:function(){this.channelName=n.result(this,"channelName")||"global",this.channel=n.result(this,"channel")||t.Wreqr.radio.channel(this.channelName),this.vent=n.result(this,"vent")||this.channel.vent,this.commands=n.result(this,"commands")||this.channel.commands,this.reqres=n.result(this,"reqres")||this.channel.reqres}}),a.Module=function(e,t,i){this.moduleName=e,this.options=n.extend({},this.options,i),this.initialize=i.initialize||this.initialize,this.submodules={},this._setupInitializersAndFinalizers(),this.app=t,n.isFunction(this.initialize)&&this.initialize(e,t,this.options)},a.Module.extend=a.extend,n.extend(a.Module.prototype,t.Events,{startWithParent:!0,initialize:function(){},addInitializer:function(e){this._initializerCallbacks.add(e)},addFinalizer:function(e){this._finalizerCallbacks.add(e)},start:function(e){this._isInitialized||(n.each(this.submodules,function(t){t.startWithParent&&t.start(e)}),this.triggerMethod("before:start",e),this._initializerCallbacks.run(e,this),this._isInitialized=!0,this.triggerMethod("start",e))},stop:function(){this._isInitialized&&(this._isInitialized=!1,this.triggerMethod("before:stop"),n.invoke(this.submodules,"stop"),this._finalizerCallbacks.run(void 0,this),this._initializerCallbacks.reset(),this._finalizerCallbacks.reset(),this.triggerMethod("stop"))},addDefinition:function(e,t){this._runModuleDefinition(e,t)},_runModuleDefinition:function(e,i){if(e){var r=n.flatten([this,this.app,t,a,t.$,n,i]);e.apply(this,r)}},_setupInitializersAndFinalizers:function(){this._initializerCallbacks=new a.Callbacks,this._finalizerCallbacks=new a.Callbacks},triggerMethod:a.triggerMethod}),n.extend(a.Module,{create:function(e,t,i){var r=e,a=n.drop(arguments,3),s=(t=t.split(".")).length,o=[];return o[s-1]=i,n.each(t,function(t,n){var s=r;r=this._getModule(s,t,e,i),this._addModuleDefinition(s,r,o[n],a)},this),r},_getModule:function(e,t,i,r,a){var s=n.extend({},r),o=this.getClass(r),l=e[t];return l||(l=new o(t,i,s),e[t]=l,e.submodules[t]=l),l},getClass:function(e){var t=a.Module;return e?e.prototype instanceof t?e:e.moduleClass||t:t},_addModuleDefinition:function(e,t,n,i){var r=this._getDefine(n),a=this._getStartWithParent(n,t);r&&t.addDefinition(r,i),this._addStartWithParent(e,t,a)},_getStartWithParent:function(e,t){var i;return n.isFunction(e)&&e.prototype instanceof a.Module?(i=t.constructor.prototype.startWithParent,!!n.isUndefined(i)||i):!n.isObject(e)||(i=e.startWithParent,!!n.isUndefined(i)||i)},_getDefine:function(e){return!n.isFunction(e)||e.prototype instanceof a.Module?n.isObject(e)?e.define:null:e},_addStartWithParent:function(e,t,n){t.startWithParent=t.startWithParent&&n,t.startWithParent&&!t.startWithParentIsConfigured&&(t.startWithParentIsConfigured=!0,e.addInitializer(function(e){t.startWithParent&&t.start(e)}))}}),a}),define("js/mixins/widget_utility",[],function(){var e={};return e.extendMethod=function(e,t,n){if(!_.isUndefined(t[n])){var i=e[n];e[n]=function(){var e=i.apply(this,arguments);return t[n].apply(this,arguments),e}}},e}),define("js/mixins/widget_mixin_method",["js/mixins/widget_utility"],function(e){return function(t,n){var i=this.prototype;_.extend(t,i),_.extend(t.events,i.events),_.each(Array.prototype.slice.call(arguments,1),function(n){e.extendMethod(i,t,n)})}}),define("js/widgets/base/base_widget",["backbone","marionette","js/components/api_query","js/components/api_request","js/mixins/widget_mixin_method","js/components/api_targets","js/mixins/dependon"],function(e,t,n,i,r,a,s){var o=t.Controller.extend({initialize:function(e){e=e||{},_.bindAll(this,"dispatchRequest","processResponse"),this._currentQuery=new n,this.defaultQueryArguments=this.defaultQueryArguments||{},e.defaultQueryArguments&&(this.defaultQueryArguments=_.extend(this.defaultQueryArguments,e.defaultQueryArguments)),e.view&&(this.view=e.view,this.collection=e.view.collection),this.view&&t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.model&&t.bindEntityEvents(this,this.model,t.getOption(this,"modelEvents"))},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,this.dispatchRequest),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},dispatchNewQuery:function(e){_.each(this.defaultQueryArguments,function(t,n){e.unset(n)});var t=this.getPubSub();t.publish(t.START_SEARCH,e)},dispatchRequest:function(e){this._dispatchRequest(e)},_dispatchRequest:function(e){var t=this.customizeQuery(e);if(t){var n=this.composeRequest(t);if(n){var i=this.getPubSub();i.publish(i.DELIVERING_REQUEST,n)}}},customizeQuery:function(e){var t=e.clone();return t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t)),t},processResponse:function(e){var t=e.getApiQuery();throw this.setCurrentQuery(t),new Error("you need to customize this function")},composeRequest:function(e){return new i({target:a.SEARCH,query:e})},setCurrentQuery:function(e){this._currentQuery=e},getCurrentQuery:function(){return this._currentQuery},composeQuery:function(e,t){var n;return t?n=t:(n=this.getCurrentQuery(),n=n.clone()),e&&_.each(e,function(e,t){n.has(t)||n.set(t,e)}),n},onDestroy:function(){this.view.destroy()},getEl:function(){return this.view.el&&this.view.$el.children().length?this.view.el:this.view.render().el},render:function(){return this.view.render()}},{mixin:r});return _.extend(o.prototype,s.BeeHive),o}),define("hbs!js/page_managers/templates/results-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="results-page-layout" class="s-results-page-layout">\n    <div class="row s-stable-search-bar-height">\n        <div class="s-search-bar-full-width-container">\n            <div class="col-sm-10 col-md-8 col-lg-7 col-sm-offset-2 s-search-bar-row" id="search-bar-row"\n                 data-widget="SearchWidget">\n            </div>\n        </div>\n    </div>\n    <div class="row s-message-control-row" id="message-control-row"><span data-widget="AlertsWidgetx"></span></div>\n    <div class="row s-results-control-row" id="results-control-row">\n    </div>\n    <div class="row">\n        <div class="col-xs-12 s-dynamic-page-body" id="dynamic-page-body">\n            <div class="max-width-wrapper">\n                <div class="row">\n                    <div class="hidden-xs col-sm-3 col-md-2 s-left-column s-results-column" id="results-left-column">\n                        <h2 class="sr-only">Filters for the Current Search</h2>\n                        <div class="left-col-container s-left-col-container">\n                            <div data-widget="AuthorFacet"/>\n                            <div data-widget="DatabaseFacet"/>\n                            <div data-widget="RefereedFacet"/>\n                            <div data-widget="KeywordFacet"/>\n                            <div data-widget="BibstemFacet"/>\n                            <div data-widget="BibgroupFacet"/>\n                            <div data-widget="ObjectFacet"/>\n                            <div data-widget="DataFacet"/>\n                            <div data-widget="VizierFacet"/>\n                            <div data-widget="GrantsFacet"/>\n                            <div data-widget="PubtypeFacet"/>\n                        </div>\n                    </div>\n\n                    <div class="col-sm-9 col-md-7  s-results-middle-column s-results-column" id="results-middle-column">\n                        <div class="main-content-container s-main-content-container" id="main-content" tabindex="-1" role="main" aria-label="container for search results and other main content">\n                            <div data-widget="Results"/>\n                            <div data-widget="ExportWidget"/>\n                            <div data-widget="AuthorNetwork"/>\n                            <div data-widget="PaperNetwork"/>\n                            <div data-widget="Metrics" data-allow-redirect="true"/>\n                            <div data-widget="BubbleChart"/>\n                            <div data-widget="ConceptCloud"/>\n                            <div data-widget="CitationHelper"/>\n                        </div>\n                    </div>\n\n                    <div class="hidden-xs col-sm-3 col-md-3 results-right-column s-right-column s-results-column" id="results-right-column">\n                        <h2 class="sr-only">Additional Functionality (Information about your query, and more search filters)</h2>\n\n                        <div data-widget="QueryInfo"/>\n                        <div data-widget="GraphTabs"/>\n                        <div data-widget="QueryDebugInfo" data-debug="true"/>\n                    </div>\n                </div>\n            </div>\n\n        </div>\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/results-page-layout",n),n}),define("hbs!js/page_managers/templates/results-control-row",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-results-control-row-container">\n    <div class="col-sm-6">\n        <div data-widget="BreadcrumbsWidget" class="s-display-inline-block"/>\n    </div>\n\n\n    <div class="col-sm-6" style="padding-right:0">\n        <div class="s-results-action-buttons">\n            <div class="col-md-6 clearfix" style="margin-bottom:10px;">\n                <div data-widget="Sort" class="s-display-inline-block pull-right"/>\n            </div>\n            <div class="col-md-6">\n                <div data-widget="VisualizationDropdown" class="s-display-inline-block pull-right"/>\n                <div data-widget="ExportDropdown" class="s-display-inline-block pull-right"/>\n            </div>\n        </div>\n    </div>\n\n</div>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/results-control-row",n),n}),define("js/page_managers/three_column_view",["underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget"],function(e,t,n,i){var r=Backbone.Model.extend({defaults:function(){return{left:"open",right:"open",user_left:null,user_right:null}}});return t.ItemView.extend({initialize:function(e){var e=e||{};this.widgets=e.widgets,this.model=new r},destroy:function(){t.ItemView.prototype.destroy.call(this,arguments)},template:n,modelEvents:{"change:left":"_updateColumnView","change:right":"_updateColumnView"},events:{"click .btn-expand":"onClickToggleColumns"},onRender:function(){this.$("#results-control-row").append(i()),this.displaySearchBar(this.options.displaySearchBar),this.displayControlRow(this.options.displayControlRow),this.displayLeftColumn(this.options.displayLeftColumn),this.displayRightColumn(this.options.displayRightColumn),this.displayMiddleColumn(this.options.displayMiddleColumn)},onShow:function(){this.displaySearchBar(!0)},displaySearchBar:function(e){$("#search-bar-row").toggle(null===e||e)},displayLeftColumn:function(e){this.$(".s-left-col-container").toggle(null===e||e)},displayControlRow:function(e){this.$("#results-control-row").toggle(null===e||e)},displayRightColumn:function(e){this.$(".s-left-col-container").toggle(null===e||e)},displayMiddleColumn:function(e){this.$(".s-left-col-container").toggle(null===e||e)},_returnBootstrapClasses:function(){var t=this.classList,n=[];return e.each(t,function(e){-1!==e.indexOf("col-")&&n.push(e)}),n.join(" ")},showCols:function(e){e=e||{left:!0,right:!0,force:!1};for(var t=["left","right"],n=0;n<t.length;n++){var i=t[n];i in e&&(null===this.model.get("user_"+i)?this.model.set(i,e[i]?"open":"closed"):e.force&&(this.model.set(i,e[i]?"open":"closed"),this.model.set("user_"+i,null)))}},_updateColumnView:function(){var t,n,i,r,a;t=this.model.get("left"),n=this.model.get("right"),i=this.$("#results-left-column"),r=this.$("#results-right-column"),a=this.$("#results-middle-column"),e.each([["left",t,i],["right",n,r]],function(e){if("open"==e[1]){e[2].removeClass("hidden");var t=e[2];setTimeout(function(){t.children().show(0)},500)}else e[2].addClass("hidden")}),"open"===t&&"open"===n?a.removeClass(this._returnBootstrapClasses).addClass("col-sm-9 col-md-7"):"closed"===t&&"closed"===n&&a.removeClass(this._returnBootstrapClasses).addClass("col-md-12 col-sm-12")}})}),define("js/page_managers/view_mixin",["underscore","jquery"],function(e,t){return{getWidgetsFromTemplate:function(n,i){var r={},a=t(n).find("[data-widget]");return a.length>0&&e.each(a,function(e){var t=e.getAttribute("data-widget"),n=e.getAttribute("data-debug");n&&"true"==n&&!n||(r[t]=e)}),r}}}),define("js/page_managers/controller",["jquery","underscore","marionette","hbs!js/page_managers/templates/results-page-layout","hbs!js/page_managers/templates/results-control-row","js/widgets/base/base_widget","./three_column_view","./view_mixin","js/mixins/dependon"],function(e,t,n,i,r,a,s,o,l){var c=a.extend({initialize:function(e){this.widgets={},this.widgetDoms={},this.initialized=!1,this.widgetId=null,this.assembled=!1,t.extend(this,t.pick(e,["debug","widgetId"]))},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets})},setWidgetId:function(e){this.widgetId=e},createView:function(e){return new s(e)},assemble:function(n){if(this.assembled)return this.view.el;this.assembled=!0,this.view.render();var i,r=this;t.extend(r.widgetDoms,r.getWidgetsFromTemplate(r.view.$el)),t.each(r.widgetDoms,function(a,s){if(!n.hasWidget(s))return delete r.widgetDoms[s],void delete r.widgets[s];var o=n._getWidget(s);this.persistentWidgets&&this.persistentWidgets.indexOf(s)>-1&&n._getWidget(s),o&&(o.assemble&&o.assemble(n),t.assign(o,{componentParams:e(a).data()}),i=o.getEl?o.getEl():o.render().el,e(r.widgetDoms[s]).empty().append(i),r.widgets[s]=o)},this)},disAssemble:function(n){t.each(t.keys(this.widgets),function(t){var i=this.widgets[t];i.disAssemble&&i.disAssemble(),n.returnWidget(t),n._isBarbarianAlive("widget:"+t)?e(this.widgetDoms[t]).detach():e(this.widgetDoms[t]).empty(),delete this.widgets[t],delete this.widgetDoms[t]},this),this.assembled=!1},show:function(e){var n=this;if(e){this.hideAll();var i=[].slice.apply(arguments);t.each(i,function(e){if(n.widgets[e]){var i=n.widgets[e],r=n.view.$el.find('[data-widget="'+e+'"]');if(r.length){var a=r.data("debug");if(void 0!==a&&a&&!n.debug)return;r.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:r.data()});try{n.widgets[e].triggerMethod("show")}catch(t){console.error("Error when displaying widget: "+e,t.message,t.stack)}}else console.warn("Cannot insert widget: "+e+' (no selector [data-widget="'+e+'"])')}else n.debug&&console.error("Cannot show widget: "+e+"(because, frankly... there is no such widget there!)")})}else this.showAll();return this.triggerMethod("show"),this.view},hideAll:function(){return t.each(this.widgets,function(e){e.noDetach||("detach"in e&&t.isFunction(e.detach)?e.detach():e.view&&e.view.$el?e.view.$el.detach():e.$el&&e.$el.detach())}),this.view},showAll:function(){var e=this;return t.each(t.keys(e.widgets),function(n){var i=e.widgets[n],r=e.view.$el.find('[data-widget="'+n+'"]');r.append(i.el?i.el:i.view.el),t.assign(i,{componentParams:r.data()}),e.widgets[n].triggerMethod("show")}),this.view},broadcast:function(){var e=arguments;t.each(this.widgets,function(t,n){t.trigger.apply(t,e)},this)}});return t.extend(c.prototype,o,l.BeeHive,{getPubSub:function(){return this._ps&&this.hasPubSub()?this._ps:(this._ps=this.getBeeHive().getHardenedInstance().getService("PubSub"),this._ps)}}),c}),define("hbs!js/page_managers/templates/aria-announcement",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'<a href="#main-content" id="skip-to-main-content" class="sr-only sr-only-focusable">Skip to main content</a>\n'},3:function(e,t,n,i){return'<a href="#main-content"  id="skip-to-main-content" class="sr-only sr-only-focusable">Skip to main content</a>\n'},5:function(e,t,n,i){return"    home page\n"},7:function(e,t,n,i){return"    search results page\n"},9:function(e,t,n,i){return"    article abstract page\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"SearchPage",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"DetailsPage",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'\n<div id="aria-announcement-container">\n    Now on\n'+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"LandingPage",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"SearchPage",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"DetailsPage",{name:"compare",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>\n"},useData:!0});return t.registerPartial("js/page_managers/templates/aria-announcement",n),n}),define("hbs!js/page_managers/templates/master-page-manager",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="row" id="navbar-container">\n    <div data-widget="NavbarWidget"/>\n</div>\n\n<div class="row" data-widget="AlertsWidget"/>\n\n<div class="dynamic-container s-dynamic-container"> </div>\n\n<div data-widget="FooterWidget"/>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/master-page-manager",n),n}),define("js/page_managers/master",["js/widgets/base/base_widget","js/components/generic_module","js/page_managers/controller","hbs!js/page_managers/templates/aria-announcement","hbs!js/page_managers/templates/master-page-manager","marionette","js/mixins/dependon"],function(e,t,n,i,r,a,s){var o=Backbone.Model.extend({defaults:function(){return{id:void 0,isSelected:!1,object:void 0,options:void 0}}}),l=Backbone.Collection.extend({model:o,selectOne:function(e){var t=null;this.each(function(n){n.id==e?t=n:n.set("isSelected",!1,{silent:!0})}),t.set("isSelected",!0)}}),c=Backbone.Model.extend({defaults:function(){return{name:void 0,numCalled:0,numAttached:0,ariaAnnouncement:void 0}}}),u=a.ItemView.extend({className:"s-master-page-manager",constructor:function(e){(e=e||{}).collection||(e.collection=new l),e.model||(e.model=new c),e.template=r,a.ItemView.prototype.constructor.call(this,e)},changeManager:function(){var e=this.collection.findWhere({isSelected:!0}),t=e.attributes.object.show.apply(e.attributes.object,e.attributes.options);this.$(".dynamic-container").children().detach(),this.$(".dynamic-container").append(t.$el),e.attributes.numAttach+=1,document.body.scrollTop=document.documentElement.scrollTop=0,$(".s-search-bar-full-width-container").removeClass("s-search-bar-motion"),$(".s-quick-add").removeClass("hidden")},changeWithinManager:function(){var e=this.collection.findWhere({isSelected:!0});e.attributes.object.show.apply(e.attributes.object,e.attributes.options),e.attributes.numAttach+=1}}),d=n.extend({initialize:function(e){e=e||{},this.view=new u(e),this.collection=this.view.collection,this.model=this.view.model,n.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.ARIA_ANNOUNCEMENT,this.handleAriaAnnouncement)},assemble:function(e){this.setApp(e),n.prototype.assemble.call(this,e)},show:function(e,t){var n=this.getApp();this.collection.find({id:e})||this.collection.add({id:e});var i,r=this.collection.find({id:e});r.get("object")?i=r.get("object"):(i=n._getWidget(e),r.set("object",i)),i||console.error("unable to find page manager: "+e),i.assemble?i.assemble(n):console.error("eeeek, "+pageManager+" has no assemble() method!"),r.get("isSelected")?(r.set({options:t,object:i}),this.view.changeWithinManager()):(r.set({options:t,object:i}),this.collection.selectOne(e),this.view.changeManager());var a=this.currentChild;if(this.currentChild=e,a&&a!=e){var s=this.collection.find({id:a});s&&s.get("object")&&(s.set("numDetach",s.get("numDetach")+1),s.get("object").disAssemble(n))}this.getPubSub().publish(this.getPubSub().ARIA_ANNOUNCEMENT,e)},getCurrentActiveChild:function(){return this.collection.get(this.currentChild).get("object")},disAssemble:function(){_.each(this.collection.models,function(e){if(e.attributes.isSelected){var t=e.get("object");if(t.disAssemble)t.disAssemble(this.getApp());else{if(!t.destroy)throw new Error("Contract breach, no way to get ridd of the widget/page manager");t.destroy()}}e.set({isSelected:!1,object:null}),this.assembled=!1},this)},handleAriaAnnouncement:function(e){$("a#skip-to-main-content").remove(),$("div#aria-announcement-container").remove(),$("#app-container").before(i({page:e}))}});return _.extend(d.prototype,s.App),d}),define("js/components/app_storage",["backbone","underscore","js/components/api_query","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i,r){var a=e.Model.extend({activate:function(e){this.setBeeHive(e),t.bindAll(this,"onPaperSelection","onBulkPaperSelection");var n=this.getPubSub();n.subscribe(n.PAPER_SELECTION,this.onPaperSelection),n.subscribe(n.BULK_PAPER_SELECTION,this.onBulkPaperSelection)},initialize:function(){this.on("change:selectedPapers",function(e){if(this._updateNumSelected(),this.hasPubSub())var t=this.getPubSub();t.publish(t.STORAGE_PAPER_UPDATE,this.getNumSelectedPapers())})},setCurrentQuery:function(e){if(e||(e=new n),!(e instanceof n))throw new Error("You must save ApiQuery instance");this.set("currentQuery",e),this.getBeeHive().getService("PersistentStorage")&&this.getBeeHive().getService("PersistentStorage").set("currentQuery",e.toJSON())},setCurrentNumFound:function(e){this.set("numFound",e)},getCurrentQuery:function(){return this.get("currentQuery")},hasCurrentQuery:function(){return this.has("currentQuery")},hasSelectedPapers:function(){return!!t.keys(this.get("selectedPapers")).length},getSelectedPapers:function(){return t.keys(this.get("selectedPapers")||{})},clearSelectedPapers:function(){this.set("selectedPapers",{})},addSelectedPapers:function(e){var n=t.clone(this.get("selectedPapers")||{}),i=!1;t.isArray(e)?t.each(e,function(e){n[e]||(n[e]=!0,i=!0)}):n[e]||(n[e]=!0,i=!0),i&&this.set("selectedPapers",n)},isPaperSelected:function(e){if(t.isArray(e))throw new Error("Identifier must be a string or a number");return!!(this.get("selectedPapers")||{})[e]},removeSelectedPapers:function(e){var n=t.clone(this.get("selectedPapers")||{});t.isArray(e)?t.each(e,function(e){delete n[e]}):e?delete n[e]:n={},this.set("selectedPapers",n)},getNumSelectedPapers:function(){return this._numSelectedPapers||0},_updateNumSelected:function(){this._numSelectedPapers=t.keys(this.get("selectedPapers")||{}).length},onPaperSelection:function(e){this.isPaperSelected(e)?this.removeSelectedPapers(e):this.addSelectedPapers(e)},onBulkPaperSelection:function(e,t){"remove"!=t?this.addSelectedPapers(e):this.removeSelectedPapers(e)},setConfig:function(e){this.set("dynamicConfig",e)},getConfigCopy:function(){return JSON.parse(JSON.stringify(this.get("dynamicConfig")))},hardenedInterface:{getNumSelectedPapers:"getNumSelectedPapers",isPaperSelected:"isPaperSelected",hasSelectedPapers:"hasSelectedPapers",getSelectedPapers:"getSelectedPapers",clearSelectedPapers:"clearSelectedPapers",getCurrentQuery:"getCurrentQuery",hasCurrentQuery:"hasCurrentQuery",getConfigCopy:"get read-only copy of dynamic config",set:"set a value into app storage",get:"get a val from app storage"}});return t.extend(a.prototype,i,r.BeeHive),a}),define("js/components/recaptcha_manager",["backbone","js/components/generic_module","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i){var r=$.Deferred();onRecaptchaLoad=function(){r.resolve()};var a=t.extend({initialize:function(){this.grecaptchaDeferred=r,this.siteKeyDeferred=$.Deferred(),this.when=$.when(this.siteKeyDeferred,this.grecaptchaDeferred)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["getRecaptchaKey"]),t.subscribe(t.APP_STARTED,this.getRecaptchaKey)},getRecaptchaKey:function(){var e=this.getBeeHive().getObject("AppStorage").getConfigCopy().recaptchaKey;this.siteKeyDeferred.resolve(e)},activateRecaptcha:function(e){this.when.done(_.partial(this.renderRecaptcha,e))},renderRecaptcha:function(e,t,n){grecaptcha.render(e.$(".g-recaptcha")[0],{sitekey:t,callback:function(t){e.model&&e.model.set("g-recaptcha-response",t)}})},hardenedInterface:{activateRecaptcha:"activateRecaptcha"}});return _.extend(a.prototype,n,i.BeeHive),a}),define("js/components/csrf_manager",["backbone","js/components/generic_module","js/mixins/hardened","js/components/api_request","js/components/api_targets","js/mixins/dependon"],function(e,t,n,i,r,a){var s=t.extend({activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["resolvePromiseWithNewKey"]),t.subscribe(t.DELIVERING_RESPONSE,this.resolvePromiseWithNewKey)},getCSRF:function(){this.deferred=$.Deferred();var e=new i({target:r.CSRF}),t=this.getPubSub();return t.publish(t.EXECUTE_REQUEST,e),this.deferred.promise()},resolvePromiseWithNewKey:function(e){var t=e.toJSON().csrf;this.deferred.resolve(t)},hardenedInterface:{getCSRF:"getCSRF"}});return _.extend(s.prototype,n,a.BeeHive),s}),define("js/components/library_controller",["backbone","js/components/generic_module","js/mixins/hardened","js/components/api_targets","js/components/api_request","js/components/api_feedback","js/components/api_query","js/mixins/dependon"],function(e,t,n,i,r,a,s,o){var l=e.Model.extend({defaults:function(){return{num_documents:0,date_last_modified:void 0,permission:void 0,description:"",public:!1,num_users:1,owner:void 0,date_created:void 0,id:void 0,title:""}}}),c=e.Collection.extend({model:l}),u=t.extend({initialize:function(){this.collection=new c},activate:function(t){this.setBeeHive(t.getHardenedInstance()),pubsub=this.getBeeHive().getService("PubSub"),pubsub.subscribe(pubsub.INVITING_REQUEST,_.bind(this.updateCurrentQuery,this)),pubsub.subscribe(pubsub.USER_ANNOUNCEMENT,_.bind(this.handleUserAnnouncement,this)),_.each(["change","add","reset","remove"],function(t){this.listenTo(this.collection,t,function(n,i){"change"==t&&n instanceof e.Model?(pubsub.publish(pubsub.LIBRARY_CHANGE,this.collection.toJSON(),{ev:t,id:n.id}),delete this._libraryBibcodeCache[n.id]):pubsub.publish(pubsub.LIBRARY_CHANGE,this.collection.toJSON(),{ev:t})})},this)},handleUserAnnouncement:function(e){"user_signed_in"==e?this._fetchAllMetadata():"user_signed_out"==e&&this.collection.reset({})},updateCurrentQuery:function(e){this._currentQuery=e},composeRequest:function(e,t,n){var i,a=(n=n||{}).data||void 0,s=$.Deferred();return i=new r({target:e,options:{context:this,type:t,data:JSON.stringify(a),contentType:"application/json",done:function(){var e=[_.extend(arguments[0],n.extraArguments),[].slice(arguments,1)];s.resolve.apply(void 0,e)},fail:function(){s.reject.apply(void 0,arguments)}}}),this.getBeeHive().getService("Api").request(i),s},_executeApiRequest:function(e){var t=new r({target:i.SEARCH,query:e}),n=$.Deferred();return pubsub.subscribeOnce(pubsub.DELIVERING_RESPONSE,_.bind(function(e){n.resolve(e)}),this),pubsub.publish(pubsub.EXECUTE_REQUEST,t),n},_getBibcodes:function(e){function t(){l.set("start",a),this._executeApiRequest(l).done(function(e){var l=_.map(e.get("response.docs"),function(e){return e.bibcode});[].push.apply(o,l),(a+=s)<r?t.call(i):n.resolve(o)})}var n=$.Deferred(),i=this;if("all"==e.bibcodes){var r=e.limit||2e3,a=0,s=100,o=[],l=this._currentQuery.clone();l.unlock(),l.set("rows",100),l.set("fl","bibcode"),t.call(this)}else if("selected"==e.bibcodes){var c=this.getBeeHive().getObject("AppStorage").getSelectedPapers();n.resolve(c)}else{if(!_.isArray(e.bibcodes))throw new Error("should we add all bibcodes or only selected ones?");n.resolve(e.bibcodes)}return n.promise()},_fetchAllMetadata:function(){var e=this,t=i.LIBRARIES;return this.composeRequest(t,"GET").done(function(t){e._metadataLoaded=!0,e.collection.reset(t.libraries)})},getLibraryMetadata:function(e){if(e&&!this.collection.get(e))return this.fetchLibraryMetadata(e);var t=$.Deferred(),n=this;if(this._metadataLoaded){var i=e?n.collection.get(e).toJSON():n.collection.toJSON();t.resolve(i)}else this._fetchAllMetadata().done(function(i){setTimeout(function(){var i=e?n.collection.get(e).toJSON():n.collection.toJSON();t.resolve(i)},1)});return t.promise()},fetchLibraryMetadata:function(e){var t=this;if(!e)throw new Error("need to provide a library id");var n=$.Deferred();return this.composeRequest(i.LIBRARIES+"/"+e).done(function(e){n.resolve(e.metadata),t.collection.add(e.metadata,{merge:!0})}).fail(function(){t.getPubSub().publish(t.getPubSub().NAVIGATE,"404")}),n.promise()},_libraryBibcodeCache:{},getLibraryBibcodes:function(e){function t(t){c=t.solr.response.numFound>l?l:t.solr.response.numFound;var i=_.pluck(t.solr.response.docs,"bibcode");[].push.apply(h,i),(u+=d)<c?n():(o._libraryBibcodeCache[e]=h,a.resolve(h))}function n(){var e=new s;e.set("rows",100),e.set("fl","bibcode"),e.set("start",u);var n=new r({target:p,query:e,options:{context:this,contentType:"application/x-www-form-urlencoded",done:t,fail:this.handleError}});o.getBeeHive().getService("Api").request(n)}var a=$.Deferred(),o=this,l=1e4;if(this._libraryBibcodeCache[e])return a.resolve(this._libraryBibcodeCache[e]),a.promise();var c=l,u=0,d=100,h=[],p=i.LIBRARIES+"/"+e,o=this;return n.call(this),a.promise()},createLibrary:function(e){var t=this,n=i.LIBRARIES;return this.composeRequest(n,"POST",{data:e}).done(function(e){t._fetchAllMetadata()})},deleteLibrary:function(e,t){var t,n=this,r=i.DOCUMENTS+"/"+e;return this.composeRequest(r,"DELETE").done(function(){n.collection.remove(e),n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").NAVIGATE,"AllLibrariesWidget","libraries");var i="Library <b>"+t+"</b> was successfully deleted";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new a({code:0,msg:i,type:"success"}))}).fail(function(e){var i=JSON.parse(e.responseText).error,r="Library <b>"+t+"</b> could not be deleted : ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new a({code:0,msg:r,type:"danger"}))})},updateLibraryContents:function(e,t){var n=this,r={data:t,extraArguments:{numBibcodesRequested:t.bibcode.length}},s=i.DOCUMENTS+"/"+e;return this.composeRequest(s,"POST",r).done(function(){n.fetchLibraryMetadata(e)}).fail(function(t){var i=JSON.parse(t.responseText).error,r="Library <b>"+n.collection.get(e).title+"</b> could not be updated: ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new a({code:0,msg:r,type:"danger"}))})},updateLibraryMetadata:function(e,t){var n=this,r=i.DOCUMENTS+"/"+e;return this.composeRequest(r,"PUT",{data:t}).done(function(t){n.collection.get(e).set(t)}).fail(function(t){var i=JSON.parse(t.responseText).error,r="Library <b>"+n.collection.get(e).get("name")+"</b> could not be updated: ("+i+")";n.getBeeHive().getService("PubSub").publish(n.getBeeHive().getService("PubSub").ALERT,new a({code:0,msg:r,type:"danger"}))})},addBibcodesToLib:function(e){var t=this;return this._getBibcodes(e).then(function(n){return t.updateLibraryContents(e.library,{bibcode:n,action:"add"}).fail(function(){var n="Library <b>"+t.collection.get(e.library).title+"</b> could not be updated";t.getBeeHive().getService("PubSub").publish(t.getBeeHive().getService("PubSub").ALERT,new a({code:0,msg:n,type:"danger"}))})})},createLibAndAddBibcodes:function(e){var t=this;return this._getBibcodes(e).then(function(n){if(!n)throw new Error("Solr returned no bibcodes, can't put them in the new library");return e.bibcode=n,t.createLibrary(e).fail(function(){var e="Library <b>"+name+"</b> could not be created";t.getBeeHive().getService("PubSub").publish(t.getBeeHive().getService("PubSub").ALERT,new a({code:0,msg:e,type:"danger"}))})})},importLibraries:function(e){var t,n=$.Deferred(),a=this;if("classic"===e)t=i.LIBRARY_IMPORT_CLASSIC_TO_BBB;else{if("twopointoh"!==e)return void console.error("didn't recognize library endpoint! should be one of 'classic' or 'twopointoh' ");t=i.LIBRARY_IMPORT_ADS2_TO_BBB}return this.getBeeHive().getService("Api").request(new r({target:t,options:{done:function(e){n.resolve.apply(void 0,[].slice.apply(arguments)),a._fetchAllMetadata()},fail:function(e){n.reject.apply(void 0,[].slice.apply(arguments))}}})),n.promise()},hardenedInterface:{getLibraryMetadata:"returns json list of libraries, optional lib id as param",createLibrary:"createLibrary",createLibAndAddBibcodes:"createLibAndAddBibcodes",addBibcodesToLib:"addBibcodesToLib",deleteLibrary:"deleteLibrary",updateLibraryContents:"updateLibraryContents",updateLibraryMetadata:"updateLibraryMetadata",importLibraries:"importLibraries",getLibraryBibcodes:"getLibraryBibcodes"}});return _.extend(u.prototype,n,o.BeeHive),u}),define("js/components/doc_stash_controller",["backbone","js/components/generic_module","js/mixins/hardened","js/mixins/dependon"],function(e,t,n,i){var r=t.extend({_docs:[],activate:function(e){this.setBeeHive(e.getHardenedInstance());var t=this.getBeeHive().getService("PubSub");t.subscribe(t.START_SEARCH,_.bind(this.emptyStash,this))},stashDocs:function(e){this._docs.push.apply(this._docs,e)},getDocs:function(){return _.cloneDeep(this._docs)},emptyStash:function(){this.docs=[]},hardenedInterface:{stashDocs:"stash docs",getDocs:"getDocs"}});return _.extend(r.prototype,n,i.BeeHive),r}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("redux",[],t):"object"==typeof exports?exports.Redux=t():e.Redux=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){}t.__esModule=!0,t.compose=t.applyMiddleware=t.bindActionCreators=t.combineReducers=t.createStore=void 0;var a=i(n(2)),s=i(n(7)),o=i(n(6)),l=i(n(5)),c=i(n(1)),u=i(n(3));"string"==typeof r.name&&"isCrushed"!==r.name&&(0,u.default)("You are currently using minified code outside of NODE_ENV === 'production'. This means that you are running a slower development build of Redux. You can use loose-envify (https://github.com/zertosh/loose-envify) for browserify or DefinePlugin for webpack (http://stackoverflow.com/questions/30030031) to ensure you have the correct code for your production build."),t.createStore=a.default,t.combineReducers=s.default,t.bindActionCreators=o.default,t.applyMiddleware=l.default,t.compose=c.default},function(e,t){"use strict";t.__esModule=!0,t.default=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];if(0===t.length)return function(e){return e};var i=function(){var e=t[t.length-1],n=t.slice(0,-1);return{v:function(){return n.reduceRight(function(e,t){return t(e)},e.apply(void 0,arguments))}}}();return"object"==typeof i?i.v:void 0}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t,n){function i(){g===f&&(g=f.slice())}function l(){return p}function c(e){if("function"!=typeof e)throw new Error("Expected listener to be a function.");var t=!0;return i(),g.push(e),function(){if(t){t=!1,i();var n=g.indexOf(e);g.splice(n,1)}}}function u(e){if(!(0,a.default)(e))throw new Error("Actions must be plain objects. Use custom middleware for async actions.");if(void 0===e.type)throw new Error('Actions may not have an undefined "type" property. Have you misspelled a constant?');if(m)throw new Error("Reducers may not dispatch actions.");try{m=!0,p=h(p,e)}finally{m=!1}for(var t=f=g,n=0;n<t.length;n++)t[n]();return e}var d;if("function"==typeof t&&void 0===n&&(n=t,t=void 0),void 0!==n){if("function"!=typeof n)throw new Error("Expected the enhancer to be a function.");return n(r)(e,t)}if("function"!=typeof e)throw new Error("Expected the reducer to be a function.");var h=e,p=t,f=[],g=f,m=!1;return u({type:o.INIT}),d={dispatch:u,subscribe:c,getState:l,replaceReducer:function(e){if("function"!=typeof e)throw new Error("Expected the nextReducer to be a function.");h=e,u({type:o.INIT})}},d[s.default]=function(){var e,t=c;return e={subscribe:function(e){function n(){e.next&&e.next(l())}if("object"!=typeof e)throw new TypeError("Expected the observer to be an object.");return n(),{unsubscribe:t(n)}}},e[s.default]=function(){return this},e},d}t.__esModule=!0,t.ActionTypes=void 0,t.default=r;var a=i(n(4)),s=i(n(11)),o=t.ActionTypes={INIT:"@@redux/INIT"}},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},function(e,t,n){var i=n(8),r=n(9),a=n(10),s="[object Object]",o=Object.prototype,l=Function.prototype.toString,c=o.hasOwnProperty,u=l.call(Object),d=o.toString;e.exports=function(e){if(!a(e)||d.call(e)!=s||r(e))return!1;var t=i(e);if(null===t)return!0;var n=c.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&l.call(n)==u}},function(e,t,n){"use strict";t.__esModule=!0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.default=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return function(e){return function(n,a,s){var o=e(n,a,s),l=o.dispatch,c=[],u={getState:o.getState,dispatch:function(e){return l(e)}};return c=t.map(function(e){return e(u)}),l=r.default.apply(void 0,c)(o.dispatch),i({},o,{dispatch:l})}}};var r=function(e){return e&&e.__esModule?e:{default:e}}(n(1))},function(e,t){"use strict";function n(e,t){return function(){return t(e.apply(void 0,arguments))}}t.__esModule=!0,t.default=function(e,t){if("function"==typeof e)return n(e,t);if("object"!=typeof e||null===e)throw new Error("bindActionCreators expected an object or a function, instead received "+(null===e?"null":typeof e)+'. Did you write "import ActionCreators from" instead of "import * as ActionCreators from"?');for(var i=Object.keys(e),r={},a=0;a<i.length;a++){var s=i[a],o=e[s];"function"==typeof o&&(r[s]=n(o,t))}return r}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){var n=t&&t.type;return"Given action "+(n&&'"'+n.toString()+'"'||"an action")+', reducer "'+e+'" returned undefined. To ignore an action, you must explicitly return the previous state.'}function a(e,t,n){var i=Object.keys(t),r=n&&n.type===o.ActionTypes.INIT?"initialState argument passed to createStore":"previous state received by the reducer";if(0===i.length)return"Store does not have a valid reducer. Make sure the argument passed to combineReducers is an object whose values are reducers.";if(!(0,l.default)(e))return"The "+r+' has unexpected type of "'+{}.toString.call(e).match(/\s([a-z|A-Z]+)/)[1]+'". Expected argument to be an object with the following keys: "'+i.join('", "')+'"';var a=Object.keys(e).filter(function(e){return!t.hasOwnProperty(e)});return a.length>0?"Unexpected "+(a.length>1?"keys":"key")+' "'+a.join('", "')+'" found in '+r+'. Expected to find one of the known reducer keys instead: "'+i.join('", "')+'". Unexpected keys will be ignored.':void 0}function s(e){Object.keys(e).forEach(function(t){var n=e[t];if(void 0===n(void 0,{type:o.ActionTypes.INIT}))throw new Error('Reducer "'+t+'" returned undefined during initialization. If the state passed to the reducer is undefined, you must explicitly return the initial state. The initial state may not be undefined.');if(void 0===n(void 0,{type:"@@redux/PROBE_UNKNOWN_ACTION_"+Math.random().toString(36).substring(7).split("").join(".")}))throw new Error('Reducer "'+t+"\" returned undefined when probed with a random type. Don't try to handle "+o.ActionTypes.INIT+' or other actions in "redux/*" namespace. They are considered private. Instead, you must return the current state for any unknown actions, unless it is undefined, in which case you must return the initial state, regardless of the action type. The initial state may not be undefined.')})}t.__esModule=!0,t.default=function(e){for(var t=Object.keys(e),n={},i=0;i<t.length;i++){var o=t[i];"function"==typeof e[o]&&(n[o]=e[o])}var l,u=Object.keys(n);try{s(n)}catch(e){l=e}return function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0],t=arguments[1];if(l)throw l;var i=a(e,n,t);i&&(0,c.default)(i);for(var s=!1,o={},d=0;d<u.length;d++){var h=u[d],p=n[h],f=e[h],g=p(f,t);if(void 0===g){var m=r(h,t);throw new Error(m)}o[h]=g,s=s||g!==f}return s?o:e}};var o=n(2),l=i(n(4)),c=i(n(3))},function(e,t){var n=Object.getPrototypeOf;e.exports=function(e){return n(Object(e))}},function(e,t){e.exports=function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}},function(e,t){e.exports=function(e){return!!e&&"object"==typeof e}},function(e,t,n){(function(t){"use strict";e.exports=n(12)(t||window||this)}).call(t,function(){return this}())},function(e,t){"use strict";e.exports=function(e){var t,n=e.Symbol;return"function"==typeof n?n.observable?t=n.observable:(t="function"==typeof n.for?n.for("observable"):n("observable"),n.observable=t):t="@@observable",t}}])}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("react"),require("redux")):"function"==typeof define&&define.amd?define("react-redux",["react","redux"],t):"object"==typeof exports?exports.ReactRedux=t(require("react"),require("redux")):e.ReactRedux=t(e.React,e.Redux)}(this,function(e,t){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}t.__esModule=!0,t.connect=t.Provider=void 0;var r=i(n(4)),a=i(n(5));t.Provider=r.default,t.connect=a.default},function(t,n){t.exports=e},function(e,t,n){"use strict";t.__esModule=!0;var i=n(1);t.default=i.PropTypes.shape({subscribe:i.PropTypes.func.isRequired,dispatch:i.PropTypes.func.isRequired,getState:i.PropTypes.func.isRequired})},function(e,t){"use strict";t.__esModule=!0,t.default=function(e){"undefined"!=typeof console&&"function"==typeof console.error&&console.error(e);try{throw new Error(e)}catch(e){}}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(){d||(d=!0,(0,u.default)("<Provider> does not support changing `store` on the fly. It is most likely that you see this error because you updated to Redux 2.x and React Redux 2.x which no longer hot reload reducers automatically. See https://github.com/reactjs/react-redux/releases/tag/v2.0.0 for the migration instructions."))}t.__esModule=!0,t.default=void 0;var l=n(1),c=i(n(2)),u=i(n(3)),d=!1,h=function(e){function t(n,i){r(this,t);var s=a(this,e.call(this,n,i));return s.store=n.store,s}return s(t,e),t.prototype.getChildContext=function(){return{store:this.store}},t.prototype.render=function(){var e=this.props.children;return l.Children.only(e)},t}(l.Component);t.default=h,h.prototype.componentWillReceiveProps=function(e){this.store!==e.store&&o()},h.propTypes={store:c.default.isRequired,children:l.PropTypes.element.isRequired},h.childContextTypes={store:c.default.isRequired}},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){return e.displayName||e.name||"Component"}function l(e,t){try{return e.apply(t)}catch(e){return _.value=e,_}}var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e};t.__esModule=!0,t.default=function(e,t,n){var i=arguments.length<=3||void 0===arguments[3]?{}:arguments[3],S=Boolean(e),E=e||v,A=void 0;A="function"==typeof t?t:t?(0,p.default)(t):y;var k=n||w,C=i.pure,P=void 0===C||C,M=i.withRef,O=void 0!==M&&M,T=P&&k!==w,R=x++;return function(e){function t(e,t){(0,g.default)(e)||(0,f.default)(t+"() in "+i+" must return a plain object. Instead received "+e+".")}function n(e,n,i){var r=k(e,n,i);return t(r,"mergeProps"),r}var i="Connect("+o(e)+")",p=function(o){function d(e,t){r(this,d);var n=a(this,o.call(this,e,t));n.version=R,n.store=e.store||t.store,(0,b.default)(n.store,'Could not find "store" in either the context or props of "'+i+'". Either wrap the root component in a <Provider>, or explicitly pass "store" as a prop to "'+i+'".');var s=n.store.getState();return n.state={storeState:s},n.clearCache(),n}return s(d,o),d.prototype.shouldComponentUpdate=function(){return!P||this.haveOwnPropsChanged||this.hasStoreStateChanged},d.prototype.computeStateProps=function(e,n){if(!this.finalMapStateToProps)return this.configureFinalMapState(e,n);var i=e.getState(),r=this.doStatePropsDependOnOwnProps?this.finalMapStateToProps(i,n):this.finalMapStateToProps(i);return t(r,"mapStateToProps"),r},d.prototype.configureFinalMapState=function(e,n){var i=E(e.getState(),n),r="function"==typeof i;return this.finalMapStateToProps=r?i:E,this.doStatePropsDependOnOwnProps=1!==this.finalMapStateToProps.length,r?this.computeStateProps(e,n):(t(i,"mapStateToProps"),i)},d.prototype.computeDispatchProps=function(e,n){if(!this.finalMapDispatchToProps)return this.configureFinalMapDispatch(e,n);var i=e.dispatch,r=this.doDispatchPropsDependOnOwnProps?this.finalMapDispatchToProps(i,n):this.finalMapDispatchToProps(i);return t(r,"mapDispatchToProps"),r},d.prototype.configureFinalMapDispatch=function(e,n){var i=A(e.dispatch,n),r="function"==typeof i;return this.finalMapDispatchToProps=r?i:A,this.doDispatchPropsDependOnOwnProps=1!==this.finalMapDispatchToProps.length,r?this.computeDispatchProps(e,n):(t(i,"mapDispatchToProps"),i)},d.prototype.updateStatePropsIfNeeded=function(){var e=this.computeStateProps(this.store,this.props);return!(this.stateProps&&(0,h.default)(e,this.stateProps)||(this.stateProps=e,0))},d.prototype.updateDispatchPropsIfNeeded=function(){var e=this.computeDispatchProps(this.store,this.props);return!(this.dispatchProps&&(0,h.default)(e,this.dispatchProps)||(this.dispatchProps=e,0))},d.prototype.updateMergedPropsIfNeeded=function(){var e=n(this.stateProps,this.dispatchProps,this.props);return!(this.mergedProps&&T&&(0,h.default)(e,this.mergedProps)||(this.mergedProps=e,0))},d.prototype.isSubscribed=function(){return"function"==typeof this.unsubscribe},d.prototype.trySubscribe=function(){S&&!this.unsubscribe&&(this.unsubscribe=this.store.subscribe(this.handleChange.bind(this)),this.handleChange())},d.prototype.tryUnsubscribe=function(){this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null)},d.prototype.componentDidMount=function(){this.trySubscribe()},d.prototype.componentWillReceiveProps=function(e){P&&(0,h.default)(e,this.props)||(this.haveOwnPropsChanged=!0)},d.prototype.componentWillUnmount=function(){this.tryUnsubscribe(),this.clearCache()},d.prototype.clearCache=function(){this.dispatchProps=null,this.stateProps=null,this.mergedProps=null,this.haveOwnPropsChanged=!0,this.hasStoreStateChanged=!0,this.haveStatePropsBeenPrecalculated=!1,this.statePropsPrecalculationError=null,this.renderedElement=null,this.finalMapDispatchToProps=null,this.finalMapStateToProps=null},d.prototype.handleChange=function(){if(this.unsubscribe){var e=this.store.getState(),t=this.state.storeState;if(!P||t!==e){if(P&&!this.doStatePropsDependOnOwnProps){var n=l(this.updateStatePropsIfNeeded,this);if(!n)return;n===_&&(this.statePropsPrecalculationError=_.value),this.haveStatePropsBeenPrecalculated=!0}this.hasStoreStateChanged=!0,this.setState({storeState:e})}}},d.prototype.getWrappedInstance=function(){return(0,b.default)(O,"To access the wrapped instance, you need to specify { withRef: true } as the fourth argument of the connect() call."),this.refs.wrappedInstance},d.prototype.render=function(){var t=this.haveOwnPropsChanged,n=this.hasStoreStateChanged,i=this.haveStatePropsBeenPrecalculated,r=this.statePropsPrecalculationError,a=this.renderedElement;if(this.haveOwnPropsChanged=!1,this.hasStoreStateChanged=!1,this.haveStatePropsBeenPrecalculated=!1,this.statePropsPrecalculationError=null,r)throw r;var s=!0,o=!0;P&&a&&(s=n||t&&this.doStatePropsDependOnOwnProps,o=t&&this.doDispatchPropsDependOnOwnProps);var l=!1,d=!1;return i?l=!0:s&&(l=this.updateStatePropsIfNeeded()),o&&(d=this.updateDispatchPropsIfNeeded()),(l||d||t)&&this.updateMergedPropsIfNeeded()||!a?(this.renderedElement=O?(0,u.createElement)(e,c({},this.mergedProps,{ref:"wrappedInstance"})):(0,u.createElement)(e,this.mergedProps),this.renderedElement):a},d}(u.Component);return p.displayName=i,p.WrappedComponent=e,p.contextTypes={store:d.default},p.propTypes={store:d.default},p.prototype.componentWillUpdate=function(){this.version!==R&&(this.version=R,this.trySubscribe(),this.clearCache())},(0,m.default)(p,e)}};var u=n(1),d=i(n(2)),h=i(n(6)),p=i(n(7)),f=i(n(3)),g=i(n(12)),m=i(n(8)),b=i(n(9)),v=function(e){return{}},y=function(e){return{dispatch:e}},w=function(e,t,n){return c({},n,e,t)},_={value:null},x=0},function(e,t){"use strict";t.__esModule=!0,t.default=function(e,t){if(e===t)return!0;var n=Object.keys(e),i=Object.keys(t);if(n.length!==i.length)return!1;for(var r=Object.prototype.hasOwnProperty,a=0;a<n.length;a++)if(!r.call(t,n[a])||e[n[a]]!==t[n[a]])return!1;return!0}},function(e,t,n){"use strict";t.__esModule=!0,t.default=function(e){return function(t){return(0,i.bindActionCreators)(e,t)}};var i=n(13)},function(e,t){"use strict";var n={childContextTypes:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,arguments:!0,arity:!0};e.exports=function(e,t){for(var r=Object.getOwnPropertyNames(t),a=0;a<r.length;++a)n[r[a]]||i[r[a]]||(e[r[a]]=t[r[a]]);return e}},function(e,t,n){"use strict";e.exports=function(e,t,n,i,r,a,s,o){if(void 0===t)throw new Error("invariant requires an error message argument");if(!e){var l;if(void 0===t)l=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var c=[n,i,r,a,s,o],u=0;(l=new Error(t.replace(/%s/g,function(){return c[u++]}))).name="Invariant Violation"}throw l.framesToPop=1,l}}},function(e,t){e.exports=function(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}},function(e,t){e.exports=function(e){return!!e&&"object"==typeof e}},function(e,t,n){var i=n(10),r=n(11),a="[object Object]",s=Object.prototype,o=Function.prototype.toString,l=o.call(Object),c=s.toString,u=Object.getPrototypeOf;e.exports=function(e){if(!r(e)||c.call(e)!=a||i(e))return!1;var t=s;if("function"==typeof e.constructor&&(t=u(e)),null===t)return!0;var n=t.constructor;return"function"==typeof n&&n instanceof n&&o.call(n)==l}},function(e,n){e.exports=t}])}),define("babel",{}),define("es6",{load:function(e){throw new Error("Dynamic load not allowed: "+e)}}),function(){function e(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function t(e){return null===e?NaN:+e}function n(e){return!isNaN(e)}function i(e){return{left:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)<0?i=a+1:r=a}return i},right:function(t,n,i,r){for(arguments.length<3&&(i=0),arguments.length<4&&(r=t.length);i<r;){var a=i+r>>>1;e(t[a],n)>0?r=a:i=a+1}return i}}}function r(e){return e.length}function a(e){for(var t=1;e*t%1;)t*=10;return t}function s(e,t){for(var n in t)Object.defineProperty(e.prototype,n,{value:t[n],enumerable:!1})}function o(){this._=Object.create(null)}function l(e){return(e+="")===Ba||e[0]===Va?Va+e:e}function c(e){return(e+="")[0]===Va?e.slice(1):e}function u(e){return l(e)in this._}function d(e){return(e=l(e))in this._&&delete this._[e]}function h(){var e=[];for(var t in this._)e.push(c(t));return e}function p(){var e=0;for(var t in this._)++e;return e}function f(){for(var e in this._)return!1;return!0}function g(){this._=Object.create(null)}function m(e,t,n){return function(){var i=n.apply(t,arguments);return i===t?e:i}}function b(e,t){if(t in e)return t;t=t.charAt(0).toUpperCase()+t.slice(1);for(var n=0,i=$a.length;n<i;++n){var r=$a[n]+t;if(r in e)return r}}function v(){}function y(){}function w(e){function t(){for(var t,i=n,r=-1,a=i.length;++r<a;)(t=i[r].on)&&t.apply(this,arguments);return e}var n=[],i=new o;return t.on=function(t,r){var a,s=i.get(t);return arguments.length<2?s&&s.on:(s&&(s.on=null,n=n.slice(0,a=n.indexOf(s)).concat(n.slice(a+1)),i.remove(t)),r&&n.push(i.set(t,{on:r})),e)},t}function _(){Ca.event.preventDefault()}function x(){for(var e,t=Ca.event;e=t.sourceEvent;)t=e;return t}function S(e){for(var t=new y,n=0,i=arguments.length;++n<i;)t[arguments[n]]=w(t);return t.of=function(n,i){return function(r){try{var a=r.sourceEvent=Ca.event;r.target=e,Ca.event=r,t[r.type].apply(n,i)}finally{Ca.event=a}}},t}function E(e){return Ha(e,Qa),e}function A(e){return"function"==typeof e?e:function(){return za(e,this)}}function k(e){return"function"==typeof e?e:function(){return Ga(e,this)}}function C(e,t){return e=Ca.ns.qualify(e),null==t?e.local?function(){this.removeAttributeNS(e.space,e.local)}:function(){this.removeAttribute(e)}:"function"==typeof t?e.local?function(){var n=t.apply(this,arguments);null==n?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}:function(){var n=t.apply(this,arguments);null==n?this.removeAttribute(e):this.setAttribute(e,n)}:e.local?function(){this.setAttributeNS(e.space,e.local,t)}:function(){this.setAttribute(e,t)}}function P(e){return e.trim().replace(/\s+/g," ")}function M(e){return new RegExp("(?:^|\\s+)"+Ca.requote(e)+"(?:\\s+|$)","g")}function O(e){return(e+"").trim().split(/^|\s+/)}function T(e,t){var n=(e=O(e).map(R)).length;return"function"==typeof t?function(){for(var i=-1,r=t.apply(this,arguments);++i<n;)e[i](this,r)}:function(){for(var i=-1;++i<n;)e[i](this,t)}}function R(e){var t=M(e);return function(n,i){if(r=n.classList)return i?r.add(e):r.remove(e);var r=n.getAttribute("class")||"";i?(t.lastIndex=0,t.test(r)||n.setAttribute("class",P(r+" "+e))):n.setAttribute("class",P(r.replace(t," ")))}}function D(e,t,n){return null==t?function(){this.style.removeProperty(e)}:"function"==typeof t?function(){var i=t.apply(this,arguments);null==i?this.style.removeProperty(e):this.style.setProperty(e,i,n)}:function(){this.style.setProperty(e,t,n)}}function I(e,t){return null==t?function(){delete this[e]}:"function"==typeof t?function(){var n=t.apply(this,arguments);null==n?delete this[e]:this[e]=n}:function(){this[e]=t}}function j(e){return"function"==typeof e?e:(e=Ca.ns.qualify(e)).local?function(){return this.ownerDocument.createElementNS(e.space,e.local)}:function(){return this.ownerDocument.createElementNS(this.namespaceURI,e)}}function N(e){return{__data__:e}}function q(e){return function(){return Wa(this,e)}}function L(t){return arguments.length||(t=e),function(e,n){return e&&n?t(e.__data__,n.__data__):!e-!n}}function F(e,t){for(var n=0,i=e.length;n<i;n++)for(var r,a=e[n],s=0,o=a.length;s<o;s++)(r=a[s])&&t(r,s,n);return e}function B(e){return Ha(e,Ka),e}function V(e){var t,n;return function(i,r,a){var s,o=e[a].update,l=o.length;for(a!=n&&(n=a,t=0),r>=t&&(t=r+1);!(s=o[t])&&++t<l;);return s}}function $(){var e=this.__transition__;e&&++e.active}function U(e,t,n){function i(){var t=this[r];t&&(this.removeEventListener(e,t,t.$),delete this[r])}var r="__on"+e,a=e.indexOf("."),s=H;a>0&&(e=e.slice(0,a));var o=Xa.get(e);return o&&(e=o,s=z),a?t?function(){var a=s(t,Ma(arguments));i.call(this),this.addEventListener(e,this[r]=a,a.$=n),a._=t}:i:t?v:function(){var t,n=new RegExp("^__on([^.]+)"+Ca.requote(e)+"$");for(var i in this)if(t=i.match(n)){var r=this[i];this.removeEventListener(t[1],r,r.$),delete this[i]}}}function H(e,t){return function(n){var i=Ca.event;Ca.event=n,t[0]=this.__data__;try{e.apply(this,t)}finally{Ca.event=i}}}function z(e,t){var n=H(e,t);return function(e){var t=this,i=e.relatedTarget;i&&(i===t||8&i.compareDocumentPosition(t))||n.call(t,e)}}function G(){var e=".dragsuppress-"+ ++ts,t="click"+e,n=Ca.select(Ra).on("touchmove"+e,_).on("dragstart"+e,_).on("selectstart"+e,_);if(es){var i=Ta.style,r=i[es];i[es]="none"}return function(a){function s(){n.on(t,null)}n.on(e,null),es&&(i[es]=r),a&&(n.on(t,function(){_(),s()},!0),setTimeout(s,0))}}function J(e,t){t.changedTouches&&(t=t.changedTouches[0]);var n=e.ownerSVGElement||e;if(n.createSVGPoint){var i=n.createSVGPoint();if(ns<0&&(Ra.scrollX||Ra.scrollY)){var r=(n=Ca.select("body").append("svg").style({position:"absolute",top:0,left:0,margin:0,padding:0,border:"none"},"important"))[0][0].getScreenCTM();ns=!(r.f||r.e),n.remove()}return ns?(i.x=t.pageX,i.y=t.pageY):(i.x=t.clientX,i.y=t.clientY),i=i.matrixTransform(e.getScreenCTM().inverse()),[i.x,i.y]}var a=e.getBoundingClientRect();return[t.clientX-a.left-e.clientLeft,t.clientY-a.top-e.clientTop]}function W(){return Ca.event.changedTouches[0].identifier}function Q(){return Ca.event.target}function Y(){return Ra}function K(e){return e>0?1:e<0?-1:0}function Z(e,t,n){return(t[0]-e[0])*(n[1]-e[1])-(t[1]-e[1])*(n[0]-e[0])}function X(e){return e>1?0:e<-1?is:Math.acos(e)}function ee(e){return e>1?as:e<-1?-as:Math.asin(e)}function te(e){return((e=Math.exp(e))-1/e)/2}function ne(e){return((e=Math.exp(e))+1/e)/2}function ie(e){return((e=Math.exp(2*e))-1)/(e+1)}function re(e){return(e=Math.sin(e/2))*e}function ae(){}function se(e,t,n){return this instanceof se?(this.h=+e,this.s=+t,void(this.l=+n)):arguments.length<2?e instanceof se?new se(e.h,e.s,e.l):we(""+e,_e,se):new se(e,t,n)}function oe(e,t,n){function i(e){return e>360?e-=360:e<0&&(e+=360),e<60?a+(s-a)*e/60:e<180?s:e<240?a+(s-a)*(240-e)/60:a}function r(e){return Math.round(255*i(e))}var a,s;return e=isNaN(e)?0:(e%=360)<0?e+360:e,t=isNaN(t)?0:t<0?0:t>1?1:t,n=n<0?0:n>1?1:n,s=n<=.5?n*(1+t):n+t-n*t,a=2*n-s,new me(r(e+120),r(e),r(e-120))}function le(e,t,n){return this instanceof le?(this.h=+e,this.c=+t,void(this.l=+n)):arguments.length<2?e instanceof le?new le(e.h,e.c,e.l):e instanceof ue?he(e.l,e.a,e.b):he((e=xe((e=Ca.rgb(e)).r,e.g,e.b)).l,e.a,e.b):new le(e,t,n)}function ce(e,t,n){return isNaN(e)&&(e=0),isNaN(t)&&(t=0),new ue(n,Math.cos(e*=ls)*t,Math.sin(e)*t)}function ue(e,t,n){return this instanceof ue?(this.l=+e,this.a=+t,void(this.b=+n)):arguments.length<2?e instanceof ue?new ue(e.l,e.a,e.b):e instanceof le?ce(e.h,e.c,e.l):xe((e=me(e)).r,e.g,e.b):new ue(e,t,n)}function de(e,t,n){var i=(e+16)/116,r=i+t/500,a=i-n/200;return r=pe(r)*vs,i=pe(i)*ys,a=pe(a)*ws,new me(ge(3.2404542*r-1.5371385*i-.4985314*a),ge(-.969266*r+1.8760108*i+.041556*a),ge(.0556434*r-.2040259*i+1.0572252*a))}function he(e,t,n){return e>0?new le(Math.atan2(n,t)*cs,Math.sqrt(t*t+n*n),e):new le(NaN,NaN,e)}function pe(e){return e>.206893034?e*e*e:(e-4/29)/7.787037}function fe(e){return e>.008856?Math.pow(e,1/3):7.787037*e+4/29}function ge(e){return Math.round(255*(e<=.00304?12.92*e:1.055*Math.pow(e,1/2.4)-.055))}function me(e,t,n){return this instanceof me?(this.r=~~e,this.g=~~t,void(this.b=~~n)):arguments.length<2?e instanceof me?new me(e.r,e.g,e.b):we(""+e,me,oe):new me(e,t,n)}function be(e){return new me(e>>16,e>>8&255,255&e)}function ve(e){return be(e)+""}function ye(e){return e<16?"0"+Math.max(0,e).toString(16):Math.min(255,e).toString(16)}function we(e,t,n){var i,r,a,s=0,o=0,l=0;if(i=/([a-z]+)\((.*)\)/i.exec(e))switch(r=i[2].split(","),i[1]){case"hsl":return n(parseFloat(r[0]),parseFloat(r[1])/100,parseFloat(r[2])/100);case"rgb":return t(Ee(r[0]),Ee(r[1]),Ee(r[2]))}return(a=Ss.get(e))?t(a.r,a.g,a.b):(null==e||"#"!==e.charAt(0)||isNaN(a=parseInt(e.slice(1),16))||(4===e.length?(s=(3840&a)>>4,s|=s>>4,o=240&a,o|=o>>4,l=15&a,l|=l<<4):7===e.length&&(s=(16711680&a)>>16,o=(65280&a)>>8,l=255&a)),t(s,o,l))}function _e(e,t,n){var i,r,a=Math.min(e/=255,t/=255,n/=255),s=Math.max(e,t,n),o=s-a,l=(s+a)/2;return o?(r=l<.5?o/(s+a):o/(2-s-a),i=e==s?(t-n)/o+(t<n?6:0):t==s?(n-e)/o+2:(e-t)/o+4,i*=60):(i=NaN,r=l>0&&l<1?0:i),new se(i,r,l)}function xe(e,t,n){var i=fe((.4124564*(e=Se(e))+.3575761*(t=Se(t))+.1804375*(n=Se(n)))/vs),r=fe((.2126729*e+.7151522*t+.072175*n)/ys);return ue(116*r-16,500*(i-r),200*(r-fe((.0193339*e+.119192*t+.9503041*n)/ws)))}function Se(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ee(e){var t=parseFloat(e);return"%"===e.charAt(e.length-1)?Math.round(2.55*t):t}function Ae(e){return"function"==typeof e?e:function(){return e}}function ke(e){return e}function Ce(e){return function(t,n,i){return 2===arguments.length&&"function"==typeof n&&(i=n,n=null),Pe(t,n,e,i)}}function Pe(e,t,n,i){function r(){var e,t=l.status;if(!t&&Oe(l)||t>=200&&t<300||304===t){try{e=n.call(a,l)}catch(e){return void s.error.call(a,e)}s.load.call(a,e)}else s.error.call(a,l)}var a={},s=Ca.dispatch("beforesend","progress","load","error"),o={},l=new XMLHttpRequest,c=null;return!Ra.XDomainRequest||"withCredentials"in l||!/^(http(s)?:)?\/\//.test(e)||(l=new XDomainRequest),"onload"in l?l.onload=l.onerror=r:l.onreadystatechange=function(){l.readyState>3&&r()},l.onprogress=function(e){var t=Ca.event;Ca.event=e;try{s.progress.call(a,l)}finally{Ca.event=t}},a.header=function(e,t){return e=(e+"").toLowerCase(),arguments.length<2?o[e]:(null==t?delete o[e]:o[e]=t+"",a)},a.mimeType=function(e){return arguments.length?(t=null==e?null:e+"",a):t},a.responseType=function(e){return arguments.length?(c=e,a):c},a.response=function(e){return n=e,a},["get","post"].forEach(function(e){a[e]=function(){return a.send.apply(a,[e].concat(Ma(arguments)))}}),a.send=function(n,i,r){if(2===arguments.length&&"function"==typeof i&&(r=i,i=null),l.open(n,e,!0),null==t||"accept"in o||(o.accept=t+",*/*"),l.setRequestHeader)for(var u in o)l.setRequestHeader(u,o[u]);return null!=t&&l.overrideMimeType&&l.overrideMimeType(t),null!=c&&(l.responseType=c),null!=r&&a.on("error",r).on("load",function(e){r(null,e)}),s.beforesend.call(a,l),l.send(null==i?null:i),a},a.abort=function(){return l.abort(),a},Ca.rebind(a,s,"on"),null==i?a:a.get(Me(i))}function Me(e){return 1===e.length?function(t,n){e(null==t?n:null)}:e}function Oe(e){var t=e.responseType;return t&&"text"!==t?e.response:e.responseText}function Te(){var e=Re(),t=De()-e;t>24?(isFinite(t)&&(clearTimeout(Cs),Cs=setTimeout(Te,t)),ks=0):(ks=1,Ms(Te))}function Re(){var e=Date.now();for(Ps=Es;Ps;)e>=Ps.t&&(Ps.f=Ps.c(e-Ps.t)),Ps=Ps.n;return e}function De(){for(var e,t=Es,n=1/0;t;)t.f?t=e?e.n=t.n:Es=t.n:(t.t<n&&(n=t.t),t=(e=t).n);return As=e,n}function Ie(e,t){return t-(e?Math.ceil(Math.log(e)/Math.LN10):1)}function je(e){var t=e.decimal,n=e.thousands,i=e.grouping,r=e.currency,a=i&&n?function(e,t){for(var r=e.length,a=[],s=0,o=i[0],l=0;r>0&&o>0&&(l+o+1>t&&(o=Math.max(1,t-l)),a.push(e.substring(r-=o,r+o)),!((l+=o+1)>t));)o=i[s=(s+1)%i.length];return a.reverse().join(n)}:ke;return function(e){var n=Ts.exec(e),i=n[1]||" ",s=n[2]||">",o=n[3]||"-",l=n[4]||"",c=n[5],u=+n[6],d=n[7],h=n[8],p=n[9],f=1,g="",m="",b=!1,v=!0;switch(h&&(h=+h.substring(1)),(c||"0"===i&&"="===s)&&(c=i="0",s="="),p){case"n":d=!0,p="g";break;case"%":f=100,m="%",p="f";break;case"p":f=100,m="%",p="r";break;case"b":case"o":case"x":case"X":"#"===l&&(g="0"+p.toLowerCase());case"c":v=!1;case"d":b=!0,h=0;break;case"s":f=-1,p="r"}"$"===l&&(g=r[0],m=r[1]),"r"!=p||h||(p="g"),null!=h&&("g"==p?h=Math.max(1,Math.min(21,h)):"e"!=p&&"f"!=p||(h=Math.max(0,Math.min(20,h)))),p=Rs.get(p)||Ne;var y=c&&d;return function(e){var n=m;if(b&&e%1)return"";var r=e<0||0===e&&1/e<0?(e=-e,"-"):"-"===o?"":o;if(f<0){var l=Ca.formatPrefix(e,h);e=l.scale(e),n=l.symbol+m}else e*=f;var w,_,x=(e=p(e,h)).lastIndexOf(".");if(x<0){var S=v?e.lastIndexOf("e"):-1;S<0?(w=e,_=""):(w=e.substring(0,S),_=e.substring(S))}else w=e.substring(0,x),_=t+e.substring(x+1);!c&&d&&(w=a(w,1/0));var E=g.length+w.length+_.length+(y?0:r.length),A=E<u?new Array(E=u-E+1).join(i):"";return y&&(w=a(A+w,A.length?u-_.length:1/0)),r+=g,e=w+_,("<"===s?r+e+A:">"===s?A+r+e:"^"===s?A.substring(0,E>>=1)+r+e+A.substring(E):r+(y?e:A+e))+n}}}function Ne(e){return e+""}function qe(){this._=new Date(arguments.length>1?Date.UTC.apply(this,arguments):arguments[0])}function Le(e,t,n){function i(t){var n=e(t),i=a(n,1);return t-n<i-t?n:i}function r(n){return t(n=e(new Is(n-1)),1),n}function a(e,n){return t(e=new Is(+e),n),e}function s(e,i,a){var s=r(e),o=[];if(a>1)for(;s<i;)n(s)%a||o.push(new Date(+s)),t(s,1);else for(;s<i;)o.push(new Date(+s)),t(s,1);return o}e.floor=e,e.round=i,e.ceil=r,e.offset=a,e.range=s;var o=e.utc=Fe(e);return o.floor=o,o.round=Fe(i),o.ceil=Fe(r),o.offset=Fe(a),o.range=function(e,t,n){try{Is=qe;var i=new qe;return i._=e,s(i,t,n)}finally{Is=Date}},e}function Fe(e){return function(t,n){try{Is=qe;var i=new qe;return i._=t,e(i,n)._}finally{Is=Date}}}function Be(e){function t(e){function t(t){for(var n,r,a,s=[],o=-1,l=0;++o<i;)37===e.charCodeAt(o)&&(s.push(e.slice(l,o)),null!=(r=Ns[n=e.charAt(++o)])&&(n=e.charAt(++o)),(a=w[n])&&(n=a(t,null==r?"e"===n?" ":"0":r)),s.push(n),l=o+1);return s.push(e.slice(l,o)),s.join("")}var i=e.length;return t.parse=function(t){var i={y:1900,m:0,d:1,H:0,M:0,S:0,L:0,Z:null};if(n(i,e,t,0)!=t.length)return null;"p"in i&&(i.H=i.H%12+12*i.p);var r=null!=i.Z&&Is!==qe,a=new(r?qe:Is);return"j"in i?a.setFullYear(i.y,0,i.j):"w"in i&&("W"in i||"U"in i)?(a.setFullYear(i.y,0,1),a.setFullYear(i.y,0,"W"in i?(i.w+6)%7+7*i.W-(a.getDay()+5)%7:i.w+7*i.U-(a.getDay()+6)%7)):a.setFullYear(i.y,i.m,i.d),a.setHours(i.H+(i.Z/100|0),i.M+i.Z%100,i.S,i.L),r?a._:a},t.toString=function(){return e},t}function n(e,t,n,i){for(var r,a,s,o=0,l=t.length,c=n.length;o<l;){if(i>=c)return-1;if(37===(r=t.charCodeAt(o++))){if(s=t.charAt(o++),!(a=_[s in Ns?t.charAt(o++):s])||(i=a(e,n,i))<0)return-1}else if(r!=n.charCodeAt(i++))return-1}return i}var i=e.dateTime,r=e.date,a=e.time,s=e.periods,o=e.days,l=e.shortDays,c=e.months,u=e.shortMonths;t.utc=function(e){function n(e){try{var t=new(Is=qe);return t._=e,i(t)}finally{Is=Date}}var i=t(e);return n.parse=function(e){try{Is=qe;var t=i.parse(e);return t&&t._}finally{Is=Date}},n.toString=i.toString,n},t.multi=t.utc.multi=st;var d=Ca.map(),h=$e(o),p=Ue(o),f=$e(l),g=Ue(l),m=$e(c),b=Ue(c),v=$e(u),y=Ue(u);s.forEach(function(e,t){d.set(e.toLowerCase(),t)});var w={a:function(e){return l[e.getDay()]},A:function(e){return o[e.getDay()]},b:function(e){return u[e.getMonth()]},B:function(e){return c[e.getMonth()]},c:t(i),d:function(e,t){return Ve(e.getDate(),t,2)},e:function(e,t){return Ve(e.getDate(),t,2)},H:function(e,t){return Ve(e.getHours(),t,2)},I:function(e,t){return Ve(e.getHours()%12||12,t,2)},j:function(e,t){return Ve(1+Ds.dayOfYear(e),t,3)},L:function(e,t){return Ve(e.getMilliseconds(),t,3)},m:function(e,t){return Ve(e.getMonth()+1,t,2)},M:function(e,t){return Ve(e.getMinutes(),t,2)},p:function(e){return s[+(e.getHours()>=12)]},S:function(e,t){return Ve(e.getSeconds(),t,2)},U:function(e,t){return Ve(Ds.sundayOfYear(e),t,2)},w:function(e){return e.getDay()},W:function(e,t){return Ve(Ds.mondayOfYear(e),t,2)},x:t(r),X:t(a),y:function(e,t){return Ve(e.getFullYear()%100,t,2)},Y:function(e,t){return Ve(e.getFullYear()%1e4,t,4)},Z:rt,"%":function(){return"%"}},_={a:function(e,t,n){f.lastIndex=0;var i=f.exec(t.slice(n));return i?(e.w=g.get(i[0].toLowerCase()),n+i[0].length):-1},A:function(e,t,n){h.lastIndex=0;var i=h.exec(t.slice(n));return i?(e.w=p.get(i[0].toLowerCase()),n+i[0].length):-1},b:function(e,t,n){v.lastIndex=0;var i=v.exec(t.slice(n));return i?(e.m=y.get(i[0].toLowerCase()),n+i[0].length):-1},B:function(e,t,n){m.lastIndex=0;var i=m.exec(t.slice(n));return i?(e.m=b.get(i[0].toLowerCase()),n+i[0].length):-1},c:function(e,t,i){return n(e,w.c.toString(),t,i)},d:Ze,e:Ze,H:et,I:et,j:Xe,L:it,m:Ke,M:tt,p:function(e,t,n){var i=d.get(t.slice(n,n+=2).toLowerCase());return null==i?-1:(e.p=i,n)},S:nt,U:ze,w:He,W:Ge,x:function(e,t,i){return n(e,w.x.toString(),t,i)},X:function(e,t,i){return n(e,w.X.toString(),t,i)},y:We,Y:Je,Z:Qe,"%":at};return t}function Ve(e,t,n){var i=e<0?"-":"",r=(i?-e:e)+"",a=r.length;return i+(a<n?new Array(n-a+1).join(t)+r:r)}function $e(e){return new RegExp("^(?:"+e.map(Ca.requote).join("|")+")","i")}function Ue(e){for(var t=new o,n=-1,i=e.length;++n<i;)t.set(e[n].toLowerCase(),n);return t}function He(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+1));return i?(e.w=+i[0],n+i[0].length):-1}function ze(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n));return i?(e.U=+i[0],n+i[0].length):-1}function Ge(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n));return i?(e.W=+i[0],n+i[0].length):-1}function Je(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+4));return i?(e.y=+i[0],n+i[0].length):-1}function We(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+2));return i?(e.y=Ye(+i[0]),n+i[0].length):-1}function Qe(e,t,n){return/^[+-]\d{4}$/.test(t=t.slice(n,n+5))?(e.Z=-t,n+5):-1}function Ye(e){return e+(e>68?1900:2e3)}function Ke(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+2));return i?(e.m=i[0]-1,n+i[0].length):-1}function Ze(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+2));return i?(e.d=+i[0],n+i[0].length):-1}function Xe(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+3));return i?(e.j=+i[0],n+i[0].length):-1}function et(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+2));return i?(e.H=+i[0],n+i[0].length):-1}function tt(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+2));return i?(e.M=+i[0],n+i[0].length):-1}function nt(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+2));return i?(e.S=+i[0],n+i[0].length):-1}function it(e,t,n){qs.lastIndex=0;var i=qs.exec(t.slice(n,n+3));return i?(e.L=+i[0],n+i[0].length):-1}function rt(e){var t=e.getTimezoneOffset(),n=t>0?"-":"+",i=Fa(t)/60|0,r=Fa(t)%60;return n+Ve(i,"0",2)+Ve(r,"0",2)}function at(e,t,n){Ls.lastIndex=0;var i=Ls.exec(t.slice(n,n+1));return i?n+i[0].length:-1}function st(e){for(var t=e.length,n=-1;++n<t;)e[n][0]=this(e[n][0]);return function(t){for(var n=0,i=e[n];!i[1](t);)i=e[++n];return i[0](t)}}function ot(){}function lt(e,t,n){var i=n.s=e+t,r=i-e,a=i-r;n.t=e-a+(t-r)}function ct(e,t){e&&$s.hasOwnProperty(e.type)&&$s[e.type](e,t)}function ut(e,t,n){var i,r=-1,a=e.length-n;for(t.lineStart();++r<a;)i=e[r],t.point(i[0],i[1],i[2]);t.lineEnd()}function dt(e,t){var n=-1,i=e.length;for(t.polygonStart();++n<i;)ut(e[n],t,1);t.polygonEnd()}function ht(){function e(e,t){t=t*ls/2+is/4;var n=(e*=ls)-i,s=n>=0?1:-1,o=s*n,l=Math.cos(t),c=Math.sin(t),u=a*c,d=r*l+u*Math.cos(o),h=u*s*Math.sin(o);Hs.add(Math.atan2(h,d)),i=e,r=l,a=c}var t,n,i,r,a;zs.point=function(s,o){zs.point=e,i=(t=s)*ls,r=Math.cos(o=(n=o)*ls/2+is/4),a=Math.sin(o)},zs.lineEnd=function(){e(t,n)}}function pt(e){var t=e[0],n=e[1],i=Math.cos(n);return[i*Math.cos(t),i*Math.sin(t),Math.sin(n)]}function ft(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function gt(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}function mt(e,t){e[0]+=t[0],e[1]+=t[1],e[2]+=t[2]}function bt(e,t){return[e[0]*t,e[1]*t,e[2]*t]}function vt(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);e[0]/=t,e[1]/=t,e[2]/=t}function yt(e){return[Math.atan2(e[1],e[0]),ee(e[2])]}function wt(e,t){return Fa(e[0]-t[0])<ss&&Fa(e[1]-t[1])<ss}function _t(e,t){e*=ls;var n=Math.cos(t*=ls);xt(n*Math.cos(e),n*Math.sin(e),Math.sin(t))}function xt(e,t,n){Ws+=(e-Ws)/++Gs,Qs+=(t-Qs)/Gs,Ys+=(n-Ys)/Gs}function St(){function e(e,r){e*=ls;var a=Math.cos(r*=ls),s=a*Math.cos(e),o=a*Math.sin(e),l=Math.sin(r),c=Math.atan2(Math.sqrt((c=n*l-i*o)*c+(c=i*s-t*l)*c+(c=t*o-n*s)*c),t*s+n*o+i*l);Js+=c,Ks+=c*(t+(t=s)),Zs+=c*(n+(n=o)),Xs+=c*(i+(i=l)),xt(t,n,i)}var t,n,i;io.point=function(r,a){r*=ls;var s=Math.cos(a*=ls);t=s*Math.cos(r),n=s*Math.sin(r),i=Math.sin(a),io.point=e,xt(t,n,i)}}function Et(){io.point=_t}function At(){function e(e,t){e*=ls;var n=Math.cos(t*=ls),s=n*Math.cos(e),o=n*Math.sin(e),l=Math.sin(t),c=r*l-a*o,u=a*s-i*l,d=i*o-r*s,h=Math.sqrt(c*c+u*u+d*d),p=i*s+r*o+a*l,f=h&&-X(p)/h,g=Math.atan2(h,p);eo+=f*c,to+=f*u,no+=f*d,Js+=g,Ks+=g*(i+(i=s)),Zs+=g*(r+(r=o)),Xs+=g*(a+(a=l)),xt(i,r,a)}var t,n,i,r,a;io.point=function(s,o){t=s,n=o,io.point=e,s*=ls;var l=Math.cos(o*=ls);i=l*Math.cos(s),r=l*Math.sin(s),a=Math.sin(o),xt(i,r,a)},io.lineEnd=function(){e(t,n),io.lineEnd=Et,io.point=_t}}function kt(){return!0}function Ct(e,t,n,i,r){var a=[],s=[];if(e.forEach(function(e){if(!((t=e.length-1)<=0)){var t,n=e[0],i=e[t];if(wt(n,i)){r.lineStart();for(var o=0;o<t;++o)r.point((n=e[o])[0],n[1]);r.lineEnd()}else{var l=new Mt(n,e,null,!0),c=new Mt(n,null,l,!1);l.o=c,a.push(l),s.push(c),c=new Mt(i,null,l=new Mt(i,e,null,!1),!0),l.o=c,a.push(l),s.push(c)}}}),s.sort(t),Pt(a),Pt(s),a.length){for(var o=0,l=n,c=s.length;o<c;++o)s[o].e=l=!l;for(var u,d,h=a[0];;){for(var p=h,f=!0;p.v;)if((p=p.n)===h)return;u=p.z,r.lineStart();do{if(p.v=p.o.v=!0,p.e){if(f)for(var o=0,c=u.length;o<c;++o)r.point((d=u[o])[0],d[1]);else i(p.x,p.n.x,1,r);p=p.n}else{if(f)for(o=(u=p.p.z).length-1;o>=0;--o)r.point((d=u[o])[0],d[1]);else i(p.x,p.p.x,-1,r);p=p.p}u=(p=p.o).z,f=!f}while(!p.v);r.lineEnd()}}}function Pt(e){if(t=e.length){for(var t,n,i=0,r=e[0];++i<t;)r.n=n=e[i],n.p=r,r=n;r.n=n=e[0],n.p=r}}function Mt(e,t,n,i){this.x=e,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Ot(e,t,n,i){return function(r,a){function s(t,n){var i=r(t,n);e(t=i[0],n=i[1])&&a.point(t,n)}function o(e,t){var n=r(e,t);m.point(n[0],n[1])}function l(){v.point=o,m.lineStart()}function c(){v.point=s,m.lineEnd()}function u(e,t){g.push([e,t]);var n=r(e,t);w.point(n[0],n[1])}function d(){w.lineStart(),g=[]}function h(){u(g[0][0],g[0][1]),w.lineEnd();var e,t=w.clean(),n=y.buffer(),i=n.length;if(g.pop(),f.push(g),g=null,i)if(1&t){var r,s=-1;if((i=(e=n[0]).length-1)>0){for(_||(a.polygonStart(),_=!0),a.lineStart();++s<i;)a.point((r=e[s])[0],r[1]);a.lineEnd()}}else i>1&&2&t&&n.push(n.pop().concat(n.shift())),p.push(n.filter(Tt))}var p,f,g,m=t(a),b=r.invert(i[0],i[1]),v={point:s,lineStart:l,lineEnd:c,polygonStart:function(){v.point=u,v.lineStart=d,v.lineEnd=h,p=[],f=[]},polygonEnd:function(){v.point=s,v.lineStart=l,v.lineEnd=c,p=Ca.merge(p);var e=jt(b,f);p.length?(_||(a.polygonStart(),_=!0),Ct(p,Dt,e,n,a)):e&&(_||(a.polygonStart(),_=!0),a.lineStart(),n(null,null,1,a),a.lineEnd()),_&&(a.polygonEnd(),_=!1),p=f=null},sphere:function(){a.polygonStart(),a.lineStart(),n(null,null,1,a),a.lineEnd(),a.polygonEnd()}},y=Rt(),w=t(y),_=!1;return v}}function Tt(e){return e.length>1}function Rt(){var e,t=[];return{lineStart:function(){t.push(e=[])},point:function(t,n){e.push([t,n])},lineEnd:v,buffer:function(){var n=t;return t=[],e=null,n},rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))}}}function Dt(e,t){return((e=e.x)[0]<0?e[1]-as-ss:as-e[1])-((t=t.x)[0]<0?t[1]-as-ss:as-t[1])}function It(e,t,n,i){var r,a,s=Math.sin(e-n);return Fa(s)>ss?Math.atan((Math.sin(t)*(a=Math.cos(i))*Math.sin(n)-Math.sin(i)*(r=Math.cos(t))*Math.sin(e))/(r*a*s)):(t+i)/2}function jt(e,t){var n=e[0],i=e[1],r=[Math.sin(n),-Math.cos(n),0],a=0,s=0;Hs.reset();for(var o=0,l=t.length;o<l;++o){var c=t[o],u=c.length;if(u)for(var d=c[0],h=d[0],p=d[1]/2+is/4,f=Math.sin(p),g=Math.cos(p),m=1;;){m===u&&(m=0);var b=(e=c[m])[0],v=e[1]/2+is/4,y=Math.sin(v),w=Math.cos(v),_=b-h,x=_>=0?1:-1,S=x*_,E=S>is,A=f*y;if(Hs.add(Math.atan2(A*x*Math.sin(S),g*w+A*Math.cos(S))),a+=E?_+x*rs:_,E^h>=n^b>=n){var k=gt(pt(d),pt(e));vt(k);var C=gt(r,k);vt(C);var P=(E^_>=0?-1:1)*ee(C[2]);(i>P||i===P&&(k[0]||k[1]))&&(s+=E^_>=0?1:-1)}if(!m++)break;h=b,f=y,g=w,d=e}}return(a<-ss||a<ss&&Hs<0)^1&s}function Nt(e){function t(e,t){return Math.cos(e)*Math.cos(t)>r}function n(e,t,n){var i=[1,0,0],a=gt(pt(e),pt(t)),s=ft(a,a),o=a[0],l=s-o*o;if(!l)return!n&&e;var c=r*s/l,u=-r*o/l,d=gt(i,a),h=bt(i,c);mt(h,bt(a,u));var p=d,f=ft(h,p),g=ft(p,p),m=f*f-g*(ft(h,h)-1);if(!(m<0)){var b=Math.sqrt(m),v=bt(p,(-f-b)/g);if(mt(v,h),v=yt(v),!n)return v;var y,w=e[0],_=t[0],x=e[1],S=t[1];_<w&&(y=w,w=_,_=y);var E=_-w,A=Fa(E-is)<ss,k=A||E<ss;if(!A&&S<x&&(y=x,x=S,S=y),k?A?x+S>0^v[1]<(Fa(v[0]-w)<ss?x:S):x<=v[1]&&v[1]<=S:E>is^(w<=v[0]&&v[0]<=_)){var C=bt(p,(-f+b)/g);return mt(C,h),[v,yt(C)]}}}function i(t,n){var i=a?e:is-e,r=0;return t<-i?r|=1:t>i&&(r|=2),n<-i?r|=4:n>i&&(r|=8),r}var r=Math.cos(e),a=r>0,s=Fa(r)>ss;return Ot(t,function(e){var r,o,l,c,u;return{lineStart:function(){c=l=!1,u=1},point:function(d,h){var p,f=[d,h],g=t(d,h),m=a?g?0:i(d,h):g?i(d+(d<0?is:-is),h):0;if(!r&&(c=l=g)&&e.lineStart(),g!==l&&(p=n(r,f),(wt(r,p)||wt(f,p))&&(f[0]+=ss,f[1]+=ss,g=t(f[0],f[1]))),g!==l)u=0,g?(e.lineStart(),p=n(f,r),e.point(p[0],p[1])):(p=n(r,f),e.point(p[0],p[1]),e.lineEnd()),r=p;else if(s&&r&&a^g){var b;m&o||!(b=n(f,r,!0))||(u=0,a?(e.lineStart(),e.point(b[0][0],b[0][1]),e.point(b[1][0],b[1][1]),e.lineEnd()):(e.point(b[1][0],b[1][1]),e.lineEnd(),e.lineStart(),e.point(b[0][0],b[0][1])))}!g||r&&wt(r,f)||e.point(f[0],f[1]),r=f,l=g,o=m},lineEnd:function(){l&&e.lineEnd(),r=null},clean:function(){return u|(c&&l)<<1}}},un(e,6*ls),a?[0,-e]:[-is,e-is])}function qt(e,t,n,i){return function(r){var a,s=r.a,o=r.b,l=s.x,c=s.y,u=0,d=1,h=o.x-l,p=o.y-c;if(a=e-l,h||!(a>0)){if(a/=h,h<0){if(a<u)return;a<d&&(d=a)}else if(h>0){if(a>d)return;a>u&&(u=a)}if(a=n-l,h||!(a<0)){if(a/=h,h<0){if(a>d)return;a>u&&(u=a)}else if(h>0){if(a<u)return;a<d&&(d=a)}if(a=t-c,p||!(a>0)){if(a/=p,p<0){if(a<u)return;a<d&&(d=a)}else if(p>0){if(a>d)return;a>u&&(u=a)}if(a=i-c,p||!(a<0)){if(a/=p,p<0){if(a>d)return;a>u&&(u=a)}else if(p>0){if(a<u)return;a<d&&(d=a)}return u>0&&(r.a={x:l+u*h,y:c+u*p}),d<1&&(r.b={x:l+d*h,y:c+d*p}),r}}}}}}function Lt(e,t,n,i){function r(i,r){return Fa(i[0]-e)<ss?r>0?0:3:Fa(i[0]-n)<ss?r>0?2:1:Fa(i[1]-t)<ss?r>0?1:0:r>0?3:2}function a(e,t){return s(e.x,t.x)}function s(e,t){var n=r(e,1),i=r(t,1);return n!==i?n-i:0===n?t[1]-e[1]:1===n?e[0]-t[0]:2===n?e[1]-t[1]:t[0]-e[0]}return function(o){function l(e){for(var t=0,n=f.length,i=e[1],r=0;r<n;++r)for(var a,s=1,o=f[r],l=o.length,c=o[0];s<l;++s)a=o[s],c[1]<=i?a[1]>i&&Z(c,a,e)>0&&++t:a[1]<=i&&Z(c,a,e)<0&&--t,c=a;return 0!==t}function c(a,o,l,c){var u=0,d=0;if(null==a||(u=r(a,l))!==(d=r(o,l))||s(a,o)<0^l>0)do{c.point(0===u||3===u?e:n,u>1?i:t)}while((u=(u+l+4)%4)!==d);else c.point(o[0],o[1])}function u(r,a){return e<=r&&r<=n&&t<=a&&a<=i}function d(e,t){u(e,t)&&o.point(e,t)}function h(e,t){var n=u(e=Math.max(-ao,Math.min(ao,e)),t=Math.max(-ao,Math.min(ao,t)));if(f&&g.push([e,t]),x)m=e,b=t,v=n,x=!1,n&&(o.lineStart(),o.point(e,t));else if(n&&_)o.point(e,t);else{var i={a:{x:y,y:w},b:{x:e,y:t}};k(i)?(_||(o.lineStart(),o.point(i.a.x,i.a.y)),o.point(i.b.x,i.b.y),n||o.lineEnd(),S=!1):n&&(o.lineStart(),o.point(e,t),S=!1)}y=e,w=t,_=n}var p,f,g,m,b,v,y,w,_,x,S,E=o,A=Rt(),k=qt(e,t,n,i),C={point:d,lineStart:function(){C.point=h,f&&f.push(g=[]),x=!0,_=!1,y=w=NaN},lineEnd:function(){p&&(h(m,b),v&&_&&A.rejoin(),p.push(A.buffer())),C.point=d,_&&o.lineEnd()},polygonStart:function(){o=A,p=[],f=[],S=!0},polygonEnd:function(){o=E,p=Ca.merge(p);var t=l([e,i]),n=S&&t,r=p.length;(n||r)&&(o.polygonStart(),n&&(o.lineStart(),c(null,null,1,o),o.lineEnd()),r&&Ct(p,a,t,c,o),o.polygonEnd()),p=f=g=null}};return C}}function Ft(e,t){function n(n,i){return n=e(n,i),t(n[0],n[1])}return e.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&e.invert(n[0],n[1])}),n}function Bt(e){var t=0,n=is/3,i=tn(e),r=i(t,n);return r.parallels=function(e){return arguments.length?i(t=e[0]*is/180,n=e[1]*is/180):[t/is*180,n/is*180]},r}function Vt(e,t){function n(e,t){var n=Math.sqrt(a-2*r*Math.sin(t))/r;return[n*Math.sin(e*=r),s-n*Math.cos(e)]}var i=Math.sin(e),r=(i+Math.sin(t))/2,a=1+i*(2*r-i),s=Math.sqrt(a)/r;return n.invert=function(e,t){var n=s-t;return[Math.atan2(e,n)/r,ee((a-(e*e+n*n)*r*r)/(2*r))]},n}function $t(){function e(e,t){oo+=r*e-i*t,i=e,r=t}var t,n,i,r;po.point=function(a,s){po.point=e,t=i=a,n=r=s},po.lineEnd=function(){e(t,n)}}function Ut(){function e(e,t){s.push("M",e,",",t,a)}function t(e,t){s.push("M",e,",",t),o.point=n}function n(e,t){s.push("L",e,",",t)}function i(){o.point=e}function r(){s.push("Z")}var a=Ht(4.5),s=[],o={point:e,lineStart:function(){o.point=t},lineEnd:i,polygonStart:function(){o.lineEnd=r},polygonEnd:function(){o.lineEnd=i,o.point=e},pointRadius:function(e){return a=Ht(e),o},result:function(){if(s.length){var e=s.join("");return s=[],e}}};return o}function Ht(e){return"m0,"+e+"a"+e+","+e+" 0 1,1 0,"+-2*e+"a"+e+","+e+" 0 1,1 0,"+2*e+"z"}function zt(e,t){Ws+=e,Qs+=t,++Ys}function Gt(){function e(e,i){var r=e-t,a=i-n,s=Math.sqrt(r*r+a*a);Ks+=s*(t+e)/2,Zs+=s*(n+i)/2,Xs+=s,zt(t=e,n=i)}var t,n;go.point=function(i,r){go.point=e,zt(t=i,n=r)}}function Jt(){go.point=zt}function Wt(){function e(e,t){var n=e-i,a=t-r,s=Math.sqrt(n*n+a*a);Ks+=s*(i+e)/2,Zs+=s*(r+t)/2,Xs+=s,eo+=(s=r*e-i*t)*(i+e),to+=s*(r+t),no+=3*s,zt(i=e,r=t)}var t,n,i,r;go.point=function(a,s){go.point=e,zt(t=i=a,n=r=s)},go.lineEnd=function(){e(t,n)}}function Qt(e){function t(t,n){e.moveTo(t,n),e.arc(t,n,s,0,rs)}function n(t,n){e.moveTo(t,n),o.point=i}function i(t,n){e.lineTo(t,n)}function r(){o.point=t}function a(){e.closePath()}var s=4.5,o={point:t,lineStart:function(){o.point=n},lineEnd:r,polygonStart:function(){o.lineEnd=a},polygonEnd:function(){o.lineEnd=r,o.point=t},pointRadius:function(e){return s=e,o},result:v};return o}function Yt(e){function t(e){return(o?i:n)(e)}function n(t){return Xt(t,function(n,i){n=e(n,i),t.point(n[0],n[1])})}function i(t){function n(n,i){n=e(n,i),t.point(n[0],n[1])}function i(){y=NaN,E.point=a,t.lineStart()}function a(n,i){var a=pt([n,i]),s=e(n,i);r(y,w,v,_,x,S,y=s[0],w=s[1],v=n,_=a[0],x=a[1],S=a[2],o,t),t.point(y,w)}function s(){E.point=n,t.lineEnd()}function l(){i(),E.point=c,E.lineEnd=u}function c(e,t){a(d=e,h=t),p=y,f=w,g=_,m=x,b=S,E.point=a}function u(){r(y,w,v,_,x,S,p,f,d,g,m,b,o,t),E.lineEnd=s,s()}var d,h,p,f,g,m,b,v,y,w,_,x,S,E={point:n,lineStart:i,lineEnd:s,polygonStart:function(){t.polygonStart(),E.lineStart=l},polygonEnd:function(){t.polygonEnd(),E.lineStart=i}};return E}function r(t,n,i,o,l,c,u,d,h,p,f,g,m,b){var v=u-t,y=d-n,w=v*v+y*y;if(w>4*a&&m--){var _=o+p,x=l+f,S=c+g,E=Math.sqrt(_*_+x*x+S*S),A=Math.asin(S/=E),k=Fa(Fa(S)-1)<ss||Fa(i-h)<ss?(i+h)/2:Math.atan2(x,_),C=e(k,A),P=C[0],M=C[1],O=P-t,T=M-n,R=y*O-v*T;(R*R/w>a||Fa((v*O+y*T)/w-.5)>.3||o*p+l*f+c*g<s)&&(r(t,n,i,o,l,c,P,M,k,_/=E,x/=E,S,m,b),b.point(P,M),r(P,M,k,_,x,S,u,d,h,p,f,g,m,b))}}var a=.5,s=Math.cos(30*ls),o=16;return t.precision=function(e){return arguments.length?(o=(a=e*e)>0&&16,t):Math.sqrt(a)},t}function Kt(e){var t=Yt(function(t,n){return e([t*cs,n*cs])});return function(e){return nn(t(e))}}function Zt(e){this.stream=e}function Xt(e,t){return{point:t,sphere:function(){e.sphere()},lineStart:function(){e.lineStart()},lineEnd:function(){e.lineEnd()},polygonStart:function(){e.polygonStart()},polygonEnd:function(){e.polygonEnd()}}}function en(e){return tn(function(){return e})()}function tn(e){function t(e){return e=o(e[0]*ls,e[1]*ls),[e[0]*h+l,c-e[1]*h]}function n(e){return(e=o.invert((e[0]-l)/h,(c-e[1])/h))&&[e[0]*cs,e[1]*cs]}function i(){o=Ft(s=sn(b,v,y),a);var e=a(g,m);return l=p-e[0]*h,c=f+e[1]*h,r()}function r(){return u&&(u.valid=!1,u=null),t}var a,s,o,l,c,u,d=Yt(function(e,t){return e=a(e,t),[e[0]*h+l,c-e[1]*h]}),h=150,p=480,f=250,g=0,m=0,b=0,v=0,y=0,w=ro,_=ke,x=null,S=null;return t.stream=function(e){return u&&(u.valid=!1),u=nn(w(s,d(_(e)))),u.valid=!0,u},t.clipAngle=function(e){return arguments.length?(w=null==e?(x=e,ro):Nt((x=+e)*ls),r()):x},t.clipExtent=function(e){return arguments.length?(S=e,_=e?Lt(e[0][0],e[0][1],e[1][0],e[1][1]):ke,r()):S},t.scale=function(e){return arguments.length?(h=+e,i()):h},t.translate=function(e){return arguments.length?(p=+e[0],f=+e[1],i()):[p,f]},t.center=function(e){return arguments.length?(g=e[0]%360*ls,m=e[1]%360*ls,i()):[g*cs,m*cs]},t.rotate=function(e){return arguments.length?(b=e[0]%360*ls,v=e[1]%360*ls,y=e.length>2?e[2]%360*ls:0,i()):[b*cs,v*cs,y*cs]},Ca.rebind(t,d,"precision"),function(){return a=e.apply(this,arguments),t.invert=a.invert&&n,i()}}function nn(e){return Xt(e,function(t,n){e.point(t*ls,n*ls)})}function rn(e,t){return[e,t]}function an(e,t){return[e>is?e-rs:e<-is?e+rs:e,t]}function sn(e,t,n){return e?t||n?Ft(ln(e),cn(t,n)):ln(e):t||n?cn(t,n):an}function on(e){return function(t,n){return t+=e,[t>is?t-rs:t<-is?t+rs:t,n]}}function ln(e){var t=on(e);return t.invert=on(-e),t}function cn(e,t){function n(e,t){var n=Math.cos(t),o=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),u=c*i+o*r;return[Math.atan2(l*a-u*s,o*i-c*r),ee(u*a+l*s)]}var i=Math.cos(e),r=Math.sin(e),a=Math.cos(t),s=Math.sin(t);return n.invert=function(e,t){var n=Math.cos(t),o=Math.cos(e)*n,l=Math.sin(e)*n,c=Math.sin(t),u=c*a-l*s;return[Math.atan2(l*a+c*s,o*i+u*r),ee(u*i-o*r)]},n}function un(e,t){var n=Math.cos(e),i=Math.sin(e);return function(r,a,s,o){var l=s*t;null!=r?(r=dn(n,r),a=dn(n,a),(s>0?r<a:r>a)&&(r+=s*rs)):(r=e+s*rs,a=e-.5*l);for(var c,u=r;s>0?u>a:u<a;u-=l)o.point((c=yt([n,-i*Math.cos(u),-i*Math.sin(u)]))[0],c[1])}}function dn(e,t){var n=pt(t);n[0]-=e,vt(n);var i=X(-n[1]);return((-n[2]<0?-i:i)+2*Math.PI-ss)%(2*Math.PI)}function hn(e,t,n){var i=Ca.range(e,t-ss,n).concat(t);return function(e){return i.map(function(t){return[e,t]})}}function pn(e,t,n){var i=Ca.range(e,t-ss,n).concat(t);return function(e){return i.map(function(t){return[t,e]})}}function fn(e){return e.source}function gn(e){return e.target}function mn(e,t,n,i){var r=Math.cos(t),a=Math.sin(t),s=Math.cos(i),o=Math.sin(i),l=r*Math.cos(e),c=r*Math.sin(e),u=s*Math.cos(n),d=s*Math.sin(n),h=2*Math.asin(Math.sqrt(re(i-t)+r*s*re(n-e))),p=1/Math.sin(h),f=h?function(e){var t=Math.sin(e*=h)*p,n=Math.sin(h-e)*p,i=n*l+t*u,r=n*c+t*d,s=n*a+t*o;return[Math.atan2(r,i)*cs,Math.atan2(s,Math.sqrt(i*i+r*r))*cs]}:function(){return[e*cs,t*cs]};return f.distance=h,f}function bn(e,t){function n(t,n){var i=Math.cos(t),r=Math.cos(n),a=e(i*r);return[a*r*Math.sin(t),a*Math.sin(n)]}return n.invert=function(e,n){var i=Math.sqrt(e*e+n*n),r=t(i),a=Math.sin(r),s=Math.cos(r);return[Math.atan2(e*a,i*s),Math.asin(i&&n*a/i)]},n}function vn(e,t){function n(e,t){s>0?t<-as+ss&&(t=-as+ss):t>as-ss&&(t=as-ss);var n=s/Math.pow(r(t),a);return[n*Math.sin(a*e),s-n*Math.cos(a*e)]}var i=Math.cos(e),r=function(e){return Math.tan(is/4+e/2)},a=e===t?Math.sin(e):Math.log(i/Math.cos(t))/Math.log(r(t)/r(e)),s=i*Math.pow(r(e),a)/a;return a?(n.invert=function(e,t){var n=s-t,i=K(a)*Math.sqrt(e*e+n*n);return[Math.atan2(e,n)/a,2*Math.atan(Math.pow(s/i,1/a))-as]},n):wn}function yn(e,t){function n(e,t){var n=a-t;return[n*Math.sin(r*e),a-n*Math.cos(r*e)]}var i=Math.cos(e),r=e===t?Math.sin(e):(i-Math.cos(t))/(t-e),a=i/r+e;return Fa(r)<ss?rn:(n.invert=function(e,t){var n=a-t;return[Math.atan2(e,n)/r,a-K(r)*Math.sqrt(e*e+n*n)]},n)}function wn(e,t){return[e,Math.log(Math.tan(is/4+t/2))]}function _n(e){var t,n=en(e),i=n.scale,r=n.translate,a=n.clipExtent;return n.scale=function(){var e=i.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.translate=function(){var e=r.apply(n,arguments);return e===n?t?n.clipExtent(null):n:e},n.clipExtent=function(e){var s=a.apply(n,arguments);if(s===n){if(t=null==e){var o=is*i(),l=r();a([[l[0]-o,l[1]-o],[l[0]+o,l[1]+o]])}}else t&&(s=null);return s},n.clipExtent(null)}function xn(e,t){return[Math.log(Math.tan(is/4+t/2)),-e]}function Sn(e){return e[0]}function En(e){return e[1]}function An(e){for(var t=e.length,n=[0,1],i=2,r=2;r<t;r++){for(;i>1&&Z(e[n[i-2]],e[n[i-1]],e[r])<=0;)--i;n[i++]=r}return n.slice(0,i)}function kn(e,t){return e[0]-t[0]||e[1]-t[1]}function Cn(e,t,n){return(n[0]-t[0])*(e[1]-t[1])<(n[1]-t[1])*(e[0]-t[0])}function Pn(e,t,n,i){var r=e[0],a=n[0],s=t[0]-r,o=i[0]-a,l=e[1],c=n[1],u=t[1]-l,d=i[1]-c,h=(o*(l-c)-d*(r-a))/(d*s-o*u);return[r+h*s,l+h*u]}function Mn(e){var t=e[0],n=e[e.length-1];return!(t[0]-n[0]||t[1]-n[1])}function On(){Kn(this),this.edge=this.site=this.circle=null}function Tn(e){var t=Mo.pop()||new On;return t.site=e,t}function Rn(e){$n(e),ko.remove(e),Mo.push(e),Kn(e)}function Dn(e){var t=e.circle,n=t.x,i=t.cy,r={x:n,y:i},a=e.P,s=e.N,o=[e];Rn(e);for(var l=a;l.circle&&Fa(n-l.circle.x)<ss&&Fa(i-l.circle.cy)<ss;)a=l.P,o.unshift(l),Rn(l),l=a;o.unshift(l),$n(l);for(var c=s;c.circle&&Fa(n-c.circle.x)<ss&&Fa(i-c.circle.cy)<ss;)s=c.N,o.push(c),Rn(c),c=s;o.push(c),$n(c);var u,d=o.length;for(u=1;u<d;++u)c=o[u],l=o[u-1],Wn(c.edge,l.site,c.site,r);l=o[0],(c=o[d-1]).edge=Gn(l.site,c.site,null,r),Vn(l),Vn(c)}function In(e){for(var t,n,i,r,a=e.x,s=e.y,o=ko._;o;)if((i=jn(o,s)-a)>ss)o=o.L;else{if(!((r=a-Nn(o,s))>ss)){i>-ss?(t=o.P,n=o):r>-ss?(t=o,n=o.N):t=n=o;break}if(!o.R){t=o;break}o=o.R}var l=Tn(e);if(ko.insert(t,l),t||n){if(t===n)return $n(t),n=Tn(t.site),ko.insert(l,n),l.edge=n.edge=Gn(t.site,l.site),Vn(t),void Vn(n);if(n){$n(t),$n(n);var c=t.site,u=c.x,d=c.y,h=e.x-u,p=e.y-d,f=n.site,g=f.x-u,m=f.y-d,b=2*(h*m-p*g),v=h*h+p*p,y=g*g+m*m,w={x:(m*v-p*y)/b+u,y:(h*y-g*v)/b+d};Wn(n.edge,c,f,w),l.edge=Gn(c,e,null,w),n.edge=Gn(e,f,null,w),Vn(t),Vn(n)}else l.edge=Gn(t.site,l.site)}}function jn(e,t){var n=e.site,i=n.x,r=n.y,a=r-t;if(!a)return i;var s=e.P;if(!s)return-1/0;var o=(n=s.site).x,l=n.y,c=l-t;if(!c)return o;var u=o-i,d=1/a-1/c,h=u/c;return d?(-h+Math.sqrt(h*h-2*d*(u*u/(-2*c)-l+c/2+r-a/2)))/d+i:(i+o)/2}function Nn(e,t){var n=e.N;if(n)return jn(n,t);var i=e.site;return i.y===t?i.x:1/0}function qn(e){this.site=e,this.edges=[]}function Ln(e){for(var t,n,i,r,a,s,o,l,c,u,d=e[0][0],h=e[1][0],p=e[0][1],f=e[1][1],g=Ao,m=g.length;m--;)if((a=g[m])&&a.prepare())for(l=(o=a.edges).length,s=0;s<l;)i=(u=o[s].end()).x,r=u.y,t=(c=o[++s%l].start()).x,n=c.y,(Fa(i-t)>ss||Fa(r-n)>ss)&&(o.splice(s,0,new Qn(Jn(a.site,u,Fa(i-d)<ss&&f-r>ss?{x:d,y:Fa(t-d)<ss?n:f}:Fa(r-f)<ss&&h-i>ss?{x:Fa(n-f)<ss?t:h,y:f}:Fa(i-h)<ss&&r-p>ss?{x:h,y:Fa(t-h)<ss?n:p}:Fa(r-p)<ss&&i-d>ss?{x:Fa(n-p)<ss?t:d,y:p}:null),a.site,null)),++l)}function Fn(e,t){return t.angle-e.angle}function Bn(){Kn(this),this.x=this.y=this.arc=this.site=this.cy=null}function Vn(e){var t=e.P,n=e.N;if(t&&n){var i=t.site,r=e.site,a=n.site;if(i!==a){var s=r.x,o=r.y,l=i.x-s,c=i.y-o,u=a.x-s,d=2*(l*(m=a.y-o)-c*u);if(!(d>=-os)){var h=l*l+c*c,p=u*u+m*m,f=(m*h-c*p)/d,g=(l*p-u*h)/d,m=g+o,b=Oo.pop()||new Bn;b.arc=e,b.site=r,b.x=f+s,b.y=m+Math.sqrt(f*f+g*g),b.cy=m,e.circle=b;for(var v=null,y=Po._;y;)if(b.y<y.y||b.y===y.y&&b.x<=y.x){if(!y.L){v=y.P;break}y=y.L}else{if(!y.R){v=y;break}y=y.R}Po.insert(v,b),v||(Co=b)}}}}function $n(e){var t=e.circle;t&&(t.P||(Co=t.N),Po.remove(t),Oo.push(t),Kn(t),e.circle=null)}function Un(e){for(var t,n=Eo,i=qt(e[0][0],e[0][1],e[1][0],e[1][1]),r=n.length;r--;)(!Hn(t=n[r],e)||!i(t)||Fa(t.a.x-t.b.x)<ss&&Fa(t.a.y-t.b.y)<ss)&&(t.a=t.b=null,n.splice(r,1))}function Hn(e,t){var n=e.b;if(n)return!0;var i,r,a=e.a,s=t[0][0],o=t[1][0],l=t[0][1],c=t[1][1],u=e.l,d=e.r,h=u.x,p=u.y,f=d.x,g=d.y,m=(h+f)/2,b=(p+g)/2;if(g===p){if(m<s||m>=o)return;if(h>f){if(a){if(a.y>=c)return}else a={x:m,y:l};n={x:m,y:c}}else{if(a){if(a.y<l)return}else a={x:m,y:c};n={x:m,y:l}}}else if(i=(h-f)/(g-p),r=b-i*m,i<-1||i>1)if(h>f){if(a){if(a.y>=c)return}else a={x:(l-r)/i,y:l};n={x:(c-r)/i,y:c}}else{if(a){if(a.y<l)return}else a={x:(c-r)/i,y:c};n={x:(l-r)/i,y:l}}else if(p<g){if(a){if(a.x>=o)return}else a={x:s,y:i*s+r};n={x:o,y:i*o+r}}else{if(a){if(a.x<s)return}else a={x:o,y:i*o+r};n={x:s,y:i*s+r}}return e.a=a,e.b=n,!0}function zn(e,t){this.l=e,this.r=t,this.a=this.b=null}function Gn(e,t,n,i){var r=new zn(e,t);return Eo.push(r),n&&Wn(r,e,t,n),i&&Wn(r,t,e,i),Ao[e.i].edges.push(new Qn(r,e,t)),Ao[t.i].edges.push(new Qn(r,t,e)),r}function Jn(e,t,n){var i=new zn(e,null);return i.a=t,i.b=n,Eo.push(i),i}function Wn(e,t,n,i){e.a||e.b?e.l===n?e.b=i:e.a=i:(e.a=i,e.l=t,e.r=n)}function Qn(e,t,n){var i=e.a,r=e.b;this.edge=e,this.site=t,this.angle=n?Math.atan2(n.y-t.y,n.x-t.x):e.l===t?Math.atan2(r.x-i.x,i.y-r.y):Math.atan2(i.x-r.x,r.y-i.y)}function Yn(){this._=null}function Kn(e){e.U=e.C=e.L=e.R=e.P=e.N=null}function Zn(e,t){var n=t,i=t.R,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.R=i.L,n.R&&(n.R.U=n),i.L=n}function Xn(e,t){var n=t,i=t.L,r=n.U;r?r.L===n?r.L=i:r.R=i:e._=i,i.U=r,n.U=i,n.L=i.R,n.L&&(n.L.U=n),i.R=n}function ei(e){for(;e.L;)e=e.L;return e}function ti(e,t){var n,i,r,a=e.sort(ni).pop();for(Eo=[],Ao=new Array(e.length),ko=new Yn,Po=new Yn;;)if(r=Co,a&&(!r||a.y<r.y||a.y===r.y&&a.x<r.x))a.x===n&&a.y===i||(Ao[a.i]=new qn(a),In(a),n=a.x,i=a.y),a=e.pop();else{if(!r)break;Dn(r.arc)}t&&(Un(t),Ln(t));var s={cells:Ao,edges:Eo};return ko=Po=Eo=Ao=null,s}function ni(e,t){return t.y-e.y||t.x-e.x}function ii(e,t,n){return(e.x-n.x)*(t.y-e.y)-(e.x-t.x)*(n.y-e.y)}function ri(e){return e.x}function ai(e){return e.y}function si(e,t,n,i,r,a){if(!e(t,n,i,r,a)){var s=.5*(n+r),o=.5*(i+a),l=t.nodes;l[0]&&si(e,l[0],n,i,s,o),l[1]&&si(e,l[1],s,i,r,o),l[2]&&si(e,l[2],n,o,s,a),l[3]&&si(e,l[3],s,o,r,a)}}function oi(e,t){e=Ca.rgb(e),t=Ca.rgb(t);var n=e.r,i=e.g,r=e.b,a=t.r-n,s=t.g-i,o=t.b-r;return function(e){return"#"+ye(Math.round(n+a*e))+ye(Math.round(i+s*e))+ye(Math.round(r+o*e))}}function li(e,t){var n,i={},r={};for(n in e)n in t?i[n]=di(e[n],t[n]):r[n]=e[n];for(n in t)n in e||(r[n]=t[n]);return function(e){for(n in i)r[n]=i[n](e);return r}}function ci(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function ui(e,t){var n,i,r,a=Ro.lastIndex=Do.lastIndex=0,s=-1,o=[],l=[];for(e+="",t+="";(n=Ro.exec(e))&&(i=Do.exec(t));)(r=i.index)>a&&(r=t.slice(a,r),o[s]?o[s]+=r:o[++s]=r),(n=n[0])===(i=i[0])?o[s]?o[s]+=i:o[++s]=i:(o[++s]=null,l.push({i:s,x:ci(n,i)})),a=Do.lastIndex;return a<t.length&&(r=t.slice(a),o[s]?o[s]+=r:o[++s]=r),o.length<2?l[0]?(t=l[0].x,function(e){return t(e)+""}):function(){return t}:(t=l.length,function(e){for(var n,i=0;i<t;++i)o[(n=l[i]).i]=n.x(e);return o.join("")})}function di(e,t){for(var n,i=Ca.interpolators.length;--i>=0&&!(n=Ca.interpolators[i](e,t)););return n}function hi(e,t){var n,i=[],r=[],a=e.length,s=t.length,o=Math.min(e.length,t.length);for(n=0;n<o;++n)i.push(di(e[n],t[n]));for(;n<a;++n)r[n]=e[n];for(;n<s;++n)r[n]=t[n];return function(e){for(n=0;n<o;++n)r[n]=i[n](e);return r}}function pi(e){return function(t){return t<=0?0:t>=1?1:e(t)}}function fi(e){return function(t){return 1-e(1-t)}}function gi(e){return function(t){return.5*(t<.5?e(2*t):2-e(2-2*t))}}function mi(e){return e*e}function bi(e){return e*e*e}function vi(e){if(e<=0)return 0;if(e>=1)return 1;var t=e*e,n=t*e;return 4*(e<.5?n:3*(e-t)+n-.75)}function yi(e){return 1-Math.cos(e*as)}function wi(e){return Math.pow(2,10*(e-1))}function _i(e){return 1-Math.sqrt(1-e*e)}function xi(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375}function Si(e,t){return t-=e,function(n){return Math.round(e+t*n)}}function Ei(e){var t=[e.a,e.b],n=[e.c,e.d],i=ki(t),r=Ai(t,n),a=ki(Ci(n,t,-r))||0;t[0]*n[1]<n[0]*t[1]&&(t[0]*=-1,t[1]*=-1,i*=-1,r*=-1),this.rotate=(i?Math.atan2(t[1],t[0]):Math.atan2(-n[0],n[1]))*cs,this.translate=[e.e,e.f],this.scale=[i,a],this.skew=a?Math.atan2(r,a)*cs:0}function Ai(e,t){return e[0]*t[0]+e[1]*t[1]}function ki(e){var t=Math.sqrt(Ai(e,e));return t&&(e[0]/=t,e[1]/=t),t}function Ci(e,t,n){return e[0]+=n*t[0],e[1]+=n*t[1],e}function Pi(e,t){var n,i=[],r=[],a=Ca.transform(e),s=Ca.transform(t),o=a.translate,l=s.translate,c=a.rotate,u=s.rotate,d=a.skew,h=s.skew,p=a.scale,f=s.scale;return o[0]!=l[0]||o[1]!=l[1]?(i.push("translate(",null,",",null,")"),r.push({i:1,x:ci(o[0],l[0])},{i:3,x:ci(o[1],l[1])})):l[0]||l[1]?i.push("translate("+l+")"):i.push(""),c!=u?(c-u>180?u+=360:u-c>180&&(c+=360),r.push({i:i.push(i.pop()+"rotate(",null,")")-2,x:ci(c,u)})):u&&i.push(i.pop()+"rotate("+u+")"),d!=h?r.push({i:i.push(i.pop()+"skewX(",null,")")-2,x:ci(d,h)}):h&&i.push(i.pop()+"skewX("+h+")"),p[0]!=f[0]||p[1]!=f[1]?(n=i.push(i.pop()+"scale(",null,",",null,")"),r.push({i:n-4,x:ci(p[0],f[0])},{i:n-2,x:ci(p[1],f[1])})):1==f[0]&&1==f[1]||i.push(i.pop()+"scale("+f+")"),n=r.length,function(e){for(var t,a=-1;++a<n;)i[(t=r[a]).i]=t.x(e);return i.join("")}}function Mi(e,t){return t=(t-=e=+e)||1/t,function(n){return(n-e)/t}}function Oi(e,t){return t=(t-=e=+e)||1/t,function(n){return Math.max(0,Math.min(1,(n-e)/t))}}function Ti(e){for(var t=e.source,n=e.target,i=Di(t,n),r=[t];t!==i;)t=t.parent,r.push(t);for(var a=r.length;n!==i;)r.splice(a,0,n),n=n.parent;return r}function Ri(e){for(var t=[],n=e.parent;null!=n;)t.push(e),e=n,n=n.parent;return t.push(e),t}function Di(e,t){if(e===t)return e;for(var n=Ri(e),i=Ri(t),r=n.pop(),a=i.pop(),s=null;r===a;)s=r,r=n.pop(),a=i.pop();return s}function Ii(e){e.fixed|=2}function ji(e){e.fixed&=-7}function Ni(e){e.fixed|=4,e.px=e.x,e.py=e.y}function qi(e){e.fixed&=-5}function Li(e,t,n){var i=0,r=0;if(e.charge=0,!e.leaf)for(var a,s=e.nodes,o=s.length,l=-1;++l<o;)null!=(a=s[l])&&(Li(a,t,n),e.charge+=a.charge,i+=a.charge*a.cx,r+=a.charge*a.cy);if(e.point){e.leaf||(e.point.x+=Math.random()-.5,e.point.y+=Math.random()-.5);var c=t*n[e.point.index];e.charge+=e.pointCharge=c,i+=c*e.point.x,r+=c*e.point.y}e.cx=i/e.charge,e.cy=r/e.charge}function Fi(e,t){return Ca.rebind(e,t,"sort","children","value"),e.nodes=e,e.links=zi,e}function Bi(e,t){for(var n=[e];null!=(e=n.pop());)if(t(e),(r=e.children)&&(i=r.length))for(var i,r;--i>=0;)n.push(r[i])}function Vi(e,t){for(var n=[e],i=[];null!=(e=n.pop());)if(i.push(e),(a=e.children)&&(r=a.length))for(var r,a,s=-1;++s<r;)n.push(a[s]);for(;null!=(e=i.pop());)t(e)}function $i(e){return e.children}function Ui(e){return e.value}function Hi(e,t){return t.value-e.value}function zi(e){return Ca.merge(e.map(function(e){return(e.children||[]).map(function(t){return{source:e,target:t}})}))}function Gi(e){return e.x}function Ji(e){return e.y}function Wi(e,t,n){e.y0=t,e.y=n}function Qi(e){return Ca.range(e.length)}function Yi(e){for(var t=-1,n=e[0].length,i=[];++t<n;)i[t]=0;return i}function Ki(e){for(var t,n=1,i=0,r=e[0][1],a=e.length;n<a;++n)(t=e[n][1])>r&&(i=n,r=t);return i}function Zi(e){return e.reduce(Xi,0)}function Xi(e,t){return e+t[1]}function er(e,t){return tr(e,Math.ceil(Math.log(t.length)/Math.LN2+1))}function tr(e,t){for(var n=-1,i=+e[0],r=(e[1]-i)/t,a=[];++n<=t;)a[n]=r*n+i;return a}function nr(e){return[Ca.min(e),Ca.max(e)]}function ir(e,t){return e.value-t.value}function rr(e,t){var n=e._pack_next;e._pack_next=t,t._pack_prev=e,t._pack_next=n,n._pack_prev=t}function ar(e,t){e._pack_next=t,t._pack_prev=e}function sr(e,t){var n=t.x-e.x,i=t.y-e.y,r=e.r+t.r;return.999*r*r>n*n+i*i}function or(e){function t(e){u=Math.min(e.x-e.r,u),d=Math.max(e.x+e.r,d),h=Math.min(e.y-e.r,h),p=Math.max(e.y+e.r,p)}if((n=e.children)&&(c=n.length)){var n,i,r,a,s,o,l,c,u=1/0,d=-1/0,h=1/0,p=-1/0;if(n.forEach(lr),i=n[0],i.x=-i.r,i.y=0,t(i),c>1&&(r=n[1],r.x=r.r,r.y=0,t(r),c>2))for(dr(i,r,a=n[2]),t(a),rr(i,a),i._pack_prev=a,rr(a,r),r=i._pack_next,s=3;s<c;s++){dr(i,r,a=n[s]);var f=0,g=1,m=1;for(o=r._pack_next;o!==r;o=o._pack_next,g++)if(sr(o,a)){f=1;break}if(1==f)for(l=i._pack_prev;l!==o._pack_prev&&!sr(l,a);l=l._pack_prev,m++);f?(g<m||g==m&&r.r<i.r?ar(i,r=o):ar(i=l,r),s--):(rr(i,a),r=a,t(a))}var b=(u+d)/2,v=(h+p)/2,y=0;for(s=0;s<c;s++)(a=n[s]).x-=b,a.y-=v,y=Math.max(y,a.r+Math.sqrt(a.x*a.x+a.y*a.y));e.r=y,n.forEach(cr)}}function lr(e){e._pack_next=e._pack_prev=e}function cr(e){delete e._pack_next,delete e._pack_prev}function ur(e,t,n,i){var r=e.children;if(e.x=t+=i*e.x,e.y=n+=i*e.y,e.r*=i,r)for(var a=-1,s=r.length;++a<s;)ur(r[a],t,n,i)}function dr(e,t,n){var i=e.r+n.r,r=t.x-e.x,a=t.y-e.y;if(i&&(r||a)){var s=t.r+n.r,o=r*r+a*a,l=.5+((i*=i)-(s*=s))/(2*o),c=Math.sqrt(Math.max(0,2*s*(i+o)-(i-=o)*i-s*s))/(2*o);n.x=e.x+l*r+c*a,n.y=e.y+l*a-c*r}else n.x=e.x+i,n.y=e.y}function hr(e,t){return e.parent==t.parent?1:2}function pr(e){var t=e.children;return t.length?t[0]:e.t}function fr(e){var t,n=e.children;return(t=n.length)?n[t-1]:e.t}function gr(e,t,n){var i=n/(t.i-e.i);t.c-=i,t.s+=n,e.c+=i,t.z+=n,t.m+=n}function mr(e){for(var t,n=0,i=0,r=e.children,a=r.length;--a>=0;)(t=r[a]).z+=n,t.m+=n,n+=t.s+(i+=t.c)}function br(e,t,n){return e.a.parent===t.parent?e.a:n}function vr(e){return 1+Ca.max(e,function(e){return e.y})}function yr(e){return e.reduce(function(e,t){return e+t.x},0)/e.length}function wr(e){var t=e.children;return t&&t.length?wr(t[0]):e}function _r(e){var t,n=e.children;return n&&(t=n.length)?_r(n[t-1]):e}function xr(e){return{x:e.x,y:e.y,dx:e.dx,dy:e.dy}}function Sr(e,t){var n=e.x+t[3],i=e.y+t[0],r=e.dx-t[1]-t[3],a=e.dy-t[0]-t[2];return r<0&&(n+=r/2,r=0),a<0&&(i+=a/2,a=0),{x:n,y:i,dx:r,dy:a}}function Er(e){var t=e[0],n=e[e.length-1];return t<n?[t,n]:[n,t]}function Ar(e){return e.rangeExtent?e.rangeExtent():Er(e.range())}function kr(e,t,n,i){var r=n(e[0],e[1]),a=i(t[0],t[1]);return function(e){return a(r(e))}}function Cr(e,t){var n,i=0,r=e.length-1,a=e[i],s=e[r];return s<a&&(n=i,i=r,r=n,n=a,a=s,s=n),e[i]=t.floor(a),e[r]=t.ceil(s),e}function Pr(e){return e?{floor:function(t){return Math.floor(t/e)*e},ceil:function(t){return Math.ceil(t/e)*e}}:Ho}function Mr(e,t,n,i){var r=[],a=[],s=0,o=Math.min(e.length,t.length)-1;for(e[o]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++s<=o;)r.push(n(e[s-1],e[s])),a.push(i(t[s-1],t[s]));return function(t){var n=Ca.bisect(e,t,1,o)-1;return a[n](r[n](t))}}function Or(e,t,n,i){function r(){var r=Math.min(e.length,t.length)>2?Mr:kr,l=i?Oi:Mi;return s=r(e,t,l,n),o=r(t,e,l,di),a}function a(e){return s(e)}var s,o;return a.invert=function(e){return o(e)},a.domain=function(t){return arguments.length?(e=t.map(Number),r()):e},a.range=function(e){return arguments.length?(t=e,r()):t},a.rangeRound=function(e){return a.range(e).interpolate(Si)},a.clamp=function(e){return arguments.length?(i=e,r()):i},a.interpolate=function(e){return arguments.length?(n=e,r()):n},a.ticks=function(t){return Ir(e,t)},a.tickFormat=function(t,n){return jr(e,t,n)},a.nice=function(t){return Rr(e,t),r()},a.copy=function(){return Or(e,t,n,i)},r()}function Tr(e,t){return Ca.rebind(e,t,"range","rangeRound","interpolate","clamp")}function Rr(e,t){return Cr(e,Pr(Dr(e,t)[2]))}function Dr(e,t){null==t&&(t=10);var n=Er(e),i=n[1]-n[0],r=Math.pow(10,Math.floor(Math.log(i/t)/Math.LN10)),a=t/i*r;return a<=.15?r*=10:a<=.35?r*=5:a<=.75&&(r*=2),n[0]=Math.ceil(n[0]/r)*r,n[1]=Math.floor(n[1]/r)*r+.5*r,n[2]=r,n}function Ir(e,t){return Ca.range.apply(Ca,Dr(e,t))}function jr(e,t,n){var i=Dr(e,t);if(n){var r=Ts.exec(n);if(r.shift(),"s"===r[8]){var a=Ca.formatPrefix(Math.max(Fa(i[0]),Fa(i[1])));return r[7]||(r[7]="."+Nr(a.scale(i[2]))),r[8]="f",n=Ca.format(r.join("")),function(e){return n(a.scale(e))+a.symbol}}r[7]||(r[7]="."+qr(r[8],i)),n=r.join("")}else n=",."+Nr(i[2])+"f";return Ca.format(n)}function Nr(e){return-Math.floor(Math.log(e)/Math.LN10+.01)}function qr(e,t){var n=Nr(t[2]);return e in zo?Math.abs(n-Nr(Math.max(Fa(t[0]),Fa(t[1]))))+ +("e"!==e):n-2*("%"===e)}function Lr(e,t,n,i){function r(e){return(n?Math.log(e<0?0:e):-Math.log(e>0?0:-e))/Math.log(t)}function a(e){return n?Math.pow(t,e):-Math.pow(t,-e)}function s(t){return e(r(t))}return s.invert=function(t){return a(e.invert(t))},s.domain=function(t){return arguments.length?(n=t[0]>=0,e.domain((i=t.map(Number)).map(r)),s):i},s.base=function(n){return arguments.length?(t=+n,e.domain(i.map(r)),s):t},s.nice=function(){var t=Cr(i.map(r),n?Math:Jo);return e.domain(t),i=t.map(a),s},s.ticks=function(){var e=Er(i),s=[],o=e[0],l=e[1],c=Math.floor(r(o)),u=Math.ceil(r(l)),d=t%1?2:t;if(isFinite(u-c)){if(n){for(;c<u;c++)for(h=1;h<d;h++)s.push(a(c)*h);s.push(a(c))}else for(s.push(a(c));c++<u;)for(var h=d-1;h>0;h--)s.push(a(c)*h);for(c=0;s[c]<o;c++);for(u=s.length;s[u-1]>l;u--);s=s.slice(c,u)}return s},s.tickFormat=function(e,t){if(!arguments.length)return Go;arguments.length<2?t=Go:"function"!=typeof t&&(t=Ca.format(t));var i,o=Math.max(.1,e/s.ticks().length),l=n?(i=1e-12,Math.ceil):(i=-1e-12,Math.floor);return function(e){return e/a(l(r(e)+i))<=o?t(e):""}},s.copy=function(){return Lr(e.copy(),t,n,i)},Tr(s,e)}function Fr(e,t,n){function i(t){return e(r(t))}var r=Br(t),a=Br(1/t);return i.invert=function(t){return a(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain((n=t.map(Number)).map(r)),i):n},i.ticks=function(e){return Ir(n,e)},i.tickFormat=function(e,t){return jr(n,e,t)},i.nice=function(e){return i.domain(Rr(n,e))},i.exponent=function(s){return arguments.length?(r=Br(t=s),a=Br(1/t),e.domain(n.map(r)),i):t},i.copy=function(){return Fr(e.copy(),t,n)},Tr(i,e)}function Br(e){return function(t){return t<0?-Math.pow(-t,e):Math.pow(t,e)}}function Vr(e,t){function n(n){return a[((r.get(n)||("range"===t.t?r.set(n,e.push(n)):NaN))-1)%a.length]}function i(t,n){return Ca.range(e.length).map(function(e){return t+n*e})}var r,a,s;return n.domain=function(i){if(!arguments.length)return e;e=[],r=new o;for(var a,s=-1,l=i.length;++s<l;)r.has(a=i[s])||r.set(a,e.push(a));return n[t.t].apply(n,t.a)},n.range=function(e){return arguments.length?(a=e,s=0,t={t:"range",a:arguments},n):a},n.rangePoints=function(r,o){arguments.length<2&&(o=0);var l=r[0],c=r[1],u=(c-l)/(Math.max(1,e.length-1)+o);return a=i(e.length<2?(l+c)/2:l+u*o/2,u),s=0,t={t:"rangePoints",a:arguments},n},n.rangeBands=function(r,o,l){arguments.length<2&&(o=0),arguments.length<3&&(l=o);var c=r[1]<r[0],u=r[c-0],d=(r[1-c]-u)/(e.length-o+2*l);return a=i(u+d*l,d),c&&a.reverse(),s=d*(1-o),t={t:"rangeBands",a:arguments},n},n.rangeRoundBands=function(r,o,l){arguments.length<2&&(o=0),arguments.length<3&&(l=o);var c=r[1]<r[0],u=r[c-0],d=r[1-c],h=Math.floor((d-u)/(e.length-o+2*l)),p=d-u-(e.length-o)*h;return a=i(u+Math.round(p/2),h),c&&a.reverse(),s=Math.round(h*(1-o)),t={t:"rangeRoundBands",a:arguments},n},n.rangeBand=function(){return s},n.rangeExtent=function(){return Er(t.a[0])},n.copy=function(){return Vr(e,t)},n.domain(e)}function $r(i,r){function a(){var e=0,t=r.length;for(o=[];++e<t;)o[e-1]=Ca.quantile(i,e/t);return s}function s(e){if(!isNaN(e=+e))return r[Ca.bisect(o,e)]}var o;return s.domain=function(r){return arguments.length?(i=r.map(t).filter(n).sort(e),a()):i},s.range=function(e){return arguments.length?(r=e,a()):r},s.quantiles=function(){return o},s.invertExtent=function(e){return(e=r.indexOf(e))<0?[NaN,NaN]:[e>0?o[e-1]:i[0],e<o.length?o[e]:i[i.length-1]]},s.copy=function(){return $r(i,r)},a()}function Ur(e,t,n){function i(t){return n[Math.max(0,Math.min(s,Math.floor(a*(t-e))))]}function r(){return a=n.length/(t-e),s=n.length-1,i}var a,s;return i.domain=function(n){return arguments.length?(e=+n[0],t=+n[n.length-1],r()):[e,t]},i.range=function(e){return arguments.length?(n=e,r()):n},i.invertExtent=function(t){return t=n.indexOf(t),t=t<0?NaN:t/a+e,[t,t+1/a]},i.copy=function(){return Ur(e,t,n)},r()}function Hr(e,t){function n(n){if(n<=n)return t[Ca.bisect(e,n)]}return n.domain=function(t){return arguments.length?(e=t,n):e},n.range=function(e){return arguments.length?(t=e,n):t},n.invertExtent=function(n){return n=t.indexOf(n),[e[n-1],e[n]]},n.copy=function(){return Hr(e,t)},n}function zr(e){function t(e){return+e}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=n.map(t),t):e},t.ticks=function(t){return Ir(e,t)},t.tickFormat=function(t,n){return jr(e,t,n)},t.copy=function(){return zr(e)},t}function Gr(e){return e.innerRadius}function Jr(e){return e.outerRadius}function Wr(e){return e.startAngle}function Qr(e){return e.endAngle}function Yr(e){function t(t){function s(){c.push("M",a(e(u),o))}for(var l,c=[],u=[],d=-1,h=t.length,p=Ae(n),f=Ae(i);++d<h;)r.call(this,l=t[d],d)?u.push([+p.call(this,l,d),+f.call(this,l,d)]):u.length&&(s(),u=[]);return u.length&&s(),c.length?c.join(""):null}var n=Sn,i=En,r=kt,a=Kr,s=a.key,o=.7;return t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t.defined=function(e){return arguments.length?(r=e,t):r},t.interpolate=function(e){return arguments.length?(s="function"==typeof e?a=e:(a=el.get(e)||Kr).key,t):s},t.tension=function(e){return arguments.length?(o=e,t):o},t}function Kr(e){return e.join("L")}function Zr(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("V",(i=e[t])[1],"H",i[0]);return r.join("")}function Xr(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i=e[t])[0],"V",i[1]);return r.join("")}function ea(e,t){if(t.length<1||e.length!=t.length&&e.length!=t.length+2)return Kr(e);var n=e.length!=t.length,i="",r=e[0],a=e[1],s=t[0],o=s,l=1;if(n&&(i+="Q"+(a[0]-2*s[0]/3)+","+(a[1]-2*s[1]/3)+","+a[0]+","+a[1],r=e[1],l=2),t.length>1){o=t[1],a=e[l],l++,i+="C"+(r[0]+s[0])+","+(r[1]+s[1])+","+(a[0]-o[0])+","+(a[1]-o[1])+","+a[0]+","+a[1];for(var c=2;c<t.length;c++,l++)a=e[l],o=t[c],i+="S"+(a[0]-o[0])+","+(a[1]-o[1])+","+a[0]+","+a[1]}if(n){var u=e[l];i+="Q"+(a[0]+2*o[0]/3)+","+(a[1]+2*o[1]/3)+","+u[0]+","+u[1]}return i}function ta(e,t){for(var n,i=[],r=(1-t)/2,a=e[0],s=e[1],o=1,l=e.length;++o<l;)n=a,a=s,s=e[o],i.push([r*(s[0]-n[0]),r*(s[1]-n[1])]);return i}function na(e){if(e.length<3)return Kr(e);var t=1,n=e.length,i=e[0],r=i[0],a=i[1],s=[r,r,r,(i=e[1])[0]],o=[a,a,a,i[1]],l=[r,",",a,"L",ia(il,s),",",ia(il,o)];for(e.push(e[n-1]);++t<=n;)i=e[t],s.shift(),s.push(i[0]),o.shift(),o.push(i[1]),ra(l,s,o);return e.pop(),l.push("L",i),l.join("")}function ia(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function ra(e,t,n){e.push("C",ia(tl,t),",",ia(tl,n),",",ia(nl,t),",",ia(nl,n),",",ia(il,t),",",ia(il,n))}function aa(e,t){return(t[1]-e[1])/(t[0]-e[0])}function sa(e){for(var t=0,n=e.length-1,i=[],r=e[0],a=e[1],s=i[0]=aa(r,a);++t<n;)i[t]=(s+(s=aa(r=a,a=e[t+1])))/2;return i[t]=s,i}function oa(e){for(var t,n,i,r,a=[],s=sa(e),o=-1,l=e.length-1;++o<l;)t=aa(e[o],e[o+1]),Fa(t)<ss?s[o]=s[o+1]=0:(r=(n=s[o]/t)*n+(i=s[o+1]/t)*i)>9&&(r=3*t/Math.sqrt(r),s[o]=r*n,s[o+1]=r*i);for(o=-1;++o<=l;)r=(e[Math.min(l,o+1)][0]-e[Math.max(0,o-1)][0])/(6*(1+s[o]*s[o])),a.push([r||0,s[o]*r||0]);return a}function la(e){for(var t,n,i,r=-1,a=e.length;++r<a;)n=(t=e[r])[0],i=t[1]+Zo,t[0]=n*Math.cos(i),t[1]=n*Math.sin(i);return e}function ca(e){function t(t){function l(){g.push("M",o(e(b),d),u,c(e(m.reverse()),d),"Z")}for(var h,p,f,g=[],m=[],b=[],v=-1,y=t.length,w=Ae(n),_=Ae(r),x=n===i?function(){return p}:Ae(i),S=r===a?function(){return f}:Ae(a);++v<y;)s.call(this,h=t[v],v)?(m.push([p=+w.call(this,h,v),f=+_.call(this,h,v)]),b.push([+x.call(this,h,v),+S.call(this,h,v)])):m.length&&(l(),m=[],b=[]);return m.length&&l(),g.length?g.join(""):null}var n=Sn,i=Sn,r=0,a=En,s=kt,o=Kr,l=o.key,c=o,u="L",d=.7;return t.x=function(e){return arguments.length?(n=i=e,t):i},t.x0=function(e){return arguments.length?(n=e,t):n},t.x1=function(e){return arguments.length?(i=e,t):i},t.y=function(e){return arguments.length?(r=a=e,t):a},t.y0=function(e){return arguments.length?(r=e,t):r},t.y1=function(e){return arguments.length?(a=e,t):a},t.defined=function(e){return arguments.length?(s=e,t):s},t.interpolate=function(e){return arguments.length?(l="function"==typeof e?o=e:(o=el.get(e)||Kr).key,c=o.reverse||o,u=o.closed?"M":"L",t):l},t.tension=function(e){return arguments.length?(d=e,t):d},t}function ua(e){return e.radius}function da(e){return[e.x,e.y]}function ha(e){return function(){var t=e.apply(this,arguments),n=t[0],i=t[1]+Zo;return[n*Math.cos(i),n*Math.sin(i)]}}function pa(){return 64}function fa(){return"circle"}function ga(e){var t=Math.sqrt(e/is);return"M0,"+t+"A"+t+","+t+" 0 1,1 0,"+-t+"A"+t+","+t+" 0 1,1 0,"+t+"Z"}function ma(e,t){return Ha(e,cl),e.id=t,e}function ba(e,t,n,i){var r=e.id;return F(e,"function"==typeof n?function(e,a,s){e.__transition__[r].tween.set(t,i(n.call(e,e.__data__,a,s)))}:(n=i(n),function(e){e.__transition__[r].tween.set(t,n)}))}function va(e){return null==e&&(e=""),function(){this.textContent=e}}function ya(e,t,n,i){var r=e.__transition__||(e.__transition__={active:0,count:0}),a=r[n];if(!a){var s=i.time;a=r[n]={tween:new o,time:s,ease:i.ease,delay:i.delay,duration:i.duration},++r.count,Ca.timer(function(i){function o(i){if(r.active>n)return c();r.active=n,a.event&&a.event.start.call(e,u,t),a.tween.forEach(function(n,i){(i=i.call(e,u,t))&&g.push(i)}),Ca.timer(function(){return f.c=l(i||1)?kt:l,1},0,s)}function l(i){if(r.active!==n)return c();for(var s=i/p,o=d(s),l=g.length;l>0;)g[--l].call(e,o);return s>=1?(a.event&&a.event.end.call(e,u,t),c()):void 0}function c(){return--r.count?delete r[n]:delete e.__transition__,1}var u=e.__data__,d=a.ease,h=a.delay,p=a.duration,f=Ps,g=[];if(f.t=h+s,h<=i)return o(i-h);f.c=o},0,s)}}function wa(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate("+(isFinite(i)?i:n(e))+",0)"})}function _a(e,t,n){e.attr("transform",function(e){var i=t(e);return"translate(0,"+(isFinite(i)?i:n(e))+")"})}function xa(e){return e.toISOString()}function Sa(e,t,n){function i(t){return e(t)}function r(e,n){var i=(e[1]-e[0])/n,r=Ca.bisect(vl,i);return r==vl.length?[t.year,Dr(e.map(function(e){return e/31536e6}),n)[2]]:r?t[i/vl[r-1]<vl[r]/i?r-1:r]:[_l,Dr(e,n)[2]]}return i.invert=function(t){return Ea(e.invert(t))},i.domain=function(t){return arguments.length?(e.domain(t),i):e.domain().map(Ea)},i.nice=function(e,t){function n(n){return!isNaN(n)&&!e.range(n,Ea(+n+1),t).length}var a=i.domain(),s=Er(a),o=null==e?r(s,10):"number"==typeof e&&r(s,e);return o&&(e=o[0],t=o[1]),i.domain(Cr(a,t>1?{floor:function(t){for(;n(t=e.floor(t));)t=Ea(t-1);return t},ceil:function(t){for(;n(t=e.ceil(t));)t=Ea(+t+1);return t}}:e))},i.ticks=function(e,t){var n=Er(i.domain()),a=null==e?r(n,10):"number"==typeof e?r(n,e):!e.range&&[{range:e},t];return a&&(e=a[0],t=a[1]),e.range(n[0],Ea(+n[1]+1),t<1?1:t)},i.tickFormat=function(){return n},i.copy=function(){return Sa(e.copy(),t,n)},Tr(i,e)}function Ea(e){return new Date(e)}function Aa(e){return JSON.parse(e.responseText)}function ka(e){var t=Oa.createRange();return t.selectNode(Oa.body),t.createContextualFragment(e.responseText)}var Ca={version:"3.4.13"};Date.now||(Date.now=function(){return+new Date});var Pa=[].slice,Ma=function(e){return Pa.call(e)},Oa=document,Ta=Oa.documentElement,Ra=window;try{Ma(Ta.childNodes)[0].nodeType}catch(e){Ma=function(e){for(var t=e.length,n=new Array(t);t--;)n[t]=e[t];return n}}try{Oa.createElement("div").style.setProperty("opacity",0,"")}catch(e){var Da=Ra.Element.prototype,Ia=Da.setAttribute,ja=Da.setAttributeNS,Na=Ra.CSSStyleDeclaration.prototype,qa=Na.setProperty;Da.setAttribute=function(e,t){Ia.call(this,e,t+"")},Da.setAttributeNS=function(e,t,n){ja.call(this,e,t,n+"")},Na.setProperty=function(e,t,n){qa.call(this,e,t+"",n)}}Ca.ascending=e,Ca.descending=function(e,t){return t<e?-1:t>e?1:t>=e?0:NaN},Ca.min=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a&&!(null!=(n=e[r])&&n<=n);)n=void 0;for(;++r<a;)null!=(i=e[r])&&n>i&&(n=i)}else{for(;++r<a&&!(null!=(n=t.call(e,e[r],r))&&n<=n);)n=void 0;for(;++r<a;)null!=(i=t.call(e,e[r],r))&&n>i&&(n=i)}return n},Ca.max=function(e,t){var n,i,r=-1,a=e.length;if(1===arguments.length){for(;++r<a&&!(null!=(n=e[r])&&n<=n);)n=void 0;for(;++r<a;)null!=(i=e[r])&&i>n&&(n=i)}else{for(;++r<a&&!(null!=(n=t.call(e,e[r],r))&&n<=n);)n=void 0;for(;++r<a;)null!=(i=t.call(e,e[r],r))&&i>n&&(n=i)}return n},Ca.extent=function(e,t){var n,i,r,a=-1,s=e.length;if(1===arguments.length){for(;++a<s&&!(null!=(n=r=e[a])&&n<=n);)n=r=void 0;for(;++a<s;)null!=(i=e[a])&&(n>i&&(n=i),r<i&&(r=i))}else{for(;++a<s&&!(null!=(n=r=t.call(e,e[a],a))&&n<=n);)n=void 0;for(;++a<s;)null!=(i=t.call(e,e[a],a))&&(n>i&&(n=i),r<i&&(r=i))}return[n,r]},Ca.sum=function(e,t){var i,r=0,a=e.length,s=-1;if(1===arguments.length)for(;++s<a;)n(i=+e[s])&&(r+=i);else for(;++s<a;)n(i=+t.call(e,e[s],s))&&(r+=i);return r},Ca.mean=function(e,i){var r,a=0,s=e.length,o=-1,l=s;if(1===arguments.length)for(;++o<s;)n(r=t(e[o]))?a+=r:--l;else for(;++o<s;)n(r=t(i.call(e,e[o],o)))?a+=r:--l;return l?a/l:void 0},Ca.quantile=function(e,t){var n=(e.length-1)*t+1,i=Math.floor(n),r=+e[i-1],a=n-i;return a?r+a*(e[i]-r):r},Ca.median=function(i,r){var a,s=[],o=i.length,l=-1;if(1===arguments.length)for(;++l<o;)n(a=t(i[l]))&&s.push(a);else for(;++l<o;)n(a=t(r.call(i,i[l],l)))&&s.push(a);return s.length?Ca.quantile(s.sort(e),.5):void 0};var La=i(e);Ca.bisectLeft=La.left,Ca.bisect=Ca.bisectRight=La.right,Ca.bisector=function(t){return i(1===t.length?function(n,i){return e(t(n),i)}:t)},Ca.shuffle=function(e){for(var t,n,i=e.length;i;)n=Math.random()*i--|0,t=e[i],e[i]=e[n],e[n]=t;return e},Ca.permute=function(e,t){for(var n=t.length,i=new Array(n);n--;)i[n]=e[t[n]];return i},Ca.pairs=function(e){for(var t=0,n=e.length-1,i=e[0],r=new Array(n<0?0:n);t<n;)r[t]=[i,i=e[++t]];return r},Ca.zip=function(){if(!(i=arguments.length))return[];for(var e=-1,t=Ca.min(arguments,r),n=new Array(t);++e<t;)for(var i,a=-1,s=n[e]=new Array(i);++a<i;)s[a]=arguments[a][e];return n},Ca.transpose=function(e){return Ca.zip.apply(Ca,e)},Ca.keys=function(e){var t=[];for(var n in e)t.push(n);return t},Ca.values=function(e){var t=[];for(var n in e)t.push(e[n]);return t},Ca.entries=function(e){var t=[];for(var n in e)t.push({key:n,value:e[n]});return t},Ca.merge=function(e){for(var t,n,i,r=e.length,a=-1,s=0;++a<r;)s+=e[a].length;for(n=new Array(s);--r>=0;)for(t=(i=e[r]).length;--t>=0;)n[--s]=i[t];return n};var Fa=Math.abs;Ca.range=function(e,t,n){if(arguments.length<3&&(n=1,arguments.length<2&&(t=e,e=0)),(t-e)/n==1/0)throw new Error("infinite range");var i,r=[],s=a(Fa(n)),o=-1;if(e*=s,t*=s,(n*=s)<0)for(;(i=e+n*++o)>t;)r.push(i/s);else for(;(i=e+n*++o)<t;)r.push(i/s);return r},Ca.map=function(e){var t=new o;if(e instanceof o)e.forEach(function(e,n){t.set(e,n)});else for(var n in e)t.set(n,e[n]);return t};var Ba="__proto__",Va="\0";s(o,{has:u,get:function(e){return this._[l(e)]},set:function(e,t){return this._[l(e)]=t},remove:d,keys:h,values:function(){var e=[];for(var t in this._)e.push(this._[t]);return e},entries:function(){var e=[];for(var t in this._)e.push({key:c(t),value:this._[t]});return e},size:p,empty:f,forEach:function(e){for(var t in this._)e.call(this,c(t),this._[t])}}),Ca.nest=function(){function e(t,s,l){if(l>=a.length)return i?i.call(r,s):n?s.sort(n):s;for(var c,u,d,h,p=-1,f=s.length,g=a[l++],m=new o;++p<f;)(h=m.get(c=g(u=s[p])))?h.push(u):m.set(c,[u]);return t?(u=t(),d=function(n,i){u.set(n,e(t,i,l))}):(u={},d=function(n,i){u[n]=e(t,i,l)}),m.forEach(d),u}function t(e,n){if(n>=a.length)return e;var i=[],r=s[n++];return e.forEach(function(e,r){i.push({key:e,values:t(r,n)})}),r?i.sort(function(e,t){return r(e.key,t.key)}):i}var n,i,r={},a=[],s=[];return r.map=function(t,n){return e(n,t,0)},r.entries=function(n){return t(e(Ca.map,n,0),0)},r.key=function(e){return a.push(e),r},r.sortKeys=function(e){return s[a.length-1]=e,r},r.sortValues=function(e){return n=e,r},r.rollup=function(e){return i=e,r},r},Ca.set=function(e){var t=new g;if(e)for(var n=0,i=e.length;n<i;++n)t.add(e[n]);return t},s(g,{has:u,add:function(e){return this._[l(e+="")]=!0,e},remove:d,values:h,size:p,empty:f,forEach:function(e){for(var t in this._)e.call(this,c(t))}}),Ca.behavior={},Ca.rebind=function(e,t){for(var n,i=1,r=arguments.length;++i<r;)e[n=arguments[i]]=m(e,t,t[n]);return e};var $a=["webkit","ms","moz","Moz","o","O"];Ca.dispatch=function(){for(var e=new y,t=-1,n=arguments.length;++t<n;)e[arguments[t]]=w(e);return e},y.prototype.on=function(e,t){var n=e.indexOf("."),i="";if(n>=0&&(i=e.slice(n+1),e=e.slice(0,n)),e)return arguments.length<2?this[e].on(i):this[e].on(i,t);if(2===arguments.length){if(null==t)for(e in this)this.hasOwnProperty(e)&&this[e].on(i,null);return this}},Ca.event=null,Ca.requote=function(e){return e.replace(Ua,"\\$&")};var Ua=/[\\\^\$\*\+\?\|\[\]\(\)\.\{\}]/g,Ha={}.__proto__?function(e,t){e.__proto__=t}:function(e,t){for(var n in t)e[n]=t[n]},za=function(e,t){return t.querySelector(e)},Ga=function(e,t){return t.querySelectorAll(e)},Ja=Ta.matches||Ta[b(Ta,"matchesSelector")],Wa=function(e,t){return Ja.call(e,t)};"function"==typeof Sizzle&&(za=function(e,t){return Sizzle(e,t)[0]||null},Ga=Sizzle,Wa=Sizzle.matchesSelector),Ca.selection=function(){return Za};var Qa=Ca.selection.prototype=[];Qa.select=function(e){var t,n,i,r,a=[];e=A(e);for(var s=-1,o=this.length;++s<o;){a.push(t=[]),t.parentNode=(i=this[s]).parentNode;for(var l=-1,c=i.length;++l<c;)(r=i[l])?(t.push(n=e.call(r,r.__data__,l,s)),n&&"__data__"in r&&(n.__data__=r.__data__)):t.push(null)}return E(a)},Qa.selectAll=function(e){var t,n,i=[];e=k(e);for(var r=-1,a=this.length;++r<a;)for(var s=this[r],o=-1,l=s.length;++o<l;)(n=s[o])&&(i.push(t=Ma(e.call(n,n.__data__,o,r))),t.parentNode=n);return E(i)};var Ya={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};Ca.ns={prefix:Ya,qualify:function(e){var t=e.indexOf(":"),n=e;return t>=0&&(n=e.slice(0,t),e=e.slice(t+1)),Ya.hasOwnProperty(n)?{space:Ya[n],local:e}:e}},Qa.attr=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node();return(e=Ca.ns.qualify(e)).local?n.getAttributeNS(e.space,e.local):n.getAttribute(e)}for(t in e)this.each(C(t,e[t]));return this}return this.each(C(e,t))},Qa.classed=function(e,t){if(arguments.length<2){if("string"==typeof e){var n=this.node(),i=(e=O(e)).length,r=-1;if(t=n.classList){for(;++r<i;)if(!t.contains(e[r]))return!1}else for(t=n.getAttribute("class");++r<i;)if(!M(e[r]).test(t))return!1;return!0}for(t in e)this.each(T(t,e[t]));return this}return this.each(T(e,t))},Qa.style=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t="");for(n in e)this.each(D(n,e[n],t));return this}if(i<2)return Ra.getComputedStyle(this.node(),null).getPropertyValue(e);n=""}return this.each(D(e,t,n))},Qa.property=function(e,t){if(arguments.length<2){if("string"==typeof e)return this.node()[e];for(t in e)this.each(I(t,e[t]));return this}return this.each(I(e,t))},Qa.text=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.textContent=null==t?"":t}:null==e?function(){this.textContent=""}:function(){this.textContent=e}):this.node().textContent},Qa.html=function(e){return arguments.length?this.each("function"==typeof e?function(){var t=e.apply(this,arguments);this.innerHTML=null==t?"":t}:null==e?function(){this.innerHTML=""}:function(){this.innerHTML=e}):this.node().innerHTML},Qa.append=function(e){return e=j(e),this.select(function(){return this.appendChild(e.apply(this,arguments))})},Qa.insert=function(e,t){return e=j(e),t=A(t),this.select(function(){return this.insertBefore(e.apply(this,arguments),t.apply(this,arguments)||null)})},Qa.remove=function(){return this.each(function(){var e=this.parentNode;e&&e.removeChild(this)})},Qa.data=function(e,t){function n(e,n){var i,r,a,s=e.length,d=n.length,h=Math.min(s,d),p=new Array(d),f=new Array(d),g=new Array(s);if(t){var m,b=new o,v=new Array(s);for(i=-1;++i<s;)b.has(m=t.call(r=e[i],r.__data__,i))?g[i]=r:b.set(m,r),v[i]=m;for(i=-1;++i<d;)(r=b.get(m=t.call(n,a=n[i],i)))?!0!==r&&(p[i]=r,r.__data__=a):f[i]=N(a),b.set(m,!0);for(i=-1;++i<s;)!0!==b.get(v[i])&&(g[i]=e[i])}else{for(i=-1;++i<h;)r=e[i],a=n[i],r?(r.__data__=a,p[i]=r):f[i]=N(a);for(;i<d;++i)f[i]=N(n[i]);for(;i<s;++i)g[i]=e[i]}f.update=p,f.parentNode=p.parentNode=g.parentNode=e.parentNode,l.push(f),c.push(p),u.push(g)}var i,r,a=-1,s=this.length;if(!arguments.length){for(e=new Array(s=(i=this[0]).length);++a<s;)(r=i[a])&&(e[a]=r.__data__);return e}var l=B([]),c=E([]),u=E([]);if("function"==typeof e)for(;++a<s;)n(i=this[a],e.call(i,i.parentNode.__data__,a));else for(;++a<s;)n(i=this[a],e);return c.enter=function(){return l},c.exit=function(){return u},c},Qa.datum=function(e){return arguments.length?this.property("__data__",e):this.property("__data__")},Qa.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=q(e));for(var a=0,s=this.length;a<s;a++){r.push(t=[]),t.parentNode=(n=this[a]).parentNode;for(var o=0,l=n.length;o<l;o++)(i=n[o])&&e.call(i,i.__data__,o,a)&&t.push(i)}return E(r)},Qa.order=function(){for(var e=-1,t=this.length;++e<t;)for(var n,i=this[e],r=i.length-1,a=i[r];--r>=0;)(n=i[r])&&(a&&a!==n.nextSibling&&a.parentNode.insertBefore(n,a),a=n);return this},Qa.sort=function(e){e=L.apply(this,arguments);for(var t=-1,n=this.length;++t<n;)this[t].sort(e);return this.order()},Qa.each=function(e){return F(this,function(t,n,i){e.call(t,t.__data__,n,i)})},Qa.call=function(e){var t=Ma(arguments);return e.apply(t[0]=this,t),this},Qa.empty=function(){return!this.node()},Qa.node=function(){for(var e=0,t=this.length;e<t;e++)for(var n=this[e],i=0,r=n.length;i<r;i++){var a=n[i];if(a)return a}return null},Qa.size=function(){var e=0;return F(this,function(){++e}),e};var Ka=[];Ca.selection.enter=B,Ca.selection.enter.prototype=Ka,Ka.append=Qa.append,Ka.empty=Qa.empty,Ka.node=Qa.node,Ka.call=Qa.call,Ka.size=Qa.size,Ka.select=function(e){for(var t,n,i,r,a,s=[],o=-1,l=this.length;++o<l;){i=(r=this[o]).update,s.push(t=[]),t.parentNode=r.parentNode;for(var c=-1,u=r.length;++c<u;)(a=r[c])?(t.push(i[c]=n=e.call(r.parentNode,a.__data__,c,o)),n.__data__=a.__data__):t.push(null)}return E(s)},Ka.insert=function(e,t){return arguments.length<2&&(t=V(this)),Qa.insert.call(this,e,t)},Qa.transition=function(){for(var e,t,n=al||++ul,i=[],r=sl||{time:Date.now(),ease:vi,delay:0,duration:250},a=-1,s=this.length;++a<s;){i.push(e=[]);for(var o=this[a],l=-1,c=o.length;++l<c;)(t=o[l])&&ya(t,l,n,r),e.push(t)}return ma(i,n)},Qa.interrupt=function(){return this.each($)},Ca.select=function(e){var t=["string"==typeof e?za(e,Oa):e];return t.parentNode=Ta,E([t])},Ca.selectAll=function(e){var t=Ma("string"==typeof e?Ga(e,Oa):e);return t.parentNode=Ta,E([t])};var Za=Ca.select(Ta);Qa.on=function(e,t,n){var i=arguments.length;if(i<3){if("string"!=typeof e){i<2&&(t=!1);for(n in e)this.each(U(n,e[n],t));return this}if(i<2)return(i=this.node()["__on"+e])&&i._;n=!1}return this.each(U(e,t,n))};var Xa=Ca.map({mouseenter:"mouseover",mouseleave:"mouseout"});Xa.forEach(function(e){"on"+e in Oa&&Xa.remove(e)});var es="onselectstart"in Oa?null:b(Ta.style,"userSelect"),ts=0;Ca.mouse=function(e){return J(e,x())};var ns=/WebKit/.test(Ra.navigator.userAgent)?-1:0;Ca.touch=function(e,t,n){if(arguments.length<3&&(n=t,t=x().changedTouches),t)for(var i,r=0,a=t.length;r<a;++r)if((i=t[r]).identifier===n)return J(e,i)},Ca.behavior.drag=function(){function e(){this.on("mousedown.drag",r).on("touchstart.drag",a)}function t(e,t,r,a,s){return function(){var o,l=this,c=Ca.event.target,u=l.parentNode,d=n.of(l,arguments),h=0,p=e(),f=".drag"+(null==p?"":"-"+p),g=Ca.select(r()).on(a+f,function(){var e,n,i=t(u,p);i&&(e=i[0]-b[0],n=i[1]-b[1],h|=e|n,b=i,d({type:"drag",x:i[0]+o[0],y:i[1]+o[1],dx:e,dy:n}))}).on(s+f,function(){t(u,p)&&(g.on(a+f,null).on(s+f,null),m(h&&Ca.event.target===c),d({type:"dragend"}))}),m=G(),b=t(u,p);i?(o=i.apply(l,arguments),o=[o.x-b[0],o.y-b[1]]):o=[0,0],d({type:"dragstart"})}}var n=S(e,"drag","dragstart","dragend"),i=null,r=t(v,Ca.mouse,Y,"mousemove","mouseup"),a=t(W,Ca.touch,Q,"touchmove","touchend");return e.origin=function(t){return arguments.length?(i=t,e):i},Ca.rebind(e,n,"on")},Ca.touches=function(e,t){return arguments.length<2&&(t=x().touches),t?Ma(t).map(function(t){var n=J(e,t);return n.identifier=t.identifier,n}):[]};var is=Math.PI,rs=2*is,as=is/2,ss=1e-6,os=ss*ss,ls=is/180,cs=180/is,us=Math.SQRT2,ds=2;Ca.interpolateZoom=function(e,t){function n(e){var t=e*b;if(m){var n=ne(g),s=a/(ds*h)*(n*ie(us*t+g)-te(g));return[i+s*c,r+s*u,a*n/ne(us*t+g)]}return[i+e*c,r+e*u,a*Math.exp(us*t)]}var i=e[0],r=e[1],a=e[2],s=t[0],o=t[1],l=t[2],c=s-i,u=o-r,d=c*c+u*u,h=Math.sqrt(d),p=(l*l-a*a+4*d)/(2*a*ds*h),f=(l*l-a*a-4*d)/(2*l*ds*h),g=Math.log(Math.sqrt(p*p+1)-p),m=Math.log(Math.sqrt(f*f+1)-f)-g,b=(m||Math.log(l/a))/us;return n.duration=1e3*b,n},Ca.behavior.zoom=function(){function e(e){e.on(C,c).on(fs+".zoom",d).on("dblclick.zoom",h).on(O,u)}function t(e){return[(e[0]-E.x)/E.k,(e[1]-E.y)/E.k]}function n(e){return[e[0]*E.k+E.x,e[1]*E.k+E.y]}function i(e){E.k=Math.max(k[0],Math.min(k[1],e))}function r(e,t){t=n(t),E.x+=e[0]-t[0],E.y+=e[1]-t[1]}function a(){y&&y.domain(v.range().map(function(e){return(e-E.x)/E.k}).map(v.invert)),x&&x.domain(w.range().map(function(e){return(e-E.y)/E.k}).map(w.invert))}function s(e){e({type:"zoomstart"})}function o(e){a(),e({type:"zoom",scale:E.k,translate:[E.x,E.y]})}function l(e){e({type:"zoomend"})}function c(){var e=this,n=Ca.event.target,i=T.of(e,arguments),a=0,c=Ca.select(Ra).on(P,function(){a=1,r(Ca.mouse(e),u),o(i)}).on(M,function(){c.on(P,null).on(M,null),d(a&&Ca.event.target===n),l(i)}),u=t(Ca.mouse(e)),d=G();$.call(e),s(i)}function u(){function e(){var e=Ca.touches(p);return h=E.k,e.forEach(function(e){e.identifier in g&&(g[e.identifier]=t(e))}),e}function n(){var t=Ca.event.target;Ca.select(t).on(y,a).on(w,d),x.push(t);for(var n=Ca.event.changedTouches,s=0,l=n.length;s<l;++s)g[n[s].identifier]=null;var c=e(),u=Date.now();if(1===c.length){if(u-b<500){var h=c[0],p=g[h.identifier];i(2*E.k),r(h,p),_(),o(f)}b=u}else if(c.length>1){var h=c[0],v=c[1],S=h[0]-v[0],A=h[1]-v[1];m=S*S+A*A}}function a(){for(var e,t,n,a,s=Ca.touches(p),l=0,c=s.length;l<c;++l,a=null)if(n=s[l],a=g[n.identifier]){if(t)break;e=n,t=a}if(a){var u=(u=n[0]-e[0])*u+(u=n[1]-e[1])*u,d=m&&Math.sqrt(u/m);e=[(e[0]+n[0])/2,(e[1]+n[1])/2],t=[(t[0]+a[0])/2,(t[1]+a[1])/2],i(d*h)}b=null,r(e,t),o(f)}function d(){if(Ca.event.touches.length){for(var t=Ca.event.changedTouches,n=0,i=t.length;n<i;++n)delete g[t[n].identifier];for(var r in g)return void e()}Ca.selectAll(x).on(v,null),S.on(C,c).on(O,u),A(),l(f)}var h,p=this,f=T.of(p,arguments),g={},m=0,v=".zoom-"+Ca.event.changedTouches[0].identifier,y="touchmove"+v,w="touchend"+v,x=[],S=Ca.select(p),A=G();$.call(p),n(),s(f),S.on(C,null).on(O,n)}function d(){var e=T.of(this,arguments);m?clearTimeout(m):(p=t(f=g||Ca.mouse(this)),$.call(this),s(e)),m=setTimeout(function(){m=null,l(e)},50),_(),i(Math.pow(2,.002*hs())*E.k),r(f,p),o(e)}function h(){var e=T.of(this,arguments),n=Ca.mouse(this),a=t(n),c=Math.log(E.k)/Math.LN2;s(e),i(Math.pow(2,Ca.event.shiftKey?Math.ceil(c)-1:Math.floor(c)+1)),r(n,a),o(e),l(e)}var p,f,g,m,b,v,y,w,x,E={x:0,y:0,k:1},A=[960,500],k=ps,C="mousedown.zoom",P="mousemove.zoom",M="mouseup.zoom",O="touchstart.zoom",T=S(e,"zoomstart","zoom","zoomend");return e.event=function(e){e.each(function(){var e=T.of(this,arguments),t=E;al?Ca.select(this).transition().each("start.zoom",function(){E=this.__chart__||{x:0,y:0,k:1},s(e)}).tween("zoom:zoom",function(){var n=A[0],i=A[1],r=n/2,a=i/2,s=Ca.interpolateZoom([(r-E.x)/E.k,(a-E.y)/E.k,n/E.k],[(r-t.x)/t.k,(a-t.y)/t.k,n/t.k]);return function(t){var i=s(t),l=n/i[2];this.__chart__=E={x:r-i[0]*l,y:a-i[1]*l,k:l},o(e)}}).each("end.zoom",function(){l(e)}):(this.__chart__=E,s(e),o(e),l(e))})},e.translate=function(t){return arguments.length?(E={x:+t[0],y:+t[1],k:E.k},a(),e):[E.x,E.y]},e.scale=function(t){return arguments.length?(E={x:E.x,y:E.y,k:+t},a(),e):E.k},e.scaleExtent=function(t){return arguments.length?(k=null==t?ps:[+t[0],+t[1]],e):k},e.center=function(t){return arguments.length?(g=t&&[+t[0],+t[1]],e):g},e.size=function(t){return arguments.length?(A=t&&[+t[0],+t[1]],e):A},e.x=function(t){return arguments.length?(y=t,v=t.copy(),E={x:0,y:0,k:1},e):y},e.y=function(t){return arguments.length?(x=t,w=t.copy(),E={x:0,y:0,k:1},e):x},Ca.rebind(e,T,"on")};var hs,ps=[0,1/0],fs="onwheel"in Oa?(hs=function(){return-Ca.event.deltaY*(Ca.event.deltaMode?120:1)},"wheel"):"onmousewheel"in Oa?(hs=function(){return Ca.event.wheelDelta},"mousewheel"):(hs=function(){return-Ca.event.detail},"MozMousePixelScroll");Ca.color=ae,ae.prototype.toString=function(){return this.rgb()+""},Ca.hsl=se;var gs=se.prototype=new ae;gs.brighter=function(e){return e=Math.pow(.7,arguments.length?e:1),new se(this.h,this.s,this.l/e)},gs.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new se(this.h,this.s,e*this.l)},gs.rgb=function(){return oe(this.h,this.s,this.l)},Ca.hcl=le;var ms=le.prototype=new ae;ms.brighter=function(e){return new le(this.h,this.c,Math.min(100,this.l+bs*(arguments.length?e:1)))},ms.darker=function(e){return new le(this.h,this.c,Math.max(0,this.l-bs*(arguments.length?e:1)))},ms.rgb=function(){return ce(this.h,this.c,this.l).rgb()},Ca.lab=ue;var bs=18,vs=.95047,ys=1,ws=1.08883,_s=ue.prototype=new ae;_s.brighter=function(e){return new ue(Math.min(100,this.l+bs*(arguments.length?e:1)),this.a,this.b)},_s.darker=function(e){return new ue(Math.max(0,this.l-bs*(arguments.length?e:1)),this.a,this.b)},_s.rgb=function(){return de(this.l,this.a,this.b)},Ca.rgb=me;var xs=me.prototype=new ae;xs.brighter=function(e){e=Math.pow(.7,arguments.length?e:1);var t=this.r,n=this.g,i=this.b,r=30;return t||n||i?(t&&t<r&&(t=r),n&&n<r&&(n=r),i&&i<r&&(i=r),new me(Math.min(255,t/e),Math.min(255,n/e),Math.min(255,i/e))):new me(r,r,r)},xs.darker=function(e){return e=Math.pow(.7,arguments.length?e:1),new me(e*this.r,e*this.g,e*this.b)},xs.hsl=function(){return _e(this.r,this.g,this.b)},xs.toString=function(){return"#"+ye(this.r)+ye(this.g)+ye(this.b)};var Ss=Ca.map({aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074});Ss.forEach(function(e,t){Ss.set(e,be(t))}),Ca.functor=Ae,Ca.xhr=Ce(ke),Ca.dsv=function(e,t){function n(e,n,a){arguments.length<3&&(a=n,n=null);var s=Pe(e,t,null==n?i:r(n),a);return s.row=function(e){return arguments.length?s.response(null==(n=e)?i:r(e)):n},s}function i(e){return n.parse(e.responseText)}function r(e){return function(t){return n.parse(t.responseText,e)}}function a(t){return t.map(s).join(e)}function s(e){return o.test(e)?'"'+e.replace(/\"/g,'""')+'"':e}var o=new RegExp('["'+e+"\n]"),l=e.charCodeAt(0);return n.parse=function(e,t){var i;return n.parseRows(e,function(e,n){if(i)return i(e,n-1);var r=new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}");i=t?function(e,n){return t(r(e),n)}:r})},n.parseRows=function(e,t){function n(){if(u>=c)return s;if(r)return r=!1,a;var t=u;if(34===e.charCodeAt(t)){for(var n=t;n++<c;)if(34===e.charCodeAt(n)){if(34!==e.charCodeAt(n+1))break;++n}return u=n+2,13===(i=e.charCodeAt(n+1))?(r=!0,10===e.charCodeAt(n+2)&&++u):10===i&&(r=!0),e.slice(t+1,n).replace(/""/g,'"')}for(;u<c;){var i=e.charCodeAt(u++),o=1;if(10===i)r=!0;else if(13===i)r=!0,10===e.charCodeAt(u)&&(++u,++o);else if(i!==l)continue;return e.slice(t,u-o)}return e.slice(t)}for(var i,r,a={},s={},o=[],c=e.length,u=0,d=0;(i=n())!==s;){for(var h=[];i!==a&&i!==s;)h.push(i),i=n();t&&null==(h=t(h,d++))||o.push(h)}return o},n.format=function(t){if(Array.isArray(t[0]))return n.formatRows(t);var i=new g,r=[];return t.forEach(function(e){for(var t in e)i.has(t)||r.push(i.add(t))}),[r.map(s).join(e)].concat(t.map(function(t){return r.map(function(e){return s(t[e])}).join(e)})).join("\n")},n.formatRows=function(e){return e.map(a).join("\n")},n},Ca.csv=Ca.dsv(",","text/csv"),Ca.tsv=Ca.dsv("\t","text/tab-separated-values");var Es,As,ks,Cs,Ps,Ms=Ra[b(Ra,"requestAnimationFrame")]||function(e){setTimeout(e,17)};Ca.timer=function(e,t,n){var i=arguments.length;i<2&&(t=0),i<3&&(n=Date.now());var r={c:e,t:n+t,f:!1,n:null};As?As.n=r:Es=r,As=r,ks||(Cs=clearTimeout(Cs),ks=1,Ms(Te))},Ca.timer.flush=function(){Re(),De()},Ca.round=function(e,t){return t?Math.round(e*(t=Math.pow(10,t)))/t:Math.round(e)};var Os=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"].map(function(e,t){var n=Math.pow(10,3*Fa(8-t));return{scale:t>8?function(e){return e/n}:function(e){return e*n},symbol:e}});Ca.formatPrefix=function(e,t){var n=0;return e&&(e<0&&(e*=-1),t&&(e=Ca.round(e,Ie(e,t))),n=1+Math.floor(1e-12+Math.log(e)/Math.LN10),n=Math.max(-24,Math.min(24,3*Math.floor((n-1)/3)))),Os[8+n/3]};var Ts=/(?:([^{])?([<>=^]))?([+\- ])?([$#])?(0)?(\d+)?(,)?(\.-?\d+)?([a-z%])?/i,Rs=Ca.map({b:function(e){return e.toString(2)},c:function(e){return String.fromCharCode(e)},o:function(e){return e.toString(8)},x:function(e){return e.toString(16)},X:function(e){return e.toString(16).toUpperCase()},g:function(e,t){return e.toPrecision(t)},e:function(e,t){return e.toExponential(t)},f:function(e,t){return e.toFixed(t)},r:function(e,t){return(e=Ca.round(e,Ie(e,t))).toFixed(Math.max(0,Math.min(20,Ie(e*(1+1e-15),t))))}}),Ds=Ca.time={},Is=Date;qe.prototype={getDate:function(){return this._.getUTCDate()},getDay:function(){return this._.getUTCDay()},getFullYear:function(){return this._.getUTCFullYear()},getHours:function(){return this._.getUTCHours()},getMilliseconds:function(){return this._.getUTCMilliseconds()},getMinutes:function(){return this._.getUTCMinutes()},getMonth:function(){return this._.getUTCMonth()},getSeconds:function(){return this._.getUTCSeconds()},getTime:function(){return this._.getTime()},getTimezoneOffset:function(){return 0},valueOf:function(){return this._.valueOf()},setDate:function(){js.setUTCDate.apply(this._,arguments)},setDay:function(){js.setUTCDay.apply(this._,arguments)},setFullYear:function(){js.setUTCFullYear.apply(this._,arguments)},setHours:function(){js.setUTCHours.apply(this._,arguments)},setMilliseconds:function(){js.setUTCMilliseconds.apply(this._,arguments)},setMinutes:function(){js.setUTCMinutes.apply(this._,arguments)},setMonth:function(){js.setUTCMonth.apply(this._,arguments)},setSeconds:function(){js.setUTCSeconds.apply(this._,arguments)},setTime:function(){js.setTime.apply(this._,arguments)}};var js=Date.prototype;Ds.year=Le(function(e){return(e=Ds.day(e)).setMonth(0,1),e},function(e,t){e.setFullYear(e.getFullYear()+t)},function(e){return e.getFullYear()}),Ds.years=Ds.year.range,Ds.years.utc=Ds.year.utc.range,Ds.day=Le(function(e){var t=new Is(2e3,0);return t.setFullYear(e.getFullYear(),e.getMonth(),e.getDate()),t},function(e,t){e.setDate(e.getDate()+t)},function(e){return e.getDate()-1}),Ds.days=Ds.day.range,Ds.days.utc=Ds.day.utc.range,Ds.dayOfYear=function(e){var t=Ds.year(e);return Math.floor((e-t-6e4*(e.getTimezoneOffset()-t.getTimezoneOffset()))/864e5)},["sunday","monday","tuesday","wednesday","thursday","friday","saturday"].forEach(function(e,t){t=7-t;var n=Ds[e]=Le(function(e){return(e=Ds.day(e)).setDate(e.getDate()-(e.getDay()+t)%7),e},function(e,t){e.setDate(e.getDate()+7*Math.floor(t))},function(e){var n=Ds.year(e).getDay();return Math.floor((Ds.dayOfYear(e)+(n+t)%7)/7)-(n!==t)});Ds[e+"s"]=n.range,Ds[e+"s"].utc=n.utc.range,Ds[e+"OfYear"]=function(e){var n=Ds.year(e).getDay();return Math.floor((Ds.dayOfYear(e)+(n+t)%7)/7)}}),Ds.week=Ds.sunday,Ds.weeks=Ds.sunday.range,Ds.weeks.utc=Ds.sunday.utc.range,Ds.weekOfYear=Ds.sundayOfYear;var Ns={"-":"",_:" ",0:"0"},qs=/^\s*\d+/,Ls=/^%/;Ca.locale=function(e){return{numberFormat:je(e),timeFormat:Be(e)}};var Fs=Ca.locale({decimal:".",thousands:",",grouping:[3],currency:["$",""],dateTime:"%a %b %e %X %Y",date:"%m/%d/%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});Ca.format=Fs.numberFormat,Ca.geo={},ot.prototype={s:0,t:0,add:function(e){lt(e,this.t,Bs),lt(Bs.s,this.s,this),this.s?this.t+=Bs.t:this.s=Bs.t},reset:function(){this.s=this.t=0},valueOf:function(){return this.s}};var Bs=new ot;Ca.geo.stream=function(e,t){e&&Vs.hasOwnProperty(e.type)?Vs[e.type](e,t):ct(e,t)};var Vs={Feature:function(e,t){ct(e.geometry,t)},FeatureCollection:function(e,t){for(var n=e.features,i=-1,r=n.length;++i<r;)ct(n[i].geometry,t)}},$s={Sphere:function(e,t){t.sphere()},Point:function(e,t){e=e.coordinates,t.point(e[0],e[1],e[2])},MultiPoint:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)e=n[i],t.point(e[0],e[1],e[2])},LineString:function(e,t){ut(e.coordinates,t,0)},MultiLineString:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)ut(n[i],t,0)},Polygon:function(e,t){dt(e.coordinates,t)},MultiPolygon:function(e,t){for(var n=e.coordinates,i=-1,r=n.length;++i<r;)dt(n[i],t)},GeometryCollection:function(e,t){for(var n=e.geometries,i=-1,r=n.length;++i<r;)ct(n[i],t)}};Ca.geo.area=function(e){return Us=0,Ca.geo.stream(e,zs),Us};var Us,Hs=new ot,zs={sphere:function(){Us+=4*is},point:v,lineStart:v,lineEnd:v,polygonStart:function(){Hs.reset(),zs.lineStart=ht},polygonEnd:function(){var e=2*Hs;Us+=e<0?4*is+e:e,zs.lineStart=zs.lineEnd=zs.point=v}};Ca.geo.bounds=function(){function e(e,t){y.push(w=[u=e,h=e]),t<d&&(d=t),t>p&&(p=t)}function t(t,n){var i=pt([t*ls,n*ls]);if(b){var r=gt(b,i),a=gt([r[1],-r[0],0],r);vt(a),a=yt(a);var s=t-f,l=s>0?1:-1,c=a[0]*cs*l,g=Fa(s)>180;if(g^(l*f<c&&c<l*t))(m=a[1]*cs)>p&&(p=m);else if(c=(c+360)%360-180,g^(l*f<c&&c<l*t)){var m=-a[1]*cs;m<d&&(d=m)}else n<d&&(d=n),n>p&&(p=n);g?t<f?o(u,t)>o(u,h)&&(h=t):o(t,h)>o(u,h)&&(u=t):h>=u?(t<u&&(u=t),t>h&&(h=t)):t>f?o(u,t)>o(u,h)&&(h=t):o(t,h)>o(u,h)&&(u=t)}else e(t,n);b=i,f=t}function n(){_.point=t}function i(){w[0]=u,w[1]=h,_.point=e,b=null}function r(e,n){if(b){var i=e-f;v+=Fa(i)>180?i+(i>0?360:-360):i}else g=e,m=n;zs.point(e,n),t(e,n)}function a(){zs.lineStart()}function s(){r(g,m),zs.lineEnd(),Fa(v)>ss&&(u=-(h=180)),w[0]=u,w[1]=h,b=null}function o(e,t){return(t-=e)<0?t+360:t}function l(e,t){return e[0]-t[0]}function c(e,t){return t[0]<=t[1]?t[0]<=e&&e<=t[1]:e<t[0]||t[1]<e}var u,d,h,p,f,g,m,b,v,y,w,_={point:e,lineStart:n,lineEnd:i,polygonStart:function(){_.point=r,_.lineStart=a,_.lineEnd=s,v=0,zs.polygonStart()},polygonEnd:function(){zs.polygonEnd(),_.point=e,_.lineStart=n,_.lineEnd=i,Hs<0?(u=-(h=180),d=-(p=90)):v>ss?p=90:v<-ss&&(d=-90),w[0]=u,w[1]=h}};return function(e){p=h=-(u=d=1/0),y=[],Ca.geo.stream(e,_);var t=y.length;if(t){y.sort(l);for(var n=1,i=[f=y[0]];n<t;++n)c((a=y[n])[0],f)||c(a[1],f)?(o(f[0],a[1])>o(f[0],f[1])&&(f[1]=a[1]),o(a[0],f[1])>o(f[0],f[1])&&(f[0]=a[0])):i.push(f=a);for(var r,a,s=-1/0,n=0,f=i[t=i.length-1];n<=t;f=a,++n)a=i[n],(r=o(f[1],a[0]))>s&&(s=r,u=a[0],h=f[1])}return y=w=null,u===1/0||d===1/0?[[NaN,NaN],[NaN,NaN]]:[[u,d],[h,p]]}}(),Ca.geo.centroid=function(e){Gs=Js=Ws=Qs=Ys=Ks=Zs=Xs=eo=to=no=0,Ca.geo.stream(e,io);var t=eo,n=to,i=no,r=t*t+n*n+i*i;return r<os&&(t=Ks,n=Zs,i=Xs,Js<ss&&(t=Ws,n=Qs,i=Ys),(r=t*t+n*n+i*i)<os)?[NaN,NaN]:[Math.atan2(n,t)*cs,ee(i/Math.sqrt(r))*cs]};var Gs,Js,Ws,Qs,Ys,Ks,Zs,Xs,eo,to,no,io={sphere:v,point:_t,lineStart:St,lineEnd:Et,polygonStart:function(){io.lineStart=At},polygonEnd:function(){io.lineStart=St}},ro=Ot(kt,function(e){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){e.lineStart(),t=1},point:function(a,s){var o=a>0?is:-is,l=Fa(a-n);Fa(l-is)<ss?(e.point(n,i=(i+s)/2>0?as:-as),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(o,i),e.point(a,i),t=0):r!==o&&l>=is&&(Fa(n-r)<ss&&(n-=r*ss),Fa(a-o)<ss&&(a-=o*ss),i=It(n,i,a,s),e.point(r,i),e.lineEnd(),e.lineStart(),e.point(o,i),t=0),e.point(n=a,i=s),r=o},lineEnd:function(){e.lineEnd(),n=i=NaN},clean:function(){return 2-t}}},function(e,t,n,i){var r;if(null==e)r=n*as,i.point(-is,r),i.point(0,r),i.point(is,r),i.point(is,0),i.point(is,-r),i.point(0,-r),i.point(-is,-r),i.point(-is,0),i.point(-is,r);else if(Fa(e[0]-t[0])>ss){var a=e[0]<t[0]?is:-is;r=n*a/2,i.point(-a,r),i.point(0,r),i.point(a,r)}else i.point(t[0],t[1])},[-is,-is/2]),ao=1e9;Ca.geo.clipExtent=function(){var e,t,n,i,r,a,s={stream:function(e){return r&&(r.valid=!1),r=a(e),r.valid=!0,r},extent:function(o){return arguments.length?(a=Lt(e=+o[0][0],t=+o[0][1],n=+o[1][0],i=+o[1][1]),r&&(r.valid=!1,r=null),s):[[e,t],[n,i]]}};return s.extent([[0,0],[960,500]])},(Ca.geo.conicEqualArea=function(){return Bt(Vt)}).raw=Vt,Ca.geo.albers=function(){return Ca.geo.conicEqualArea().rotate([96,0]).center([-.6,38.7]).parallels([29.5,45.5]).scale(1070)},Ca.geo.albersUsa=function(){function e(e){var a=e[0],s=e[1];return t=null,n(a,s),t||(i(a,s),t)||r(a,s),t}var t,n,i,r,a=Ca.geo.albers(),s=Ca.geo.conicEqualArea().rotate([154,0]).center([-2,58.5]).parallels([55,65]),o=Ca.geo.conicEqualArea().rotate([157,0]).center([-3,19.9]).parallels([8,18]),l={point:function(e,n){t=[e,n]}};return e.invert=function(e){var t=a.scale(),n=a.translate(),i=(e[0]-n[0])/t,r=(e[1]-n[1])/t;return(r>=.12&&r<.234&&i>=-.425&&i<-.214?s:r>=.166&&r<.234&&i>=-.214&&i<-.115?o:a).invert(e)},e.stream=function(e){var t=a.stream(e),n=s.stream(e),i=o.stream(e);return{point:function(e,r){t.point(e,r),n.point(e,r),i.point(e,r)},sphere:function(){t.sphere(),n.sphere(),i.sphere()},lineStart:function(){t.lineStart(),n.lineStart(),i.lineStart()},lineEnd:function(){t.lineEnd(),n.lineEnd(),i.lineEnd()},polygonStart:function(){t.polygonStart(),n.polygonStart(),i.polygonStart()},polygonEnd:function(){t.polygonEnd(),n.polygonEnd(),i.polygonEnd()}}},e.precision=function(t){return arguments.length?(a.precision(t),s.precision(t),o.precision(t),e):a.precision()},e.scale=function(t){return arguments.length?(a.scale(t),s.scale(.35*t),o.scale(t),e.translate(a.translate())):a.scale()},e.translate=function(t){if(!arguments.length)return a.translate();var c=a.scale(),u=+t[0],d=+t[1];return n=a.translate(t).clipExtent([[u-.455*c,d-.238*c],[u+.455*c,d+.238*c]]).stream(l).point,i=s.translate([u-.307*c,d+.201*c]).clipExtent([[u-.425*c+ss,d+.12*c+ss],[u-.214*c-ss,d+.234*c-ss]]).stream(l).point,r=o.translate([u-.205*c,d+.212*c]).clipExtent([[u-.214*c+ss,d+.166*c+ss],[u-.115*c-ss,d+.234*c-ss]]).stream(l).point,e},e.scale(1070)};var so,oo,lo,co,uo,ho,po={point:v,lineStart:v,lineEnd:v,polygonStart:function(){oo=0,po.lineStart=$t},polygonEnd:function(){po.lineStart=po.lineEnd=po.point=v,so+=Fa(oo/2)}},fo={point:function(e,t){e<lo&&(lo=e),e>uo&&(uo=e),t<co&&(co=t),t>ho&&(ho=t)},lineStart:v,lineEnd:v,polygonStart:v,polygonEnd:v},go={point:zt,lineStart:Gt,lineEnd:Jt,polygonStart:function(){go.lineStart=Wt},polygonEnd:function(){go.point=zt,go.lineStart=Gt,go.lineEnd=Jt}};Ca.geo.path=function(){function e(e){return e&&("function"==typeof o&&a.pointRadius(+o.apply(this,arguments)),s&&s.valid||(s=r(a)),Ca.geo.stream(e,s)),a.result()}function t(){return s=null,e}var n,i,r,a,s,o=4.5;return e.area=function(e){return so=0,Ca.geo.stream(e,r(po)),so},e.centroid=function(e){return Ws=Qs=Ys=Ks=Zs=Xs=eo=to=no=0,Ca.geo.stream(e,r(go)),no?[eo/no,to/no]:Xs?[Ks/Xs,Zs/Xs]:Ys?[Ws/Ys,Qs/Ys]:[NaN,NaN]},e.bounds=function(e){return uo=ho=-(lo=co=1/0),Ca.geo.stream(e,r(fo)),[[lo,co],[uo,ho]]},e.projection=function(e){return arguments.length?(r=(n=e)?e.stream||Kt(e):ke,t()):n},e.context=function(e){return arguments.length?(a=null==(i=e)?new Ut:new Qt(e),"function"!=typeof o&&a.pointRadius(o),t()):i},e.pointRadius=function(t){return arguments.length?(o="function"==typeof t?t:(a.pointRadius(+t),+t),e):o},e.projection(Ca.geo.albersUsa()).context(null)},Ca.geo.transform=function(e){return{stream:function(t){var n=new Zt(t);for(var i in e)n[i]=e[i];return n}}},Zt.prototype={point:function(e,t){this.stream.point(e,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}},Ca.geo.projection=en,Ca.geo.projectionMutator=tn,(Ca.geo.equirectangular=function(){return en(rn)}).raw=rn.invert=rn,Ca.geo.rotation=function(e){function t(t){return t=e(t[0]*ls,t[1]*ls),t[0]*=cs,t[1]*=cs,t}return e=sn(e[0]%360*ls,e[1]*ls,e.length>2?e[2]*ls:0),t.invert=function(t){return t=e.invert(t[0]*ls,t[1]*ls),t[0]*=cs,t[1]*=cs,t},t},an.invert=rn,Ca.geo.circle=function(){function e(){var e="function"==typeof i?i.apply(this,arguments):i,t=sn(-e[0]*ls,-e[1]*ls,0).invert,r=[];return n(null,null,1,{point:function(e,n){r.push(e=t(e,n)),e[0]*=cs,e[1]*=cs}}),{type:"Polygon",coordinates:[r]}}var t,n,i=[0,0],r=6;return e.origin=function(t){return arguments.length?(i=t,e):i},e.angle=function(i){return arguments.length?(n=un((t=+i)*ls,r*ls),e):t},e.precision=function(i){return arguments.length?(n=un(t*ls,(r=+i)*ls),e):r},e.angle(90)},Ca.geo.distance=function(e,t){var n,i=(t[0]-e[0])*ls,r=e[1]*ls,a=t[1]*ls,s=Math.sin(i),o=Math.cos(i),l=Math.sin(r),c=Math.cos(r),u=Math.sin(a),d=Math.cos(a);return Math.atan2(Math.sqrt((n=d*s)*n+(n=c*u-l*d*o)*n),l*u+c*d*o)},Ca.geo.graticule=function(){function e(){return{type:"MultiLineString",coordinates:t()}}function t(){return Ca.range(Math.ceil(a/m)*m,r,m).map(h).concat(Ca.range(Math.ceil(c/b)*b,l,b).map(p)).concat(Ca.range(Math.ceil(i/f)*f,n,f).filter(function(e){return Fa(e%m)>ss}).map(u)).concat(Ca.range(Math.ceil(o/g)*g,s,g).filter(function(e){return Fa(e%b)>ss}).map(d))}var n,i,r,a,s,o,l,c,u,d,h,p,f=10,g=f,m=90,b=360,v=2.5;return e.lines=function(){return t().map(function(e){return{type:"LineString",coordinates:e}})},e.outline=function(){return{type:"Polygon",coordinates:[h(a).concat(p(l).slice(1),h(r).reverse().slice(1),p(c).reverse().slice(1))]}},e.extent=function(t){return arguments.length?e.majorExtent(t).minorExtent(t):e.minorExtent()},e.majorExtent=function(t){return arguments.length?(a=+t[0][0],r=+t[1][0],c=+t[0][1],l=+t[1][1],a>r&&(t=a,a=r,r=t),c>l&&(t=c,c=l,l=t),e.precision(v)):[[a,c],[r,l]]},e.minorExtent=function(t){return arguments.length?(i=+t[0][0],n=+t[1][0],o=+t[0][1],s=+t[1][1],i>n&&(t=i,i=n,n=t),o>s&&(t=o,o=s,s=t),e.precision(v)):[[i,o],[n,s]]},e.step=function(t){return arguments.length?e.majorStep(t).minorStep(t):e.minorStep()},e.majorStep=function(t){return arguments.length?(m=+t[0],b=+t[1],e):[m,b]},e.minorStep=function(t){return arguments.length?(f=+t[0],g=+t[1],e):[f,g]},e.precision=function(t){return arguments.length?(v=+t,u=hn(o,s,90),d=pn(i,n,v),h=hn(c,l,90),p=pn(a,r,v),e):v},e.majorExtent([[-180,-90+ss],[180,90-ss]]).minorExtent([[-180,-80-ss],[180,80+ss]])},Ca.geo.greatArc=function(){function e(){return{type:"LineString",coordinates:[t||i.apply(this,arguments),n||r.apply(this,arguments)]}}var t,n,i=fn,r=gn;return e.distance=function(){return Ca.geo.distance(t||i.apply(this,arguments),n||r.apply(this,arguments))},e.source=function(n){return arguments.length?(i=n,t="function"==typeof n?null:n,e):i},e.target=function(t){return arguments.length?(r=t,n="function"==typeof t?null:t,e):r},e.precision=function(){return arguments.length?e:0},e},Ca.geo.interpolate=function(e,t){return mn(e[0]*ls,e[1]*ls,t[0]*ls,t[1]*ls)},Ca.geo.length=function(e){return mo=0,Ca.geo.stream(e,bo),mo};var mo,bo={sphere:v,point:v,lineStart:function(){function e(e,r){var a=Math.sin(r*=ls),s=Math.cos(r),o=Fa((e*=ls)-t),l=Math.cos(o);mo+=Math.atan2(Math.sqrt((o=s*Math.sin(o))*o+(o=i*a-n*s*l)*o),n*a+i*s*l),t=e,n=a,i=s}var t,n,i;bo.point=function(r,a){t=r*ls,n=Math.sin(a*=ls),i=Math.cos(a),bo.point=e},bo.lineEnd=function(){bo.point=bo.lineEnd=v}},lineEnd:v,polygonStart:v,polygonEnd:v},vo=bn(function(e){return Math.sqrt(2/(1+e))},function(e){return 2*Math.asin(e/2)});(Ca.geo.azimuthalEqualArea=function(){return en(vo)}).raw=vo;var yo=bn(function(e){var t=Math.acos(e);return t&&t/Math.sin(t)},ke);(Ca.geo.azimuthalEquidistant=function(){return en(yo)}).raw=yo,(Ca.geo.conicConformal=function(){return Bt(vn)}).raw=vn,(Ca.geo.conicEquidistant=function(){return Bt(yn)}).raw=yn;var wo=bn(function(e){return 1/e},Math.atan);(Ca.geo.gnomonic=function(){return en(wo)}).raw=wo,wn.invert=function(e,t){return[e,2*Math.atan(Math.exp(t))-as]},(Ca.geo.mercator=function(){return _n(wn)}).raw=wn;var _o=bn(function(){return 1},Math.asin);(Ca.geo.orthographic=function(){return en(_o)}).raw=_o;var xo=bn(function(e){return 1/(1+e)},function(e){return 2*Math.atan(e)});(Ca.geo.stereographic=function(){return en(xo)}).raw=xo,xn.invert=function(e,t){return[-t,2*Math.atan(Math.exp(e))-as]},(Ca.geo.transverseMercator=function(){var e=_n(xn),t=e.center,n=e.rotate;return e.center=function(e){return e?t([-e[1],e[0]]):(e=t(),[e[1],-e[0]])},e.rotate=function(e){return e?n([e[0],e[1],e.length>2?e[2]+90:90]):(e=n(),[e[0],e[1],e[2]-90])},n([0,0,90])}).raw=xn,Ca.geom={},Ca.geom.hull=function(e){function t(e){if(e.length<3)return[];var t,r=Ae(n),a=Ae(i),s=e.length,o=[],l=[];for(t=0;t<s;t++)o.push([+r.call(this,e[t],t),+a.call(this,e[t],t),t]);for(o.sort(kn),t=0;t<s;t++)l.push([o[t][0],-o[t][1]]);var c=An(o),u=An(l),d=u[0]===c[0],h=u[u.length-1]===c[c.length-1],p=[];for(t=c.length-1;t>=0;--t)p.push(e[o[c[t]][2]]);for(t=+d;t<u.length-h;++t)p.push(e[o[u[t]][2]]);return p}var n=Sn,i=En;return arguments.length?t(e):(t.x=function(e){return arguments.length?(n=e,t):n},t.y=function(e){return arguments.length?(i=e,t):i},t)},Ca.geom.polygon=function(e){return Ha(e,So),e};var So=Ca.geom.polygon.prototype=[];So.area=function(){for(var e,t=-1,n=this.length,i=this[n-1],r=0;++t<n;)e=i,i=this[t],r+=e[1]*i[0]-e[0]*i[1];return.5*r},So.centroid=function(e){var t,n,i=-1,r=this.length,a=0,s=0,o=this[r-1];for(arguments.length||(e=-1/(6*this.area()));++i<r;)t=o,o=this[i],n=t[0]*o[1]-o[0]*t[1],a+=(t[0]+o[0])*n,s+=(t[1]+o[1])*n;return[a*e,s*e]},So.clip=function(e){for(var t,n,i,r,a,s,o=Mn(e),l=-1,c=this.length-Mn(this),u=this[c-1];++l<c;){for(t=e.slice(),e.length=0,r=this[l],a=t[(i=t.length-o)-1],n=-1;++n<i;)Cn(s=t[n],u,r)?(Cn(a,u,r)||e.push(Pn(a,s,u,r)),e.push(s)):Cn(a,u,r)&&e.push(Pn(a,s,u,r)),a=s;o&&e.push(e[0]),u=r}return e};var Eo,Ao,ko,Co,Po,Mo=[],Oo=[];qn.prototype.prepare=function(){for(var e,t=this.edges,n=t.length;n--;)(e=t[n].edge).b&&e.a||t.splice(n,1);return t.sort(Fn),t.length},Qn.prototype={start:function(){return this.edge.l===this.site?this.edge.a:this.edge.b},end:function(){return this.edge.l===this.site?this.edge.b:this.edge.a}},Yn.prototype={insert:function(e,t){var n,i,r;if(e){if(t.P=e,t.N=e.N,e.N&&(e.N.P=t),e.N=t,e.R){for(e=e.R;e.L;)e=e.L;e.L=t}else e.R=t;n=e}else this._?(e=ei(this._),t.P=null,t.N=e,e.P=e.L=t,n=e):(t.P=t.N=null,this._=t,n=null);for(t.L=t.R=null,t.U=n,t.C=!0,e=t;n&&n.C;)n===(i=n.U).L?(r=i.R)&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.R&&(Zn(this,n),n=(e=n).U),n.C=!1,i.C=!0,Xn(this,i)):(r=i.L)&&r.C?(n.C=r.C=!1,i.C=!0,e=i):(e===n.L&&(Xn(this,n),n=(e=n).U),n.C=!1,i.C=!0,Zn(this,i)),n=e.U;this._.C=!1},remove:function(e){e.N&&(e.N.P=e.P),e.P&&(e.P.N=e.N),e.N=e.P=null;var t,n,i,r=e.U,a=e.L,s=e.R;if(n=a?s?ei(s):a:s,r?r.L===e?r.L=n:r.R=n:this._=n,a&&s?(i=n.C,n.C=e.C,n.L=a,a.U=n,n!==s?(r=n.U,n.U=e.U,e=n.R,r.L=e,n.R=s,s.U=n):(n.U=r,r=n,e=n.R)):(i=e.C,e=n),e&&(e.U=r),!i)if(e&&e.C)e.C=!1;else{do{if(e===this._)break;if(e===r.L){if((t=r.R).C&&(t.C=!1,r.C=!0,Zn(this,r),t=r.R),t.L&&t.L.C||t.R&&t.R.C){t.R&&t.R.C||(t.L.C=!1,t.C=!0,Xn(this,t),t=r.R),t.C=r.C,r.C=t.R.C=!1,Zn(this,r),e=this._;break}}else if((t=r.L).C&&(t.C=!1,r.C=!0,Xn(this,r),t=r.L),t.L&&t.L.C||t.R&&t.R.C){t.L&&t.L.C||(t.R.C=!1,t.C=!0,Zn(this,t),t=r.L),t.C=r.C,r.C=t.L.C=!1,Xn(this,r),e=this._;break}t.C=!0,e=r,r=r.U}while(!e.C);e&&(e.C=!1)}}},Ca.geom.voronoi=function(e){function t(e){var t=new Array(e.length),i=o[0][0],r=o[0][1],a=o[1][0],s=o[1][1];return ti(n(e),o).cells.forEach(function(n,o){var l=n.edges,c=n.site;(t[o]=l.length?l.map(function(e){var t=e.start();return[t.x,t.y]}):c.x>=i&&c.x<=a&&c.y>=r&&c.y<=s?[[i,s],[a,s],[a,r],[i,r]]:[]).point=e[o]}),t}function n(e){return e.map(function(e,t){return{x:Math.round(a(e,t)/ss)*ss,y:Math.round(s(e,t)/ss)*ss,i:t}})}var i=Sn,r=En,a=i,s=r,o=To;return e?t(e):(t.links=function(e){return ti(n(e)).edges.filter(function(e){return e.l&&e.r}).map(function(t){return{source:e[t.l.i],target:e[t.r.i]}})},t.triangles=function(e){var t=[];return ti(n(e)).cells.forEach(function(n,i){for(var r,a=n.site,s=n.edges.sort(Fn),o=-1,l=s.length,c=s[l-1].edge,u=c.l===a?c.r:c.l;++o<l;)c,r=u,u=(c=s[o].edge).l===a?c.r:c.l,i<r.i&&i<u.i&&ii(a,r,u)<0&&t.push([e[i],e[r.i],e[u.i]])}),t},t.x=function(e){return arguments.length?(a=Ae(i=e),t):i},t.y=function(e){return arguments.length?(s=Ae(r=e),t):r},t.clipExtent=function(e){return arguments.length?(o=null==e?To:e,t):o===To?null:o},t.size=function(e){return arguments.length?t.clipExtent(e&&[[0,0],e]):o===To?null:o&&o[1]},t)};var To=[[-1e6,-1e6],[1e6,1e6]];Ca.geom.delaunay=function(e){return Ca.geom.voronoi().triangles(e)},Ca.geom.quadtree=function(e,t,n,i,r){function a(e){function a(e,t,n,i,r,a,s,o){if(!isNaN(n)&&!isNaN(i))if(e.leaf){var l=e.x,u=e.y;if(null!=l)if(Fa(l-n)+Fa(u-i)<.01)c(e,t,n,i,r,a,s,o);else{var d=e.point;e.x=e.y=e.point=null,c(e,d,l,u,r,a,s,o),c(e,t,n,i,r,a,s,o)}else e.x=n,e.y=i,e.point=t}else c(e,t,n,i,r,a,s,o)}function c(e,t,n,i,r,s,o,l){var c=.5*(r+o),u=.5*(s+l),d=n>=c,h=i>=u,p=(h<<1)+d;e.leaf=!1,e=e.nodes[p]||(e.nodes[p]={leaf:!0,nodes:[],point:null,x:null,y:null}),d?r=c:o=c,h?s=u:l=u,a(e,t,n,i,r,s,o,l)}var u,d,h,p,f,g,m,b,v,y=Ae(o),w=Ae(l);if(null!=t)g=t,m=n,b=i,v=r;else if(b=v=-(g=m=1/0),d=[],h=[],f=e.length,s)for(p=0;p<f;++p)(u=e[p]).x<g&&(g=u.x),u.y<m&&(m=u.y),u.x>b&&(b=u.x),u.y>v&&(v=u.y),d.push(u.x),h.push(u.y);else for(p=0;p<f;++p){var _=+y(u=e[p],p),x=+w(u,p);_<g&&(g=_),x<m&&(m=x),_>b&&(b=_),x>v&&(v=x),d.push(_),h.push(x)}var S=b-g,E=v-m;S>E?v=m+S:b=g+E;var A={leaf:!0,nodes:[],point:null,x:null,y:null};if(A.add=function(e){a(A,e,+y(e,++p),+w(e,p),g,m,b,v)},A.visit=function(e){si(e,A,g,m,b,v)},p=-1,null==t){for(;++p<f;)a(A,e[p],d[p],h[p],g,m,b,v);--p}else e.forEach(A.add);return d=h=e=u=null,A}var s,o=Sn,l=En;return(s=arguments.length)?(o=ri,l=ai,3===s&&(r=n,i=t,n=t=0),a(e)):(a.x=function(e){return arguments.length?(o=e,a):o},a.y=function(e){return arguments.length?(l=e,a):l},a.extent=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=+e[0][0],n=+e[0][1],i=+e[1][0],r=+e[1][1]),a):null==t?null:[[t,n],[i,r]]},a.size=function(e){return arguments.length?(null==e?t=n=i=r=null:(t=n=0,i=+e[0],r=+e[1]),a):null==t?null:[i-t,r-n]},a)},Ca.interpolateRgb=oi,Ca.interpolateObject=li,Ca.interpolateNumber=ci,Ca.interpolateString=ui;var Ro=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,Do=new RegExp(Ro.source,"g");Ca.interpolate=di,Ca.interpolators=[function(e,t){var n=typeof t;return("string"===n?Ss.has(t)||/^(#|rgb\(|hsl\()/.test(t)?oi:ui:t instanceof ae?oi:Array.isArray(t)?hi:"object"===n&&isNaN(t)?li:ci)(e,t)}],Ca.interpolateArray=hi;var Io=function(){return ke},jo=Ca.map({linear:Io,poly:function(e){return function(t){return Math.pow(t,e)}},quad:function(){return mi},cubic:function(){return bi},sin:function(){return yi},exp:function(){return wi},circle:function(){return _i},elastic:function(e,t){var n;return arguments.length<2&&(t=.45),arguments.length?n=t/rs*Math.asin(1/e):(e=1,n=t/4),function(i){return 1+e*Math.pow(2,-10*i)*Math.sin((i-n)*rs/t)}},back:function(e){return e||(e=1.70158),function(t){return t*t*((e+1)*t-e)}},bounce:function(){return xi}}),No=Ca.map({in:ke,out:fi,"in-out":gi,"out-in":function(e){return gi(fi(e))}});Ca.ease=function(e){var t=e.indexOf("-"),n=t>=0?e.slice(0,t):e,i=t>=0?e.slice(t+1):"in";return n=jo.get(n)||Io,i=No.get(i)||ke,pi(i(n.apply(null,Pa.call(arguments,1))))},Ca.interpolateHcl=function(e,t){e=Ca.hcl(e),t=Ca.hcl(t);var n=e.h,i=e.c,r=e.l,a=t.h-n,s=t.c-i,o=t.l-r;return isNaN(s)&&(s=0,i=isNaN(i)?t.c:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return ce(n+a*e,i+s*e,r+o*e)+""}},Ca.interpolateHsl=function(e,t){e=Ca.hsl(e),t=Ca.hsl(t);var n=e.h,i=e.s,r=e.l,a=t.h-n,s=t.s-i,o=t.l-r;return isNaN(s)&&(s=0,i=isNaN(i)?t.s:i),isNaN(a)?(a=0,n=isNaN(n)?t.h:n):a>180?a-=360:a<-180&&(a+=360),function(e){return oe(n+a*e,i+s*e,r+o*e)+""}},Ca.interpolateLab=function(e,t){e=Ca.lab(e),t=Ca.lab(t);var n=e.l,i=e.a,r=e.b,a=t.l-n,s=t.a-i,o=t.b-r;return function(e){return de(n+a*e,i+s*e,r+o*e)+""}},Ca.interpolateRound=Si,Ca.transform=function(e){var t=Oa.createElementNS(Ca.ns.prefix.svg,"g");return(Ca.transform=function(e){if(null!=e){t.setAttribute("transform",e);var n=t.transform.baseVal.consolidate()}return new Ei(n?n.matrix:qo)})(e)},Ei.prototype.toString=function(){return"translate("+this.translate+")rotate("+this.rotate+")skewX("+this.skew+")scale("+this.scale+")"};var qo={a:1,b:0,c:0,d:1,e:0,f:0};Ca.interpolateTransform=Pi,Ca.layout={},Ca.layout.bundle=function(){return function(e){for(var t=[],n=-1,i=e.length;++n<i;)t.push(Ti(e[n]));return t}},Ca.layout.chord=function(){function e(){var e,c,d,h,p,f={},g=[],m=Ca.range(a),b=[];for(n=[],i=[],e=0,h=-1;++h<a;){for(c=0,p=-1;++p<a;)c+=r[h][p];g.push(c),b.push(Ca.range(a)),e+=c}for(s&&m.sort(function(e,t){return s(g[e],g[t])}),o&&b.forEach(function(e,t){e.sort(function(e,n){return o(r[t][e],r[t][n])})}),e=(rs-u*a)/e,c=0,h=-1;++h<a;){for(d=c,p=-1;++p<a;){var v=m[h],y=b[v][p],w=r[v][y],_=c,x=c+=w*e;f[v+"-"+y]={index:v,subindex:y,startAngle:_,endAngle:x,value:w}}i[v]={index:v,startAngle:d,endAngle:c,value:(c-d)/e},c+=u}for(h=-1;++h<a;)for(p=h-1;++p<a;){var S=f[h+"-"+p],E=f[p+"-"+h];(S.value||E.value)&&n.push(S.value<E.value?{source:E,target:S}:{source:S,target:E})}l&&t()}function t(){n.sort(function(e,t){return l((e.source.value+e.target.value)/2,(t.source.value+t.target.value)/2)})}var n,i,r,a,s,o,l,c={},u=0;return c.matrix=function(e){return arguments.length?(a=(r=e)&&r.length,n=i=null,c):r},c.padding=function(e){return arguments.length?(u=e,n=i=null,c):u},c.sortGroups=function(e){return arguments.length?(s=e,n=i=null,c):s},c.sortSubgroups=function(e){return arguments.length?(o=e,n=null,c):o},c.sortChords=function(e){return arguments.length?(l=e,n&&t(),c):l},c.chords=function(){return n||e(),n},c.groups=function(){return i||e(),i},c},Ca.layout.force=function(){function e(e){return function(t,n,i,r){if(t.point!==e){var a=t.cx-e.x,s=t.cy-e.y,o=r-n,l=a*a+s*s;if(o*o/m<l){if(l<f){c=t.charge/l;e.px-=a*c,e.py-=s*c}return!0}if(t.point&&l&&l<f){var c=t.pointCharge/l;e.px-=a*c,e.py-=s*c}}return!t.charge}}function t(e){e.px=Ca.event.x,e.py=Ca.event.y,o.resume()}var n,i,r,a,s,o={},l=Ca.dispatch("start","tick","end"),c=[1,1],u=.9,d=Lo,h=Fo,p=-30,f=Bo,g=.1,m=.64,b=[],v=[];return o.tick=function(){if((i*=.99)<.005)return l.end({type:"end",alpha:i=0}),!0;var t,n,o,d,h,f,m,y,w,_=b.length,x=v.length;for(n=0;n<x;++n)d=(o=v[n]).source,(f=(y=(h=o.target).x-d.x)*y+(w=h.y-d.y)*w)&&(y*=f=i*a[n]*((f=Math.sqrt(f))-r[n])/f,w*=f,h.x-=y*(m=d.weight/(h.weight+d.weight)),h.y-=w*m,d.x+=y*(m=1-m),d.y+=w*m);if((m=i*g)&&(y=c[0]/2,w=c[1]/2,n=-1,m))for(;++n<_;)(o=b[n]).x+=(y-o.x)*m,o.y+=(w-o.y)*m;if(p)for(Li(t=Ca.geom.quadtree(b),i,s),n=-1;++n<_;)(o=b[n]).fixed||t.visit(e(o));for(n=-1;++n<_;)(o=b[n]).fixed?(o.x=o.px,o.y=o.py):(o.x-=(o.px-(o.px=o.x))*u,o.y-=(o.py-(o.py=o.y))*u);l.tick({type:"tick",alpha:i})},o.nodes=function(e){return arguments.length?(b=e,o):b},o.links=function(e){return arguments.length?(v=e,o):v},o.size=function(e){return arguments.length?(c=e,o):c},o.linkDistance=function(e){return arguments.length?(d="function"==typeof e?e:+e,o):d},o.distance=o.linkDistance,o.linkStrength=function(e){return arguments.length?(h="function"==typeof e?e:+e,o):h},o.friction=function(e){return arguments.length?(u=+e,o):u},o.charge=function(e){return arguments.length?(p="function"==typeof e?e:+e,o):p},o.chargeDistance=function(e){return arguments.length?(f=e*e,o):Math.sqrt(f)},o.gravity=function(e){return arguments.length?(g=+e,o):g},o.theta=function(e){return arguments.length?(m=e*e,o):Math.sqrt(m)},o.alpha=function(e){return arguments.length?(e=+e,i?i=e>0?e:0:e>0&&(l.start({type:"start",alpha:i=e}),Ca.timer(o.tick)),o):i},o.start=function(){function e(e,i){if(!n){for(n=new Array(l),o=0;o<l;++o)n[o]=[];for(o=0;o<c;++o){var r=v[o];n[r.source.index].push(r.target),n[r.target.index].push(r.source)}}for(var a,s=n[t],o=-1,c=s.length;++o<c;)if(!isNaN(a=s[o][e]))return a;return Math.random()*i}var t,n,i,l=b.length,u=v.length,f=c[0],g=c[1];for(t=0;t<l;++t)(i=b[t]).index=t,i.weight=0;for(t=0;t<u;++t)"number"==typeof(i=v[t]).source&&(i.source=b[i.source]),"number"==typeof i.target&&(i.target=b[i.target]),++i.source.weight,++i.target.weight;for(t=0;t<l;++t)i=b[t],isNaN(i.x)&&(i.x=e("x",f)),isNaN(i.y)&&(i.y=e("y",g)),isNaN(i.px)&&(i.px=i.x),isNaN(i.py)&&(i.py=i.y);if(r=[],"function"==typeof d)for(t=0;t<u;++t)r[t]=+d.call(this,v[t],t);else for(t=0;t<u;++t)r[t]=d;if(a=[],"function"==typeof h)for(t=0;t<u;++t)a[t]=+h.call(this,v[t],t);else for(t=0;t<u;++t)a[t]=h;if(s=[],"function"==typeof p)for(t=0;t<l;++t)s[t]=+p.call(this,b[t],t);else for(t=0;t<l;++t)s[t]=p;return o.resume()},o.resume=function(){return o.alpha(.1)},o.stop=function(){return o.alpha(0)},o.drag=function(){if(n||(n=Ca.behavior.drag().origin(ke).on("dragstart.force",Ii).on("drag.force",t).on("dragend.force",ji)),!arguments.length)return n;this.on("mouseover.force",Ni).on("mouseout.force",qi).call(n)},Ca.rebind(o,l,"on")};var Lo=20,Fo=1,Bo=1/0;Ca.layout.hierarchy=function(){function e(r){var a,s=[r],o=[];for(r.depth=0;null!=(a=s.pop());)if(o.push(a),(c=n.call(e,a,a.depth))&&(l=c.length)){for(var l,c,u;--l>=0;)s.push(u=c[l]),u.parent=a,u.depth=a.depth+1;i&&(a.value=0),a.children=c}else i&&(a.value=+i.call(e,a,a.depth)||0),delete a.children;return Vi(r,function(e){var n,r;t&&(n=e.children)&&n.sort(t),i&&(r=e.parent)&&(r.value+=e.value)}),o}var t=Hi,n=$i,i=Ui;return e.sort=function(n){return arguments.length?(t=n,e):t},e.children=function(t){return arguments.length?(n=t,e):n},e.value=function(t){return arguments.length?(i=t,e):i},e.revalue=function(t){return i&&(Bi(t,function(e){e.children&&(e.value=0)}),Vi(t,function(t){var n;t.children||(t.value=+i.call(e,t,t.depth)||0),(n=t.parent)&&(n.value+=t.value)})),t},e},Ca.layout.partition=function(){function e(t,n,i,r){var a=t.children;if(t.x=n,t.y=t.depth*r,t.dx=i,t.dy=r,a&&(s=a.length)){var s,o,l,c=-1;for(i=t.value?i/t.value:0;++c<s;)e(o=a[c],n,l=o.value*i,r),n+=l}}function t(e){var n=e.children,i=0;if(n&&(r=n.length))for(var r,a=-1;++a<r;)i=Math.max(i,t(n[a]));return 1+i}function n(n,a){var s=i.call(this,n,a);return e(s[0],0,r[0],r[1]/t(s[0])),s}var i=Ca.layout.hierarchy(),r=[1,1];return n.size=function(e){return arguments.length?(r=e,n):r},Fi(n,i)},Ca.layout.pie=function(){function e(a){var s=a.map(function(n,i){return+t.call(e,n,i)}),o=+("function"==typeof i?i.apply(this,arguments):i),l=(("function"==typeof r?r.apply(this,arguments):r)-o)/Ca.sum(s),c=Ca.range(a.length);null!=n&&c.sort(n===Vo?function(e,t){return s[t]-s[e]}:function(e,t){return n(a[e],a[t])});var u=[];return c.forEach(function(e){var t;u[e]={data:a[e],value:t=s[e],startAngle:o,endAngle:o+=t*l}}),u}var t=Number,n=Vo,i=0,r=rs;return e.value=function(n){return arguments.length?(t=n,e):t},e.sort=function(t){return arguments.length?(n=t,e):n},e.startAngle=function(t){return arguments.length?(i=t,e):i},e.endAngle=function(t){return arguments.length?(r=t,e):r},e};var Vo={};Ca.layout.stack=function(){function e(o,l){if(!(h=o.length))return o;var c=o.map(function(n,i){return t.call(e,n,i)}),u=c.map(function(t){return t.map(function(t,n){return[a.call(e,t,n),s.call(e,t,n)]})}),d=n.call(e,u,l);c=Ca.permute(c,d),u=Ca.permute(u,d);var h,p,f,g,m=i.call(e,u,l),b=c[0].length;for(f=0;f<b;++f)for(r.call(e,c[0][f],g=m[f],u[0][f][1]),p=1;p<h;++p)r.call(e,c[p][f],g+=u[p-1][f][1],u[p][f][1]);return o}var t=ke,n=Qi,i=Yi,r=Wi,a=Gi,s=Ji;return e.values=function(n){return arguments.length?(t=n,e):t},e.order=function(t){return arguments.length?(n="function"==typeof t?t:$o.get(t)||Qi,e):n},e.offset=function(t){return arguments.length?(i="function"==typeof t?t:Uo.get(t)||Yi,e):i},e.x=function(t){return arguments.length?(a=t,e):a},e.y=function(t){return arguments.length?(s=t,e):s},e.out=function(t){return arguments.length?(r=t,e):r},e};var $o=Ca.map({"inside-out":function(e){var t,n,i=e.length,r=e.map(Ki),a=e.map(Zi),s=Ca.range(i).sort(function(e,t){return r[e]-r[t]}),o=0,l=0,c=[],u=[];for(t=0;t<i;++t)n=s[t],o<l?(o+=a[n],c.push(n)):(l+=a[n],u.push(n));return u.reverse().concat(c)},reverse:function(e){return Ca.range(e.length).reverse()},default:Qi}),Uo=Ca.map({silhouette:function(e){var t,n,i,r=e.length,a=e[0].length,s=[],o=0,l=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];i>o&&(o=i),s.push(i)}for(n=0;n<a;++n)l[n]=(o-s[n])/2;return l},wiggle:function(e){var t,n,i,r,a,s,o,l,c,u=e.length,d=e[0],h=d.length,p=[];for(p[0]=l=c=0,n=1;n<h;++n){for(t=0,r=0;t<u;++t)r+=e[t][n][1];for(t=0,a=0,o=d[n][0]-d[n-1][0];t<u;++t){for(i=0,s=(e[t][n][1]-e[t][n-1][1])/(2*o);i<t;++i)s+=(e[i][n][1]-e[i][n-1][1])/o;a+=s*e[t][n][1]}p[n]=l-=r?a/r*o:0,l<c&&(c=l)}for(n=0;n<h;++n)p[n]-=c;return p},expand:function(e){var t,n,i,r=e.length,a=e[0].length,s=1/r,o=[];for(n=0;n<a;++n){for(t=0,i=0;t<r;t++)i+=e[t][n][1];if(i)for(t=0;t<r;t++)e[t][n][1]/=i;else for(t=0;t<r;t++)e[t][n][1]=s}for(n=0;n<a;++n)o[n]=0;return o},zero:Yi});Ca.layout.histogram=function(){function e(e,a){for(var s,o,l=[],c=e.map(n,this),u=i.call(this,c,a),d=r.call(this,u,c,a),a=-1,h=c.length,p=d.length-1,f=t?1:1/h;++a<p;)(s=l[a]=[]).dx=d[a+1]-(s.x=d[a]),s.y=0;if(p>0)for(a=-1;++a<h;)(o=c[a])>=u[0]&&o<=u[1]&&((s=l[Ca.bisect(d,o,1,p)-1]).y+=f,s.push(e[a]));return l}var t=!0,n=Number,i=nr,r=er;return e.value=function(t){return arguments.length?(n=t,e):n},e.range=function(t){return arguments.length?(i=Ae(t),e):i},e.bins=function(t){return arguments.length?(r="number"==typeof t?function(e){return tr(e,t)}:Ae(t),e):r},e.frequency=function(n){return arguments.length?(t=!!n,e):t},e},Ca.layout.pack=function(){function e(e,a){var s=n.call(this,e,a),o=s[0],l=r[0],c=r[1],u=null==t?Math.sqrt:"function"==typeof t?t:function(){return t};if(o.x=o.y=0,Vi(o,function(e){e.r=+u(e.value)}),Vi(o,or),i){var d=i*(t?1:Math.max(2*o.r/l,2*o.r/c))/2;Vi(o,function(e){e.r+=d}),Vi(o,or),Vi(o,function(e){e.r-=d})}return ur(o,l/2,c/2,t?1:1/Math.max(2*o.r/l,2*o.r/c)),s}var t,n=Ca.layout.hierarchy().sort(ir),i=0,r=[1,1];return e.size=function(t){return arguments.length?(r=t,e):r},e.radius=function(n){return arguments.length?(t=null==n||"function"==typeof n?n:+n,e):t},e.padding=function(t){return arguments.length?(i=+t,e):i},Fi(e,n)},Ca.layout.tree=function(){function e(e,r){var u=s.call(this,e,r),d=u[0],h=t(d);if(Vi(h,n),h.parent.m=-h.z,Bi(h,i),c)Bi(d,a);else{var p=d,f=d,g=d;Bi(d,function(e){e.x<p.x&&(p=e),e.x>f.x&&(f=e),e.depth>g.depth&&(g=e)});var m=o(p,f)/2-p.x,b=l[0]/(f.x+o(f,p)/2+m),v=l[1]/(g.depth||1);Bi(d,function(e){e.x=(e.x+m)*b,e.y=e.depth*v})}return u}function t(e){for(var t,n={A:null,children:[e]},i=[n];null!=(t=i.pop());)for(var r,a=t.children,s=0,o=a.length;s<o;++s)i.push((a[s]=r={_:a[s],parent:t,children:(r=a[s].children)&&r.slice()||[],A:null,a:null,z:0,m:0,c:0,s:0,t:null,i:s}).a=r);return n.children[0]}function n(e){var t=e.children,n=e.parent.children,i=e.i?n[e.i-1]:null;if(t.length){mr(e);var a=(t[0].z+t[t.length-1].z)/2;i?(e.z=i.z+o(e._,i._),e.m=e.z-a):e.z=a}else i&&(e.z=i.z+o(e._,i._));e.parent.A=r(e,i,e.parent.A||n[0])}function i(e){e._.x=e.z+e.parent.m,e.m+=e.parent.m}function r(e,t,n){if(t){for(var i,r=e,a=e,s=t,l=r.parent.children[0],c=r.m,u=a.m,d=s.m,h=l.m;s=fr(s),r=pr(r),s&&r;)l=pr(l),(a=fr(a)).a=e,(i=s.z+d-r.z-c+o(s._,r._))>0&&(gr(br(s,e,n),e,i),c+=i,u+=i),d+=s.m,c+=r.m,h+=l.m,u+=a.m;s&&!fr(a)&&(a.t=s,a.m+=d-u),r&&!pr(l)&&(l.t=r,l.m+=c-h,n=e)}return n}function a(e){e.x*=l[0],e.y=e.depth*l[1]}var s=Ca.layout.hierarchy().sort(null).value(null),o=hr,l=[1,1],c=null;return e.separation=function(t){return arguments.length?(o=t,e):o},e.size=function(t){return arguments.length?(c=null==(l=t)?a:null,e):c?null:l},e.nodeSize=function(t){return arguments.length?(c=null==(l=t)?null:a,e):c?l:null},Fi(e,s)},Ca.layout.cluster=function(){function e(e,a){var s,o=t.call(this,e,a),l=o[0],c=0;Vi(l,function(e){var t=e.children;t&&t.length?(e.x=yr(t),e.y=vr(t)):(e.x=s?c+=n(e,s):0,e.y=0,s=e)});var u=wr(l),d=_r(l),h=u.x-n(u,d)/2,p=d.x+n(d,u)/2;return Vi(l,r?function(e){e.x=(e.x-l.x)*i[0],e.y=(l.y-e.y)*i[1]}:function(e){e.x=(e.x-h)/(p-h)*i[0],e.y=(1-(l.y?e.y/l.y:1))*i[1]}),o}var t=Ca.layout.hierarchy().sort(null).value(null),n=hr,i=[1,1],r=!1;return e.separation=function(t){return arguments.length?(n=t,e):n},e.size=function(t){return arguments.length?(r=null==(i=t),e):r?null:i},e.nodeSize=function(t){return arguments.length?(r=null!=(i=t),e):r?i:null},Fi(e,t)},Ca.layout.treemap=function(){function e(e,t){for(var n,i,r=-1,a=e.length;++r<a;)i=(n=e[r]).value*(t<0?0:t),n.area=isNaN(i)||i<=0?0:i}function t(n){var a=n.children;if(a&&a.length){var s,o,l,c=d(n),u=[],h=a.slice(),f=1/0,g="slice"===p?c.dx:"dice"===p?c.dy:"slice-dice"===p?1&n.depth?c.dy:c.dx:Math.min(c.dx,c.dy);for(e(h,c.dx*c.dy/n.value),u.area=0;(l=h.length)>0;)u.push(s=h[l-1]),u.area+=s.area,"squarify"!==p||(o=i(u,g))<=f?(h.pop(),f=o):(u.area-=u.pop().area,r(u,g,c,!1),g=Math.min(c.dx,c.dy),u.length=u.area=0,f=1/0);u.length&&(r(u,g,c,!0),u.length=u.area=0),a.forEach(t)}}function n(t){var i=t.children;if(i&&i.length){var a,s=d(t),o=i.slice(),l=[];for(e(o,s.dx*s.dy/t.value),l.area=0;a=o.pop();)l.push(a),l.area+=a.area,null!=a.z&&(r(l,a.z?s.dx:s.dy,s,!o.length),l.length=l.area=0);i.forEach(n)}}function i(e,t){for(var n,i=e.area,r=0,a=1/0,s=-1,o=e.length;++s<o;)(n=e[s].area)&&(n<a&&(a=n),n>r&&(r=n));return i*=i,t*=t,i?Math.max(t*r*f/i,i/(t*a*f)):1/0}function r(e,t,n,i){var r,a=-1,s=e.length,o=n.x,c=n.y,u=t?l(e.area/t):0;if(t==n.dx){for((i||u>n.dy)&&(u=n.dy);++a<s;)(r=e[a]).x=o,r.y=c,r.dy=u,o+=r.dx=Math.min(n.x+n.dx-o,u?l(r.area/u):0);r.z=!0,r.dx+=n.x+n.dx-o,n.y+=u,n.dy-=u}else{for((i||u>n.dx)&&(u=n.dx);++a<s;)(r=e[a]).x=o,r.y=c,r.dx=u,c+=r.dy=Math.min(n.y+n.dy-c,u?l(r.area/u):0);r.z=!1,r.dy+=n.y+n.dy-c,n.x+=u,n.dx-=u}}function a(i){var r=s||o(i),a=r[0];return a.x=0,a.y=0,a.dx=c[0],a.dy=c[1],s&&o.revalue(a),e([a],a.dx*a.dy/a.value),(s?n:t)(a),h&&(s=r),r}var s,o=Ca.layout.hierarchy(),l=Math.round,c=[1,1],u=null,d=xr,h=!1,p="squarify",f=.5*(1+Math.sqrt(5));return a.size=function(e){return arguments.length?(c=e,a):c},a.padding=function(e){function t(t){return Sr(t,e)}if(!arguments.length)return u;var n;return d=null==(u=e)?xr:"function"==(n=typeof e)?function(t){var n=e.call(a,t,t.depth);return null==n?xr(t):Sr(t,"number"==typeof n?[n,n,n,n]:n)}:"number"===n?(e=[e,e,e,e],t):t,a},a.round=function(e){return arguments.length?(l=e?Math.round:Number,a):l!=Number},a.sticky=function(e){return arguments.length?(h=e,s=null,a):h},a.ratio=function(e){return arguments.length?(f=e,a):f},a.mode=function(e){return arguments.length?(p=e+"",a):p},Fi(a,o)},Ca.random={normal:function(e,t){var n=arguments.length;return n<2&&(t=1),n<1&&(e=0),function(){var n,i,r;do{r=(n=2*Math.random()-1)*n+(i=2*Math.random()-1)*i}while(!r||r>1);return e+t*n*Math.sqrt(-2*Math.log(r)/r)}},logNormal:function(){var e=Ca.random.normal.apply(Ca,arguments);return function(){return Math.exp(e())}},bates:function(e){var t=Ca.random.irwinHall(e);return function(){return t()/e}},irwinHall:function(e){return function(){for(var t=0,n=0;n<e;n++)t+=Math.random();return t}}},Ca.scale={};var Ho={floor:ke,ceil:ke};Ca.scale.linear=function(){return Or([0,1],[0,1],di,!1)};var zo={s:1,g:1,p:1,r:1,e:1};Ca.scale.log=function(){return Lr(Ca.scale.linear().domain([0,1]),10,!0,[1,10])};var Go=Ca.format(".0e"),Jo={floor:function(e){return-Math.ceil(-e)},ceil:function(e){return-Math.floor(-e)}};Ca.scale.pow=function(){return Fr(Ca.scale.linear(),1,[0,1])},Ca.scale.sqrt=function(){return Ca.scale.pow().exponent(.5)},Ca.scale.ordinal=function(){return Vr([],{t:"range",a:[[]]})},Ca.scale.category10=function(){return Ca.scale.ordinal().range(Wo)},Ca.scale.category20=function(){return Ca.scale.ordinal().range(Qo)},Ca.scale.category20b=function(){return Ca.scale.ordinal().range(Yo)},Ca.scale.category20c=function(){return Ca.scale.ordinal().range(Ko)};var Wo=[2062260,16744206,2924588,14034728,9725885,9197131,14907330,8355711,12369186,1556175].map(ve),Qo=[2062260,11454440,16744206,16759672,2924588,10018698,14034728,16750742,9725885,12955861,9197131,12885140,14907330,16234194,8355711,13092807,12369186,14408589,1556175,10410725].map(ve),Yo=[3750777,5395619,7040719,10264286,6519097,9216594,11915115,13556636,9202993,12426809,15186514,15190932,8666169,11356490,14049643,15177372,8077683,10834324,13528509,14589654].map(ve),Ko=[3244733,7057110,10406625,13032431,15095053,16616764,16625259,16634018,3253076,7652470,10607003,13101504,7695281,10394312,12369372,14342891,6513507,9868950,12434877,14277081].map(ve);Ca.scale.quantile=function(){return $r([],[])},Ca.scale.quantize=function(){return Ur(0,1,[0,1])},Ca.scale.threshold=function(){return Hr([.5],[0,1])},Ca.scale.identity=function(){return zr([0,1])},Ca.svg={},Ca.svg.arc=function(){function e(){var e=t.apply(this,arguments),a=n.apply(this,arguments),s=i.apply(this,arguments)+Zo,o=r.apply(this,arguments)+Zo,l=(o<s&&(l=s,s=o,o=l),o-s),c=l<is?"0":"1",u=Math.cos(s),d=Math.sin(s),h=Math.cos(o),p=Math.sin(o);return l>=Xo?e?"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"M0,"+e+"A"+e+","+e+" 0 1,0 0,"+-e+"A"+e+","+e+" 0 1,0 0,"+e+"Z":"M0,"+a+"A"+a+","+a+" 0 1,1 0,"+-a+"A"+a+","+a+" 0 1,1 0,"+a+"Z":e?"M"+a*u+","+a*d+"A"+a+","+a+" 0 "+c+",1 "+a*h+","+a*p+"L"+e*h+","+e*p+"A"+e+","+e+" 0 "+c+",0 "+e*u+","+e*d+"Z":"M"+a*u+","+a*d+"A"+a+","+a+" 0 "+c+",1 "+a*h+","+a*p+"L0,0Z"}var t=Gr,n=Jr,i=Wr,r=Qr;return e.innerRadius=function(n){return arguments.length?(t=Ae(n),e):t},e.outerRadius=function(t){return arguments.length?(n=Ae(t),e):n},e.startAngle=function(t){return arguments.length?(i=Ae(t),e):i},e.endAngle=function(t){return arguments.length?(r=Ae(t),e):r},e.centroid=function(){var e=(t.apply(this,arguments)+n.apply(this,arguments))/2,a=(i.apply(this,arguments)+r.apply(this,arguments))/2+Zo;return[Math.cos(a)*e,Math.sin(a)*e]},e};var Zo=-as,Xo=rs-ss;Ca.svg.line=function(){return Yr(ke)};var el=Ca.map({linear:Kr,"linear-closed":function(e){return Kr(e)+"Z"},step:function(e){for(var t=0,n=e.length,i=e[0],r=[i[0],",",i[1]];++t<n;)r.push("H",(i[0]+(i=e[t])[0])/2,"V",i[1]);return n>1&&r.push("H",i[0]),r.join("")},"step-before":Zr,"step-after":Xr,basis:na,"basis-open":function(e){if(e.length<4)return Kr(e);for(var t,n=[],i=-1,r=e.length,a=[0],s=[0];++i<3;)t=e[i],a.push(t[0]),s.push(t[1]);for(n.push(ia(il,a)+","+ia(il,s)),--i;++i<r;)t=e[i],a.shift(),a.push(t[0]),s.shift(),s.push(t[1]),ra(n,a,s);return n.join("")},"basis-closed":function(e){for(var t,n,i=-1,r=e.length,a=r+4,s=[],o=[];++i<4;)n=e[i%r],s.push(n[0]),o.push(n[1]);for(t=[ia(il,s),",",ia(il,o)],--i;++i<a;)n=e[i%r],s.shift(),s.push(n[0]),o.shift(),o.push(n[1]),ra(t,s,o);return t.join("")},bundle:function(e,t){var n=e.length-1;if(n)for(var i,r,a=e[0][0],s=e[0][1],o=e[n][0]-a,l=e[n][1]-s,c=-1;++c<=n;)r=c/n,(i=e[c])[0]=t*i[0]+(1-t)*(a+r*o),i[1]=t*i[1]+(1-t)*(s+r*l);return na(e)},cardinal:function(e,t){return e.length<3?Kr(e):e[0]+ea(e,ta(e,t))},"cardinal-open":function(e,t){return e.length<4?Kr(e):e[1]+ea(e.slice(1,e.length-1),ta(e,t))},"cardinal-closed":function(e,t){return e.length<3?Kr(e):e[0]+ea((e.push(e[0]),e),ta([e[e.length-2]].concat(e,[e[1]]),t))},monotone:function(e){return e.length<3?Kr(e):e[0]+ea(e,oa(e))}});el.forEach(function(e,t){t.key=e,t.closed=/-closed$/.test(e)});var tl=[0,2/3,1/3,0],nl=[0,1/3,2/3,0],il=[0,1/6,2/3,1/6];Ca.svg.line.radial=function(){var e=Yr(la);return e.radius=e.x,delete e.x,e.angle=e.y,delete e.y,e},Zr.reverse=Xr,Xr.reverse=Zr,Ca.svg.area=function(){return ca(ke)},Ca.svg.area.radial=function(){var e=ca(la);return e.radius=e.x,delete e.x,e.innerRadius=e.x0,delete e.x0,e.outerRadius=e.x1,delete e.x1,e.angle=e.y,delete e.y,e.startAngle=e.y0,delete e.y0,e.endAngle=e.y1,delete e.y1,e},Ca.svg.chord=function(){function e(e,o){var l=t(this,a,e,o),c=t(this,s,e,o);return"M"+l.p0+i(l.r,l.p1,l.a1-l.a0)+(n(l,c)?r(l.r,l.p1,l.r,l.p0):r(l.r,l.p1,c.r,c.p0)+i(c.r,c.p1,c.a1-c.a0)+r(c.r,c.p1,l.r,l.p0))+"Z"}function t(e,t,n,i){var r=t.call(e,n,i),a=o.call(e,r,i),s=l.call(e,r,i)+Zo,u=c.call(e,r,i)+Zo;return{r:a,a0:s,a1:u,p0:[a*Math.cos(s),a*Math.sin(s)],p1:[a*Math.cos(u),a*Math.sin(u)]}}function n(e,t){return e.a0==t.a0&&e.a1==t.a1}function i(e,t,n){return"A"+e+","+e+" 0 "+ +(n>is)+",1 "+t}function r(e,t,n,i){return"Q 0,0 "+i}var a=fn,s=gn,o=ua,l=Wr,c=Qr;return e.radius=function(t){return arguments.length?(o=Ae(t),e):o},e.source=function(t){return arguments.length?(a=Ae(t),e):a},e.target=function(t){return arguments.length?(s=Ae(t),e):s},e.startAngle=function(t){return arguments.length?(l=Ae(t),e):l},e.endAngle=function(t){return arguments.length?(c=Ae(t),e):c},e},Ca.svg.diagonal=function(){function e(e,r){var a=t.call(this,e,r),s=n.call(this,e,r),o=(a.y+s.y)/2,l=[a,{x:a.x,y:o},{x:s.x,y:o},s];return"M"+(l=l.map(i))[0]+"C"+l[1]+" "+l[2]+" "+l[3]}var t=fn,n=gn,i=da;return e.source=function(n){return arguments.length?(t=Ae(n),e):t},e.target=function(t){return arguments.length?(n=Ae(t),e):n},e.projection=function(t){return arguments.length?(i=t,e):i},e},Ca.svg.diagonal.radial=function(){var e=Ca.svg.diagonal(),t=da,n=e.projection;return e.projection=function(e){return arguments.length?n(ha(t=e)):t},e},Ca.svg.symbol=function(){function e(e,i){return(rl.get(t.call(this,e,i))||ga)(n.call(this,e,i))}var t=fa,n=pa;return e.type=function(n){return arguments.length?(t=Ae(n),e):t},e.size=function(t){return arguments.length?(n=Ae(t),e):n},e};var rl=Ca.map({circle:ga,cross:function(e){var t=Math.sqrt(e/5)/2;return"M"+-3*t+","+-t+"H"+-t+"V"+-3*t+"H"+t+"V"+-t+"H"+3*t+"V"+t+"H"+t+"V"+3*t+"H"+-t+"V"+t+"H"+-3*t+"Z"},diamond:function(e){var t=Math.sqrt(e/(2*ll)),n=t*ll;return"M0,"+-t+"L"+n+",0 0,"+t+" "+-n+",0Z"},square:function(e){var t=Math.sqrt(e)/2;return"M"+-t+","+-t+"L"+t+","+-t+" "+t+","+t+" "+-t+","+t+"Z"},"triangle-down":function(e){var t=Math.sqrt(e/ol),n=t*ol/2;return"M0,"+n+"L"+t+","+-n+" "+-t+","+-n+"Z"},"triangle-up":function(e){var t=Math.sqrt(e/ol),n=t*ol/2;return"M0,"+-n+"L"+t+","+n+" "+-t+","+n+"Z"}});Ca.svg.symbolTypes=rl.keys();var al,sl,ol=Math.sqrt(3),ll=Math.tan(30*ls),cl=[],ul=0;cl.call=Qa.call,cl.empty=Qa.empty,cl.node=Qa.node,cl.size=Qa.size,Ca.transition=function(e){return arguments.length?al?e.transition():e:Za.transition()},Ca.transition.prototype=cl,cl.select=function(e){var t,n,i,r=this.id,a=[];e=A(e);for(var s=-1,o=this.length;++s<o;){a.push(t=[]);for(var l=this[s],c=-1,u=l.length;++c<u;)(i=l[c])&&(n=e.call(i,i.__data__,c,s))?("__data__"in i&&(n.__data__=i.__data__),ya(n,c,r,i.__transition__[r]),t.push(n)):t.push(null)}return ma(a,r)},cl.selectAll=function(e){var t,n,i,r,a,s=this.id,o=[];e=k(e);for(var l=-1,c=this.length;++l<c;)for(var u=this[l],d=-1,h=u.length;++d<h;)if(i=u[d]){a=i.__transition__[s],n=e.call(i,i.__data__,d,l),o.push(t=[]);for(var p=-1,f=n.length;++p<f;)(r=n[p])&&ya(r,p,s,a),t.push(r)}return ma(o,s)},cl.filter=function(e){var t,n,i,r=[];"function"!=typeof e&&(e=q(e));for(var a=0,s=this.length;a<s;a++){r.push(t=[]);for(var o=0,l=(n=this[a]).length;o<l;o++)(i=n[o])&&e.call(i,i.__data__,o,a)&&t.push(i)}return ma(r,this.id)},cl.tween=function(e,t){var n=this.id;return arguments.length<2?this.node().__transition__[n].tween.get(e):F(this,null==t?function(t){t.__transition__[n].tween.remove(e)}:function(i){i.__transition__[n].tween.set(e,t)})},cl.attr=function(e,t){function n(){this.removeAttribute(a)}function i(){this.removeAttributeNS(a.space,a.local)}if(arguments.length<2){for(t in e)this.attr(t,e[t]);return this}var r="transform"==e?Pi:di,a=Ca.ns.qualify(e);return ba(this,"attr."+e,t,a.local?function(e){return null==e?i:(e+="",function(){var t,n=this.getAttributeNS(a.space,a.local);return n!==e&&(t=r(n,e),function(e){this.setAttributeNS(a.space,a.local,t(e))})})}:function(e){return null==e?n:(e+="",function(){var t,n=this.getAttribute(a);return n!==e&&(t=r(n,e),function(e){this.setAttribute(a,t(e))})})})},cl.attrTween=function(e,t){var n=Ca.ns.qualify(e);return this.tween("attr."+e,n.local?function(e,i){var r=t.call(this,e,i,this.getAttributeNS(n.space,n.local));return r&&function(e){this.setAttributeNS(n.space,n.local,r(e))}}:function(e,i){var r=t.call(this,e,i,this.getAttribute(n));return r&&function(e){this.setAttribute(n,r(e))}})},cl.style=function(e,t,n){function i(){this.style.removeProperty(e)}var r=arguments.length;if(r<3){if("string"!=typeof e){r<2&&(t="");for(n in e)this.style(n,e[n],t);return this}n=""}return ba(this,"style."+e,t,function(t){return null==t?i:(t+="",function(){var i,r=Ra.getComputedStyle(this,null).getPropertyValue(e);return r!==t&&(i=di(r,t),function(t){this.style.setProperty(e,i(t),n)})})})},cl.styleTween=function(e,t,n){return arguments.length<3&&(n=""),this.tween("style."+e,function(i,r){var a=t.call(this,i,r,Ra.getComputedStyle(this,null).getPropertyValue(e));return a&&function(t){this.style.setProperty(e,a(t),n)}})},cl.text=function(e){return ba(this,"text",e,va)},cl.remove=function(){return this.each("end.transition",function(){var e;this.__transition__.count<2&&(e=this.parentNode)&&e.removeChild(this)})},cl.ease=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].ease:("function"!=typeof e&&(e=Ca.ease.apply(Ca,arguments)),F(this,function(n){n.__transition__[t].ease=e}))},cl.delay=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].delay:F(this,"function"==typeof e?function(n,i,r){n.__transition__[t].delay=+e.call(n,n.__data__,i,r)}:(e=+e,function(n){n.__transition__[t].delay=e}))},cl.duration=function(e){var t=this.id;return arguments.length<1?this.node().__transition__[t].duration:F(this,"function"==typeof e?function(n,i,r){n.__transition__[t].duration=Math.max(1,e.call(n,n.__data__,i,r))}:(e=Math.max(1,e),function(n){n.__transition__[t].duration=e}))},cl.each=function(e,t){var n=this.id;if(arguments.length<2){var i=sl,r=al;al=n,F(this,function(t,i,r){sl=t.__transition__[n],e.call(t,t.__data__,i,r)}),sl=i,al=r}else F(this,function(i){var r=i.__transition__[n];(r.event||(r.event=Ca.dispatch("start","end"))).on(e,t)});return this},cl.transition=function(){for(var e,t,n,i,r=this.id,a=++ul,s=[],o=0,l=this.length;o<l;o++){s.push(e=[]);for(var c=0,u=(t=this[o]).length;c<u;c++)(n=t[c])&&((i=Object.create(n.__transition__[r])).delay+=i.duration,ya(n,c,a,i)),e.push(n)}return ma(s,a)},Ca.svg.axis=function(){function e(e){e.each(function(){var e,c=Ca.select(this),u=this.__chart__||n,d=this.__chart__=n.copy(),h=null==l?d.ticks?d.ticks.apply(d,o):d.domain():l,p=null==t?d.tickFormat?d.tickFormat.apply(d,o):ke:t,f=c.selectAll(".tick").data(h,d),g=f.enter().insert("g",".domain").attr("class","tick").style("opacity",ss),m=Ca.transition(f.exit()).style("opacity",ss).remove(),b=Ca.transition(f.order()).style("opacity",1),v=Math.max(r,0)+s,y=Ar(d),w=c.selectAll(".domain").data([0]),_=(w.enter().append("path").attr("class","domain"),Ca.transition(w));g.append("line"),g.append("text");var x,S,E,A,k=g.select("line"),C=b.select("line"),P=f.select("text").text(p),M=g.select("text"),O=b.select("text"),T="top"===i||"left"===i?-1:1;if("bottom"===i||"top"===i?(e=wa,x="x",E="y",S="x2",A="y2",P.attr("dy",T<0?"0em":".71em").style("text-anchor","middle"),_.attr("d","M"+y[0]+","+T*a+"V0H"+y[1]+"V"+T*a)):(e=_a,x="y",E="x",S="y2",A="x2",P.attr("dy",".32em").style("text-anchor",T<0?"end":"start"),_.attr("d","M"+T*a+","+y[0]+"H0V"+y[1]+"H"+T*a)),k.attr(A,T*r),M.attr(E,T*v),C.attr(S,0).attr(A,T*r),O.attr(x,0).attr(E,T*v),d.rangeBand){var R=d,D=R.rangeBand()/2;u=d=function(e){return R(e)+D}}else u.rangeBand?u=d:m.call(e,d,u);g.call(e,u,d),b.call(e,d,d)})}var t,n=Ca.scale.linear(),i=dl,r=6,a=6,s=3,o=[10],l=null;return e.scale=function(t){return arguments.length?(n=t,e):n},e.orient=function(t){return arguments.length?(i=t in hl?t+"":dl,e):i},e.ticks=function(){return arguments.length?(o=arguments,e):o},e.tickValues=function(t){return arguments.length?(l=t,e):l},e.tickFormat=function(n){return arguments.length?(t=n,e):t},e.tickSize=function(t){var n=arguments.length;return n?(r=+t,a=+arguments[n-1],e):r},e.innerTickSize=function(t){return arguments.length?(r=+t,e):r},e.outerTickSize=function(t){return arguments.length?(a=+t,e):a},e.tickPadding=function(t){return arguments.length?(s=+t,e):s},e.tickSubdivide=function(){return arguments.length&&e},e};var dl="bottom",hl={top:1,right:1,bottom:1,left:1};Ca.svg.brush=function(){function e(a){a.each(function(){var a=Ca.select(this).style("pointer-events","all").style("-webkit-tap-highlight-color","rgba(0,0,0,0)").on("mousedown.brush",r).on("touchstart.brush",r),s=a.selectAll(".background").data([0]);s.enter().append("rect").attr("class","background").style("visibility","hidden").style("cursor","crosshair"),a.selectAll(".extent").data([0]).enter().append("rect").attr("class","extent").style("cursor","move");var o=a.selectAll(".resize").data(f,ke);o.exit().remove(),o.enter().append("g").attr("class",function(e){return"resize "+e}).style("cursor",function(e){return pl[e]}).append("rect").attr("x",function(e){return/[ew]$/.test(e)?-3:null}).attr("y",function(e){return/^[ns]/.test(e)?-3:null}).attr("width",6).attr("height",6).style("visibility","hidden"),o.style("display",e.empty()?"none":null);var u,d=Ca.transition(a),h=Ca.transition(s);l&&(u=Ar(l),h.attr("x",u[0]).attr("width",u[1]-u[0]),n(d)),c&&(u=Ar(c),h.attr("y",u[0]).attr("height",u[1]-u[0]),i(d)),t(d)})}function t(e){e.selectAll(".resize").attr("transform",function(e){return"translate("+u[+/e$/.test(e)]+","+d[+/^s/.test(e)]+")"})}function n(e){e.select(".extent").attr("x",u[0]),e.selectAll(".extent,.n>rect,.s>rect").attr("width",u[1]-u[0])}function i(e){e.select(".extent").attr("y",d[0]),e.selectAll(".extent,.e>rect,.w>rect").attr("height",d[1]-d[0])}function r(){function r(){var e=Ca.mouse(v),r=!1;b&&(e[0]+=b[0],e[1]+=b[1]),k||(Ca.event.altKey?(m||(m=[(u[0]+u[1])/2,(d[0]+d[1])/2]),P[0]=u[+(e[0]<m[0])],P[1]=d[+(e[1]<m[1])]):m=null),E&&f(e,l,0)&&(n(x),r=!0),A&&f(e,c,1)&&(i(x),r=!0),r&&(t(x),w({type:"brush",mode:k?"move":"resize"}))}function f(e,t,n){var i,r,o=Ar(t),l=o[0],c=o[1],f=P[n],g=n?d:u,b=g[1]-g[0];if(k&&(l-=f,c-=b+f),i=(n?p:h)?Math.max(l,Math.min(c,e[n])):e[n],k?r=(i+=f)+b:(m&&(f=Math.max(l,Math.min(c,2*m[n]-i))),f<i?(r=i,i=f):r=f),g[0]!=i||g[1]!=r)return n?s=null:a=null,g[0]=i,g[1]=r,!0}function g(){r(),x.style("pointer-events","all").selectAll(".resize").style("display",e.empty()?"none":null),Ca.select("body").style("cursor",null),M.on("mousemove.brush",null).on("mouseup.brush",null).on("touchmove.brush",null).on("touchend.brush",null).on("keydown.brush",null).on("keyup.brush",null),C(),w({type:"brushend"})}var m,b,v=this,y=Ca.select(Ca.event.target),w=o.of(v,arguments),x=Ca.select(v),S=y.datum(),E=!/^(n|s)$/.test(S)&&l,A=!/^(e|w)$/.test(S)&&c,k=y.classed("extent"),C=G(),P=Ca.mouse(v),M=Ca.select(Ra).on("keydown.brush",function(){32==Ca.event.keyCode&&(k||(m=null,P[0]-=u[1],P[1]-=d[1],k=2),_())}).on("keyup.brush",function(){32==Ca.event.keyCode&&2==k&&(P[0]+=u[1],P[1]+=d[1],k=0,_())});if(Ca.event.changedTouches?M.on("touchmove.brush",r).on("touchend.brush",g):M.on("mousemove.brush",r).on("mouseup.brush",g),x.interrupt().selectAll("*").interrupt(),k)P[0]=u[0]-P[0],P[1]=d[0]-P[1];else if(S){var O=+/w$/.test(S),T=+/^n/.test(S);b=[u[1-O]-P[0],d[1-T]-P[1]],P[0]=u[O],P[1]=d[T]}else Ca.event.altKey&&(m=P.slice());x.style("pointer-events","none").selectAll(".resize").style("display",null),Ca.select("body").style("cursor",y.style("cursor")),w({type:"brushstart"}),r()}var a,s,o=S(e,"brushstart","brush","brushend"),l=null,c=null,u=[0,0],d=[0,0],h=!0,p=!0,f=fl[0];return e.event=function(e){e.each(function(){var e=o.of(this,arguments),t={x:u,y:d,i:a,j:s},n=this.__chart__||t;this.__chart__=t,al?Ca.select(this).transition().each("start.brush",function(){a=n.i,s=n.j,u=n.x,d=n.y,e({type:"brushstart"})}).tween("brush:brush",function(){var n=hi(u,t.x),i=hi(d,t.y);return a=s=null,function(r){u=t.x=n(r),d=t.y=i(r),e({type:"brush",mode:"resize"})}}).each("end.brush",function(){a=t.i,s=t.j,e({type:"brush",mode:"resize"}),e({type:"brushend"})}):(e({type:"brushstart"}),e({type:"brush",mode:"resize"}),e({type:"brushend"}))})},e.x=function(t){return arguments.length?(l=t,f=fl[!l<<1|!c],e):l},e.y=function(t){return arguments.length?(c=t,f=fl[!l<<1|!c],e):c},e.clamp=function(t){return arguments.length?(l&&c?(h=!!t[0],p=!!t[1]):l?h=!!t:c&&(p=!!t),e):l&&c?[h,p]:l?h:c?p:null},e.extent=function(t){var n,i,r,o,h;return arguments.length?(l&&(n=t[0],i=t[1],c&&(n=n[0],i=i[0]),a=[n,i],l.invert&&(n=l(n),i=l(i)),i<n&&(h=n,n=i,i=h),n==u[0]&&i==u[1]||(u=[n,i])),c&&(r=t[0],o=t[1],l&&(r=r[1],o=o[1]),s=[r,o],c.invert&&(r=c(r),o=c(o)),o<r&&(h=r,r=o,o=h),r==d[0]&&o==d[1]||(d=[r,o])),e):(l&&(a?(n=a[0],i=a[1]):(n=u[0],i=u[1],l.invert&&(n=l.invert(n),i=l.invert(i)),i<n&&(h=n,n=i,i=h))),c&&(s?(r=s[0],o=s[1]):(r=d[0],o=d[1],c.invert&&(r=c.invert(r),o=c.invert(o)),o<r&&(h=r,r=o,o=h))),l&&c?[[n,r],[i,o]]:l?[n,i]:c&&[r,o])},e.clear=function(){return e.empty()||(u=[0,0],d=[0,0],a=s=null),e},e.empty=function(){return!!l&&u[0]==u[1]||!!c&&d[0]==d[1]},Ca.rebind(e,o,"on")};var pl={n:"ns-resize",e:"ew-resize",s:"ns-resize",w:"ew-resize",nw:"nwse-resize",ne:"nesw-resize",se:"nwse-resize",sw:"nesw-resize"},fl=[["n","e","s","w","nw","ne","se","sw"],["e","w"],["n","s"],[]],gl=Ds.format=Fs.timeFormat,ml=gl.utc,bl=ml("%Y-%m-%dT%H:%M:%S.%LZ");gl.iso=Date.prototype.toISOString&&+new Date("2000-01-01T00:00:00.000Z")?xa:bl,xa.parse=function(e){var t=new Date(e);return isNaN(t)?null:t},xa.toString=bl.toString,Ds.second=Le(function(e){return new Is(1e3*Math.floor(e/1e3))},function(e,t){e.setTime(e.getTime()+1e3*Math.floor(t))},function(e){return e.getSeconds()}),Ds.seconds=Ds.second.range,Ds.seconds.utc=Ds.second.utc.range,Ds.minute=Le(function(e){return new Is(6e4*Math.floor(e/6e4))},function(e,t){e.setTime(e.getTime()+6e4*Math.floor(t))},function(e){return e.getMinutes()}),Ds.minutes=Ds.minute.range,Ds.minutes.utc=Ds.minute.utc.range,Ds.hour=Le(function(e){var t=e.getTimezoneOffset()/60;return new Is(36e5*(Math.floor(e/36e5-t)+t))},function(e,t){e.setTime(e.getTime()+36e5*Math.floor(t))},function(e){return e.getHours()}),Ds.hours=Ds.hour.range,Ds.hours.utc=Ds.hour.utc.range,Ds.month=Le(function(e){return(e=Ds.day(e)).setDate(1),e},function(e,t){e.setMonth(e.getMonth()+t)},function(e){return e.getMonth()}),Ds.months=Ds.month.range,Ds.months.utc=Ds.month.utc.range;var vl=[1e3,5e3,15e3,3e4,6e4,3e5,9e5,18e5,36e5,108e5,216e5,432e5,864e5,1728e5,6048e5,2592e6,7776e6,31536e6],yl=[[Ds.second,1],[Ds.second,5],[Ds.second,15],[Ds.second,30],[Ds.minute,1],[Ds.minute,5],[Ds.minute,15],[Ds.minute,30],[Ds.hour,1],[Ds.hour,3],[Ds.hour,6],[Ds.hour,12],[Ds.day,1],[Ds.day,2],[Ds.week,1],[Ds.month,1],[Ds.month,3],[Ds.year,1]],wl=gl.multi([[".%L",function(e){return e.getMilliseconds()}],[":%S",function(e){return e.getSeconds()}],["%I:%M",function(e){return e.getMinutes()}],["%I %p",function(e){return e.getHours()}],["%a %d",function(e){return e.getDay()&&1!=e.getDate()}],["%b %d",function(e){return 1!=e.getDate()}],["%B",function(e){return e.getMonth()}],["%Y",kt]]),_l={range:function(e,t,n){return Ca.range(Math.ceil(e/n)*n,+t,n).map(Ea)},floor:ke,ceil:ke};yl.year=Ds.year,Ds.scale=function(){return Sa(Ca.scale.linear(),yl,wl)};var xl=yl.map(function(e){return[e[0].utc,e[1]]}),Sl=ml.multi([[".%L",function(e){return e.getUTCMilliseconds()}],[":%S",function(e){return e.getUTCSeconds()}],["%I:%M",function(e){return e.getUTCMinutes()}],["%I %p",function(e){return e.getUTCHours()}],["%a %d",function(e){return e.getUTCDay()&&1!=e.getUTCDate()}],["%b %d",function(e){return 1!=e.getUTCDate()}],["%B",function(e){return e.getUTCMonth()}],["%Y",kt]]);xl.year=Ds.year.utc,Ds.scale.utc=function(){return Sa(Ca.scale.linear(),xl,Sl)},Ca.text=Ce(function(e){return e.responseText}),Ca.json=function(e,t){return Pe(e,"application/json",Aa,t)},Ca.html=function(e,t){return Pe(e,"text/html",ka,t)},Ca.xml=Ce(function(e){return e.responseXML}),"function"==typeof define&&define.amd?define("d3",Ca):"object"==typeof module&&module.exports&&(module.exports=Ca),this.d3=Ca}(),define("es6!js/widgets/facet/toggle_list.jsx",["react","underscore","d3"],function(e,t,n){var i=e.createClass({displayName:"FacetCheckbox",format:function(e){return n.format("s")(e).replace(/\.\d{2,}/,function(e){return e.slice(0,2)}).replace(".0","")},updateFacetSelect:function(e){e.target.checked?(this.props.selectFacet(this.props.id),this.props.reduxState&&2===this.props.reduxState.config.hierMaxLevels&&this.props.toggleFacet(this.props.id,!0)):this.props.unselectFacet(this.props.id)},render:function(){var t=e.createElement("label",{className:"facet-label"},e.createElement("input",{type:"checkbox",onChange:this.updateFacetSelect,checked:this.props.isChecked})," ",e.createElement("span",null,e.createElement("span",{className:"facet-label__title"},this.props.name),e.createElement("span",{className:"facet-label__amount",title:this.props.count},this.format(this.props.count))));return this.props.hierarchical?e.createElement(r,{id:this.props.value,reduxState:this.props.reduxState,currentLevel:this.props.currentLevel+1,showMoreFacets:this.props.showMoreFacets,resetVisibleFacets:this.props.resetVisibleFacets,toggleFacet:this.props.toggleFacet,selectFacet:this.props.selectFacet,unselectFacet:this.props.unselectFacet},t):t},propTypes:{isChecked:e.PropTypes.bool.isRequired,name:e.PropTypes.string.isRequired,count:e.PropTypes.number.isRequired,reduxState:e.PropTypes.object,currentLevel:e.PropTypes.number,showMoreFacets:e.PropTypes.func,resetVisibleFacets:e.PropTypes.func,toggleFacet:e.PropTypes.func,selectFacet:e.PropTypes.func,unselectFacet:e.PropTypes.func}}),r=e.createClass({displayName:"ToggleList",render:function(){var n=1===this.props.currentLevel?this.props.reduxState:this.props.reduxState.facets[this.props.id],r=n.state.open,a=n.state.visible,s=n.pagination.finished||!1,o=t.values(t.pick(this.props.reduxState.facets,n.children)),l="";if("loading"===n.pagination.state?l=e.createElement("span",null,"loading..."):"failure"===n.pagination.state?l=e.createElement("span",null,e.createElement("i",{className:"icon-danger"}),"request failed"):"success"!==n.pagination.state||o.length||(l=e.createElement("span",null,"no data retrieved")),o.length)c=o.slice(0,a).map(function(n){var r={isChecked:this.props.reduxState.state.selected.indexOf(n.value)>-1,name:n.name,count:n.count,hierarchical:this.props.reduxState.config.hierMaxLevels>this.props.currentLevel,value:n.value,id:n.value,selectFacet:this.props.selectFacet,unselectFacet:this.props.unselectFacet};return r.hierarchical&&t.extend(r,t.pick(this.props,["showMoreFacets","resetVisibleFacets","toggleFacet","reduxState","currentLevel"])),e.createElement("li",{key:n.value},e.createElement(i,r))},this);else var c=e.createElement("li",null);var u,d=!s||o.length>a?"btn btn-default btn-xs facet__pagination-button":" hidden",h=a>5?"btn btn-default btn-xs facet__pagination-button":"hidden",p=this.props.currentLevel>1?"facet__list-container facet__list-container--child":"facet__list-container";return r&&(u=e.createElement("div",{className:p},e.createElement("ul",{className:"facet__list"},c),e.createElement("div",{className:"facet__state-message"},l),e.createElement("div",{className:"facet__pagination-container"},e.createElement("button",{className:h,onClick:t.partial(this.props.resetVisibleFacets,this.props.id)},"less"),e.createElement("button",{className:d,onClick:t.partial(this.props.showMoreFacets,this.props.id)},"more")))),e.createElement("div",null,e.createElement("div",{className:"facet__toggle"},e.createElement("i",{className:r?"facet__icon facet__icon--open":"facet__icon facet__icon--closed",onClick:t.partial(this.props.toggleFacet,this.props.id,!r)})," ",this.props.children),u)},propTypes:{reduxState:e.PropTypes.object.isRequired,currentLevel:e.PropTypes.number.isRequired,showMoreFacets:e.PropTypes.func.isRequired,resetVisibleFacets:e.PropTypes.func.isRequired,toggleFacet:e.PropTypes.func.isRequired,selectFacet:e.PropTypes.func.isRequired,unselectFacet:e.PropTypes.func.isRequired}});return r}),define("js/widgets/facet/reducers",["underscore"],function(e){function t(e,n){switch(e||(e=t.getDefaultState()),n.type){case"DATA_REQUESTED":return t.dataRequested(e,n.id);case"DATA_RECEIVED":return t.dataReceived(e,n.data,n.id);case"INCREASE_VISIBLE":return t.increaseVisible(e,n.num,n.id);case"RESET_VISIBLE":return t.resetVisible(e,n.id);case"FACET_SELECTED":return t.facetSelected(e,n.id);case"FACET_UNSELECTED":return t.facetUnselected(e,n.id);case"FACET_TOGGLED":return t.facetToggled(e,n.open,n.id);case"SUBMIT_FILTER":return t.submitFilter(e,n.logicOption);case"RESET_STATE":return t.getDefaultState(e);default:return e}}function n(e){var t=e.split("/");if(t.length>2){var n=t[t.length-2];return n=parseInt(e[0])-1+"/"+n}}function i(t,n,i,r){if(r=r||"state",n){var a={};return a[n]=e.assign({},t.facets[n]),a[n][r]=e.assign({},t.facets[n][r],i),e.assign({},t,{facets:e.assign({},t.facets,a)})}var s=e.assign({},t);return s[r]=e.assign({},t[r],i),s}return t.getActiveFacets=function(e,t){return t.map(function(e){return!(t.indexOf(n(e))>-1)&&e}).filter(function(e){if(e)return e})},t.facetSelected=function(t,n){var i=t.facets[n].state.visible,r=e.unique(t.state.selected.concat(t.facets[n].children.slice(0,i).concat([n]))),a=e.filter(e.pairs(t.facets),function(e){return e[1].children.indexOf(n)>-1});if(a.length){a=a[0][0];var s=t.facets[a],o=s.children.slice(0,s.state.visible);e.intersection(r,o).length===o.length&&(r=r.concat([a]))}return e.assign({},t,{state:e.assign({},t.state,{selected:r})})},t.facetUnselected=function(t,i){var r=e.without(t.state.selected,i),a=n(i);return a&&(r=e.without(r,a)),r=e.without.apply(void 0,[r].concat(t.facets[i].children)),e.assign({},t,{state:e.assign({},t.state,{selected:r})})},t.resetVisible=function(e,t){return i(e,t,{visible:5})},t.increaseVisible=function(e,t,n){return i(e,n,n?{visible:e.facets[n].state.visible+t}:{visible:e.state.visible+t})},t.facetToggled=function(e,t,n){return i(e,n,{open:t})},t.dataRequested=function(t,n){if(n)r=e.assign({},t.facets[n].pagination,{state:"loading"});else var r=e.assign({},t.pagination,{state:"loading"});return i(t,n,r,"pagination")},t.processData=function(n,i){i=i||[],e.isFunction(i)&&(i=[i]);var n=n.map(function(i,r){if(r%2==0)return{name:i.split("/")[i.split("/").length-1],value:i,count:n[r+1],pagination:e.assign({},e.cloneDeep(t.defaultState.pagination)),children:[],state:e.assign({},e.cloneDeep(t.defaultState.state))}}).filter(function(e){if(e)return e});return i.reduce(function(e,t){return t(e)},n)},t.dataReceived=function(n,i,r){var a=i.facet_counts.facet_fields[Object.keys(i.facet_counts.facet_fields)[0]],s=a.length/2!=parseInt(i.responseHeader.params["facet.limit"]),o=(a=t.processData(a,n.config.preprocessors)).map(function(e){return e.value});if(a=e.object(o,a),r){var l=e.assign({},n.facets[r],{children:n.facets[r].children.concat(o),pagination:e.assign({},n.facets[r].pagination,{state:"success",finished:s})}),c=e.assign({},n.facets,a);if(c[r]=l,n.state.selected.indexOf(r)>-1)u=e.uniq(n.state.selected.concat(o.slice(0,n.facets[r].state.visible)));else var u=n.state.selected;return e.assign({},n,{facets:c,state:e.assign({},n.state,{selected:u})})}return e.assign({},n,{pagination:e.assign({},n.pagination,{state:"success",finished:s}),facets:e.assign({},n.facets,a),children:n.children.concat(o)})},t.submitFilter=function(e){throw new Error("this should be overridden by the widget")},t.defaultState={config:{preprocessors:[],hierMaxLevels:1,facetField:void 0,openByDefault:!1},state:{open:!1,visible:5,selected:[]},pagination:{state:void 0,finished:!1},children:[],facets:{}},t.getDefaultState=function(t){return e.assign({},this.defaultState,{config:t.config})},t}),define("es6!js/widgets/facet/facet-container.jsx",["react","react-redux","underscore","es6!./toggle_list.jsx","./reducers"],function(e,t,n,i,r){var a=e.createClass({displayName:"ContainerComponent",createDropdown:function(){if(0===this.props.activeFacets.length)return"";var t;return this.props.activeFacets.length>25?e.createElement("div",{className:"facet__dropdown"},"select no more than 25 facets at a time"):"invalid choice"==(t=1===this.props.activeFacets.length?this.props.reduxState.config.logicOptions.single:this.props.reduxState.config.logicOptions.multiple)[0]?e.createElement("div",{className:"facet__dropdown"},"invalid choice!"):e.createElement("div",{className:"facet__dropdown"},e.createElement("div",{className:"facet__dropdown__title"},e.createElement("b",null,this.props.activeFacets.length)," selected"),t.map(function(t){return e.createElement("label",{key:t},e.createElement("input",{type:"radio",onChange:n.partial(this.props.submitFilter,t)})," ",t)},this))},render:function(){var t=e.createElement("h3",{className:"facet__header",onClick:n.partial(this.props.toggleFacet,void 0)},this.props.reduxState.config.facetTitle);return e.createElement("div",{className:"facet__container"},e.createElement(e.addons.CSSTransitionGroup,{transitionName:"swoop",transitionEnterTimeout:300,transitionLeaveTimeout:300},this.createDropdown()),e.createElement(i,{reduxState:this.props.reduxState,currentLevel:1,showMoreFacets:this.props.showMoreFacets,resetVisibleFacets:this.props.resetVisibleFacets,toggleFacet:this.props.toggleFacet,selectFacet:this.props.selectFacet,unselectFacet:this.props.unselectFacet},t))}});return t.connect(function(e,t){return{reduxState:e,activeFacets:r.getActiveFacets(e,e.state.selected)}},function(e,t){return{selectFacet:function(n){e(t.actions.select_facet(n))},unselectFacet:function(n){e(t.actions.unselect_facet(n))},toggleFacet:function(n,i){e(t.actions.toggle_facet(n,i))},showMoreFacets:function(n){e(t.actions.increase_visible(n))},resetVisibleFacets:function(n){e(t.actions.reset_visible(n))},submitFilter:function(n){e(t.actions.submit_filter(n))}}})(a)}),define("js/widgets/facet/actions",["underscore"],function(e){var t={};return t.data_requested=function(e){return{type:"DATA_REQUESTED",id:e}},t.reset_visible=function(e){return{type:"RESET_VISIBLE",id:e}},t.increase_visible=function(e){return function(n,i){(e?i().facets[e].children.length:i().children.length)-((e?i().facets[e].state.visible:i().state.visible)+5)<=5&&n(this.fetch_data(e)),n({type:"INCREASE_VISIBLE",id:e,num:5}),i().state.selected.indexOf(e)>-1&&n(t.select_facet(e))}.bind(this)},t.data_received=function(e,t){return{type:"DATA_RECEIVED",data:e,id:t}},t.toggle_facet=function(t,n){return function(i,r){var a=t?r().facets[t].state.open:r().state.open;n=e.isBoolean(n)?n:!a;var s=t?r().facets[t].children.length:r().children.length;n&&!s&&i(this.fetch_data(t)),i({type:"FACET_TOGGLED",open:n,id:t})}.bind(this)},t.fetch_data=function(e,t){throw new Error("this was supposed to be overridden!")},t.select_facet=function(e){return{type:"FACET_SELECTED",id:e}},t.unselect_facet=function(e){return{type:"FACET_UNSELECTED",id:e}},t.submit_filter=function(e){throw new Error("this was supposed to be overridden!")},t.reset_state=function(){return{type:"RESET_STATE"}},function(){return Object.create(t)}}),function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("redux-thunk",[],t):"object"==typeof exports?exports.ReduxThunk=t():e.ReduxThunk=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(1)},function(e,t){"use strict";function n(e){return function(t){var n=t.dispatch,i=t.getState;return function(t){return function(r){return"function"==typeof r?r(n,i,e):t(r)}}}}t.__esModule=!0;var i=n();i.withExtraArgument=n,t.default=i}])}),define("js/widgets/facet/create_store",["underscore","redux","redux-thunk","js/widgets/facet/reducers"],function(e,t,n,i){return function(r){var r={config:e.assign({},i.defaultState.config,r)},a=e.assign({},e.cloneDeep(i.defaultState),r);return t.createStore(i,a,t.applyMiddleware(n.default))}}),define("js/widgets/facet/widget",["backbone","js/components/api_query","js/components/api_request","js/widgets/base/base_widget","js/components/api_query_updater","analytics","react","react-dom","react-redux","es6!./facet-container.jsx","./actions","./reducers","./create_store"],function(e,t,n,i,r,a,s,o,l,c,u,d,h){var p=e.View.extend({render:function(e,t){return o.render(s.createElement(l.Provider,{store:e},s.createElement(c,{actions:t})),this.el),this},destroy:function(){o.unmountComponentAtNode(this.el)}});return i.extend({initialize:function(e){e=e||{};var t=_.pick(e,["facetTitle","facetField","preprocessors","hierMaxLevels","logicOptions","openByDefault"]);this.defaultQueryArguments=_.extend({},this.defaultQueryArguments,e.defaultQueryArguments,{"facet.field":e.facetField}),this.store=h(t),this.actions=u(),this.queryUpdater=new r(t.facetField),this.actions.fetch_data=function(e){return this._dispatchRequest.bind(this,e)}.bind(this),this.actions.submit_filter=function(e){return this.submitFilter.bind(this,e)}.bind(this),this.view=new p,this.view.render=_.partial(this.view.render,this.store,this.actions)},defaultQueryArguments:{facet:"true","facet.mincount":"1","facet.limit":20,fl:"id"},activate:function(e){this.setBeeHive(e),_.bindAll(this,"dispatchRequest","processResponse"),this.getPubSub().subscribe(this.getPubSub().INVITING_REQUEST,this.dispatchRequest)},dispatchRequest:function(e){this.setCurrentQuery(e),this.store.dispatch(this.actions.reset_state()),this.store.getState().config.openByDefault&&this.store.dispatch(this.actions.toggle_facet(void 0,!0))},_dispatchRequest:function(e){var t=this.getPubSub(),n=this;this.store.dispatch(this.actions.data_requested(e)),t.subscribeOnce(t.DELIVERING_RESPONSE,function(t){n.store.dispatch(n.actions.data_received(t.toJSON(),e))});var i=this.customizeQuery(this.getCurrentQuery()),r=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;i.set("facet.offset",r),i.set("rows",1),e&&i.set("facet.prefix",e.replace("0/","1/"));var a=this.composeRequest(i);t.publish(t.DELIVERING_REQUEST,a)},submitFilter:function(e){if(-1===["and","or","limit to","expand","exclude"].indexOf(e))throw new Error("we don't recognize this operator you're trying to filter on");var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n.replace("_facet_hier",""),r=d.getActiveFacets(this.store.getState(),this.store.getState().state.selected).map(function(e){return n+':"'+e+'"'});"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",r):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",r):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",r):(r.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",r)));var s="{!type=aqp v=$"+i+"}",o=t.get("fq")||[];o.push(s),t.set("fq",_.unique(o)),t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),a("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:r}))}})}),define("js/widgets/facet/graph-facet/widget",["js/components/api_query","js/components/api_request","js/widgets/base/base_widget","js/components/api_query_updater"],function(e,t,n,i){return n.extend({initialize:function(e){e=e||{},this.processResponse=e.processResponse,this.model=new Backbone.Model,this.view=new e.graphView(_.extend(e.graphViewOptions,{model:this.model})),this.listenTo(this.view,"all",this.onAllInternalEvents),this.facetField=e.facetField,this.queryUpdater=new i(this.facetField),n.prototype.initialize.apply(this,arguments),this.listenTo(this.view,"facet-applied",this.handleConditionApplied)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"dispatchRequest","processResponse"),this.getPubSub().subscribe(this.getPubSub().INVITING_REQUEST,this.dispatchRequest),this.getPubSub().subscribe(this.getPubSub().DELIVERING_RESPONSE,this.processResponse)},dispatchRequest:function(e){this.model.unset("graphData");var t=this.customizeQuery(e),n=this.composeRequest(t);this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,n)},handleConditionApplied:function(e){var t=this.getCurrentQuery();e=this.facetField+":"+e,t=t.clone();this.queryUpdater.updateQuery(t,"q","limit",e),this.dispatchNewQuery(t)}})}),define("js/widgets/facet/factory",["js/widgets/facet/widget","js/widgets/facet/graph-facet/widget"],function(e,t){return{makeBasicCheckboxFacet:function(t){var n={facetTitle:t.facetTitle,displayNum:5,maxDisplayNum:100,facetField:t.facetField,openByDefault:!1,showOptions:!0,hierMaxLevels:1};return new e(_.extend(n,t))},makeHierarchicalCheckboxFacet:function(e){return e.hierMaxLevels=2,e.defaultQueryArguments=e.defaultQueryArguments||{},e.defaultQueryArguments["facet.prefix"]="0/",this.makeBasicCheckboxFacet.apply(this,arguments)},makeGraphFacet:function(e){return e=_.extend({openByDefault:!0},e),new t(e)}}}),define("js/page_managers/toc_widget",["backbone","marionette"],function(e,t){var n=e.Model.extend({defaults:function(){return{id:void 0,path:void 0,title:void 0,showCount:!1,category:void 0,isActive:!1,isSelected:!1,numFound:0,showCount:!0,alwaysThere:!1}}}),i=e.Collection.extend({model:n,selectOne:function(e){var t=null;this.each(function(n){n.id==e?t=n:n.set("isSelected",!1,{silent:!0})}),t.set("isSelected",!0)},comparator:function(e){return e.get("order")}}),r=e.Model.extend({defaults:function(){return{bibcode:void 0,query:void 0}}});return t.ItemView.extend({initialize:function(e){e=e||{},this.collection=e.collection||new i,this.model=e.model||new r,this.on("page-manager-message",this.onPageManagerMessage),e.template||(this.template=function(){return""})},noDetach:!0,serializeData:function(){var e,t=this.model.toJSON(),n=this.collection.toJSON();return _.find(n,function(e){return void 0!==e.category})?(e=_.groupBy(this.collection.toJSON(),function(e){return e.category}),t=_.extend(t,e)):t=_.extend(t,{tabs:n}),t},events:{"click a":"navigateToPage"},navigateToPage:function(e){var t=$(e.currentTarget),n=t.attr("data-widget-id"),i={idAttribute:n};if(t.find("div").hasClass("s-nav-inactive"))return!1;if(n!==this.$(".s-nav-selected").attr("data-widget-id")){i.href=t.attr("href");var r=n.indexOf("__")>-1?n.split("__"):void 0;r&&(i.idAttribute=r[0],i.subView=r[1]),this.trigger("page-manager-event","widget-selected",i),this.$el.parent(".nav-container").removeClass("show"),$("button.toggle-menu").html(' <i class="fa fa-bars"></i> Show Menu')}return!1},modelEvents:{"change:bibcode":"resetActiveStates",change:"render"},collectionEvents:{add:"render","change:isActive":"render","change:isSelected":"render","change:numFound":"render"},resetActiveStates:function(){this.collection.each(function(e){e.get("alwaysThere")?e.set("isActive",!0):(e.set("isActive",!1),e.set("numFound",0))})},onPageManagerMessage:function(e,n){if("new-widget"==e){var i=arguments[1],r=t.getOption(this,"navConfig"),a=r[i];if(a){var s=_.extend(_.clone(a),{id:i});this.collection.add(s)}else{var o=_.pick(r,function(e,t){return t.split("__")&&t.split("__")[0]==i});_.each(o,function(e,t){var n=_.extend(_.clone(e),{id:t});this.collection.add(n)},this)}}else if("widget-ready"==e){var l=this.collection.get(n.widgetId);_.defaults(n,{isActive:!!n.numFound}),l&&l.set(_.pick(n,l.keys()))}else"broadcast-payload"===e&&this.model.set("bibcode",n.bibcode)}})}),define("js/page_managers/toc_controller",["marionette","./controller","./toc_widget"],function(e,t,n){return t.extend({createView:function(e){return this.pageConfig?new this.pageConfig.view(_.extend(e,{template:this.pageConfig.template})):t.prototype.createView.call(this,e)},assemble:function(i){if(!this.navConfig)throw new Error("TOC widget is being assembled without navigation configuration (navConfig)");if(!this.assembled){t.prototype.assemble.apply(this,arguments);var r=e.getOption(this,"TOCTemplate");this.TOCEvents?this.widgets.tocWidget=new n({template:r,events:e.getOption(this,"TOCEvents"),navConfig:e.getOption(this,"navConfig")}):this.widgets.tocWidget=new n({template:r,navConfig:e.getOption(this,"navConfig")}),this.view.$(".nav-container").append(this.widgets.tocWidget.render().el),_.each(_.keys(this.widgets),function(e){this.listenTo(this.widgets[e],"page-manager-event",_.bind(this.onPageManagerEvent,this,this.widgets[e])),this.broadcast("page-manager-message","new-widget",e)},this)}},onPageManagerEvent:function(e,t,n){n=n||{};var i=null,r=null;e&&_.each(_.pairs(this.widgets),function(t){t[1]===e&&(r=t[0],i=t[1])}),"widget-ready"==t&&null!==i?(n.widgetId=r,this.broadcast("page-manager-message",t,n)):"widget-selected"==t?this.getPubSub().publish(this.getPubSub().NAVIGATE,n.idAttribute,n):"broadcast-payload"==t?this.broadcast("page-manager-message",t,n):"navigate"==t?this.getPubSub().publish(this.getPubSub().NAVIGATE,n.navCommand,n.sub):"apply-function"==t&&n.func.apply(this)},setActive:function(e,t){t&&this.widgets[e].setSubView instanceof Function&&this.widgets[e].setSubView(t),t&&(e=e+"__"+t),this.widgets.tocWidget.collection.selectOne(e)},onDestroy:function(){this.stopListening(),this.widgets={},this.view.destroy()}})}),define("js/page_managers/one_column_view",["marionette","js/widgets/base/base_widget"],function(e){return e.ItemView.extend({initialize:function(e){var e=e||{};this.widgets=e.widgets},onRender:function(){}})}),define("hbs!js/wraps/landing_page_manager/landing-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="landing-page-layout" class="s-landing-page-layout">\n   <div class="s-starry-background-wrapper">\n    <section class="s-logo-header">\n        <div>\n                <img src="styles/img/transparent_logo.svg" alt="The Astrophysics Data System Logo"/>\n                <b>astrophysics</b>&nbsp;data system\n        </div>\n     </section>\n       <div  class="nav-container s-landing-nav-container">\n       </div>\n   </div>\n\n    <section class="s-search-bar-row  row">\n\n                \x3c!-- <div class="unobtrusive-landing-page-alert">\n                    <b>\n                        <a href="http://zenodo.org/communities/about/astrothesis/" target="_blank">\n                            <i class="fa fa-graduation-cap"></i>\n                            Learn how to contribute your thesis to the ADS Astronomy Thesis Collection\n                        </a>\n                    </b>\n                </div> --\x3e\n\n                <div class="search-bar-rows-container s-search-bar-rows-container">\n                    <br/>\n                    <br/>\n                    <div data-widget="SearchWidget"/>\n                    <div data-widget="ClassicSearchForm"/>\n                    <div data-widget="PaperSearchForm"/>\n                    <br/>\n                </div>\n\n                <div class="landing-faq row" >\n                  <a href="#classic-form">\n                  <div class="col-sm-4">\n                      <i class="fa fa-life-ring fa-2x"></i>\n                    <div>\n                      Use a classic ADS-style form\n                    </div>\n                  </div>\n                  </a>\n                  <a href="https://adsabs.github.io/help/search/search-syntax" target="_blank">\n                    <div class="col-sm-4">\n\n                      <i class="fa fa-search fa-2x"></i>\n                    <div>\n                       Learn more about searching the ADS\n                    </div>\n                  </div>\n                  </a>\n                  <a href="https://github.com/adsabs/adsabs-dev-api" target="_blank">\n                  <div class="col-sm-4">\n\n                      <i class="fa fa-code fa-2x"></i>\n                    <div>\n                      Access ADS data with our API\n                    </div>\n                  </div>\n                  </a>\n                </div>\n\n    </section>\n\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/landing_page_manager/landing-page-layout",n),n}),define("hbs!js/wraps/landing_page_manager/landing-page-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'            <li class="landing-tab '+(null!=(r=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <a href="'+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n                    '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+'\n                    <span class="hidden-xs">\n                        Form\n                    </span>\n                </a>\n            </li>\n'},2:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\n<nav class="s-landing-tabs">\n'+(null!=(r=t.each.call(e,null!=e?e.tabs:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n</nav>"},useData:!0});return t.registerPartial("js/wraps/landing_page_manager/landing-page-nav",n),n}),define("js/wraps/landing_page_manager/landing_page_manager",["js/page_managers/toc_controller","js/page_managers/one_column_view","hbs!js/wraps/landing_page_manager/landing-page-layout","hbs!js/wraps/landing_page_manager/landing-page-nav"],function(e,t,n,i){return e.extend({TOCTemplate:i,className:"s-landing-page-layout",id:"landing-page-layout",pageConfig:{template:n,view:t},navConfig:{ClassicSearchForm:{title:"Classic",order:1,path:"/",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="290px" height="246px" viewBox="0 0 290 246" version="1.1"><title>Artboard 1</title><desc>Created with Sketch.</desc><g stroke="none" stroke-width="5" fill="none" fill-rule="evenodd"><g class="svg-needs-stroke" stroke-width="5" fill="#FFFFFF" fill-opacity="0"><g transform="translate(80.000000, 53.000000)"><rect x="0" y="0" width="129.999945" height="139.429993"/><rect x="13.4714969" y="24.9222692" width="42.4352152" height="24.9222692"/><rect x="74.0932328" y="24.9222692" width="42.4352152" height="24.9222692"/><rect x="13.4714969" y="61.2953108" width="103.056951" height="16.1657963"/><rect x="13.4714969" y="89.5854542" width="103.056951" height="33.0051673"/></g></g></g></svg>'},SearchWidget:{title:"Modern",order:2,path:"/",isSelected:"true",svg:'<svg class="modern-search" xmlns="http://www.w3.org/2000/svg" width="172px" height="28px" viewBox="0 0 172 28" version="1.1"><title>Rectangle 8 + Rectangle 8</title><desc>Created with Sketch.</desc><g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd"><g transform="translate(-40.000000, -82.000000)" class="svg-needs-fill"><g transform="translate(40.000000, 82.000000)"><path d="M4.26325641e-14 0L4.26325641e-14 27.0939606 164.990643 27.0939606C168.867791 27.0939606 172 23.9622017 172 20.0989813L172 6.9949793C172 3.13448997 168.861804 0 164.990643 0L4.26325641e-14 0ZM164.990643 3C167.205202 3 169 4.7916 169 6.9949793L169 20.0989813C169 22.3064289 167.209851 24.0939606 164.990643 24.0939606L3 24 3 3 164.990643 3Z"/><g transform="translate(147.000000, 6.000000)"><path d="M10.6047437 11.077395C9.59359708 11.8615052 8.32401807 12.3282675 6.9454209 12.3282675 3.64463092 12.3282675 0.968811942 9.65244849 0.968811942 6.35165851 0.968811942 3.05086853 3.64463092 0.375049553 6.9454209 0.375049553 10.2462109 0.375049553 12.9220299 3.05086853 12.9220299 6.35165851 12.9220299 7.26156094 12.7186956 8.12397211 12.354987 8.89593202L17.4624135 13.6586842C17.4624135 13.6586842 17.5766368 15.1532905 17.3179164 15.4307342 16.9425866 15.8332262 15.5602627 15.6984912 15.5602627 15.6984912L10.6047437 11.077395 10.6047437 11.077395ZM6.9454209 10.3360645C9.14594755 10.3360645 10.9298269 8.55218516 10.9298269 6.35165851 10.9298269 4.15113185 9.14594755 2.36725254 6.9454209 2.36725254 4.74489424 2.36725254 2.96101493 4.15113185 2.96101493 6.35165851 2.96101493 8.55218516 4.74489424 10.3360645 6.9454209 10.3360645Z"/></g><path d="M138 2.5L138 25.5 138 27 141 27 141 25.5 141 2.5 141 1 138 1 138 2.5 138 2.5Z"/></g></g></g></svg>'},PaperSearchForm:{title:"Paper",order:3,path:"/",svg:'<svg xmlns="http://www.w3.org/2000/svg" width="290px" height="246px" viewBox="0 0 290 246" version="1.1"><title>Artboard 1 Copy 2</title><desc>Created with Sketch.</desc><g stroke="none" stroke-width="2" fill="none" fill-rule="evenodd"><g><g transform="translate(80.000000, 50.000000)"><path d="M11.1420871 139.441341L0 139.441341 0 0 119.984612 0 119.984612 8.26117318" class="svg-needs-stroke"stroke-width="5" fill-opacity="0" /><g transform="translate(9.289131, 6.536313)"><rect class="svg-needs-stroke"stroke-width="5" fill-opacity="0"  x="0" y="0" width="119.984612" height="139.441341"/><rect class="svg-needs-fill" x="13.8443783" y="27.5977654" width="92.2958552" height="5.81005587"/><rect class="svg-needs-fill" x="13.8443783" y="41.396648" width="92.2958552" height="5.81005587"/><rect class="svg-needs-fill" x="13.8443783" y="55.9217877" width="92.2958552" height="5.81005587"/></g></g></g></g></svg>'}}})}),define("js/wraps/results_page_manager",["js/page_managers/controller","js/page_managers/three_column_view","hbs!js/page_managers/templates/results-page-layout"],function(e,t,n){return e.extend({persistentWidgets:["PubtypeFacet","SearchWidget","BreadcrumbsWidget","Sort","ExportDropdown","VisualizationDropdown","AuthorFacet","DatabaseFacet","RefereedFacet","KeywordFacet","BibstemFacet","BibgroupFacet","DataFacet","VizierFacet","GrantsFacet","Results","OrcidBigWidget","QueryInfo","GraphTabs"],createView:function(e){return e=e||{},e.template=e.template||n,new t({template:n})}})}),define("hbs!js/wraps/abstract_page_manager/abstract-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'                <a href="" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left"></i> Back to results</a>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div id="abstract-page-layout" class="s-abstract-page-layout">\n\n    <div class="row s-stable-search-bar-height">\n        <div class="s-search-bar-full-width-container">\n            <div class="col-xs-0 col-sm-12 col-md-2 s-back-button-container">\n'+(null!=(r=t.if.call(e,null!=e?e.query:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'            </div>\n            <div class="col-xs-12 col-sm-9 col-md-7 s-search-bar-row" id="search-bar-row" data-widget="SearchWidget"></div>\n        </div>\n    </div>\n    <div class="row nav-button-container s-nav-button-container">\n       <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n     </div>\n    <div class="row s-dynamic-page-body" id="dynamic-page-body">\n        <div class="s-abstract-content">\n\n            <div class="col-sm-2 nav-container s-nav-container" id="left-column"> </div>\n\n            <div class="col-sm-9 col-md-7 s-middle-column" id="middle-column">\n                \x3c!--id is for screen readers--\x3e\n                <div class="main-content-container s-main-content-container" id="main-content" tabindex="-1">\n                    <div class="print-visible"><h2 style="margin-left:6.1%;">NASA/ADS</h2> </div>\n\n                    <div id="abstract-title-container" class="s-abstract-title-container"></div>\n                    <div id="current-subview">\n                        <div data-widget="ShowAbstract"/>\n                        <div data-widget="ShowCitations"/>\n                        <div data-widget="ShowReferences"/>\n                        <div data-widget="ShowCoreads"/>\n                        <div data-widget="ShowTableOfContents"/>\n                        <div data-widget="ShowSimilar" data-debug="true"/>\n                        <div data-widget="ShowGraphics" />\n                        <div data-widget="ShowPaperExport"/>\n                        <div data-widget="ShowMetrics" data-allow-redirect="false"/>\n                        <div data-widget="MetaTagsWidget"></div>\n                    </div>\n                </div>\n            </div>\n\n            <div class="s-right-col-container col-sm-3 s-right-column" id="right-col-container">\n                <div data-widget="ShowResources"/>\n                <div data-widget="ShowLibraryAdd"/>\n                <div data-widget="ShowGraphicsSidebar"/>\n                <div data-widget="ShowRecommender"/>\n\n            </div>\n\n\n        </div>\n    </div>\n</div>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/abstract_page_manager/abstract-page-layout",n),n}),define("hbs!js/wraps/abstract_page_manager/abstract-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i,r,a){var s;return'\n    <a href="/abs/'+this.escapeExpression(this.lambda(null!=a[1]?a[1].bibcode:a[1],e))+"/"+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" '+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(2,i,0,r,a),inverse:this.noop,data:i}))?s:"")+' data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n    <div class="abstract-nav s-nav '+(null!=(s=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(4,i,0,r,a),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(6,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'">\n            <span class="s-content">\n            '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n"+(null!=(s=t.if.call(e,null!=e?e.showCount:e,{name:"if",hash:{},fn:this.program(8,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"            </span>\n    </div>\n    </a>\n\n"},2:function(e,t,n,i){return' aria-disabled="true" '},4:function(e,t,n,i){return" s-nav-selected "},6:function(e,t,n,i){return" s-nav-inactive "},8:function(e,t,n,i){var r;return'            <span class="num-items"> '+(null!=(r=t.if.call(e,null!=e?e.numFound:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+"</span>\n"},9:function(e,t,n,i){return"("+this.escapeExpression(this.lambda(null!=e?e.numFound:e,e))+")"},11:function(e,t,n,i,r,a){var s;return'\n    <a href="/abs/'+this.escapeExpression(this.lambda(null!=a[1]?a[1].bibcode:a[1],e))+"/"+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" '+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(2,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'  data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n    <div class="abstract-nav s-nav '+(null!=(s=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(4,i,0,r,a),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(6,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'">\n            <span class="s-content">\n            '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n            </span>\n    </div>\n    </a>\n\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,r,a){var s;return'\n<nav>\n    <div class="s-nav-header s-view-nav"> <i class="icon-list"></i> <h3>view </h3> </div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.view:e,{name:"each",hash:{},fn:this.program(1,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'\n\n    <div class="s-nav-header s-export-nav"><i class="icon-export"></i>  <h3>export</h3></div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.export:e,{name:"each",hash:{},fn:this.program(11,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"\n\n\n</nav>\n"},useData:!0,useDepths:!0});return t.registerPartial("js/wraps/abstract_page_manager/abstract-nav",n),n}),define("js/wraps/abstract_page_manager/abstract_page_manager",["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/abstract_page_manager/abstract-page-layout","hbs!js/wraps/abstract_page_manager/abstract-nav"],function(e,t,n,i){return e.extend({persistentWidgets:["SearchWidget","ShowAbstract","ShowCitations","ShowReferences","tocWidget"],TOCTemplate:i,createView:function(e){return e=e||{},e.template=e.template||n,new t({template:n})},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets});var t=this.getPubSub();t.subscribe(t.DISPLAY_DOCUMENTS,_.bind(this.onDisplayDocuments,this))},assemble:function(t){e.prototype.assemble.apply(this,arguments);var n=t.getObject("AppStorage");n&&n.hasCurrentQuery()&&this.addQuery(n.getCurrentQuery())},addQuery:function(e){this.view.model&&this.view.model.set("query",e.url())},show:function(t){var n=e.prototype.show.apply(this,arguments);return this.view.model&&this.view.model.has("query")&&n.$el.find(".s-back-button-container").empty().html('<a href="#search/'+this.view.model.get("query")+'" class="back-button btn btn-sm btn-default"> <i class="fa fa-arrow-left"></i> Back to results</a>'),n},onDisplayDocuments:function(e){var t=e.get("q");t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this.widgets.tocWidget.model.set("bibcode",t))},navConfig:{ShowAbstract:{title:"Abstract",path:"abstract",showCount:!1,isSelected:!0,category:"view",alwaysThere:"true"},ShowCitations:{title:"Citations",path:"citations",category:"view"},ShowReferences:{title:"References",path:"references",category:"view"},ShowCoreads:{title:"Co-Reads",path:"coreads",category:"view",showCount:!1},ShowTableOfContents:{title:"Volume Content",path:"tableofcontents",category:"view",showCount:!1},ShowSimilar:{title:"Similar Papers",path:"similar",category:"view"},ShowGraphics:{title:"Graphics",path:"graphics",showCount:!1,category:"view"},ShowMetrics:{title:"Metrics",path:"metrics",showCount:!1,category:"view"},ShowPaperExport__bibtex:{title:"in BibTeX",path:"export/bibtex",category:"export",alwaysThere:"true"},ShowPaperExport__aastex:{title:"in AASTeX",path:"export/aastex",category:"export",alwaysThere:"true"},ShowPaperExport__endnote:{title:"in EndNote",path:"export/endnote",category:"export",alwaysThere:"true"},ShowPaperExport__ris:{title:"in RIS",path:"export/ris",category:"export",alwaysThere:"true"}}})}),define("hbs!js/page_managers/templates/authentication-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="row s-message-control-row" id="message-control-row">\n    <div data-widget="AlertsWidget"/>\n</div>\n<div class="row s-darker-background">\n    <div class="col-sm-12">\n        <div data-widget="Authentication"/>\n\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/page_managers/templates/authentication-page-layout",n),n}),define("js/wraps/authentication_page_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/page_managers/templates/authentication-page-layout"],function(e,t,n){return e.extend({createView:function(e){return e=e||{},e.template=e.template||n,new t({template:n,className:"s-authentication-page-layout s-100-height",id:"user-page-layout"})}})}),define("hbs!js/wraps/user_settings_page_manager/user-settings-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div class="row">\n    <div class="col-sm-12">\n        <div data-widget="UserNavbarWidget"/>\n    </div>\n</div>\n<div class="nav-button-container s-nav-button-container row">\n    <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n</div>\n\n<div class="row s-darker-background">\n\n    <div class="col-sm-2 nav-container s-nav-container"></div>\n\n    <div class="col-sm-10">\n        <div data-widget="LibraryImport"/>\n        <div data-widget="UserSettings"/>\n        <div data-widget="UserPreferences"/>\n    </div>\n</div>\n\n\x3c!--show this when user enters information and navigates away--\x3e\n<div class="modal fade confirm-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">Confirm navigation</h4>\n            </div>\n            <div class="modal-body">\n                <p>You are leaving an unsubmitted form. The data you have entered will be lost. </p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default stay-on-form" data-dismiss="modal"> Stay on form</button>\n                <button type="button" class="btn btn-primary leave-form" data-dismiss="modal"> Leave form</button>\n            </div>\n        </div>\x3c!-- /.modal-content --\x3e\n    </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n'},useData:!0});return t.registerPartial("js/wraps/user_settings_page_manager/user-settings-layout",n),n}),define("hbs!js/wraps/user_settings_page_manager/user_nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'        <a href="#/'+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'"  >\n        <div class="abstract-nav s-nav '+(null!=(r=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <span class="s-content">\n                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n                </span>\n        </div>\n        </a>\n"},2:function(e,t,n,i){return" s-nav-selected "},4:function(e,t,n,i,r,a){var s;return'--\x3e\n            \x3c!--<a href="/abs/'+this.escapeExpression(this.lambda(null!=a[1]?a[1].bibcode:a[1],e))+"/"+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" '+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(5,i,0,r,a),inverse:this.noop,data:i}))?s:"")+' >--\x3e\n            \x3c!--<div class="abstract-nav s-nav '+(null!=(s=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0,r,a),inverse:this.noop,data:i}))?s:"")+" "+(null!=(s=t.unless.call(e,null!=e?e.isActive:e,{name:"unless",hash:{},fn:this.program(7,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">--\x3e\n                        \x3c!--<span class="s-content">--\x3e\n                        \x3c!--'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"--\x3e\n                        \x3c!--"+(null!=(s=t.if.call(e,null!=e?e.showCount:e,{name:"if",hash:{},fn:this.program(9,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"--\x3e\n                        \x3c!--</span>--\x3e\n            \x3c!--</div>--\x3e\n            \x3c!--</a>--\x3e\n        \x3c!--"},5:function(e,t,n,i){return' aria-disabled="true" '},7:function(e,t,n,i){return" s-nav-inactive "},9:function(e,t,n,i){var r;return'--\x3e\n                        \x3c!--<span class="num-items"> '+(null!=(r=t.if.call(e,null!=e?e.numFound:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"</span>--\x3e\n                        \x3c!--"},10:function(e,t,n,i){return"("+this.escapeExpression(this.lambda(null!=e?e.numFound:e,e))+")"},12:function(e,t,n,i){var r;return'\n        <a href="#/'+this.escapeExpression(this.lambda(null!=e?e.path:e,e))+'" data-widget-id="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'">\n        <div class="abstract-nav s-nav '+(null!=(r=t.if.call(e,null!=e?e.isSelected:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <span class="s-content">\n                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"\n"+(null!=(r=t.if.call(e,null!=e?e.showCount:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?r:"")+"                </span>\n        </div>\n        </a>\n\n"},13:function(e,t,n,i){var r;return'                <span class="num-items"> '+(null!=(r=t.if.call(e,null!=e?e.numFound:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"</span>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,r,a){var s;return'\n<nav>\n\n    <h2 class="s-nav-top-title"><i class="fa fa-cog"></i> Customize Settings</h2>\n\n    <div class="s-nav-header s-view-nav">user preferences</div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.preferences:e,{name:"each",hash:{},fn:this.program(1,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'\n    <div class="s-nav-header s-view-nav">notification settings</div>\n\n    <div class="abstract-nav s-nav">Coming soon</div>\n\n        \x3c!--'+(null!=(s=t.each.call(e,null!=e?e.notifications:e,{name:"each",hash:{},fn:this.program(4,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'--\x3e\n\n\n    <div class="s-nav-header s-view-nav">account settings</div>\n\n'+(null!=(s=t.each.call(e,null!=e?e.settings:e,{name:"each",hash:{},fn:this.program(12,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"\n\n\n</nav>\n"},useData:!0,useDepths:!0});return t.registerPartial("js/wraps/user_settings_page_manager/user_nav",n),n}),define("js/wraps/user_settings_page_manager/user_page_manager",["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/user_settings_page_manager/user-settings-layout","hbs!js/wraps/user_settings_page_manager/user_nav"],function(e,t,n,i){return e.extend({TOCTemplate:i,createView:function(e){return e=e||{},e.template=e.template||n,new t({template:n,className:"s-user-settings-page-layout s-100-height",id:"user-page-layout"})},activate:function(e){this.setBeeHive(e),this.debug=e.getDebug(),this.view=this.createView({debug:this.debug,widgets:this.widgets})},navConfig:{UserPreferences__librarylink:{title:"Library Link Server",path:"user/settings/librarylink",category:"preferences"},UserPreferences__orcid:{title:"ORCID Settings",path:"user/settings/orcid",category:"preferences"},LibraryImport:{title:"Import Libraries",path:"user/settings/libraryimport",category:"preferences"},UserSettings__email:{title:"Change Email",path:"user/settings/email",category:"settings"},UserSettings__password:{title:"Change Password",path:"user/settings/password",category:"settings"},UserSettings__token:{title:"API Token",path:"user/settings/token",category:"settings"},UserSettings__delete:{title:"Delete Account",path:"user/settings/delete",category:"settings"}}})}),define("hbs!js/wraps/orcid_page_manager/orcid-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="row s-stable-search-bar-height">\n    <div class="s-search-bar-full-width-container">\n        <div class="col-sm-7 col-md-7 col-sm-offset-2 s-search-bar-row" id="search-bar-row"\n             data-widget="SearchWidget">\n        </div>\n    </div>\n</div>\n<div data-widget="OrcidBigWidget"/>\n\n'},useData:!0});return t.registerPartial("js/wraps/orcid_page_manager/orcid-page-layout",n),n}),define("js/wraps/orcid_page_manager/orcid_page_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/orcid_page_manager/orcid-page-layout"],function(e,t,n){return e.extend({createView:function(e){return e=e||{},e.template=n,new t({template:n,className:"s-orcid-layout",id:"orcid-page-layout"})}})}),define("hbs!js/wraps/orcid-instructions-page-manager/orcid-instructions",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="orcid-info">\n\n    <section class="orcid-info__intro col-sm-8 col-sm-offset-2">\n            <div class="header">\n                <div class="logos">\n                        <img src="../../styles/img/ads-orcid.svg" alt="the ADS logo combined with the ORCID logo" style="max-width: 150px;">\n\n                </div>\n\n                <h1>ADS-ORCID Integration</h1>\n\n            </div>\n\n    </section>\n    <div class="row">\n        <div class="col-sm-8 col-sm-offset-2">\n\n            \x3c!-- Nav tabs --\x3e\n            <ul class="nav nav-tabs" role="tablist">\n                <li role="presentation" class="active"><a href="#orcid-instructions__claim" aria-controls="orcid-instructions__claim" role="tab" data-toggle="tab">Claim Papers</a></li>\n                <li role="presentation"><a href="#orcid-instructions__search" aria-controls="#orcid-instructions__search" role="tab" data-toggle="tab">Find Papers</a></li>\n                \x3c!--<li role="presentation"><a href="#orcid-instructions__benefit" aria-controls="#orcid-instructions__benefit" role="tab" data-toggle="tab">Benefit</a></li>--\x3e\n            </ul>\n\n            \x3c!-- Tab panes --\x3e\n            <div class="tab-content">\n                <div role="tabpanel" class="tab-pane active" id="orcid-instructions__claim">\n\n                    <section class="orcid-info__instructions">\n\n                        <h2 id="method-one-recommended-if-you-care-about-having-your-orcid-claims-searchable-in-the-ads"><b>Recommended Method:</b> If you care about having your ORCID claims searchable in the ADS</h2>\n                        <ol>\n                            <li><h3 id="make-sure-you-re-signed-in-to-ads">Make sure you&#39;re signed in to ADS</h3>\n                                If you are not signed in already, <a href="#user/account/login">sign in here</a> or <a\n                                        href="#user/account/register">create an account.</a>\n                            <li><h3 id="authenticate-with-orcid">Authenticate with ORCID</h3>\n                                Click on the ORCID button in the top navigation bar and follow the instructions.</li>\n                            <li><h3 id="enter-a-bit-of-extra-information-in-your-ads-user-profile">Enter a bit of extra information in your ADS User Profile</h3>\n                               If you haven\'t done this already, <a href="#user/settings/orcid">go to the ORCID settings page in your ADS account</a>. Enter in 1) your current affiliation, and 2) any name variations under which you might have published. Submitting the form will grant ADS permission to track your claims, allowing us to put your data in our system and marking it as trusted so that others can find it.</li>\n                            <li><h3 id="claim-papers-one-by-one-safe-but-slow-">Claim papers one-by-one</h3>\n                                <p>Search for your name variations in the search interface. Make sure ORCID mode is &quot;on&quot; (click on the ORCID button in the navigation bar to toggle the setting), and you will see a button underneath each search result allowing you to claim the paper.</p>\n                            </li>\n                            \x3c!--<li><h3 id="bulk-claiming-your-papers-fast-and-slightly-less-safe-">Bulk claiming your papers (fast and slightly less safe)</h3>--\x3e\n                                \x3c!--<p>Because you are signed in, you have the option to use an ADS library to bulk export your papers to ORCID.--\x3e\n                                    \x3c!--To create a library, perform a search for your name variations and for each page of results:</p>--\x3e\n                                \x3c!--<ol>--\x3e\n                                    \x3c!--<li>Click the &quot;select all&quot; checkbox at the top and de-select any papers that are not by you.</li>--\x3e\n                                    \x3c!--<li>Open the &quot;add papers to library&quot; panel and either create a special library for your ORCID papers or add your papers to a pre-existing library.--\x3e\n                                        \x3c!--Once you have collected all your papers in a library, go to your ADS Libraries page and open up the library with your ORCID papers in it. Go to the export dropdown and click &quot;ORCID&quot;.  This will send all papers in the library to ORCID as a single list.</li>--\x3e\n                                \x3c!--</ol>--\x3e\n                            \x3c!--</li>--\x3e\n                        </ol>\n                        <hr>\n                        <h2 id="method-two-if-you-just-want-to-use-ads-to-send-claims-to-your-orcid-profile-"><b>Alternate Method: </b> If you just want to use ADS to send claims to your ORCID profile*</h2>\n                        <ol>\n                            <li><h3 id="authenticate-with-orcid">Authenticate with ORCID</h3>\n                                Click on the ORCID button in the top navigation bar and follow the instructions.</li>\n                            <li><h3 id="claim-papers-one-by-one">Claim papers one-by-one</h3>\n                                Search for your name in the ADS and you&#39;ll get a list of search results. Make sure ORCID mode is &quot;on&quot; (click on the ORCID button in the navigation bar to toggle the setting). When the ORCID claiming mode is on, you&#39;ll see a button underneath each search result allowing you to claim the paper in ORCID.</li>\n                            <li><h3 id="it-s-not-too-late-to-change-your-mind-">It&#39;s not too late to change your mind!</h3>\n                                <p> You can always sign into your ADS account (or create a new one) and  <a href="#user/settings/orcid">submit the user profile information described above</a> to facilitate indexing your claims in ADS. Without performing this final step, some of your claims may not be properly indexed in ADS due to our inability to match your name variations against the published records.  </p>\n                            </li>\n                        </ol>\n\n                        <p>\n                            * most of your papers will likely still be eventually findable in the ADS, but they will be marked as less trusted than papers claimed using Method #1\n                        </p>\n\n                    </section>\n\n                </div>\n                <div role="tabpanel" class="tab-pane" id="orcid-instructions__search">\n                    <section class="search">\n                        <br>\n                        <p class="lead">The ORCID claims you make will be indexed in ADS within 24 hours, and can be found by using the &quot;orcid&quot; search field.</p>\n                        <hr>\n                        <p>\n                            e.g. to find Andrea Comastri\'s papers, search <a href="#search/q=orcid%3A0000-0003-3451-9970&sort=date+desc"> orcid:0000-0003-3451-9970</a>.\n                        </p>\n                    </section>\n                </div>\n                \x3c!--<div role="tabpanel" class="tab-pane" id="orcid-instructions__benefit">--\x3e\n                    \x3c!--<br>--\x3e\n                    \x3c!--<p class="lead">In the future, ORCID integration will be central to the ADS search interface.</p>--\x3e\n                    \x3c!--<hr>--\x3e\n                    \x3c!--<p>With data from ORCID, we can make our author searches smarter, reducing the problems caused by author name disambiguation.</p>--\x3e\n                    \x3c!--<p>Once we can associate a user with the papers he or she has written, we can offer smarter notification and recommendation services.</p>--\x3e\n\n                \x3c!--</div>--\x3e\n            </div>\n        </div>\n    </div>\n\n\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/orcid-instructions-page-manager/orcid-instructions",n),n}),define("js/wraps/orcid-instructions-page-manager/manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/orcid-instructions-page-manager/orcid-instructions","bootstrap"],function(e,t,n,i){return e.extend({createView:function(e){return e=e||{},e.template=n,new t({template:n,className:"orcid-info"})}})}),define("hbs!js/wraps/libraries_page_manager/libraries-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div class="row">\n    <div class="col-sm-12">\n    <div data-widget="UserNavbarWidget"/>\n    </div>\n</div>\n\n<div class="row nav-button-container s-nav-button-container">\n    <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n</div>\n\n<div class="row s-darker-background">\n\n    <div class="col-sm-2 nav-container s-nav-container"></div>\n    <div class="col-sm-10 body-min-height">\n        <div data-widget="IndividualLibraryWidget"/>\n        <div data-widget="AllLibrariesWidget"/>\n        <div data-widget="LibraryListWidget"/>\n        <div data-widget="ExportWidget" class="s-inner-div-background"/>\n        <div data-widget="Metrics" class="s-inner-div-background"/>\n        <div data-widget="AuthorNetwork" class="s-inner-div-background"/>\n        <div data-widget="PaperNetwork" class="s-inner-div-background"/>\n        <div data-widget="BubbleChart" class="s-inner-div-background"/>\n        <div data-widget="ConceptCloud" class="s-inner-div-background"/>\n        <div data-widget="CitationHelper" class="s-inner-div-background"/>\n     </div>\n</div>'},useData:!0});return t.registerPartial("js/wraps/libraries_page_manager/libraries-page-layout",n),n}),define("hbs!js/wraps/libraries_page_manager/libraries-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<nav class="library-nav">\n  <div>\n    <button class="btn btn-link create-library">\n      <i class="fa fa-plus"></i>&nbsp;&nbsp;Add a library\n    </button>\n  </div>\n  <div>\n    <a href="#/user/libraries"><i class="fa fa-list"></i>&nbsp;&nbsp;View all libraries</a>\n  </div>\n  <div>\n    <a href="https://adsabs.github.io/help/libraries/creating-libraries" target="_blank">\n      <i class="fa fa-info-circle"></i>&nbsp;&nbsp;Library Help\n    </a>\n  </div>\n\n</nav>\n'},useData:!0});return t.registerPartial("js/wraps/libraries_page_manager/libraries-nav",n),n}),define("js/wraps/libraries_page_manager/libraries_page_manager",["js/page_managers/toc_controller","js/page_managers/toc_widget","js/page_managers/three_column_view","hbs!js/wraps/libraries_page_manager/libraries-page-layout","hbs!js/wraps/libraries_page_manager/libraries-nav"],function(e,t,n,i,r){return e.extend({TOCTemplate:r,TOCEvents:{"click button.create-library":function(){this.trigger("page-manager-event","apply-function",{func:function(){var e=this;this.getBeeHive().getObject("LibraryController").createLibrary().done(function(t){e.getPubSub().publish(e.getPubSub().NAVIGATE,"IndividualLibraryWidget",{sub:"library",id:t.id})})}})}},createView:function(e){return e=e||{},e.template=e.template||i,new n({template:i,className:"s-libraries-layout s-100-height",id:"libraries-layout"})},navConfig:[]})}),define("hbs!js/wraps/home_page_manager/home-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div class="row">\n    <div class="col-sm-12">\n        <div data-widget="UserNavbarWidget"/>\n    </div>\n</div>\n\n<div class="nav-button-container s-nav-button-container row">\n    <button class="btn btn-primary-faded toggle-menu s-toggle-menu "> <i class="fa fa-bars"></i> Show Menu </button>\n</div>\n\n\n<div class="row s-darker-background">\n\n    <div class="col-sm-2 nav-container s-nav-container">\n    </div>\n    <div class="col-sm-10 body-min-height">\n    </div>\n</div>'},useData:!0});return t.registerPartial("js/wraps/home_page_manager/home-page-layout",n),n}),define("hbs!js/wraps/home_page_manager/home-nav",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<nav>\n    <h2 class="s-nav-top-title"><i class="fa fa-user"></i> My Home Page</h2>\n\n    <div class="s-nav">\n        Nothing here yet!\n        We are working on features such as:\n        <ul>\n            <li>a public profile with customized metrics</li>\n            <li>a customized ads dashboard</li>\n            <li>research notifications</li>\n            <li>saved searches</li>\n        </ul>\n    </div>\n</nav>'},useData:!0});return t.registerPartial("js/wraps/home_page_manager/home-nav",n),n}),define("js/wraps/home_page_manager/home_page_manager",["js/page_managers/toc_controller","js/page_managers/three_column_view","hbs!js/wraps/home_page_manager/home-page-layout","hbs!js/wraps/home_page_manager/home-nav"],function(e,t,n,i){return e.extend({TOCTemplate:i,createView:function(e){return e=e||{},e.template=e.template||n,new t({template:n,className:"s-home-layout s-100-height",id:"home-layout"})},navConfig:[]})}),define("hbs!js/wraps/public_libraries_page_manager/public-libraries-page-layout",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n\n<div class="row s-darker-background">\n    <div class="col-sm-12">\n        <div class="s-public-lib-descriptor"><h3>  <i class="fa fa-lg fa-unlock text-success" title="this library is public"></i> ADS Public Library</h3> <a href=""><i class="fa fa-icon-help"></i></a><i class="fa fa-icon-help"></i></div>\n        <div data-widget="IndividualLibraryWidget"/>\n        <div data-widget="LibraryListWidget" />\n\n        <div data-widget="ExportWidget" class="s-inner-div-background"/>\n        <div data-widget="Metrics" class="s-inner-div-background"/>\n        <div data-widget="AuthorNetwork" class="s-inner-div-background"/>\n        <div data-widget="PaperNetwork" class="s-inner-div-background"/>\n        \x3c!--<div data-widget="BubbleChart" class="s-inner-div-background"/>--\x3e\n        <div data-widget="ConceptCloud" class="s-inner-div-background"/>\n        <div data-widget="CitationHelper" class="s-inner-div-background"/>\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/public_libraries_page_manager/public-libraries-page-layout",n),n}),define("js/wraps/public_libraries_page_manager/public_libraries_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/public_libraries_page_manager/public-libraries-page-layout"],function(e,t,n){return e.extend({createView:function(e){return e=e||{},e.template=n,new t({template:n,className:"s-public-libraries-layout s-libraries-layout",id:"landing-page-layout"})}})}),define("hbs!js/wraps/error_page_manager/404",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div >\n    <img src="styles/img/404.jpg"\n         class="img-responsive"\n         style="margin:auto;"\n         alt="incredibly cute 404 error image made by Jason Bitterman"/>\n   <p style="text-align: center"><a href="/">Click here to reload Bumblebee</a> or use your browser\'s back button to go to a previous page.</p>\n</div>\n'},useData:!0});return t.registerPartial("js/wraps/error_page_manager/404",n),n}),define("js/wraps/error_page_manager/error_page_manager",["js/page_managers/controller","js/page_managers/one_column_view","hbs!js/wraps/error_page_manager/404"],function(e,t,n){return e.extend({createView:function(e){return e=e||{},new t({template:n,className:"error-page-layout s-100-height"})}})}),define("js/mixins/form_view_functions",["underscore"],function(e){return{checkValidationState:function(){this.model.isValidSafe()&&this.$("button[type=submit]").prev(".help-block").html("").addClass("no-show")},triggerSubmit:function(e){if(e.preventDefault(),this.submit=!0,this.model.isValid(!0)){this.trigger("submit-form",this.model),this.$("button[type=submit]").prev(".help-block").addClass("no-show"),this.$("button[type=submit]").removeClass("btn-success").addClass("disabled").html('<i class="fa fa-lg fa-spinner fa-pulse"></i> Working...')}else this.$("button[type=submit]").prev(".help-block").removeClass("no-show").html("Fields missing or incomplete")},activateValidation:function(){Backbone.Validation.bind(this,{forceUpdate:!0}),this.stickit()},isValidSafe:function(){var t=!0;if(e.each(this.validation,function(e,n){e.required&&!this.get(n)&&(t=!1)},this),t&&this.isValid(!0))return!0},reset:function(){var t=e.keys(this.validation);e.each(this.attributes,function(n,i){e.contains(t,i)&&this.unset(i,{silent:!0})},this)}}}),define("hbs!js/widgets/success/success_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\n<div class="panel panel-default">\n    <div class="panel-heading">\n        <i class="icon-success fa-3x"> </i> '+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+'\n    </div>\n    <div class="panel-body">\n        <p> '+(null!=(r="function"==typeof(a=null!=(a=t.message||(null!=e?e.message:e))?a:t.helperMissing)?a.call(e,{name:"message",hash:{},data:i}):a)?r:"")+"</p>\n    </div>\n\n</div>\n\n\n"},useData:!0});return t.registerPartial("js/widgets/success/success_template",n),n}),define("js/widgets/success/view",["marionette","hbs!js/widgets/success/success_template"],function(e,t){return e.ItemView.extend({initialize:function(e){_.extend(this,e)},title:"Success!",message:"Check your email for further instructions.",template:t,serializeData:function(){return{title:this.title,message:this.message}}})}),define("hbs!js/widgets/authentication/templates/log-in",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default">\n    <legend class="panel-heading">Log in to ADS\n        <button class="show-register btn btn-default pull-right"> sign up for an account </button>\n        <div class="s-form-note"> <i class="fa fa-info-circle"></i> Your ADS Classic credentials will not work here.\n            <br/> You\'ll have to make a new account to access this system. </div>\n\n    </legend>\n    <form class="panel-body">\n\n        <div class="form-group has-feedback">\n            <label for="username" class="control-label"> Email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="username" id="username" placeholder="Enter email">\n        </div>\n\n        <div class="form-group has-feedback">\n            <label for="password" class="control-label"> Password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password" id="password" placeholder="Password">\n        </div>\n\n        <div class="form-group has-feedback">\n            <span class="help-block no-show s-help-block s-help-block-submit"></span>\n            <button type="submit" class="btn btn-primary-faded submit-login">Submit</button>\n        </div>\n\n        <div class="form-group">\n            <button class="btn btn-link show-reset-password-1">Forgot your password?</button>\n            <span class="help-block no-show s-help-block"></span>\n        </div>\n\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/log-in",n),n}),define("hbs!js/widgets/authentication/templates/register",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default">\n            <legend class="panel-heading">Register for an ADS Account\n             <button class="show-login btn btn-default pull-right"> I already have an account </button>\n            </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> Email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="email" id="email" placeholder="Enter email"/>\n\n        </div>\n        <div class="form-group has-feedback">\n            <label for="password1" class="control-label"> Password <small class="s-user-help"> at least 5 characters, with at least 1 number and 1 letter</small> </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password1" id="password1" placeholder="Password"/>\n\n        </div>\n\n        <div class="form-group has-feedback">\n            <label  for="password2" class="control-label"> Re-enter Password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password2" id="password2" placeholder="Re-enter password"/>\n        </div>\n\n        <div class="form-group">\n            <div class="g-recaptcha"></div>\n        </div>\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded submit-register">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/register",n),n}),define("hbs!js/widgets/authentication/templates/container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="form-container s-form-container  col-sm-10 col-sm-offset-1  col-md-8 col-md-offset-2 col-lg-6 col-lg-offset-3">\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/container",n),n}),define("hbs!js/widgets/authentication/templates/reset-password-1",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default">\n    <legend class="panel-heading"> Password Reset\n        <button class="show-login btn btn-default pull-right"> return to login form </button>\n    </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> Email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="email" id="email" placeholder="Enter email"/>\n        </div>\n\n        <div class="form-group">\n            <div class="g-recaptcha"></div>\n        </div>\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded submit-reset-password">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/reset-password-1",n),n}),define("hbs!js/widgets/authentication/templates/reset-password-2",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default">\n    <legend class="panel-heading"> Password Reset\n    </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="password1" class="control-label"> New password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <div class="s-user-help">Passwords should be at least five characters and include at least one number and one letter.</div>\n            <input type="password" class="form-control" name="password1" id="password1" placeholder="Password"/>\n\n        </div>\n\n        <div class="form-group has-feedback">\n            <label  for="password2" class="control-label"> Re-enter new password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password2" id="password2" placeholder="Re-enter password"/>\n        </div>\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded submit-reset-password">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/authentication/templates/reset-password-2",n),n}),function(e){"function"==typeof define&&define.amd?define("backbone.stickit",["underscore","backbone","exports"],e):"object"==typeof exports?e(require("underscore"),require("backbone"),exports):e(_,Backbone,{})}(function(e,t,n){n._handlers=[],n.addHandler=function(t){t=e.map(e.flatten([t]),function(t){return e.extend({updateModel:!0,updateView:!0,updateMethod:"text"},t)}),this._handlers=this._handlers.concat(t)},n.ViewMixin={_modelBindings:null,unstickit:function(t,n){if(e.isObject(n))e.each(e.keys(n),function(e){this.unstickit(t,e)},this);else{var i=[],r=[];e.each(this._modelBindings,function(e,a){t&&e.model!==t||n&&e.config.selector!=n||(r.push(e.config._destroy),e.model.off(e.event,e.fn),i.push(e.model),delete this._modelBindings[a])},this),e.invoke(e.uniq(i),"trigger","stickit:unstuck",this.cid),e.each(e.uniq(r),function(e){e.call(this)},this),this._modelBindings=e.compact(this._modelBindings),this.$el.off(".stickit"+(t?"."+t.cid:""),n)}},stickit:function(t,n){var i=t||this.model,r=n||e.result(this,"bindings")||{};this._modelBindings||(this._modelBindings=[]),this.addBinding(i,r);var a=this.remove;a.stickitWrapped||(this.remove=function(){var e=this;return this.unstickit(),a&&(e=a.apply(this,arguments)),e}),this.remove.stickitWrapped=!0},addBinding:function(t,n,i){var a,f,g,m,b,v=t||this.model,y=".stickit."+v.cid,w=i||{},_=e.uniqueId();if(e.isString(n))a=":el"===(b=n)?this.$el:this.$(b),this.unstickit(v,b),a.length&&(e.isString(w)&&(w={observe:w}),e.isFunction(w.observe)&&(w.observe=w.observe.call(this)),(m=u(a,w)).selector=b,g=m.observe,m.bindId=_,m.view=this,f=e.extend({stickitChange:m},m.setOptions),m._destroy=function(){r(this,m.destroy,a,v,m)},d(this,a,m,v,g),h(this,a,m,v,g),g&&(e.each(m.events,function(t){var n=t+y,i=function(t){var n=m.getVal.call(this,a,t,m,e.rest(arguments));s(this,m.updateModel,n,t,m)&&l(v,g,n,f,this,m)};i=e.bind(i,this),":el"===b?this.$el.on(n,i):this.$el.on(n,b,i)},this),e.each(e.flatten([g]),function(e){o(v,this,"change:"+e,m,function(e,t,n){(n&&n.stickitChange&&n.stickitChange.bindId||null)!==_&&p(this,a,m,c(e,g,m,this),e)})},this),p(this,a,m,c(v,g,m,this),v,!0)),r(this,m.initialize,a,v,m));else{var x=n;e.each(x,function(e,t){this.addBinding(v,t,x[t])},this)}}},e.extend(t.View.prototype,n.ViewMixin);var i=function(t,n){var i=(n||"").split("."),r=e.reduce(i,function(e,t){return e[t]},t);return null==r?t:r},r=function(t,n){if(n)return(e.isString(n)?i(t,n):n).apply(t,e.rest(arguments,2))},a=function(e){return e.find("option").not(function(){return!this.selected})},s=function(t,n){return e.isBoolean(n)?n:!(!e.isFunction(n)&&!e.isString(n))&&r.apply(this,arguments)},o=function(e,t,n,i,r){e.on(n,r,t),t._modelBindings.push({model:e,event:n,fn:r,config:i})},l=function(t,n,i,a,s,o){var l={};o.onSet&&(i=r(s,o.onSet,i,o)),o.set?r(s,o.set,n,i,a,o):(l[n]=i,e.isArray(n)&&e.isArray(i)&&(l=e.reduce(n,function(t,n,r){return t[n]=e.has(i,r)?i[r]:null,t},{})),t.set(l,a))},c=function(t,n,i,a){var s,o=function(e){return t[i.escape?"escape":"get"](e)},l=function(e){return null==e?"":e};return s=e.isArray(n)?e.map(n,o):o(n),i.onGet&&(s=r(a,i.onGet,s,i)),e.isArray(s)?e.map(s,l):l(s)},u=n.getConfiguration=function(t,i){var r=[{updateModel:!1,updateMethod:"text",update:function(e,t,n,i){e[i.updateMethod]&&e[i.updateMethod](t)},getVal:function(e,t,n){return e[n.updateMethod]()}}];(r=r.concat(e.filter(n._handlers,function(e){return t.is(e.selector)}))).push(i);var a=e.extend.apply(e,r);return a.visible&&!e.has(a,"updateView")?a.updateView=!1:e.has(a,"updateView")||(a.updateView=!0),a},d=function(t,n,i,r,a){var s=["autofocus","autoplay","async","checked","controls","defer","disabled","hidden","indeterminate","loop","multiple","open","readonly","required","scoped","selected"];e.each(i.attributes||[],function(l){var u,d,h="";l=e.clone(l),u=l.observe||(l.observe=a),d=function(){var i=e.indexOf(s,l.name,!0)>-1?"prop":"attr",a=c(r,u,l,t);"class"===l.name?(n.removeClass(h).addClass(a),h=a):n[i](l.name,a)},e.each(e.flatten([u]),function(e){o(r,t,"change:"+e,i,d)}),d()})},h=function(t,n,i,a,s){if(null!=i.visible){var l=function(){var o=i.visible,l=i.visibleFn,u=c(a,s,i,t),d=!!u;(e.isFunction(o)||e.isString(o))&&(d=!!r(t,o,u,i)),l?r(t,l,n,d,i):n.toggle(d)};e.each(e.flatten([s]),function(e){o(a,t,"change:"+e,i,l)}),l()}},p=function(e,t,n,i,a,o){s(e,n.updateView,i,n)&&(r(e,n.update,t,i,a,n),o||r(e,n.afterUpdate,t,i,n))};return n.addHandler([{selector:'[contenteditable="true"]',updateMethod:"html",events:["input","change"]},{selector:"input",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:"textarea",events:["propertychange","input","change"],update:function(e,t){e.val(t)},getVal:function(e){return e.val()}},{selector:'input[type="radio"]',events:["change"],update:function(e,t){e.filter('[value="'+t+'"]').prop("checked",!0)},getVal:function(e){return e.filter(":checked").val()}},{selector:'input[type="checkbox"]',events:["change"],update:function(n,i,r,a){if(n.length>1)i||(i=[]),n.each(function(n,r){var a=t.$(r),s=e.indexOf(i,a.val())>-1;a.prop("checked",s)});else{var s=e.isBoolean(i)?i:i===n.val();n.prop("checked",s)}},getVal:function(n){var i;if(n.length>1)i=e.reduce(n,function(e,n){var i=t.$(n);return i.prop("checked")&&e.push(i.val()),e},[]);else{i=n.prop("checked");var r=n.val();"on"!==r&&null!=r&&(i=i?n.val():null)}return i}},{selector:"select",events:["change"],update:function(n,a,s,o){var l,c=o.selectOptions,u=c&&c.collection||void 0,d=n.prop("multiple");if(!c){c={};var h=function(e){return e.map(function(){return{value:this.value,label:this.text}}).get()};n.find("optgroup").length?(u={opt_labels:[]},n.find("> option").length&&(u.opt_labels.push(void 0),e.each(n.find("> option"),function(e){u[void 0]=h(t.$(e))})),e.each(n.find("optgroup"),function(e){var n=t.$(e).attr("label");u.opt_labels.push(n),u[n]=h(t.$(e).find("option"))})):u=h(n.find("option"))}c.valuePath=c.valuePath||"value",c.labelPath=c.labelPath||"label";var p=function(n,r,a){e.each(n,function(n){var s=t.$("<option/>"),o=n,l=function(t,n){s.text(t),o=n,s.data("stickit_bind_val",o),e.isArray(o)||e.isObject(o)||s.val(o)};"__default__"===n?l(c.defaultOption.label,c.defaultOption.value):l(i(n,c.labelPath),i(n,c.valuePath)),!d&&null!=o&&null!=a&&o===a||e.isObject(a)&&e.isEqual(o,a)?s.prop("selected",!0):d&&e.isArray(a)&&e.each(a,function(t){e.isObject(t)&&(t=i(t,c.valuePath)),(t===o||e.isObject(t)&&e.isEqual(o,t))&&s.prop("selected",!0)}),r.append(s)})};n.find("*").remove();if((l=e.isString(u)?function(e,t){var n=window;return 0===t.indexOf("this.")&&(n=e),t=t.replace(/^[a-z]*\.(.+)$/,"$1"),i(n,t)}(this,u):e.isFunction(u)?r(this,u,n,o):u)instanceof t.Collection&&(l=l.toJSON()),c.defaultOption&&p(["__default__"],n),e.isArray(l))p(l,n,a);else if(l.opt_labels)e.each(l.opt_labels,function(e){var i=t.$("<optgroup/>").attr("label",e);p(l[e],i,a),n.append(i)});else{var f,g=[];for(var m in l)(f={})[c.valuePath]=m,f[c.labelPath]=l[m],g.push(f);p(e.sortBy(g,c.comparator||c.labelPath),n,a)}},getVal:function(e){return e.prop("multiple")?t.$(a(e).map(function(){return t.$(this).data("stickit_bind_val")})).get():a(e).data("stickit_bind_val")}}]),t.Stickit=n,t.Stickit}),define("js/widgets/authentication/widget",["marionette","js/widgets/base/base_widget","js/components/api_feedback","js/mixins/form_view_functions","js/widgets/success/view","js/components/api_targets","hbs!js/widgets/authentication/templates/log-in","hbs!js/widgets/authentication/templates/register","hbs!js/widgets/authentication/templates/container","hbs!js/widgets/authentication/templates/reset-password-1","hbs!js/widgets/authentication/templates/reset-password-2","js/components/user","backbone-validation","backbone.stickit","google-recaptcha"],function(e,t,n,i,r,a,s,o,l,c,u,d){var h,p,f=/(?=.*\d)(?=.*[a-zA-Z]).{5,}/;h=e.ItemView.extend({activateValidation:i.activateValidation,checkValidationState:i.checkValidationState,triggerSubmit:i.triggerSubmit,modelEvents:{change:"checkValidationState"},events:{"click button[type=submit]":"triggerSubmit"}}),p=Backbone.Model.extend({isValidSafe:i.isValidSafe,reset:i.reset});var g,m;g=p.extend({validation:{email:{required:!0,pattern:"email",msg:"(A valid email is required)"},password1:{required:!0,pattern:f,msg:"(Password isn't valid)"},password2:{required:!0,equalTo:"password1",msg:"(The passwords do not match)"},"g-recaptcha-response":{required:!0}},target:"REGISTER"}),m=h.extend({template:o,className:"register s-register",bindings:{"input[name=email]":{observe:"email",setOptions:{validate:!0}},"input[name=password1]":{observe:"password1",setOptions:{validate:!0}},"input[name=password2]":{observe:"password2",setOptions:{validate:!0}},"g-recaptcha-response":{required:!0}},onRender:function(){this.activateValidation(),this.trigger("activate-recaptcha")}});var b,v;v=p.extend({validation:{username:{required:!0,pattern:"email",msg:"(A valid email is required)"},password:{required:!0,pattern:f,msg:"(A valid password is required)"}},target:"USER"}),b=h.extend({template:s,className:"log-in s-log-in",bindings:{"input[name=username]":{observe:"username",setOptions:{validate:!0}},"input[name=password]":{observe:"password",setOptions:{validate:!0}}},onRender:function(){this.activateValidation()}});var y,w;w=p.extend({validation:{email:{required:!0,pattern:"email",msg:"(A valid email is required)"},"g-recaptcha-response":{required:!0}},target:"RESET_PASSWORD",method:"POST"}),y=h.extend({template:c,className:"reset-password-1 s-reset-password-1",bindings:{"input[name=email]":{observe:"email",setOptions:{validate:!0}}},onRender:function(){this.activateValidation(),this.trigger("activate-recaptcha")}});var x,S;S=p.extend({validation:{password1:{required:!0,pattern:f,msg:"(Password isn't valid)"},password2:{required:!0,equalTo:"password1",pattern:f,msg:"(The passwords do not match)"}},target:"RESET_PASSWORD",method:"PUT"}),x=h.extend({template:u,className:"reset-password-2 s-reset-password-2",bindings:{"input[name=password1]":{observe:"password1",setOptions:{validate:!0}},"input[name=password2]":{observe:"password2",setOptions:{validate:!0}}},onRender:function(){this.activateValidation()}});var E=Backbone.Model.extend({defaults:function(){return{subView:void 0}}}),A=e.LayoutView.extend({template:l,initialize:function(){this.logInModel=new v,this.registerModel=new g,this.resetPassword1Model=new w,this.resetPassword2Model=new S},modelEvents:{"change:subView":"renderSubView"},className:"s-authentication-container row s-form-widget",regions:{container:".form-container"},triggers:{"click .show-login":"navigateToLoginForm","click .show-register":"navigateToRegisterForm","click .show-reset-password-1":"navigateToResetPassword1Form"},onRender:function(){this.renderSubView()},renderSubView:function(){var e=this.model.get("subView");"login"===e?this.showLoginForm():"register"===e?this.showRegisterForm():"reset-password-1"===e?this.showResetPasswordForm1():"reset-password-2"===e&&this.showResetPasswordForm2()},showLoginForm:function(){var e=new b({model:this.logInModel});e.on("submit-form",this.forwardSubmit,this),this.container.show(e)},showRegisterForm:function(){var e=new m({model:this.registerModel});e.on("submit-form",this.forwardSubmit,this),e.on("activate-recaptcha",_.bind(this.forwardActivateRecaptcha,this,e)),this.container.show(e)},showResetPasswordForm1:function(){var e=new y({model:this.resetPassword1Model});e.on("submit-form",this.forwardSubmit,this),e.on("activate-recaptcha",_.bind(this.forwardActivateRecaptcha,this,e)),this.container.show(e)},showResetPasswordForm2:function(){var e=new x({model:this.resetPassword2Model});e.on("submit-form",this.forwardSubmit,this),this.container.show(e)},showRegisterSuccessView:function(){var e=new r({title:"Registration Successful"});this.container.show(e)},showResetPasswordSuccessView:function(){var e=new r({title:"Password Reset Successful"});this.container.show(e)},forwardSubmit:function(e){this.trigger("submit-form",e)},forwardActivateRecaptcha:function(e){this.trigger("activate-recaptcha",e)}});return t.extend({initialize:function(e){e=e||{},this.stateModel=new E,this.view=new A({controller:this,model:this.stateModel}),this.listenTo(this.view,"submit-form",this.triggerCorrectSubmit),this.listenTo(this.view,"navigateToLoginForm",this.navigateToLoginForm),this.listenTo(this.view,"navigateToRegisterForm",this.navigateToRegisterForm),this.listenTo(this.view,"navigateToResetPassword1Form",this.navigateToResetPassword1Form),this.listenTo(this.view,"activate-recaptcha",this.activateRecaptcha),e.test&&(window.grecaptcha=null)},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");_.bindAll(this,["handleUserAnnouncement"]),t.subscribe(t.USER_ANNOUNCEMENT,this.handleUserAnnouncement)},navigateToLoginForm:function(){this._navigate({subView:"login"})},navigateToRegisterForm:function(){this._navigate({subView:"register"})},navigateToResetPassword1Form:function(){this._navigate({subView:"reset-password-1"})},_navigate:function(e){var t=this.getPubSub();t.publish(t.NAVIGATE,"authentication-page",e)},setSubView:function(e){this.stateModel.set("subView",e)},handleUserAnnouncement:function(e){switch(this.resetAll(),e){case d.prototype.USER_SIGNED_IN:break;case"login_fail":this.view.showLoginForm();break;case"register_success":this.view.showRegisterSuccessView();break;case"register_fail":this.view.showRegisterForm();break;case"reset_password_1_success":this.view.showResetPasswordSuccessView();break;case"reset_password_1_fail":this.view.showResetPasswordForm1()}},resetAll:function(){this.view.logInModel.reset(),this.view.registerModel.reset(),this.view.resetPassword1Model.reset()},triggerCorrectSubmit:function(e){var t=e.toJSON();"REGISTER"==e.target?(_.extend(t,{verify_url:location.origin+"/#user/account/verify/"+a.REGISTER}),this.getBeeHive().getObject("Session").register(e.toJSON())):"USER"==e.target?this.getBeeHive().getObject("Session").login(e.toJSON()).done(function(){}):"RESET_PASSWORD"==e.target&&"POST"===e.method?this.getBeeHive().getObject("Session").resetPassword1(t):"RESET_PASSWORD"==e.target&&"PUT"===e.method&&this.getBeeHive().getObject("Session").resetPassword2(t)},onShow:function(){this.view.render()},activateRecaptcha:function(e){this.getBeeHive().getObject("RecaptchaManager").activateRecaptcha(e)}})}),define("hbs!js/widgets/user_settings/templates/api_key",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n            <p><i class="icon-loading"></i> Loading...</p>\n\n'},3:function(e,t,n,i){var r;return'\n        <div class="input-group">\n            <input type="text" class="form-control" readonly value="'+(null!=(r=t.if.call(e,null!=e?e.access_token:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?r:"")+'" style="cursor:text">\n              <span class="input-group-btn">\n                <button class="btn btn-primary-faded" type="submit">Generate a new key</button>\n              </span>\n        </div>\x3c!-- /input-group --\x3e\n\n        <div class="description">\n            <br/>\n            <br/>\n            <p> This API token allows you to access ADS data programmatically. For instance, to fetch the first few bibcodes for the query "star", make the following request: </p>\n            <p>\n                <code> curl -H \'Authorization: Bearer:'+(null!=(r=t.if.call(e,null!=e?e.access_token:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+"' 'http://api.adsabs.harvard.edu/v1/search/query?q=star&fl=bibcode'</code>\n            </p>\n            <p>\n                <i>(If you've generated a token, you can copy-paste the preceding line directly into your terminal)</i>\n            </p>\n            <p> Documentation on how to use the API is available on the <a href=\"https://github.com/adsabs/adsabs-dev-api#access-settings\"> ADS API Github repo.</a></p>\n            <p> <b>Make sure to keep your API key secret to protect it from abuse.</b></p>\n            <p> If your key has been exposed publically (say, by accidentally  being commited to a Github repo) you can generate a new one by clicking on the button above. </p>\n        </div>\n\n"},4:function(e,t,n,i){var r;return this.escapeExpression("function"==typeof(r=null!=(r=t.access_token||(null!=e?e.access_token:e))?r:t.helperMissing)?r.call(e,{name:"access_token",hash:{},data:i}):r)},6:function(e,t,n,i){return" No token currently exists "},8:function(e,t,n,i){return"[YOUR TOKEN HERE]"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="panel panel-default form-horizontal s-form-container">\n    <legend class="panel-heading"> API Token\n    </legend>\n    <div class="panel-body">\n\n'+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"\n    </div>\n\n\n</div>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/api_key",n),n}),define("hbs!js/widgets/user_settings/templates/change_email",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="panel panel-default s-form-container">\n    <legend class="panel-heading"> Change Email Address\n    </legend>\n    <form class="panel-body">\n        <div class="form-group">\n            <label class="control-label">Current email address:&nbsp;&nbsp; </label>\n            <p class="form-control-static">'+this.escapeExpression("function"==typeof(r=null!=(r=t.user||(null!=e?e.user:e))?r:t.helperMissing)?r.call(e,{name:"user",hash:{},data:i}):r)+'</p>\n        </div>\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> New email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="email" id="email">\n        </div>\n\n        <div class="form-group has-feedback">\n            <label for="email" class="control-label"> Confirm new email address </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="email" class="form-control" name="confirm-email" id="confirm-email">\n        </div>\n\n        <div class="form-group has-feedback">\n            <label for="password" class="control-label"> Password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="password" id="password">\n        </div>\n\n        <div class="form-group">\n           <div>\n                You will be logged out of your account until you click\n                the link from the verification email.\n            </div>\n            <button class="btn btn-primary-faded initial-submit" type="submit" data-toggle="modal" data-target=".confirm-change-email">Change my email</button>\n\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/change_email",n),n}),define("hbs!js/widgets/user_settings/templates/change_password",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default s-form-container">\n    <legend class="panel-heading"> Change Your Password\n    </legend>\n    <form class="panel-body">\n        <div class="form-group has-feedback">\n            <label for="old_password" class="control-label"> Current password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="old_password" id="old_password">\n        </div>\n        <div class="form-group has-feedback">\n            <label for="new_password1" class="control-label"> New password </label>\n            <span class="help-block no-show s-help-block"></span>\n            <div class="s-user-help">Passwords should be at least five characters and include at least one number and one letter.</div>\n            <input type="password" class="form-control" name="new_password1" id="new_password1" >\n\n        </div>\n        <div class="form-group has-feedback">\n            <label for="new_password2" class="control-label"> Retype new password  </label>\n            <span class="help-block no-show s-help-block"></span>\n            <input type="password" class="form-control" name="new_password2" id="new_password2">\n\n        </div>\n\n\n        <div class="form-group">\n            <button type="submit" class="btn btn-primary-faded">Submit</button>\n            <span class="help-block no-show s-help-block"></span>\n        </div>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/change_password",n),n}),define("hbs!js/widgets/user_settings/templates/delete_account",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="panel panel-default s-form-container">\n    <legend class="panel-heading">Delete Account\n    </legend>\n    <div class="panel-body">\n        <div class="form-group">\n            <p> This action cannot be reversed.\n            </p>\n            <div>\n                <button type="button" class="btn btn-primary" data-toggle="modal" data-target=".confirm-delete">Delete my account</button>\n            </div>\n        </div>\n\n    </div>\n</div>\n\n<div class="modal fade confirm-delete" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" aria-hidden="true">\n    <div class="modal-dialog modal-sm">\n        <div class="modal-content">\n            <div class="modal-header">\n              <h4>  <i class="fa fa-lg fa-exclamation-triangle"></i> Confirm deletion</h4>\n            </div>\n            <div class="modal-body">\n                Are you sure you want to delete your account permanently?\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-sm btn-default" data-dismiss="modal">Cancel</button>\n                <button type="submit" class="btn btn-sm btn-primary" data-dismiss="modal">Yes, delete my account</button>\n            </div>\n        </div>\n\n    </div>\n</div>'},useData:!0});return t.registerPartial("js/widgets/user_settings/templates/delete_account",n),n}),define("js/widgets/user_settings/widget",["marionette","js/widgets/base/base_widget","js/mixins/form_view_functions","js/widgets/success/view","js/components/api_feedback","hbs!js/widgets/user_settings/templates/api_key","hbs!js/widgets/user_settings/templates/change_email","hbs!js/widgets/user_settings/templates/change_password","hbs!js/widgets/user_settings/templates/delete_account","backbone-validation","backbone.stickit","bootstrap"],function(e,t,n,i,r,a,s,o,l,c){var u,d,h=/(?=.*\d)(?=.*[a-zA-Z]).{5,}/;u=e.ItemView.extend({activateValidation:n.activateValidation,checkValidationState:n.checkValidationState,triggerSubmit:n.triggerSubmit,modelEvents:{change:"checkValidationState"},events:{"click button[type=submit]":"triggerSubmit"}});var p,f;f=(d=Backbone.Model.extend({isValidSafe:n.isValidSafe,reset:n.reset})).extend({validation:{email:{required:!0,pattern:"email",msg:"(A valid email is required)"},"confirm-email":{required:!0,pattern:"email",equalTo:"email",msg:"(This email must be valid and match the one above)"},password:{required:!0,pattern:h,msg:"(A valid password is required)"}}}),p=u.extend({template:s,className:"change-email",triggerSubmit:function(){this.model.unset("user"),n.triggerSubmit.apply(this,arguments)},checkValidationState:function(){this.model.isValidSafe()&&this.$("button.initial-submit").prev(".help-block").html("").addClass("no-show")},bindings:{"input[name=email]":{observe:"email",setOptions:{validate:!0}},"input[name=confirm-email]":{observe:"confirm-email",setOptions:{validate:!0}},"input[name=password]":{observe:"password",setOptions:{validate:!0}}},onRender:function(){this.activateValidation()}});var g,m;m=d.extend({validation:{old_password:{required:!0,pattern:h,msg:"(A valid password is required)"},new_password1:{required:!0,pattern:h,msg:"(A valid password is required)"},new_password2:{required:!0,equalTo:"new_password1",pattern:h,msg:"(The passwords do not match)"}}}),g=u.extend({template:o,className:"change-password",onRender:function(){this.activateValidation()},bindings:{"input[name=old_password]":{observe:"old_password",setOptions:{validate:!0}},"input[name=new_password1]":{observe:"new_password1",setOptions:{validate:!0}},"input[name=new_password2]":{observe:"new_password2",setOptions:{validate:!0}}}});var b,v;v=Backbone.Model.extend({defaults:function(){return{access_token:void 0,loading:!1}}}),b=e.ItemView.extend({template:a,className:"change-token",triggerSubmit:n.triggerSubmit,events:{"click button[type=submit]":"triggerSubmit"},modelEvents:{"change:access_token":"render","change:loading":"render"}});var y,w;w=d.extend({}),y=u.extend({template:l,className:"delete-account",triggerSubmit:function(){this.$(".modal").modal("hide"),$("body").removeClass("modal-open"),$(".modal-backdrop").remove(),n.triggerSubmit.apply(this,arguments)}});var x;x=e.LayoutView.extend({template:function(){return'<div class="content-container"></div>'},className:"s-user-settings s-form-widget",regions:{content:".content-container"},events:{"click .user-pill-nav a:not(.dropdown-toggle)":"stopPropagation"},stopPropagation:function(){return!1},setSubView:function(t){var n=e.getOption(this,"config"),i=new n[t].model,r=new n[t].view({model:i}),a=this;this.model.set("subView",t),"token"==t?this.model.get("access_token")?i.set("access_token",this.model.get("access_token")):(i.set("loading",!0),this.getToken().done(function(e){a.model.set("access_token",e.access_token),i.set("access_token",e.access_token),i.set("loading",!1)})):"email"==t&&i.set("user",this.model.get("user")),this.listenToOnce(r,"submit-form",this.forwardSubmit),this.content.show(r)},showPasswordSuccessView:function(){this.content.show(new i({title:"Password Changed",message:"Next time you log in, please use your new password"}))},forwardSubmit:function(e){this.trigger("submit-form",e)}});var S=Backbone.Model.extend({defaults:function(){return{user:void 0,token:void 0,subView:void 0}}});return t.extend({config:{email:{view:p,model:f},password:{view:g,model:m},token:{view:b,model:v},delete:{view:y,model:w}},initialize:function(e){e=e||{},this.model=new S,this.view=new x({model:this.model,config:this.config}),t.prototype.initialize.apply(this,arguments)},setSubView:function(e){_.isArray(e)&&(e=e[0]),this.view.setSubView(e)},activate:function(e){var t=this;this.setBeeHive(e);var n=e.getService("PubSub");_.bindAll(this,["handleUserAnnouncement"]),n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),this.view.getToken=function(){return t.getBeeHive().getObject("User").getToken()},this.model.set("user",this.getBeeHive().getObject("User").getUserName())},viewEvents:{"submit-form":"submitForm"},handleUserAnnouncement:function(e,t){var n=this.getBeeHive().getObject("User");e==n.USER_SIGNED_IN?this.model.set("user",t):e==n.USER_SIGNED_OUT&&this.model.clear()},submitForm:function(e){var t=this.getBeeHive().getObject("User"),n=this;e instanceof this.config.token.model?t.generateToken().done(function(e){n.model.set("access_token",e.access_token),n.setSubView("token")}):e instanceof this.config.delete.model?t.deleteAccount():e instanceof this.config.email.model?t.changeEmail(e.toJSON()):e instanceof this.config.password.model&&t.changePassword(e.toJSON()).done(function(){n.view.showPasswordSuccessView()})}})}),define("hbs!js/widgets/preferences/templates/openurl",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'        <p><i class="icon-loading"></i> Loading...</p>\n'},3:function(e,t,n,i,r,a){var s;return"\n"+(null!=(s=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(4,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'\n    <div id="link-server-container" class="'+(null!=(s=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(7,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'">\n        <br/>\n        <form class="form-inline" >\n            <div class="form-group" style="min-width:300px">\n                <label for="set-link-server">Choose Your Institution</label><br/>\n                <select name="set-link-server" id="set-link-server" class="form-control" style="width: 100%">\n'+(null!=(s=t.each.call(e,null!=e?e.openURLConfig:e,{name:"each",hash:{},fn:this.program(9,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'                </select>\n            </div>\n            <button class="btn btn-sm btn-success submit">submit</button>\n\n            <br/>\n            <br/>\n            <br/>\n\n            <p> <b>Can\'t find your institution in the list above?</b>\n            </p>\n            <p>\n                Please contact your electronic resources librarian\n                and request that he or she email adshelp@cfa.harvard.edu with the relevant openurl information.\n            </p>\n            <p>\n                If you are still having difficulties, <b><a href="mailto:adshelp@cfa.harvard.edu">contact us</a></b> for help.\n            </p>\n        </form>\n        <br/>\n\n    </div>\n\n'},4:function(e,t,n,i){var r,a;return'    <div class="current-link-server">\n        <p>Your Library Link Server is set to <b>'+(null!=(r="function"==typeof(a=null!=(a=t.openURLName||(null!=e?e.openURLName:e))?a:t.helperMissing)?a.call(e,{name:"openURLName",hash:{},data:i}):a)?r:"")+'</b>.</p>\n        <button class="btn btn-primary-faded btn-sm '+(null!=(r=t.if.call(e,null!=e?e.openURLName:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+'" data-toggle="collapse" data-target="#link-server-container"><i class="toggle-icon"></i> Change Library Link Server</button>\n    </div>\n'},5:function(e,t,n,i){return" collapsed "},7:function(e,t,n,i){return" collapse "},9:function(e,t,n,i,r,a){var s;return'                    <option value="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=a[1]?a[1].link_server:a[1],null!=e?e.link:e,{name:"compare",hash:{},fn:this.program(10,i,0,r,a),inverse:this.noop,data:i}))?s:"")+" >"+(null!=(s=this.lambda(null!=e?e.name:e,e))?s:"")+"</option>\n"},10:function(e,t,n,i){return' selected="selected" '},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,r,a){var s;return'<div class="panel-heading"> Library Link Server </div>\n\n<div class="panel-body">\n'+(null!=(s=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0,r,a),inverse:this.program(3,i,0,r,a),data:i}))?s:"")+"</div>\n\n\n"},useData:!0,useDepths:!0});return t.registerPartial("js/widgets/preferences/templates/openurl",n),n}),function(e){"function"==typeof define&&define.amd?define("select2",["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var t=function(){if(e&&e.fn&&e.fn.select2&&e.fn.select2.amd)t=e.fn.select2.amd;var t;return function(){if(!t||!t.requirejs){t?n=t:t={};var e,n,i;!function(t){function r(e,t){return w.call(e,t)}function a(e,t){var n,i,r,a,s,o,l,c,u,d,h,p=t&&t.split("/"),f=v.map,g=f&&f["*"]||{};if(e&&"."===e.charAt(0))if(t){for(s=(e=e.split("/")).length-1,v.nodeIdCompat&&x.test(e[s])&&(e[s]=e[s].replace(x,"")),e=p.slice(0,p.length-1).concat(e),u=0;u<e.length;u+=1)if("."===(h=e[u]))e.splice(u,1),u-=1;else if(".."===h){if(1===u&&(".."===e[2]||".."===e[0]))break;u>0&&(e.splice(u-1,2),u-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((p||g)&&f){for(u=(n=e.split("/")).length;u>0;u-=1){if(i=n.slice(0,u).join("/"),p)for(d=p.length;d>0;d-=1)if((r=f[p.slice(0,d).join("/")])&&(r=r[i])){a=r,o=u;break}if(a)break;!l&&g&&g[i]&&(l=g[i],c=u)}!a&&l&&(a=l,o=c),a&&(n.splice(0,o,a),e=n.join("/"))}return e}function s(e,n){return function(){var i=_.call(arguments,0);return"string"!=typeof i[0]&&1===i.length&&i.push(null),p.apply(t,i.concat([e,n]))}}function o(e){return function(t){return a(t,e)}}function l(e){return function(t){m[e]=t}}function c(e){if(r(b,e)){var n=b[e];delete b[e],y[e]=!0,h.apply(t,n)}if(!r(m,e)&&!r(y,e))throw new Error("No "+e);return m[e]}function u(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function d(e){return function(){return v&&v.config&&v.config[e]||{}}}var h,p,f,g,m={},b={},v={},y={},w=Object.prototype.hasOwnProperty,_=[].slice,x=/\.js$/;f=function(e,t){var n,i=u(e),r=i[0];return e=i[1],r&&(n=c(r=a(r,t))),r?e=n&&n.normalize?n.normalize(e,o(t)):a(e,t):(r=(i=u(e=a(e,t)))[0],e=i[1],r&&(n=c(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},g={require:function(e){return s(e)},exports:function(e){var t=m[e];return void 0!==t?t:m[e]={}},module:function(e){return{id:e,uri:"",exports:m[e],config:d(e)}}},h=function(e,n,i,a){var o,u,d,h,p,v,w=[],_=typeof i;if(a=a||e,"undefined"===_||"function"===_){for(n=!n.length&&i.length?["require","exports","module"]:n,p=0;p<n.length;p+=1)if(h=f(n[p],a),"require"===(u=h.f))w[p]=g.require(e);else if("exports"===u)w[p]=g.exports(e),v=!0;else if("module"===u)o=w[p]=g.module(e);else if(r(m,u)||r(b,u)||r(y,u))w[p]=c(u);else{if(!h.p)throw new Error(e+" missing "+u);h.p.load(h.n,s(a,!0),l(u),{}),w[p]=m[u]}d=i?i.apply(m[e],w):void 0,e&&(o&&o.exports!==t&&o.exports!==m[e]?m[e]=o.exports:d===t&&v||(m[e]=d))}else e&&(m[e]=i)},e=n=p=function(e,n,i,r,a){if("string"==typeof e)return g[e]?g[e](n):c(f(e,n).f);if(!e.splice){if((v=e).deps&&p(v.deps,v.callback),!n)return;n.splice?(e=n,n=i,i=null):e=t}return n=n||function(){},"function"==typeof i&&(i=r,r=a),r?h(t,e,n,i):setTimeout(function(){h(t,e,n,i)},4),p},p.config=function(e){return p(e)},e._defined=m,(i=function(e,t,n){if("string"!=typeof e)throw new Error("See almond README: incorrect module build, no module name");t.splice||(n=t,t=[]),r(m,e)||r(b,e)||(b[e]=[e,t,n])}).amd={jQuery:!0}}(),t.requirejs=e,t.require=n,t.define=i}}(),t.define("almond",function(){}),t.define("jquery",[],function(){var t=e||$;return null==t&&console&&console.error&&console.error("Select2: An instance of jQuery or a jQuery-compatible library was not found. Make sure that you are including jQuery before Select2 on your web page."),t}),t.define("select2/utils",["jquery"],function(e){function t(e){var t=e.prototype,n=[];for(var i in t)"function"==typeof t[i]&&"constructor"!==i&&n.push(i);return n}var n={};n.Extend=function(e,t){function n(){this.constructor=e}var i={}.hasOwnProperty;for(var r in t)i.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},n.Decorate=function(e,n){function i(){var t=Array.prototype.unshift,i=n.prototype.constructor.length,r=e.prototype.constructor;i>0&&(t.call(arguments,e.prototype.constructor),r=n.prototype.constructor),r.apply(this,arguments)}var r=t(n),a=t(e);n.displayName=e.displayName,i.prototype=new function(){this.constructor=i};for(var s=0;s<a.length;s++){var o=a[s];i.prototype[o]=e.prototype[o]}for(var l=0;l<r.length;l++){var c=r[l];i.prototype[c]=function(e){var t=function(){};e in i.prototype&&(t=i.prototype[e]);var r=n.prototype[e];return function(){return Array.prototype.unshift.call(arguments,t),r.apply(this,arguments)}}(c)}return i};var i=function(){this.listeners={}};return i.prototype.on=function(e,t){this.listeners=this.listeners||{},e in this.listeners?this.listeners[e].push(t):this.listeners[e]=[t]},i.prototype.trigger=function(e){var t=Array.prototype.slice,n=t.call(arguments,1);this.listeners=this.listeners||{},null==n&&(n=[]),0===n.length&&n.push({}),n[0]._type=e,e in this.listeners&&this.invoke(this.listeners[e],t.call(arguments,1)),"*"in this.listeners&&this.invoke(this.listeners["*"],arguments)},i.prototype.invoke=function(e,t){for(var n=0,i=e.length;n<i;n++)e[n].apply(this,t)},n.Observable=i,n.generateChars=function(e){for(var t="",n=0;n<e;n++)t+=Math.floor(36*Math.random()).toString(36);return t},n.bind=function(e,t){return function(){e.apply(t,arguments)}},n._convertData=function(e){for(var t in e){var n=t.split("-"),i=e;if(1!==n.length){for(var r=0;r<n.length;r++){var a=n[r];(a=a.substring(0,1).toLowerCase()+a.substring(1))in i||(i[a]={}),r==n.length-1&&(i[a]=e[t]),i=i[a]}delete e[t]}}return e},n.hasScroll=function(t,n){var i=e(n),r=n.style.overflowX,a=n.style.overflowY;return(r!==a||"hidden"!==a&&"visible"!==a)&&("scroll"===r||"scroll"===a||(i.innerHeight()<n.scrollHeight||i.innerWidth()<n.scrollWidth))},n.escapeMarkup=function(e){var t={"\\":"&#92;","&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#47;"};return"string"!=typeof e?e:String(e).replace(/[&<>"'\/\\]/g,function(e){return t[e]})},n.appendMany=function(t,n){if("1.7"===e.fn.jquery.substr(0,3)){var i=e();e.map(n,function(e){i=i.add(e)}),n=i}t.append(n)},n}),t.define("select2/results",["jquery","./utils"],function(e,t){function n(e,t,i){this.$element=e,this.data=i,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<ul class="select2-results__options" role="tree"></ul>');return this.options.get("multiple")&&t.attr("aria-multiselectable","true"),this.$results=t,t},n.prototype.clear=function(){this.$results.empty()},n.prototype.displayMessage=function(t){var n=this.options.get("escapeMarkup");this.clear(),this.hideLoading();var i=e('<li role="treeitem" aria-live="assertive" class="select2-results__option"></li>'),r=this.options.get("translations").get(t.message);i.append(n(r(t.args))),i[0].className+=" select2-results__message",this.$results.append(i)},n.prototype.hideMessages=function(){this.$results.find(".select2-results__message").remove()},n.prototype.append=function(e){this.hideLoading();var t=[];if(null!=e.results&&0!==e.results.length){e.results=this.sort(e.results);for(var n=0;n<e.results.length;n++){var i=e.results[n],r=this.option(i);t.push(r)}this.$results.append(t)}else 0===this.$results.children().length&&this.trigger("results:message",{message:"noResults"})},n.prototype.position=function(e,t){t.find(".select2-results").append(e)},n.prototype.sort=function(e){return this.options.get("sorter")(e)},n.prototype.highlightFirstItem=function(){var e=this.$results.find(".select2-results__option[aria-selected]"),t=e.filter("[aria-selected=true]");t.length>0?t.first().trigger("mouseenter"):e.first().trigger("mouseenter"),this.ensureHighlightVisible()},n.prototype.setClasses=function(){var t=this;this.data.current(function(n){var i=e.map(n,function(e){return e.id.toString()});t.$results.find(".select2-results__option[aria-selected]").each(function(){var t=e(this),n=e.data(this,"data"),r=""+n.id;null!=n.element&&n.element.selected||null==n.element&&e.inArray(r,i)>-1?t.attr("aria-selected","true"):t.attr("aria-selected","false")})})},n.prototype.showLoading=function(e){this.hideLoading();var t={disabled:!0,loading:!0,text:this.options.get("translations").get("searching")(e)},n=this.option(t);n.className+=" loading-results",this.$results.prepend(n)},n.prototype.hideLoading=function(){this.$results.find(".loading-results").remove()},n.prototype.option=function(t){var n=document.createElement("li");n.className="select2-results__option";var i={role:"treeitem","aria-selected":"false"};t.disabled&&(delete i["aria-selected"],i["aria-disabled"]="true"),null==t.id&&delete i["aria-selected"],null!=t._resultId&&(n.id=t._resultId),t.title&&(n.title=t.title),t.children&&(i.role="group",i["aria-label"]=t.text,delete i["aria-selected"]);for(var r in i){var a=i[r];n.setAttribute(r,a)}if(t.children){var s=e(n),o=document.createElement("strong");o.className="select2-results__group";e(o);this.template(t,o);for(var l=[],c=0;c<t.children.length;c++){var u=t.children[c],d=this.option(u);l.push(d)}var h=e("<ul></ul>",{class:"select2-results__options select2-results__options--nested"});h.append(l),s.append(o),s.append(h)}else this.template(t,n);return e.data(n,"data",t),n},n.prototype.bind=function(t,n){var i=this,r=t.id+"-results";this.$results.attr("id",r),t.on("results:all",function(e){i.clear(),i.append(e.data),t.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),t.on("results:append",function(e){i.append(e.data),t.isOpen()&&i.setClasses()}),t.on("query",function(e){i.hideMessages(),i.showLoading(e)}),t.on("select",function(){t.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),t.on("unselect",function(){t.isOpen()&&(i.setClasses(),i.highlightFirstItem())}),t.on("open",function(){i.$results.attr("aria-expanded","true"),i.$results.attr("aria-hidden","false"),i.setClasses(),i.ensureHighlightVisible()}),t.on("close",function(){i.$results.attr("aria-expanded","false"),i.$results.attr("aria-hidden","true"),i.$results.removeAttr("aria-activedescendant")}),t.on("results:toggle",function(){var e=i.getHighlightedResults();0!==e.length&&e.trigger("mouseup")}),t.on("results:select",function(){var e=i.getHighlightedResults();if(0!==e.length){var t=e.data("data");"true"==e.attr("aria-selected")?i.trigger("close",{}):i.trigger("select",{data:t})}}),t.on("results:previous",function(){var e=i.getHighlightedResults(),t=i.$results.find("[aria-selected]"),n=t.index(e);if(0!==n){var r=n-1;0===e.length&&(r=0);var a=t.eq(r);a.trigger("mouseenter");var s=i.$results.offset().top,o=a.offset().top,l=i.$results.scrollTop()+(o-s);0===r?i.$results.scrollTop(0):o-s<0&&i.$results.scrollTop(l)}}),t.on("results:next",function(){var e=i.getHighlightedResults(),t=i.$results.find("[aria-selected]"),n=t.index(e)+1;if(!(n>=t.length)){var r=t.eq(n);r.trigger("mouseenter");var a=i.$results.offset().top+i.$results.outerHeight(!1),s=r.offset().top+r.outerHeight(!1),o=i.$results.scrollTop()+s-a;0===n?i.$results.scrollTop(0):s>a&&i.$results.scrollTop(o)}}),t.on("results:focus",function(e){e.element.addClass("select2-results__option--highlighted")}),t.on("results:message",function(e){i.displayMessage(e)}),e.fn.mousewheel&&this.$results.on("mousewheel",function(e){var t=i.$results.scrollTop(),n=i.$results.get(0).scrollHeight-t+e.deltaY,r=e.deltaY>0&&t-e.deltaY<=0,a=e.deltaY<0&&n<=i.$results.height();r?(i.$results.scrollTop(0),e.preventDefault(),e.stopPropagation()):a&&(i.$results.scrollTop(i.$results.get(0).scrollHeight-i.$results.height()),e.preventDefault(),e.stopPropagation())}),this.$results.on("mouseup",".select2-results__option[aria-selected]",function(t){var n=e(this),r=n.data("data");"true"!==n.attr("aria-selected")?i.trigger("select",{originalEvent:t,data:r}):i.options.get("multiple")?i.trigger("unselect",{originalEvent:t,data:r}):i.trigger("close",{})}),this.$results.on("mouseenter",".select2-results__option[aria-selected]",function(t){var n=e(this).data("data");i.getHighlightedResults().removeClass("select2-results__option--highlighted"),i.trigger("results:focus",{data:n,element:e(this)})})},n.prototype.getHighlightedResults=function(){return this.$results.find(".select2-results__option--highlighted")},n.prototype.destroy=function(){this.$results.remove()},n.prototype.ensureHighlightVisible=function(){var e=this.getHighlightedResults();if(0!==e.length){var t=this.$results.find("[aria-selected]").index(e),n=this.$results.offset().top,i=e.offset().top,r=this.$results.scrollTop()+(i-n),a=i-n;r-=2*e.outerHeight(!1),t<=2?this.$results.scrollTop(0):(a>this.$results.outerHeight()||a<0)&&this.$results.scrollTop(r)}},n.prototype.template=function(t,n){var i=this.options.get("templateResult"),r=this.options.get("escapeMarkup"),a=i(t,n);null==a?n.style.display="none":"string"==typeof a?n.innerHTML=r(a):e(n).append(a)},n}),t.define("select2/keys",[],function(){return{BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,ESC:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,DELETE:46}}),t.define("select2/selection/base",["jquery","../utils","../keys"],function(e,t,n){function i(e,t){this.$element=e,this.options=t,i.__super__.constructor.call(this)}return t.Extend(i,t.Observable),i.prototype.render=function(){var t=e('<span class="select2-selection" role="combobox"  aria-haspopup="true" aria-expanded="false"></span>');return this._tabindex=0,null!=this.$element.data("old-tabindex")?this._tabindex=this.$element.data("old-tabindex"):null!=this.$element.attr("tabindex")&&(this._tabindex=this.$element.attr("tabindex")),t.attr("title",this.$element.attr("title")),t.attr("tabindex",this._tabindex),this.$selection=t,t},i.prototype.bind=function(e,t){var i=this,r=(e.id,e.id+"-results");this.container=e,this.$selection.on("focus",function(e){i.trigger("focus",e)}),this.$selection.on("blur",function(e){i._handleBlur(e)}),this.$selection.on("keydown",function(e){i.trigger("keypress",e),e.which===n.SPACE&&e.preventDefault()}),e.on("results:focus",function(e){i.$selection.attr("aria-activedescendant",e.data._resultId)}),e.on("selection:update",function(e){i.update(e.data)}),e.on("open",function(){i.$selection.attr("aria-expanded","true"),i.$selection.attr("aria-owns",r),i._attachCloseHandler(e)}),e.on("close",function(){i.$selection.attr("aria-expanded","false"),i.$selection.removeAttr("aria-activedescendant"),i.$selection.removeAttr("aria-owns"),i.$selection.focus(),i._detachCloseHandler(e)}),e.on("enable",function(){i.$selection.attr("tabindex",i._tabindex)}),e.on("disable",function(){i.$selection.attr("tabindex","-1")})},i.prototype._handleBlur=function(t){var n=this;window.setTimeout(function(){document.activeElement==n.$selection[0]||e.contains(n.$selection[0],document.activeElement)||n.trigger("blur",t)},1)},i.prototype._attachCloseHandler=function(t){e(document.body).on("mousedown.select2."+t.id,function(t){var n=e(t.target).closest(".select2");e(".select2.select2-container--open").each(function(){var t=e(this);this!=n[0]&&t.data("element").select2("close")})})},i.prototype._detachCloseHandler=function(t){e(document.body).off("mousedown.select2."+t.id)},i.prototype.position=function(e,t){t.find(".selection").append(e)},i.prototype.destroy=function(){this._detachCloseHandler(this.container)},i.prototype.update=function(e){throw new Error("The `update` method must be defined in child classes.")},i}),t.define("select2/selection/single",["jquery","./base","../utils","../keys"],function(e,t,n,i){function r(){r.__super__.constructor.apply(this,arguments)}return n.Extend(r,t),r.prototype.render=function(){var e=r.__super__.render.call(this);return e.addClass("select2-selection--single"),e.html('<span class="select2-selection__rendered"></span><span class="select2-selection__arrow" role="presentation"><b role="presentation"></b></span>'),e},r.prototype.bind=function(e,t){var n=this;r.__super__.bind.apply(this,arguments);var i=e.id+"-container";this.$selection.find(".select2-selection__rendered").attr("id",i),this.$selection.attr("aria-labelledby",i),this.$selection.on("mousedown",function(e){1===e.which&&n.trigger("toggle",{originalEvent:e})}),this.$selection.on("focus",function(e){}),this.$selection.on("blur",function(e){}),e.on("focus",function(t){e.isOpen()||n.$selection.focus()}),e.on("selection:update",function(e){n.update(e.data)})},r.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},r.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},r.prototype.selectionContainer=function(){return e("<span></span>")},r.prototype.update=function(e){if(0!==e.length){var t=e[0],n=this.$selection.find(".select2-selection__rendered"),i=this.display(t,n);n.empty().append(i),n.prop("title",t.title||t.text)}else this.clear()},r}),t.define("select2/selection/multiple",["jquery","./base","../utils"],function(e,t,n){function i(e,t){i.__super__.constructor.apply(this,arguments)}return n.Extend(i,t),i.prototype.render=function(){var e=i.__super__.render.call(this);return e.addClass("select2-selection--multiple"),e.html('<ul class="select2-selection__rendered"></ul>'),e},i.prototype.bind=function(t,n){var r=this;i.__super__.bind.apply(this,arguments),this.$selection.on("click",function(e){r.trigger("toggle",{originalEvent:e})}),this.$selection.on("click",".select2-selection__choice__remove",function(t){if(!r.options.get("disabled")){var n=e(this).parent().data("data");r.trigger("unselect",{originalEvent:t,data:n})}})},i.prototype.clear=function(){this.$selection.find(".select2-selection__rendered").empty()},i.prototype.display=function(e,t){var n=this.options.get("templateSelection");return this.options.get("escapeMarkup")(n(e,t))},i.prototype.selectionContainer=function(){return e('<li class="select2-selection__choice"><span class="select2-selection__choice__remove" role="presentation">&times;</span></li>')},i.prototype.update=function(e){if(this.clear(),0!==e.length){for(var t=[],i=0;i<e.length;i++){var r=e[i],a=this.selectionContainer(),s=this.display(r,a);a.append(s),a.prop("title",r.title||r.text),a.data("data",r),t.push(a)}var o=this.$selection.find(".select2-selection__rendered");n.appendMany(o,t)}},i}),t.define("select2/selection/placeholder",["../utils"],function(e){function t(e,t,n){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n)}return t.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},t.prototype.createPlaceholder=function(e,t){var n=this.selectionContainer();return n.html(this.display(t)),n.addClass("select2-selection__placeholder").removeClass("select2-selection__choice"),n},t.prototype.update=function(e,t){var n=1==t.length&&t[0].id!=this.placeholder.id;if(t.length>1||n)return e.call(this,t);this.clear();var i=this.createPlaceholder(this.placeholder);this.$selection.find(".select2-selection__rendered").append(i)},t}),t.define("select2/selection/allowClear",["jquery","../keys"],function(e,t){function n(){}return n.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),null==this.placeholder&&this.options.get("debug")&&window.console&&console.error&&console.error("Select2: The `allowClear` option should be used in combination with the `placeholder` option."),this.$selection.on("mousedown",".select2-selection__clear",function(e){i._handleClear(e)}),t.on("keypress",function(e){i._handleKeyboardClear(e,t)})},n.prototype._handleClear=function(e,t){if(!this.options.get("disabled")){var n=this.$selection.find(".select2-selection__clear");if(0!==n.length){t.stopPropagation();for(var i=n.data("data"),r=0;r<i.length;r++){var a={data:i[r]};if(this.trigger("unselect",a),a.prevented)return}this.$element.val(this.placeholder.id).trigger("change"),this.trigger("toggle",{})}}},n.prototype._handleKeyboardClear=function(e,n,i){i.isOpen()||n.which!=t.DELETE&&n.which!=t.BACKSPACE||this._handleClear(n)},n.prototype.update=function(t,n){if(t.call(this,n),!(this.$selection.find(".select2-selection__placeholder").length>0||0===n.length)){var i=e('<span class="select2-selection__clear">&times;</span>');i.data("data",n),this.$selection.find(".select2-selection__rendered").prepend(i)}},n}),t.define("select2/selection/search",["jquery","../utils","../keys"],function(e,t,n){function i(e,t,n){e.call(this,t,n)}return i.prototype.render=function(t){var n=e('<li class="select2-search select2-search--inline"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" aria-autocomplete="list" /></li>');this.$searchContainer=n,this.$search=n.find("input");var i=t.call(this);return this._transferTabIndex(),i},i.prototype.bind=function(e,t,i){var r=this;e.call(this,t,i),t.on("open",function(){r.$search.trigger("focus")}),t.on("close",function(){r.$search.val(""),r.$search.removeAttr("aria-activedescendant"),r.$search.trigger("focus")}),t.on("enable",function(){r.$search.prop("disabled",!1),r._transferTabIndex()}),t.on("disable",function(){r.$search.prop("disabled",!0)}),t.on("focus",function(e){r.$search.trigger("focus")}),t.on("results:focus",function(e){r.$search.attr("aria-activedescendant",e.id)}),this.$selection.on("focusin",".select2-search--inline",function(e){r.trigger("focus",e)}),this.$selection.on("focusout",".select2-search--inline",function(e){r._handleBlur(e)}),this.$selection.on("keydown",".select2-search--inline",function(e){if(e.stopPropagation(),r.trigger("keypress",e),r._keyUpPrevented=e.isDefaultPrevented(),e.which===n.BACKSPACE&&""===r.$search.val()){var t=r.$searchContainer.prev(".select2-selection__choice");if(t.length>0){var i=t.data("data");r.searchRemoveChoice(i),e.preventDefault()}}});var a=document.documentMode,s=a&&a<=11;this.$selection.on("input.searchcheck",".select2-search--inline",function(e){s?r.$selection.off("input.search input.searchcheck"):r.$selection.off("keyup.search")}),this.$selection.on("keyup.search input.search",".select2-search--inline",function(e){if(s&&"input"===e.type)r.$selection.off("input.search input.searchcheck");else{var t=e.which;t!=n.SHIFT&&t!=n.CTRL&&t!=n.ALT&&t!=n.TAB&&r.handleSearch(e)}})},i.prototype._transferTabIndex=function(e){this.$search.attr("tabindex",this.$selection.attr("tabindex")),this.$selection.attr("tabindex","-1")},i.prototype.createPlaceholder=function(e,t){this.$search.attr("placeholder",t.text)},i.prototype.update=function(e,t){var n=this.$search[0]==document.activeElement;this.$search.attr("placeholder",""),e.call(this,t),this.$selection.find(".select2-selection__rendered").append(this.$searchContainer),this.resizeSearch(),n&&this.$search.focus()},i.prototype.handleSearch=function(){if(this.resizeSearch(),!this._keyUpPrevented){var e=this.$search.val();this.trigger("query",{term:e})}this._keyUpPrevented=!1},i.prototype.searchRemoveChoice=function(e,t){this.trigger("unselect",{data:t}),this.$search.val(t.text),this.handleSearch()},i.prototype.resizeSearch=function(){this.$search.css("width","25px");var e="";e=""!==this.$search.attr("placeholder")?this.$selection.find(".select2-selection__rendered").innerWidth():.75*(this.$search.val().length+1)+"em",this.$search.css("width",e)},i}),t.define("select2/selection/eventRelay",["jquery"],function(e){function t(){}return t.prototype.bind=function(t,n,i){var r=this,a=["open","opening","close","closing","select","selecting","unselect","unselecting"],s=["opening","closing","selecting","unselecting"];t.call(this,n,i),n.on("*",function(t,n){if(-1!==e.inArray(t,a)){n=n||{};var i=e.Event("select2:"+t,{params:n});r.$element.trigger(i),-1!==e.inArray(t,s)&&(n.prevented=i.isDefaultPrevented())}})},t}),t.define("select2/translation",["jquery","require"],function(e,t){function n(e){this.dict=e||{}}return n.prototype.all=function(){return this.dict},n.prototype.get=function(e){return this.dict[e]},n.prototype.extend=function(t){this.dict=e.extend({},t.all(),this.dict)},n._cache={},n.loadPath=function(e){if(!(e in n._cache)){var i=t(e);n._cache[e]=i}return new n(n._cache[e])},n}),t.define("select2/diacritics",[],function(){return{"Ⓐ":"A","Ａ":"A","À":"A","Á":"A","Â":"A","Ầ":"A","Ấ":"A","Ẫ":"A","Ẩ":"A","Ã":"A","Ā":"A","Ă":"A","Ằ":"A","Ắ":"A","Ẵ":"A","Ẳ":"A","Ȧ":"A","Ǡ":"A","Ä":"A","Ǟ":"A","Ả":"A","Å":"A","Ǻ":"A","Ǎ":"A","Ȁ":"A","Ȃ":"A","Ạ":"A","Ậ":"A","Ặ":"A","Ḁ":"A","Ą":"A","Ⱥ":"A","Ɐ":"A","Ꜳ":"AA","Æ":"AE","Ǽ":"AE","Ǣ":"AE","Ꜵ":"AO","Ꜷ":"AU","Ꜹ":"AV","Ꜻ":"AV","Ꜽ":"AY","Ⓑ":"B","Ｂ":"B","Ḃ":"B","Ḅ":"B","Ḇ":"B","Ƀ":"B","Ƃ":"B","Ɓ":"B","Ⓒ":"C","Ｃ":"C","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","Ç":"C","Ḉ":"C","Ƈ":"C","Ȼ":"C","Ꜿ":"C","Ⓓ":"D","Ｄ":"D","Ḋ":"D","Ď":"D","Ḍ":"D","Ḑ":"D","Ḓ":"D","Ḏ":"D","Đ":"D","Ƌ":"D","Ɗ":"D","Ɖ":"D","Ꝺ":"D","Ǳ":"DZ","Ǆ":"DZ","ǲ":"Dz","ǅ":"Dz","Ⓔ":"E","Ｅ":"E","È":"E","É":"E","Ê":"E","Ề":"E","Ế":"E","Ễ":"E","Ể":"E","Ẽ":"E","Ē":"E","Ḕ":"E","Ḗ":"E","Ĕ":"E","Ė":"E","Ë":"E","Ẻ":"E","Ě":"E","Ȅ":"E","Ȇ":"E","Ẹ":"E","Ệ":"E","Ȩ":"E","Ḝ":"E","Ę":"E","Ḙ":"E","Ḛ":"E","Ɛ":"E","Ǝ":"E","Ⓕ":"F","Ｆ":"F","Ḟ":"F","Ƒ":"F","Ꝼ":"F","Ⓖ":"G","Ｇ":"G","Ǵ":"G","Ĝ":"G","Ḡ":"G","Ğ":"G","Ġ":"G","Ǧ":"G","Ģ":"G","Ǥ":"G","Ɠ":"G","Ꞡ":"G","Ᵹ":"G","Ꝿ":"G","Ⓗ":"H","Ｈ":"H","Ĥ":"H","Ḣ":"H","Ḧ":"H","Ȟ":"H","Ḥ":"H","Ḩ":"H","Ḫ":"H","Ħ":"H","Ⱨ":"H","Ⱶ":"H","Ɥ":"H","Ⓘ":"I","Ｉ":"I","Ì":"I","Í":"I","Î":"I","Ĩ":"I","Ī":"I","Ĭ":"I","İ":"I","Ï":"I","Ḯ":"I","Ỉ":"I","Ǐ":"I","Ȉ":"I","Ȋ":"I","Ị":"I","Į":"I","Ḭ":"I","Ɨ":"I","Ⓙ":"J","Ｊ":"J","Ĵ":"J","Ɉ":"J","Ⓚ":"K","Ｋ":"K","Ḱ":"K","Ǩ":"K","Ḳ":"K","Ķ":"K","Ḵ":"K","Ƙ":"K","Ⱪ":"K","Ꝁ":"K","Ꝃ":"K","Ꝅ":"K","Ꞣ":"K","Ⓛ":"L","Ｌ":"L","Ŀ":"L","Ĺ":"L","Ľ":"L","Ḷ":"L","Ḹ":"L","Ļ":"L","Ḽ":"L","Ḻ":"L","Ł":"L","Ƚ":"L","Ɫ":"L","Ⱡ":"L","Ꝉ":"L","Ꝇ":"L","Ꞁ":"L","Ǉ":"LJ","ǈ":"Lj","Ⓜ":"M","Ｍ":"M","Ḿ":"M","Ṁ":"M","Ṃ":"M","Ɱ":"M","Ɯ":"M","Ⓝ":"N","Ｎ":"N","Ǹ":"N","Ń":"N","Ñ":"N","Ṅ":"N","Ň":"N","Ṇ":"N","Ņ":"N","Ṋ":"N","Ṉ":"N","Ƞ":"N","Ɲ":"N","Ꞑ":"N","Ꞥ":"N","Ǌ":"NJ","ǋ":"Nj","Ⓞ":"O","Ｏ":"O","Ò":"O","Ó":"O","Ô":"O","Ồ":"O","Ố":"O","Ỗ":"O","Ổ":"O","Õ":"O","Ṍ":"O","Ȭ":"O","Ṏ":"O","Ō":"O","Ṑ":"O","Ṓ":"O","Ŏ":"O","Ȯ":"O","Ȱ":"O","Ö":"O","Ȫ":"O","Ỏ":"O","Ő":"O","Ǒ":"O","Ȍ":"O","Ȏ":"O","Ơ":"O","Ờ":"O","Ớ":"O","Ỡ":"O","Ở":"O","Ợ":"O","Ọ":"O","Ộ":"O","Ǫ":"O","Ǭ":"O","Ø":"O","Ǿ":"O","Ɔ":"O","Ɵ":"O","Ꝋ":"O","Ꝍ":"O","Ƣ":"OI","Ꝏ":"OO","Ȣ":"OU","Ⓟ":"P","Ｐ":"P","Ṕ":"P","Ṗ":"P","Ƥ":"P","Ᵽ":"P","Ꝑ":"P","Ꝓ":"P","Ꝕ":"P","Ⓠ":"Q","Ｑ":"Q","Ꝗ":"Q","Ꝙ":"Q","Ɋ":"Q","Ⓡ":"R","Ｒ":"R","Ŕ":"R","Ṙ":"R","Ř":"R","Ȑ":"R","Ȓ":"R","Ṛ":"R","Ṝ":"R","Ŗ":"R","Ṟ":"R","Ɍ":"R","Ɽ":"R","Ꝛ":"R","Ꞧ":"R","Ꞃ":"R","Ⓢ":"S","Ｓ":"S","ẞ":"S","Ś":"S","Ṥ":"S","Ŝ":"S","Ṡ":"S","Š":"S","Ṧ":"S","Ṣ":"S","Ṩ":"S","Ș":"S","Ş":"S","Ȿ":"S","Ꞩ":"S","Ꞅ":"S","Ⓣ":"T","Ｔ":"T","Ṫ":"T","Ť":"T","Ṭ":"T","Ț":"T","Ţ":"T","Ṱ":"T","Ṯ":"T","Ŧ":"T","Ƭ":"T","Ʈ":"T","Ⱦ":"T","Ꞇ":"T","Ꜩ":"TZ","Ⓤ":"U","Ｕ":"U","Ù":"U","Ú":"U","Û":"U","Ũ":"U","Ṹ":"U","Ū":"U","Ṻ":"U","Ŭ":"U","Ü":"U","Ǜ":"U","Ǘ":"U","Ǖ":"U","Ǚ":"U","Ủ":"U","Ů":"U","Ű":"U","Ǔ":"U","Ȕ":"U","Ȗ":"U","Ư":"U","Ừ":"U","Ứ":"U","Ữ":"U","Ử":"U","Ự":"U","Ụ":"U","Ṳ":"U","Ų":"U","Ṷ":"U","Ṵ":"U","Ʉ":"U","Ⓥ":"V","Ｖ":"V","Ṽ":"V","Ṿ":"V","Ʋ":"V","Ꝟ":"V","Ʌ":"V","Ꝡ":"VY","Ⓦ":"W","Ｗ":"W","Ẁ":"W","Ẃ":"W","Ŵ":"W","Ẇ":"W","Ẅ":"W","Ẉ":"W","Ⱳ":"W","Ⓧ":"X","Ｘ":"X","Ẋ":"X","Ẍ":"X","Ⓨ":"Y","Ｙ":"Y","Ỳ":"Y","Ý":"Y","Ŷ":"Y","Ỹ":"Y","Ȳ":"Y","Ẏ":"Y","Ÿ":"Y","Ỷ":"Y","Ỵ":"Y","Ƴ":"Y","Ɏ":"Y","Ỿ":"Y","Ⓩ":"Z","Ｚ":"Z","Ź":"Z","Ẑ":"Z","Ż":"Z","Ž":"Z","Ẓ":"Z","Ẕ":"Z","Ƶ":"Z","Ȥ":"Z","Ɀ":"Z","Ⱬ":"Z","Ꝣ":"Z","ⓐ":"a","ａ":"a","ẚ":"a","à":"a","á":"a","â":"a","ầ":"a","ấ":"a","ẫ":"a","ẩ":"a","ã":"a","ā":"a","ă":"a","ằ":"a","ắ":"a","ẵ":"a","ẳ":"a","ȧ":"a","ǡ":"a","ä":"a","ǟ":"a","ả":"a","å":"a","ǻ":"a","ǎ":"a","ȁ":"a","ȃ":"a","ạ":"a","ậ":"a","ặ":"a","ḁ":"a","ą":"a","ⱥ":"a","ɐ":"a","ꜳ":"aa","æ":"ae","ǽ":"ae","ǣ":"ae","ꜵ":"ao","ꜷ":"au","ꜹ":"av","ꜻ":"av","ꜽ":"ay","ⓑ":"b","ｂ":"b","ḃ":"b","ḅ":"b","ḇ":"b","ƀ":"b","ƃ":"b","ɓ":"b","ⓒ":"c","ｃ":"c","ć":"c","ĉ":"c","ċ":"c","č":"c","ç":"c","ḉ":"c","ƈ":"c","ȼ":"c","ꜿ":"c","ↄ":"c","ⓓ":"d","ｄ":"d","ḋ":"d","ď":"d","ḍ":"d","ḑ":"d","ḓ":"d","ḏ":"d","đ":"d","ƌ":"d","ɖ":"d","ɗ":"d","ꝺ":"d","ǳ":"dz","ǆ":"dz","ⓔ":"e","ｅ":"e","è":"e","é":"e","ê":"e","ề":"e","ế":"e","ễ":"e","ể":"e","ẽ":"e","ē":"e","ḕ":"e","ḗ":"e","ĕ":"e","ė":"e","ë":"e","ẻ":"e","ě":"e","ȅ":"e","ȇ":"e","ẹ":"e","ệ":"e","ȩ":"e","ḝ":"e","ę":"e","ḙ":"e","ḛ":"e","ɇ":"e","ɛ":"e","ǝ":"e","ⓕ":"f","ｆ":"f","ḟ":"f","ƒ":"f","ꝼ":"f","ⓖ":"g","ｇ":"g","ǵ":"g","ĝ":"g","ḡ":"g","ğ":"g","ġ":"g","ǧ":"g","ģ":"g","ǥ":"g","ɠ":"g","ꞡ":"g","ᵹ":"g","ꝿ":"g","ⓗ":"h","ｈ":"h","ĥ":"h","ḣ":"h","ḧ":"h","ȟ":"h","ḥ":"h","ḩ":"h","ḫ":"h","ẖ":"h","ħ":"h","ⱨ":"h","ⱶ":"h","ɥ":"h","ƕ":"hv","ⓘ":"i","ｉ":"i","ì":"i","í":"i","î":"i","ĩ":"i","ī":"i","ĭ":"i","ï":"i","ḯ":"i","ỉ":"i","ǐ":"i","ȉ":"i","ȋ":"i","ị":"i","į":"i","ḭ":"i","ɨ":"i","ı":"i","ⓙ":"j","ｊ":"j","ĵ":"j","ǰ":"j","ɉ":"j","ⓚ":"k","ｋ":"k","ḱ":"k","ǩ":"k","ḳ":"k","ķ":"k","ḵ":"k","ƙ":"k","ⱪ":"k","ꝁ":"k","ꝃ":"k","ꝅ":"k","ꞣ":"k","ⓛ":"l","ｌ":"l","ŀ":"l","ĺ":"l","ľ":"l","ḷ":"l","ḹ":"l","ļ":"l","ḽ":"l","ḻ":"l","ſ":"l","ł":"l","ƚ":"l","ɫ":"l","ⱡ":"l","ꝉ":"l","ꞁ":"l","ꝇ":"l","ǉ":"lj","ⓜ":"m","ｍ":"m","ḿ":"m","ṁ":"m","ṃ":"m","ɱ":"m","ɯ":"m","ⓝ":"n","ｎ":"n","ǹ":"n","ń":"n","ñ":"n","ṅ":"n","ň":"n","ṇ":"n","ņ":"n","ṋ":"n","ṉ":"n","ƞ":"n","ɲ":"n","ŉ":"n","ꞑ":"n","ꞥ":"n","ǌ":"nj","ⓞ":"o","ｏ":"o","ò":"o","ó":"o","ô":"o","ồ":"o","ố":"o","ỗ":"o","ổ":"o","õ":"o","ṍ":"o","ȭ":"o","ṏ":"o","ō":"o","ṑ":"o","ṓ":"o","ŏ":"o","ȯ":"o","ȱ":"o","ö":"o","ȫ":"o","ỏ":"o","ő":"o","ǒ":"o","ȍ":"o","ȏ":"o","ơ":"o","ờ":"o","ớ":"o","ỡ":"o","ở":"o","ợ":"o","ọ":"o","ộ":"o","ǫ":"o","ǭ":"o","ø":"o","ǿ":"o","ɔ":"o","ꝋ":"o","ꝍ":"o","ɵ":"o","ƣ":"oi","ȣ":"ou","ꝏ":"oo","ⓟ":"p","ｐ":"p","ṕ":"p","ṗ":"p","ƥ":"p","ᵽ":"p","ꝑ":"p","ꝓ":"p","ꝕ":"p","ⓠ":"q","ｑ":"q","ɋ":"q","ꝗ":"q","ꝙ":"q","ⓡ":"r","ｒ":"r","ŕ":"r","ṙ":"r","ř":"r","ȑ":"r","ȓ":"r","ṛ":"r","ṝ":"r","ŗ":"r","ṟ":"r","ɍ":"r","ɽ":"r","ꝛ":"r","ꞧ":"r","ꞃ":"r","ⓢ":"s","ｓ":"s","ß":"s","ś":"s","ṥ":"s","ŝ":"s","ṡ":"s","š":"s","ṧ":"s","ṣ":"s","ṩ":"s","ș":"s","ş":"s","ȿ":"s","ꞩ":"s","ꞅ":"s","ẛ":"s","ⓣ":"t","ｔ":"t","ṫ":"t","ẗ":"t","ť":"t","ṭ":"t","ț":"t","ţ":"t","ṱ":"t","ṯ":"t","ŧ":"t","ƭ":"t","ʈ":"t","ⱦ":"t","ꞇ":"t","ꜩ":"tz","ⓤ":"u","ｕ":"u","ù":"u","ú":"u","û":"u","ũ":"u","ṹ":"u","ū":"u","ṻ":"u","ŭ":"u","ü":"u","ǜ":"u","ǘ":"u","ǖ":"u","ǚ":"u","ủ":"u","ů":"u","ű":"u","ǔ":"u","ȕ":"u","ȗ":"u","ư":"u","ừ":"u","ứ":"u","ữ":"u","ử":"u","ự":"u","ụ":"u","ṳ":"u","ų":"u","ṷ":"u","ṵ":"u","ʉ":"u","ⓥ":"v","ｖ":"v","ṽ":"v","ṿ":"v","ʋ":"v","ꝟ":"v","ʌ":"v","ꝡ":"vy","ⓦ":"w","ｗ":"w","ẁ":"w","ẃ":"w","ŵ":"w","ẇ":"w","ẅ":"w","ẘ":"w","ẉ":"w","ⱳ":"w","ⓧ":"x","ｘ":"x","ẋ":"x","ẍ":"x","ⓨ":"y","ｙ":"y","ỳ":"y","ý":"y","ŷ":"y","ỹ":"y","ȳ":"y","ẏ":"y","ÿ":"y","ỷ":"y","ẙ":"y","ỵ":"y","ƴ":"y","ɏ":"y","ỿ":"y","ⓩ":"z","ｚ":"z","ź":"z","ẑ":"z","ż":"z","ž":"z","ẓ":"z","ẕ":"z","ƶ":"z","ȥ":"z","ɀ":"z","ⱬ":"z","ꝣ":"z","Ά":"Α","Έ":"Ε","Ή":"Η","Ί":"Ι","Ϊ":"Ι","Ό":"Ο","Ύ":"Υ","Ϋ":"Υ","Ώ":"Ω","ά":"α","έ":"ε","ή":"η","ί":"ι","ϊ":"ι","ΐ":"ι","ό":"ο","ύ":"υ","ϋ":"υ","ΰ":"υ","ω":"ω","ς":"σ"}}),t.define("select2/data/base",["../utils"],function(e){function t(e,n){t.__super__.constructor.call(this)}return e.Extend(t,e.Observable),t.prototype.current=function(e){throw new Error("The `current` method must be defined in child classes.")},t.prototype.query=function(e,t){throw new Error("The `query` method must be defined in child classes.")},t.prototype.bind=function(e,t){},t.prototype.destroy=function(){},t.prototype.generateResultId=function(t,n){var i=t.id+"-result-";return i+=e.generateChars(4),null!=n.id?i+="-"+n.id.toString():i+="-"+e.generateChars(4),i},t}),t.define("select2/data/select",["./base","../utils","jquery"],function(e,t,n){function i(e,t){this.$element=e,this.options=t,i.__super__.constructor.call(this)}return t.Extend(i,e),i.prototype.current=function(e){var t=[],i=this;this.$element.find(":selected").each(function(){var e=n(this),r=i.item(e);t.push(r)}),e(t)},i.prototype.select=function(e){var t=this;if(e.selected=!0,n(e.element).is("option"))return e.element.selected=!0,void this.$element.trigger("change");if(this.$element.prop("multiple"))this.current(function(i){var r=[];(e=[e]).push.apply(e,i);for(var a=0;a<e.length;a++){var s=e[a].id;-1===n.inArray(s,r)&&r.push(s)}t.$element.val(r),t.$element.trigger("change")});else{var i=e.id;this.$element.val(i),this.$element.trigger("change")}},i.prototype.unselect=function(e){var t=this;if(this.$element.prop("multiple")){if(e.selected=!1,n(e.element).is("option"))return e.element.selected=!1,void this.$element.trigger("change");this.current(function(i){for(var r=[],a=0;a<i.length;a++){var s=i[a].id;s!==e.id&&-1===n.inArray(s,r)&&r.push(s)}t.$element.val(r),t.$element.trigger("change")})}},i.prototype.bind=function(e,t){var n=this;this.container=e,e.on("select",function(e){n.select(e.data)}),e.on("unselect",function(e){n.unselect(e.data)})},i.prototype.destroy=function(){this.$element.find("*").each(function(){n.removeData(this,"data")})},i.prototype.query=function(e,t){var i=[],r=this;this.$element.children().each(function(){var t=n(this);if(t.is("option")||t.is("optgroup")){var a=r.item(t),s=r.matches(e,a);null!==s&&i.push(s)}}),t({results:i})},i.prototype.addOptions=function(e){t.appendMany(this.$element,e)},i.prototype.option=function(e){var t;e.children?(t=document.createElement("optgroup")).label=e.text:void 0!==(t=document.createElement("option")).textContent?t.textContent=e.text:t.innerText=e.text,e.id&&(t.value=e.id),e.disabled&&(t.disabled=!0),e.selected&&(t.selected=!0),e.title&&(t.title=e.title);var i=n(t),r=this._normalizeItem(e);return r.element=t,n.data(t,"data",r),i},i.prototype.item=function(e){var t={};if(null!=(t=n.data(e[0],"data")))return t;if(e.is("option"))t={id:e.val(),text:e.text(),disabled:e.prop("disabled"),selected:e.prop("selected"),title:e.prop("title")};else if(e.is("optgroup")){t={text:e.prop("label"),children:[],title:e.prop("title")};for(var i=e.children("option"),r=[],a=0;a<i.length;a++){var s=n(i[a]),o=this.item(s);r.push(o)}t.children=r}return t=this._normalizeItem(t),t.element=e[0],n.data(e[0],"data",t),t},i.prototype._normalizeItem=function(e){n.isPlainObject(e)||(e={id:e,text:e});var t={selected:!1,disabled:!1};return null!=(e=n.extend({},{text:""},e)).id&&(e.id=e.id.toString()),null!=e.text&&(e.text=e.text.toString()),null==e._resultId&&e.id&&null!=this.container&&(e._resultId=this.generateResultId(this.container,e)),n.extend({},t,e)},i.prototype.matches=function(e,t){return this.options.get("matcher")(e,t)},i}),t.define("select2/data/array",["./select","../utils","jquery"],function(e,t,n){function i(e,t){var n=t.get("data")||[];i.__super__.constructor.call(this,e,t),this.addOptions(this.convertToOptions(n))}return t.Extend(i,e),i.prototype.select=function(e){var t=this.$element.find("option").filter(function(t,n){return n.value==e.id.toString()});0===t.length&&(t=this.option(e),this.addOptions(t)),i.__super__.select.call(this,e)},i.prototype.convertToOptions=function(e){for(var i=this,r=this.$element.find("option"),a=r.map(function(){return i.item(n(this)).id}).get(),s=[],o=0;o<e.length;o++){var l=this._normalizeItem(e[o]);if(n.inArray(l.id,a)>=0){var c=r.filter(function(e){return function(){return n(this).val()==e.id}}(l)),u=this.item(c),d=n.extend(!0,{},l,u),h=this.option(d);c.replaceWith(h)}else{var p=this.option(l);if(l.children){var f=this.convertToOptions(l.children);t.appendMany(p,f)}s.push(p)}}return s},i}),t.define("select2/data/ajax",["./array","../utils","jquery"],function(e,t,n){function i(e,t){this.ajaxOptions=this._applyDefaults(t.get("ajax")),null!=this.ajaxOptions.processResults&&(this.processResults=this.ajaxOptions.processResults),i.__super__.constructor.call(this,e,t)}return t.Extend(i,e),i.prototype._applyDefaults=function(e){var t={data:function(e){return n.extend({},e,{q:e.term})},transport:function(e,t,i){var r=n.ajax(e);return r.then(t),r.fail(i),r}};return n.extend({},t,e,!0)},i.prototype.processResults=function(e){return e},i.prototype.query=function(e,t){function i(){var i=a.transport(a,function(i){var a=r.processResults(i,e);r.options.get("debug")&&window.console&&console.error&&(a&&a.results&&n.isArray(a.results)||console.error("Select2: The AJAX results did not return an array in the `results` key of the response.")),t(a)},function(){i.status&&"0"===i.status||r.trigger("results:message",{message:"errorLoading"})});r._request=i}var r=this;null!=this._request&&(n.isFunction(this._request.abort)&&this._request.abort(),this._request=null);var a=n.extend({type:"GET"},this.ajaxOptions);"function"==typeof a.url&&(a.url=a.url.call(this.$element,e)),"function"==typeof a.data&&(a.data=a.data.call(this.$element,e)),this.ajaxOptions.delay&&null!=e.term?(this._queryTimeout&&window.clearTimeout(this._queryTimeout),this._queryTimeout=window.setTimeout(i,this.ajaxOptions.delay)):i()},i}),t.define("select2/data/tags",["jquery"],function(e){function t(t,n,i){var r=i.get("tags"),a=i.get("createTag");void 0!==a&&(this.createTag=a);var s=i.get("insertTag");if(void 0!==s&&(this.insertTag=s),t.call(this,n,i),e.isArray(r))for(var o=0;o<r.length;o++){var l=r[o],c=this._normalizeItem(l),u=this.option(c);this.$element.append(u)}}return t.prototype.query=function(e,t,n){function i(e,a){for(var s=e.results,o=0;o<s.length;o++){var l=s[o],c=null!=l.children&&!i({results:l.children},!0);if(l.text===t.term||c)return!a&&(e.data=s,void n(e))}if(a)return!0;var u=r.createTag(t);if(null!=u){var d=r.option(u);d.attr("data-select2-tag",!0),r.addOptions([d]),r.insertTag(s,u)}e.results=s,n(e)}var r=this;this._removeOldTags(),null!=t.term&&null==t.page?e.call(this,t,i):e.call(this,t,n)},t.prototype.createTag=function(t,n){var i=e.trim(n.term);return""===i?null:{id:i,text:i}},t.prototype.insertTag=function(e,t,n){t.unshift(n)},t.prototype._removeOldTags=function(t){this._lastTag;this.$element.find("option[data-select2-tag]").each(function(){this.selected||e(this).remove()})},t}),t.define("select2/data/tokenizer",["jquery"],function(e){function t(e,t,n){var i=n.get("tokenizer");void 0!==i&&(this.tokenizer=i),e.call(this,t,n)}return t.prototype.bind=function(e,t,n){e.call(this,t,n),this.$search=t.dropdown.$search||t.selection.$search||n.find(".select2-search__field")},t.prototype.query=function(t,n,i){function r(e){a.trigger("select",{data:e})}var a=this;n.term=n.term||"";var s=this.tokenizer(n,this.options,function(t){var n=a._normalizeItem(t);if(!a.$element.find("option").filter(function(){return e(this).val()===n.id}).length){var i=a.option(n);i.attr("data-select2-tag",!0),a._removeOldTags(),a.addOptions([i])}r(n)});s.term!==n.term&&(this.$search.length&&(this.$search.val(s.term),this.$search.focus()),n.term=s.term),t.call(this,n,i)},t.prototype.tokenizer=function(t,n,i,r){for(var a=i.get("tokenSeparators")||[],s=n.term,o=0,l=this.createTag||function(e){return{id:e.term,text:e.term}};o<s.length;){var c=s[o];if(-1!==e.inArray(c,a)){var u=s.substr(0,o),d=l(e.extend({},n,{term:u}));null!=d?(r(d),s=s.substr(o+1)||"",o=0):o++}else o++}return{term:s}},t}),t.define("select2/data/minimumInputLength",[],function(){function e(e,t,n){this.minimumInputLength=n.get("minimumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",t.term.length<this.minimumInputLength?this.trigger("results:message",{message:"inputTooShort",args:{minimum:this.minimumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),t.define("select2/data/maximumInputLength",[],function(){function e(e,t,n){this.maximumInputLength=n.get("maximumInputLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){t.term=t.term||"",this.maximumInputLength>0&&t.term.length>this.maximumInputLength?this.trigger("results:message",{message:"inputTooLong",args:{maximum:this.maximumInputLength,input:t.term,params:t}}):e.call(this,t,n)},e}),t.define("select2/data/maximumSelectionLength",[],function(){function e(e,t,n){this.maximumSelectionLength=n.get("maximumSelectionLength"),e.call(this,t,n)}return e.prototype.query=function(e,t,n){var i=this;this.current(function(r){var a=null!=r?r.length:0;i.maximumSelectionLength>0&&a>=i.maximumSelectionLength?i.trigger("results:message",{message:"maximumSelected",args:{maximum:i.maximumSelectionLength}}):e.call(i,t,n)})},e}),t.define("select2/dropdown",["jquery","./utils"],function(e,t){function n(e,t){this.$element=e,this.options=t,n.__super__.constructor.call(this)}return t.Extend(n,t.Observable),n.prototype.render=function(){var t=e('<span class="select2-dropdown"><span class="select2-results"></span></span>');return t.attr("dir",this.options.get("dir")),this.$dropdown=t,t},n.prototype.bind=function(){},n.prototype.position=function(e,t){},n.prototype.destroy=function(){this.$dropdown.remove()},n}),t.define("select2/dropdown/search",["jquery","../utils"],function(e,t){function n(){}return n.prototype.render=function(t){var n=t.call(this),i=e('<span class="select2-search select2-search--dropdown"><input class="select2-search__field" type="search" tabindex="-1" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" role="textbox" /></span>');return this.$searchContainer=i,this.$search=i.find("input"),n.prepend(i),n},n.prototype.bind=function(t,n,i){var r=this;t.call(this,n,i),this.$search.on("keydown",function(e){r.trigger("keypress",e),r._keyUpPrevented=e.isDefaultPrevented()}),this.$search.on("input",function(t){e(this).off("keyup")}),this.$search.on("keyup input",function(e){r.handleSearch(e)}),n.on("open",function(){r.$search.attr("tabindex",0),r.$search.focus(),window.setTimeout(function(){r.$search.focus()},0)}),n.on("close",function(){r.$search.attr("tabindex",-1),r.$search.val("")}),n.on("focus",function(){n.isOpen()&&r.$search.focus()}),n.on("results:all",function(e){null!=e.query.term&&""!==e.query.term||(r.showSearch(e)?r.$searchContainer.removeClass("select2-search--hide"):r.$searchContainer.addClass("select2-search--hide"))})},n.prototype.handleSearch=function(e){if(!this._keyUpPrevented){var t=this.$search.val();this.trigger("query",{term:t})}this._keyUpPrevented=!1},n.prototype.showSearch=function(e,t){return!0},n}),t.define("select2/dropdown/hidePlaceholder",[],function(){function e(e,t,n,i){this.placeholder=this.normalizePlaceholder(n.get("placeholder")),e.call(this,t,n,i)}return e.prototype.append=function(e,t){t.results=this.removePlaceholder(t.results),e.call(this,t)},e.prototype.normalizePlaceholder=function(e,t){return"string"==typeof t&&(t={id:"",text:t}),t},e.prototype.removePlaceholder=function(e,t){for(var n=t.slice(0),i=t.length-1;i>=0;i--){var r=t[i];this.placeholder.id===r.id&&n.splice(i,1)}return n},e}),t.define("select2/dropdown/infiniteScroll",["jquery"],function(e){function t(e,t,n,i){this.lastParams={},e.call(this,t,n,i),this.$loadingMore=this.createLoadingMore(),this.loading=!1}return t.prototype.append=function(e,t){this.$loadingMore.remove(),this.loading=!1,e.call(this,t),this.showLoadingMore(t)&&this.$results.append(this.$loadingMore)},t.prototype.bind=function(t,n,i){var r=this;t.call(this,n,i),n.on("query",function(e){r.lastParams=e,r.loading=!0}),n.on("query:append",function(e){r.lastParams=e,r.loading=!0}),this.$results.on("scroll",function(){var t=e.contains(document.documentElement,r.$loadingMore[0]);!r.loading&&t&&r.$results.offset().top+r.$results.outerHeight(!1)+50>=r.$loadingMore.offset().top+r.$loadingMore.outerHeight(!1)&&r.loadMore()})},t.prototype.loadMore=function(){this.loading=!0;var t=e.extend({},{page:1},this.lastParams);t.page++,this.trigger("query:append",t)},t.prototype.showLoadingMore=function(e,t){return t.pagination&&t.pagination.more},t.prototype.createLoadingMore=function(){var t=e('<li class="select2-results__option select2-results__option--load-more"role="treeitem" aria-disabled="true"></li>'),n=this.options.get("translations").get("loadingMore");return t.html(n(this.lastParams)),t},t}),t.define("select2/dropdown/attachBody",["jquery","../utils"],function(e,t){function n(t,n,i){this.$dropdownParent=i.get("dropdownParent")||e(document.body),t.call(this,n,i)}return n.prototype.bind=function(e,t,n){var i=this,r=!1;e.call(this,t,n),t.on("open",function(){i._showDropdown(),i._attachPositioningHandler(t),r||(r=!0,t.on("results:all",function(){i._positionDropdown(),i._resizeDropdown()}),t.on("results:append",function(){i._positionDropdown(),i._resizeDropdown()}))}),t.on("close",function(){i._hideDropdown(),i._detachPositioningHandler(t)}),this.$dropdownContainer.on("mousedown",function(e){e.stopPropagation()})},n.prototype.destroy=function(e){e.call(this),this.$dropdownContainer.remove()},n.prototype.position=function(e,t,n){t.attr("class",n.attr("class")),t.removeClass("select2"),t.addClass("select2-container--open"),t.css({position:"absolute",top:-999999}),this.$container=n},n.prototype.render=function(t){var n=e("<span></span>"),i=t.call(this);return n.append(i),this.$dropdownContainer=n,n},n.prototype._hideDropdown=function(e){this.$dropdownContainer.detach()},n.prototype._attachPositioningHandler=function(n,i){var r=this,a="scroll.select2."+i.id,s="resize.select2."+i.id,o="orientationchange.select2."+i.id,l=this.$container.parents().filter(t.hasScroll);l.each(function(){e(this).data("select2-scroll-position",{x:e(this).scrollLeft(),y:e(this).scrollTop()})}),l.on(a,function(t){var n=e(this).data("select2-scroll-position");e(this).scrollTop(n.y)}),e(window).on(a+" "+s+" "+o,function(e){r._positionDropdown(),r._resizeDropdown()})},n.prototype._detachPositioningHandler=function(n,i){var r="scroll.select2."+i.id,a="resize.select2."+i.id,s="orientationchange.select2."+i.id;this.$container.parents().filter(t.hasScroll).off(r),e(window).off(r+" "+a+" "+s)},n.prototype._positionDropdown=function(){var t=e(window),n=this.$dropdown.hasClass("select2-dropdown--above"),i=this.$dropdown.hasClass("select2-dropdown--below"),r=null,a=this.$container.offset();a.bottom=a.top+this.$container.outerHeight(!1);var s={height:this.$container.outerHeight(!1)};s.top=a.top,s.bottom=a.top+s.height;var o={height:this.$dropdown.outerHeight(!1)},l={top:t.scrollTop(),bottom:t.scrollTop()+t.height()},c=l.top<a.top-o.height,u=l.bottom>a.bottom+o.height,d={left:a.left,top:s.bottom},h=this.$dropdownParent;"static"===h.css("position")&&(h=h.offsetParent());var p=h.offset();d.top-=p.top,d.left-=p.left,n||i||(r="below"),u||!c||n?!c&&u&&n&&(r="below"):r="above",("above"==r||n&&"below"!==r)&&(d.top=s.top-p.top-o.height),null!=r&&(this.$dropdown.removeClass("select2-dropdown--below select2-dropdown--above").addClass("select2-dropdown--"+r),this.$container.removeClass("select2-container--below select2-container--above").addClass("select2-container--"+r)),this.$dropdownContainer.css(d)},n.prototype._resizeDropdown=function(){var e={width:this.$container.outerWidth(!1)+"px"};this.options.get("dropdownAutoWidth")&&(e.minWidth=e.width,e.position="relative",e.width="auto"),this.$dropdown.css(e)},n.prototype._showDropdown=function(e){this.$dropdownContainer.appendTo(this.$dropdownParent),this._positionDropdown(),this._resizeDropdown()},n}),t.define("select2/dropdown/minimumResultsForSearch",[],function(){function e(t){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.children?n+=e(r.children):n++}return n}function t(e,t,n,i){this.minimumResultsForSearch=n.get("minimumResultsForSearch"),this.minimumResultsForSearch<0&&(this.minimumResultsForSearch=1/0),e.call(this,t,n,i)}return t.prototype.showSearch=function(t,n){return!(e(n.data.results)<this.minimumResultsForSearch)&&t.call(this,n)},t}),t.define("select2/dropdown/selectOnClose",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("close",function(e){i._handleSelectOnClose(e)})},e.prototype._handleSelectOnClose=function(e,t){if(t&&null!=t.originalSelect2Event){var n=t.originalSelect2Event;if("select"===n._type||"unselect"===n._type)return}var i=this.getHighlightedResults();if(!(i.length<1)){var r=i.data("data");null!=r.element&&r.element.selected||null==r.element&&r.selected||this.trigger("select",{data:r})}},e}),t.define("select2/dropdown/closeOnSelect",[],function(){function e(){}return e.prototype.bind=function(e,t,n){var i=this;e.call(this,t,n),t.on("select",function(e){i._selectTriggered(e)}),t.on("unselect",function(e){i._selectTriggered(e)})},e.prototype._selectTriggered=function(e,t){var n=t.originalEvent;n&&n.ctrlKey||this.trigger("close",{originalEvent:n,originalSelect2Event:t})},e}),t.define("select2/i18n/en",[],function(){return{errorLoading:function(){return"The results could not be loaded."},inputTooLong:function(e){var t=e.input.length-e.maximum,n="Please delete "+t+" character";return 1!=t&&(n+="s"),n},inputTooShort:function(e){return"Please enter "+(e.minimum-e.input.length)+" or more characters"},loadingMore:function(){return"Loading more results…"},maximumSelected:function(e){var t="You can only select "+e.maximum+" item";return 1!=e.maximum&&(t+="s"),t},noResults:function(){return"No results found"},searching:function(){return"Searching…"}}}),t.define("select2/defaults",["jquery","require","./results","./selection/single","./selection/multiple","./selection/placeholder","./selection/allowClear","./selection/search","./selection/eventRelay","./utils","./translation","./diacritics","./data/select","./data/array","./data/ajax","./data/tags","./data/tokenizer","./data/minimumInputLength","./data/maximumInputLength","./data/maximumSelectionLength","./dropdown","./dropdown/search","./dropdown/hidePlaceholder","./dropdown/infiniteScroll","./dropdown/attachBody","./dropdown/minimumResultsForSearch","./dropdown/selectOnClose","./dropdown/closeOnSelect","./i18n/en"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p,f,g,m,b,v,y,w,_,x,S,E,A,k,C,P){function M(){this.reset()}return M.prototype.apply=function(d){if(null==(d=e.extend(!0,{},this.defaults,d)).dataAdapter){if(null!=d.ajax?d.dataAdapter=f:null!=d.data?d.dataAdapter=p:d.dataAdapter=h,d.minimumInputLength>0&&(d.dataAdapter=c.Decorate(d.dataAdapter,b)),d.maximumInputLength>0&&(d.dataAdapter=c.Decorate(d.dataAdapter,v)),d.maximumSelectionLength>0&&(d.dataAdapter=c.Decorate(d.dataAdapter,y)),d.tags&&(d.dataAdapter=c.Decorate(d.dataAdapter,g)),null==d.tokenSeparators&&null==d.tokenizer||(d.dataAdapter=c.Decorate(d.dataAdapter,m)),null!=d.query){var P=t(d.amdBase+"compat/query");d.dataAdapter=c.Decorate(d.dataAdapter,P)}if(null!=d.initSelection){var M=t(d.amdBase+"compat/initSelection");d.dataAdapter=c.Decorate(d.dataAdapter,M)}}if(null==d.resultsAdapter&&(d.resultsAdapter=n,null!=d.ajax&&(d.resultsAdapter=c.Decorate(d.resultsAdapter,S)),null!=d.placeholder&&(d.resultsAdapter=c.Decorate(d.resultsAdapter,x)),d.selectOnClose&&(d.resultsAdapter=c.Decorate(d.resultsAdapter,k))),null==d.dropdownAdapter){if(d.multiple)d.dropdownAdapter=w;else{var O=c.Decorate(w,_);d.dropdownAdapter=O}if(0!==d.minimumResultsForSearch&&(d.dropdownAdapter=c.Decorate(d.dropdownAdapter,A)),d.closeOnSelect&&(d.dropdownAdapter=c.Decorate(d.dropdownAdapter,C)),null!=d.dropdownCssClass||null!=d.dropdownCss||null!=d.adaptDropdownCssClass){var T=t(d.amdBase+"compat/dropdownCss");d.dropdownAdapter=c.Decorate(d.dropdownAdapter,T)}d.dropdownAdapter=c.Decorate(d.dropdownAdapter,E)}if(null==d.selectionAdapter){if(d.multiple?d.selectionAdapter=r:d.selectionAdapter=i,null!=d.placeholder&&(d.selectionAdapter=c.Decorate(d.selectionAdapter,a)),d.allowClear&&(d.selectionAdapter=c.Decorate(d.selectionAdapter,s)),d.multiple&&(d.selectionAdapter=c.Decorate(d.selectionAdapter,o)),null!=d.containerCssClass||null!=d.containerCss||null!=d.adaptContainerCssClass){var R=t(d.amdBase+"compat/containerCss");d.selectionAdapter=c.Decorate(d.selectionAdapter,R)}d.selectionAdapter=c.Decorate(d.selectionAdapter,l)}if("string"==typeof d.language)if(d.language.indexOf("-")>0){var D=d.language.split("-")[0];d.language=[d.language,D]}else d.language=[d.language];if(e.isArray(d.language)){var I=new u;d.language.push("en");for(var j=d.language,N=0;N<j.length;N++){var q=j[N],L={};try{L=u.loadPath(q)}catch(e){try{q=this.defaults.amdLanguageBase+q,L=u.loadPath(q)}catch(e){d.debug&&window.console&&console.warn&&console.warn('Select2: The language file for "'+q+'" could not be automatically loaded. A fallback will be used instead.');continue}}I.extend(L)}d.translations=I}else{var F=u.loadPath(this.defaults.amdLanguageBase+"en"),B=new u(d.language);B.extend(F),d.translations=B}return d},M.prototype.reset=function(){function t(e){return e.replace(/[^\u0000-\u007E]/g,function(e){return d[e]||e})}function n(i,r){if(""===e.trim(i.term))return r;if(r.children&&r.children.length>0){for(var a=e.extend(!0,{},r),s=r.children.length-1;s>=0;s--)null==n(i,r.children[s])&&a.children.splice(s,1);return a.children.length>0?a:n(i,a)}var o=t(r.text).toUpperCase(),l=t(i.term).toUpperCase();return o.indexOf(l)>-1?r:null}this.defaults={amdBase:"./",amdLanguageBase:"./i18n/",closeOnSelect:!0,debug:!1,dropdownAutoWidth:!1,escapeMarkup:c.escapeMarkup,language:P,matcher:n,minimumInputLength:0,maximumInputLength:0,maximumSelectionLength:0,minimumResultsForSearch:0,selectOnClose:!1,sorter:function(e){return e},templateResult:function(e){return e.text},templateSelection:function(e){return e.text},theme:"default",width:"resolve"}},M.prototype.set=function(t,n){var i={};i[e.camelCase(t)]=n;var r=c._convertData(i);e.extend(this.defaults,r)},new M}),t.define("select2/options",["require","jquery","./defaults","./utils"],function(e,t,n,i){function r(t,r){if(this.options=t,null!=r&&this.fromElement(r),this.options=n.apply(this.options),r&&r.is("input")){var a=e(this.get("amdBase")+"compat/inputData");this.options.dataAdapter=i.Decorate(this.options.dataAdapter,a)}}return r.prototype.fromElement=function(e){var n=["select2"];null==this.options.multiple&&(this.options.multiple=e.prop("multiple")),null==this.options.disabled&&(this.options.disabled=e.prop("disabled")),null==this.options.language&&(e.prop("lang")?this.options.language=e.prop("lang").toLowerCase():e.closest("[lang]").prop("lang")&&(this.options.language=e.closest("[lang]").prop("lang"))),null==this.options.dir&&(e.prop("dir")?this.options.dir=e.prop("dir"):e.closest("[dir]").prop("dir")?this.options.dir=e.closest("[dir]").prop("dir"):this.options.dir="ltr"),e.prop("disabled",this.options.disabled),e.prop("multiple",this.options.multiple),e.data("select2Tags")&&(this.options.debug&&window.console&&console.warn&&console.warn('Select2: The `data-select2-tags` attribute has been changed to use the `data-data` and `data-tags="true"` attributes and will be removed in future versions of Select2.'),e.data("data",e.data("select2Tags")),e.data("tags",!0)),e.data("ajaxUrl")&&(this.options.debug&&window.console&&console.warn&&console.warn("Select2: The `data-ajax-url` attribute has been changed to `data-ajax--url` and support for the old attribute will be removed in future versions of Select2."),e.attr("ajax--url",e.data("ajaxUrl")),e.data("ajax--url",e.data("ajaxUrl")));var r={};r=t.fn.jquery&&"1."==t.fn.jquery.substr(0,2)&&e[0].dataset?t.extend(!0,{},e[0].dataset,e.data()):e.data();var a=t.extend(!0,{},r);a=i._convertData(a);for(var s in a)t.inArray(s,n)>-1||(t.isPlainObject(this.options[s])?t.extend(this.options[s],a[s]):this.options[s]=a[s]);return this},r.prototype.get=function(e){return this.options[e]},r.prototype.set=function(e,t){this.options[e]=t},r}),t.define("select2/core",["jquery","./options","./utils","./keys"],function(e,t,n,i){var r=function(e,n){null!=e.data("select2")&&e.data("select2").destroy(),this.$element=e,this.id=this._generateId(e),n=n||{},this.options=new t(n,e),r.__super__.constructor.call(this);var i=e.attr("tabindex")||0;e.data("old-tabindex",i),e.attr("tabindex","-1");var a=this.options.get("dataAdapter");this.dataAdapter=new a(e,this.options);var s=this.render();this._placeContainer(s);var o=this.options.get("selectionAdapter");this.selection=new o(e,this.options),this.$selection=this.selection.render(),this.selection.position(this.$selection,s);var l=this.options.get("dropdownAdapter");this.dropdown=new l(e,this.options),this.$dropdown=this.dropdown.render(),this.dropdown.position(this.$dropdown,s);var c=this.options.get("resultsAdapter");this.results=new c(e,this.options,this.dataAdapter),this.$results=this.results.render(),this.results.position(this.$results,this.$dropdown);var u=this;this._bindAdapters(),this._registerDomEvents(),this._registerDataEvents(),this._registerSelectionEvents(),this._registerDropdownEvents(),this._registerResultsEvents(),this._registerEvents(),this.dataAdapter.current(function(e){u.trigger("selection:update",{data:e})}),e.addClass("select2-hidden-accessible"),e.attr("aria-hidden","true"),this._syncAttributes(),e.data("select2",this)};return n.Extend(r,n.Observable),r.prototype._generateId=function(e){var t="";return t=null!=e.attr("id")?e.attr("id"):null!=e.attr("name")?e.attr("name")+"-"+n.generateChars(2):n.generateChars(4),t=t.replace(/(:|\.|\[|\]|,)/g,""),t="select2-"+t},r.prototype._placeContainer=function(e){e.insertAfter(this.$element);var t=this._resolveWidth(this.$element,this.options.get("width"));null!=t&&e.css("width",t)},r.prototype._resolveWidth=function(e,t){var n=/^width:(([-+]?([0-9]*\.)?[0-9]+)(px|em|ex|%|in|cm|mm|pt|pc))/i;if("resolve"==t){var i=this._resolveWidth(e,"style");return null!=i?i:this._resolveWidth(e,"element")}if("element"==t){var r=e.outerWidth(!1);return r<=0?"auto":r+"px"}if("style"==t){var a=e.attr("style");if("string"!=typeof a)return null;for(var s=a.split(";"),o=0,l=s.length;o<l;o+=1){var c=s[o].replace(/\s/g,"").match(n);if(null!==c&&c.length>=1)return c[1]}return null}return t},r.prototype._bindAdapters=function(){this.dataAdapter.bind(this,this.$container),this.selection.bind(this,this.$container),this.dropdown.bind(this,this.$container),this.results.bind(this,this.$container)},r.prototype._registerDomEvents=function(){var t=this;this.$element.on("change.select2",function(){t.dataAdapter.current(function(e){t.trigger("selection:update",{data:e})})}),this.$element.on("focus.select2",function(e){t.trigger("focus",e)}),this._syncA=n.bind(this._syncAttributes,this),this._syncS=n.bind(this._syncSubtree,this),this.$element[0].attachEvent&&this.$element[0].attachEvent("onpropertychange",this._syncA);var i=window.MutationObserver||window.WebKitMutationObserver||window.MozMutationObserver;null!=i?(this._observer=new i(function(n){e.each(n,t._syncA),e.each(n,t._syncS)}),this._observer.observe(this.$element[0],{attributes:!0,childList:!0,subtree:!1})):this.$element[0].addEventListener&&(this.$element[0].addEventListener("DOMAttrModified",t._syncA,!1),this.$element[0].addEventListener("DOMNodeInserted",t._syncS,!1),this.$element[0].addEventListener("DOMNodeRemoved",t._syncS,!1))},r.prototype._registerDataEvents=function(){var e=this;this.dataAdapter.on("*",function(t,n){e.trigger(t,n)})},r.prototype._registerSelectionEvents=function(){var t=this,n=["toggle","focus"];this.selection.on("toggle",function(){t.toggleDropdown()}),this.selection.on("focus",function(e){t.focus(e)}),this.selection.on("*",function(i,r){-1===e.inArray(i,n)&&t.trigger(i,r)})},r.prototype._registerDropdownEvents=function(){var e=this;this.dropdown.on("*",function(t,n){e.trigger(t,n)})},r.prototype._registerResultsEvents=function(){var e=this;this.results.on("*",function(t,n){e.trigger(t,n)})},r.prototype._registerEvents=function(){var e=this;this.on("open",function(){e.$container.addClass("select2-container--open")}),this.on("close",function(){e.$container.removeClass("select2-container--open")}),this.on("enable",function(){e.$container.removeClass("select2-container--disabled")}),this.on("disable",function(){e.$container.addClass("select2-container--disabled")}),this.on("blur",function(){e.$container.removeClass("select2-container--focus")}),this.on("query",function(t){e.isOpen()||e.trigger("open",{}),this.dataAdapter.query(t,function(n){e.trigger("results:all",{data:n,query:t})})}),this.on("query:append",function(t){this.dataAdapter.query(t,function(n){e.trigger("results:append",{data:n,query:t})})}),this.on("keypress",function(t){var n=t.which;e.isOpen()?n===i.ESC||n===i.TAB||n===i.UP&&t.altKey?(e.close(),t.preventDefault()):n===i.ENTER?(e.trigger("results:select",{}),t.preventDefault()):n===i.SPACE&&t.ctrlKey?(e.trigger("results:toggle",{}),t.preventDefault()):n===i.UP?(e.trigger("results:previous",{}),t.preventDefault()):n===i.DOWN&&(e.trigger("results:next",{}),t.preventDefault()):(n===i.ENTER||n===i.SPACE||n===i.DOWN&&t.altKey)&&(e.open(),t.preventDefault())})},r.prototype._syncAttributes=function(){this.options.set("disabled",this.$element.prop("disabled")),this.options.get("disabled")?(this.isOpen()&&this.close(),this.trigger("disable",{})):this.trigger("enable",{})},r.prototype._syncSubtree=function(e,t){var n=!1,i=this;if(!e||!e.target||"OPTION"===e.target.nodeName||"OPTGROUP"===e.target.nodeName){if(t)if(t.addedNodes&&t.addedNodes.length>0)for(var r=0;r<t.addedNodes.length;r++)t.addedNodes[r].selected&&(n=!0);else t.removedNodes&&t.removedNodes.length>0&&(n=!0);else n=!0;n&&this.dataAdapter.current(function(e){i.trigger("selection:update",{data:e})})}},r.prototype.trigger=function(e,t){var n=r.__super__.trigger,i={open:"opening",close:"closing",select:"selecting",unselect:"unselecting"};if(void 0===t&&(t={}),e in i){var a=i[e],s={prevented:!1,name:e,args:t};if(n.call(this,a,s),s.prevented)return void(t.prevented=!0)}n.call(this,e,t)},r.prototype.toggleDropdown=function(){this.options.get("disabled")||(this.isOpen()?this.close():this.open())},r.prototype.open=function(){this.isOpen()||this.trigger("query",{})},r.prototype.close=function(){this.isOpen()&&this.trigger("close",{})},r.prototype.isOpen=function(){return this.$container.hasClass("select2-container--open")},r.prototype.hasFocus=function(){return this.$container.hasClass("select2-container--focus")},r.prototype.focus=function(e){this.hasFocus()||(this.$container.addClass("select2-container--focus"),this.trigger("focus",{}))},r.prototype.enable=function(e){this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("enable")` method has been deprecated and will be removed in later Select2 versions. Use $element.prop("disabled") instead.'),null!=e&&0!==e.length||(e=[!0]);var t=!e[0];this.$element.prop("disabled",t)},r.prototype.data=function(){this.options.get("debug")&&arguments.length>0&&window.console&&console.warn&&console.warn('Select2: Data can no longer be set using `select2("data")`. You should consider setting the value instead using `$element.val()`.');var e=[];return this.dataAdapter.current(function(t){e=t}),e},r.prototype.val=function(t){if(this.options.get("debug")&&window.console&&console.warn&&console.warn('Select2: The `select2("val")` method has been deprecated and will be removed in later Select2 versions. Use $element.val() instead.'),null==t||0===t.length)return this.$element.val();var n=t[0];e.isArray(n)&&(n=e.map(n,function(e){return e.toString()})),this.$element.val(n).trigger("change")},r.prototype.destroy=function(){this.$container.remove(),this.$element[0].detachEvent&&this.$element[0].detachEvent("onpropertychange",this._syncA),null!=this._observer?(this._observer.disconnect(),this._observer=null):this.$element[0].removeEventListener&&(this.$element[0].removeEventListener("DOMAttrModified",this._syncA,!1),this.$element[0].removeEventListener("DOMNodeInserted",this._syncS,!1),this.$element[0].removeEventListener("DOMNodeRemoved",this._syncS,!1)),this._syncA=null,this._syncS=null,this.$element.off(".select2"),this.$element.attr("tabindex",this.$element.data("old-tabindex")),this.$element.removeClass("select2-hidden-accessible"),this.$element.attr("aria-hidden","false"),this.$element.removeData("select2"),this.dataAdapter.destroy(),this.selection.destroy(),this.dropdown.destroy(),this.results.destroy(),this.dataAdapter=null,this.selection=null,this.dropdown=null,this.results=null},r.prototype.render=function(){var t=e('<span class="select2 select2-container"><span class="selection"></span><span class="dropdown-wrapper" aria-hidden="true"></span></span>');return t.attr("dir",this.options.get("dir")),this.$container=t,this.$container.addClass("select2-container--"+this.options.get("theme")),t.data("element",this.$element),t},r}),t.define("jquery-mousewheel",["jquery"],function(e){return e}),t.define("jquery.select2",["jquery","jquery-mousewheel","./select2/core","./select2/defaults"],function(e,t,n,i){if(null==e.fn.select2){var r=["open","close","destroy"];e.fn.select2=function(t){if("object"==typeof(t=t||{}))return this.each(function(){var i=e.extend(!0,{},t);new n(e(this),i)}),this;if("string"==typeof t){var i,a=Array.prototype.slice.call(arguments,1);return this.each(function(){var n=e(this).data("select2");null==n&&window.console&&console.error&&console.error("The select2('"+t+"') method was called on an element that is not using Select2."),i=n[t].apply(n,a)}),e.inArray(t,r)>-1?this:i}throw new Error("Invalid arguments for Select2: "+t)}}return null==e.fn.select2.defaults&&(e.fn.select2.defaults=i),n}),{define:t.define,require:t.require}}(),n=t.require("jquery.select2");return e.fn.select2.amd=t,n}),define("js/widgets/preferences/views/openurl",["marionette","hbs!js/widgets/preferences/templates/openurl","bootstrap","select2"],function(e,t,n,i){return e.ItemView.extend({template:t,className:"panel panel-default s-form-container",onRender:function(){this.$("select[name=set-link-server]").select2()},serializeData:function(){var e=this.model.toJSON();if(!e.openURLConfig||!e.user)return e.loading=!0,e;var t=_.findWhere(e.openURLConfig,{link:e.link_server});return e.openURLName=t?t.name:"",e},modelEvents:{"change:link_server":"render","change:user":"render","change:openURLConfig":"render"},events:{"click #link-server-container .submit":"changeLinkServer"},changeLinkServer:function(e){e.preventDefault();var t=this.$("#link-server-container select").val();if(t!==this.model.get("link_server")){this.trigger("change:link_server",t);this.$("#link-server-container .submit").html('<i class="fa fa-spinner fa-pulse"></i> Loading')}else this.render()}})}),define("hbs!js/widgets/preferences/templates/orcid",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <div class="panel-heading">ORCID SETTINGS</div>\n<div class="panel-body"> <p><i class="icon-loading"></i> Loading...</p></div>\n'},3:function(e,t,n,i){var r;return'\n    <div class="panel-heading">\n\n        ORCID Settings\n'+(null!=(r=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'\n    </div>\n    <div class="panel-body">\n\n'+(null!=(r=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(17,i,0),data:i}))?r:"")+"    </div>\n\n\n"},4:function(e,t,n,i){var r;return"        <h4>You are signed in to ORCID as <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.prettyOrcidName||(null!=e?e.prettyOrcidName:e))?r:t.helperMissing)?r.call(e,{name:"prettyOrcidName",hash:{},data:i}):r)+'</b></h4>\n\n        <p> Not you?\n            <button class="btn btn-sm btn-default orcid-authenticate">Sign into ORCID as a different user</button>\n        </p>\n'},6:function(e,t,n,i){var r,a;return'\n        <div class="form-group">\n            <h4>1. Your Current Academic Affiliation</h4>\n            <div class="form-group">\n                <label for="#aff-input" class="sr-only">your current academic affiliation</label>\n                <input type="text"\n                       '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.userSubmitted:e)?r.currentAffiliation:r,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'\n                id="aff-input"\n                class="form-control"\n                placeholder="e.g. Wesleyan University"\n                style="width:300px">\n            </div>\n        </div>\n\n        <br>\n        <h4 id="name-variant-header">2. Names Under Which You Have Published</h4>\n        <p class="emphasis-text">\n            If you have published under a different surname, for example,\n            or using a middle name, please add those name variations here.\n        </p>\n\n        <div class="form-group well orcid-name-container clearfix" aria-labelledby="#name-variant-header">\n\n            <div class="input-list">\n                <div class="original-orcid-name">\n                    \x3c!--this isnt editable--\x3e\n                    <label for="original-orcid-name">ORCID name</label>\n                    <input class="form-control input-list__input"\n                           type="text"\n                           id="original-orcid-name"\n                           value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidName||(null!=e?e.orcidName:e))?a:t.helperMissing)?a.call(e,{name:"orcidName",hash:{},data:i}):a)+'" disabled>\n                </div>\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.userSubmitted:e)?r.nameVariations:r,{name:"each",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'                <button class="btn btn-primary-faded pull-right add-another-orcid-name"><i class="fa fa-plus"> </i> add a name</button>\n\n                <div class="warning '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.userSubmitted:e)?r.authorizedUser:r,!1,{name:"compare",hash:{operator:"!=="},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" style="clear:both;padding-top:15px" >\n                <i class="fa fa-lg fa-warning"></i>\n                To become an ADS-verified user and have the above name data used to enrich your ORCID matches in ADS, you must check the box below.\n            </div>\n        </div>\n    </div>\n    <br>\n    <div class="form-group">\n        <h4> 3. Permission for ADS to Record and Publish Claims</h4>\n\n        <div class="checkbox">\n            <label class="emphasis-text">\n                <input type="checkbox"\n                       '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.userSubmitted:e)?r.authorizedUser:r,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?r:"")+"\n                "+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.userSubmitted:e)?r.authorizedUser:r,void 0,{name:"compare",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?r:"")+'\n                class="authorized-ads-user">\n                I allow the ADS to record my claims and to make them available publically for auditing and indexing.\n                <br>This makes me an "ADS Verified User" and allows ADS to validate my name(s) against author lists in papers.\n            </label>\n        </div>\n\n    </div>\n\n    <br>\n\n    <button class="submit btn btn-success">submit</button>\n\n'},7:function(e,t,n,i){var r;return' value="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.userSubmitted:e)?r.currentAffiliation:r,e))+'" '},9:function(e,t,n,i){return'                <div class="orcid-name-row">\n                    <input class="form-control input-list__input" type="text" placeholder="Last, First Middle"  value="'+this.escapeExpression(this.lambda(e,e))+'">\n                    <button class="btn btn-danger btn-inverse remove-name" title="remove this name"><i class="fa fa-minus-circle"></i></button>\n                </div>\n'},11:function(e,t,n,i){return" hidden "},13:function(e,t,n,i){return" checked "},15:function(e,t,n,i){return" checked  "},17:function(e,t,n,i){return'    <br>\n    <button class="btn btn-success orcid-authenticate">Authenticate with ORCID to view ADS ORCID Settings\n    </button>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"\n"},useData:!0});return t.registerPartial("js/widgets/preferences/templates/orcid",n),n}),define("hbs!js/widgets/preferences/templates/orcid-name-row-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="orcid-name-row">\n    <input class="form-control input-list__input" type="text" placeholder="Last, First Middle">\n    <button class="btn btn-danger btn-inverse remove-name" title="remove this name"><i class="fa fa-minus-circle"></i></button>\n</div>'},useData:!0});return t.registerPartial("js/widgets/preferences/templates/orcid-name-row-template",n),n}),define("js/widgets/preferences/views/orcid",["marionette","hbs!js/widgets/preferences/templates/orcid","hbs!js/widgets/preferences/templates/orcid-name-row-template"],function(e,t,n){return e.ItemView.extend({template:t,className:"panel panel-default s-form-container",events:{"click  .submit":"submitForm","change .authorized-ads-user":"toggleWarning","click .add-another-orcid-name":"addNameRow","click .remove-name":"removeNameRow"},toggleWarning:function(e){this.$(".authorized-ads-user").is(":checked")?this.$(".orcid-name-container .warning").addClass("hidden"):this.$(".orcid-name-container .warning").removeClass("hidden")},addNameRow:function(e){this.$(".add-another-orcid-name").before(n())},removeNameRow:function(e){$(arguments[0].currentTarget).parent().remove()},triggers:{"click .orcid-authenticate":"orcid-authenticate"},modelEvents:{change:"render"},submitForm:function(e){e.preventDefault();var t={};t.currentAffiliation=this.$("#aff-input").val(),t.authorizedUser=this.$(".authorized-ads-user").is(":checked"),t.nameVariations=this.$(".orcid-name-row").map(function(e){return $(this).find("input").val()}).get();this.$(".submit").html('<i class="fa fa-spinner fa-pulse"></i> Loading'),this.trigger("orcid-form-submit",t)}})}),define("hbs!js/widgets/preferences/templates/orcid-form-submit-modal",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<p>You can always resubmit the form if your information changes.</p>\n\n<p><a href="#user/orcid" class="btn btn-default">Go to my ORCID profile page in ADS</a></p>\n'},useData:!0});return t.registerPartial("js/widgets/preferences/templates/orcid-form-submit-modal",n),n}),define("js/widgets/preferences/widget",["marionette","js/widgets/base/base_widget","./views/openurl","./views/orcid","js/components/api_feedback","hbs!js/widgets/preferences/templates/orcid-form-submit-modal"],function(e,t,n,i,r,a){var s=Backbone.Model.extend({defaults:function(){return{openURLConfig:void 0,orcidLoggedIn:void 0}}}),o=e.LayoutView.extend({template:function(){return'<div class="content-container"></div>'},className:"s-preferences preferences-widget",regions:{content:".content-container"},setSubView:function(e){var t=new e({model:this.model});this.getRegion("content").show(t),this.listenTo(t,"all",function(){this.trigger.apply(this,arguments)})}});return t.extend({initialize:function(e){e=e||{},this.model=new s,this.view=new o({model:this.model}),this.listenTo(this.view,"all",this.handleViewEvents),t.prototype.initialize.apply(this,arguments)},activate:function(e){var t=this;this.setBeeHive(e),_.bindAll(this);var n=e.getService("PubSub");n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),n.subscribe(n.ORCID_ANNOUNCEMENT,this.handleOrcidAnnouncement),this.getBeeHive().getObject("User").getOpenURLConfig().done(function(e){t.model.set("openURLConfig",e)}),this.model.set(this.getBeeHive().getObject("User").getUserData())},views:{orcid:i,librarylink:n},setSubView:function(e){_.isArray(e)&&(e=e[0]);var t=this.views[e];t?(this.view.setSubView(t),this.fetchNecessaryData.apply(this,arguments)):console.warn("don't recognize this subview: ",e)},fetchNecessaryData:function(e){var t=this;if(this.model.set("orcidLoggedIn",this.getBeeHive().getService("OrcidApi").hasAccess()),"orcid"===e&&this.model.get("orcidLoggedIn")){this.model.set("loading",!0);var n=this.getBeeHive().getService("OrcidApi").getUserProfile(),i=this.getBeeHive().getService("OrcidApi").getADSUserData();$.when(n,i).done(function(e,n){var i={userSubmitted:n};try{var r=e["orcid-bio"]["personal-details"]["given-names"].value,a=e["orcid-bio"]["personal-details"]["family-name"].value;i.orcidName=a+", "+r,i.prettyOrcidName=r+" "+a}catch(e){i.orcidName="unknown",i.prettyOrcidName="unknown"}i.loading=!1,t.model.set(i)})}},handleViewEvents:function(e,t,n){var i=this;"change:link_server"===e?this.getBeeHive().getObject("User").setUserData({link_server:t}):"orcid-authenticate"===e?this.getBeeHive().getService("OrcidApi").signIn():"orcid-form-submit"===e&&this.getBeeHive().getService("OrcidApi").setADSUserData(t).done(function(){i.getPubSub().publish(i.getPubSub().ALERT,new r({code:r.CODES.ALERT,msg:a(),type:"success",title:"Thanks for submitting your supplemental ORCID information",modal:!0})),i.setSubView("orcid")}).fail(function(){i.getPubSub().publish(i.getPubSub().ALERT,new r({code:r.CODES.ALERT,msg:"Please try again later.",type:"danger",title:"Your ORCID information was not submitted",modal:!0}))})},handleUserAnnouncement:function(e,t){e==this.getBeeHive().getObject("User").USER_INFO_CHANGE&&this.model.set(t)},handleOrcidAnnouncement:function(e){"login"===e?this.model.set("orcidLoggedIn",!1):"logout"===e&&this.model.set("orcidLoggedIn",!1)}})}),define("hbs!js/widgets/library_import/templates/tab-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-form-container">\n    <div class="panel panel-default">\n        <div class="panel-heading">\n            <h3>Import Libraries from Older ADS Accounts</h3>\n        </div>\n\n        <div class="panel-body">\n            \x3c!-- Nav tabs --\x3e\n            <ul class="nav nav-tabs" role="tablist">\n                <li role="presentation" class="active"><a href="#classic-import-tab" aria-controls="classic-import-tab" role="tab" data-toggle="tab"><h4>Import from ADS Classic</h4></a></li>\n                <li role="presentation"><a href="#twopointoh-import-tab" aria-controls="twopointoh-import-tab" role="tab" data-toggle="tab"><h4>Import from ADS 2.0</h4></a></li>\n            </ul>\n\n            \x3c!-- Tab panes --\x3e\n            <div class="tab-content">\n                <div role="tabpanel" class="tab-pane active" id="classic-import-tab">\n\n                </div>\n                <div role="tabpanel" class="tab-pane" id="twopointoh-import-tab">\n\n                </div>\n            </div>\n\n        </div>\n    </div>\n\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/library_import/templates/tab-container",n),n}),define("hbs!js/widgets/library_import/templates/authentication-form-partial",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'        <div class="form-group">\n            <label for="classic-mirror-list">Choose an ADS Classic Mirror Site</label>\n            <select name="classic_mirror" class="form-control" id="classic-mirror-list">\n'+(null!=(r=t.each.call(e,null!=e?e.mirrors:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+"            </select>\n        </div>\n"},2:function(e,t,n,i){return"                <option>"+this.escapeExpression(this.lambda(e,e))+"</option>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\n<form class="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'-form basic-form-style">\n    <div class="form-group">\n        <label for="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'-username">Email address</label>\n        <input name="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'_email" type="email" class="form-control" id="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'-username" placeholder="Email">\n    </div>\n    <div class="form-group">\n        <label for="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'-password">Password</label>\n        <input name="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'_password" type="password" class="form-control" id="'+this.escapeExpression("function"==typeof(a=null!=(a=t.endpoint||(null!=e?e.endpoint:e))?a:t.helperMissing)?a.call(e,{name:"endpoint",hash:{},data:i}):a)+'-password" placeholder="Password">\n    </div>\n\n'+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.endpoint:e,"classic",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'\n    <button type="submit" class="btn btn-primary-faded submit-credentials pull-right">Submit</button>\n</form>'},useData:!0});return t.registerPartial("js/widgets/library_import/templates/authentication-form-partial",n),t.registerPartial("js/widgets/library_import/templates/authentication-form-partial",n),n}),define("hbs!js/widgets/library_import/templates/import-view-labs",["hbs","hbs/handlebars","hbs!js/widgets/library_import/templates/authentication-form-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"\n"+(null!=(r=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"    ",helpers:t,partials:n}))?r:"")+"\n"},3:function(e,t,n,i){var r,a;return"\n    <div>\n        You are currently authenticated as <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.twopointoh_email||(null!=e?e.twopointoh_email:e))?a:t.helperMissing)?a.call(e,{name:"twopointoh_email",hash:{},data:i}):a)+'</b>.\n    </div>\n    <div>\n        <button class="btn btn-primary-faded import-all-libraries"> <i class="fa fa-arrow-circle-down"></i> Import all ADS 2.0 libraries to this system</button>\n    </div>\n\n    <div>\n        <h4>Download ADS 2.0 Libraries</h4>\n        <hr>\n        <button class="btn btn-default bibtex-import" data-target="zotero">\n            <i class="fa fa-download"></i> to Zotero-style BibTeX\n        </button>\n        &nbsp;\n        <button class="btn btn-default bibtex-import" data-target="mendeley">\n            <i class="fa fa-download"></i> to Mendeley-style BibTeX\n        </button>\n    </div>\n<hr>\n<br>\n\n        <button class="btn btn-default collapsed" data-toggle="collapse" data-target="#ads2-form-container">\n            <i class="toggle-icon"></i>\n            Sign into a new ADS 2.0 account\n        </button>\n    <div class="collapse" id="ads2-form-container">\n'+(null!=(r=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"        ",helpers:t,partials:n}))?r:"")+"    </div>\n\n\n\n"},5:function(e,t,n,i){var r,a;return'    <div class="alert alert-danger alert-dismissible" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        '+(null!=(r="function"==typeof(a=null!=(a=t.errorMessage||(null!=e?e.errorMessage:e))?a:t.helperMissing)?a.call(e,{name:"errorMessage",hash:{},data:i}):a)?r:"")+"\n    </div>\n"},7:function(e,t,n,i){var r,a;return'    <div class="alert alert-success alert-dismissible" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        '+(null!=(r="function"==typeof(a=null!=(a=t.successMessage||(null!=e?e.successMessage:e))?a:t.helperMissing)?a.call(e,{name:"successMessage",hash:{},data:i}):a)?r:"")+"\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n"+(null!=(r=t.unless.call(e,null!=e?e.twopointoh_email:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+'\n<div class="status">\n'+(null!=(r=t.if.call(e,null!=e?e.errorMessage:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.successMessage:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+"</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/library_import/templates/import-view-labs",n),n}),define("hbs!js/widgets/library_import/templates/import-view-classic",["hbs","hbs/handlebars","hbs!js/widgets/library_import/templates/authentication-form-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return null!=(r=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"    ",helpers:t,partials:n}))?r:""},3:function(e,t,n,i){var r,a;return"\n<div>\n    You are currently authenticated as <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.classic_email||(null!=e?e.classic_email:e))?a:t.helperMissing)?a.call(e,{name:"classic_email",hash:{},data:i}):a)+"</b>\n    with mirror site <b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.classic_mirror||(null!=e?e.classic_mirror:e))?a:t.helperMissing)?a.call(e,{name:"classic_mirror",hash:{},data:i}):a)+'</b>.\n</div>\n\n<div>\n    <button class="btn btn-primary-faded import-all-libraries"> <i class="fa fa-arrow-circle-down"></i>  Import all Classic libraries</button>\n</div>\n\n<hr>\n\n    <button class="btn btn-default collapsed" data-toggle="collapse" data-target="#classic-form-container">\n        <i class="toggle-icon"></i>\n        Sign into a new Classic account\n    </button>\n<div class="collapse" id="classic-form-container">\n'+(null!=(r=this.invokePartial(n["js/widgets/library_import/templates/authentication-form-partial"],e,{name:"js/widgets/library_import/templates/authentication-form-partial",data:i,indent:"    ",helpers:t,partials:n}))?r:"")+"</div>\n\n"},5:function(e,t,n,i){var r,a;return'    <div class="alert alert-danger alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n        '+(null!=(r="function"==typeof(a=null!=(a=t.errorMessage||(null!=e?e.errorMessage:e))?a:t.helperMissing)?a.call(e,{name:"errorMessage",hash:{},data:i}):a)?r:"")+"\n    </div>\n"},7:function(e,t,n,i){var r,a;return'    <div class="alert alert-success alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n\n        '+(null!=(r="function"==typeof(a=null!=(a=t.successMessage||(null!=e?e.successMessage:e))?a:t.helperMissing)?a.call(e,{name:"successMessage",hash:{},data:i}):a)?r:"")+"\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=t.unless.call(e,null!=e?e.classic_email:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+'\n<div class="status">\n'+(null!=(r=t.if.call(e,null!=e?e.errorMessage:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.successMessage:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+"</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/library_import/templates/import-view-classic",n),n}),define("hbs!js/widgets/library_import/templates/success-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"<div>\n    The following libraries were successfully imported for the first time:\n    <ul>\n"+(null!=(r=t.each.call(e,null!=e?e.created:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+"    </ul>\n\n</div>\n"},2:function(e,t,n,i){return'        <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},4:function(e,t,n,i){var r;return"    <div>\n\n        The following libraries were updated or merged:\n        <ul>\n"+(null!=(r=t.each.call(e,null!=e?e.updated:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+"        </ul>\n    </div>\n"},5:function(e,t,n,i){return'            <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</a></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"<h4>Success!</h4>\n"+(null!=(r=t.if.call(e,null!=e?e.created:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n"+(null!=(r=t.if.call(e,null!=e?e.updated:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/library_import/templates/success-template",n),n}),define("js/widgets/library_import/widget",["js/widgets/base/base_widget","js/components/api_request","js/components/api_targets","hbs!js/widgets/library_import/templates/tab-container","hbs!js/widgets/library_import/templates/import-view-labs","hbs!js/widgets/library_import/templates/import-view-classic","hbs!js/widgets/library_import/templates/success-template","bootstrap"],function(e,t,n,i,r,a,s,o){var l="twopointoh",c=Backbone.Model.extend({defaults:function(){return{}}}),u=Marionette.ItemView.extend({initialize:function(e){if("classic"!==e.endpoint&&e.endpoint!==l)throw new Error("we don't recognize that endpoint: "+e.endpoint);this.model=new c({endpoint:e.endpoint}),this.template="classic"===e.endpoint?a:r},className:"library-import-form",events:{"click button.submit-credentials":"authenticate","click button.bibtex-import":"importBibtex"},triggers:{"click button.import-all-libraries":"library-import"},modelEvents:{change:"render"},importBibtex:function(e){this.trigger("bibtex-import",{target:$(e.target).data("target")})},authenticate:function(e){e.preventDefault();var t={};this.$("form").serializeArray().forEach(function(e){t[e.name]=e.value}),this.trigger("submit-credentials",t)}}),d=Marionette.LayoutView.extend({initialize:function(e){this.classicView=new u({endpoint:"classic"}),this.ads2View=new u({endpoint:l})},regions:{classic:"#classic-import-tab",ads2:"#"+l+"-import-tab"},template:i,onRender:function(){this.classic.show(this.classicView),this.ads2.show(this.ads2View)}});return e.extend({initialize:function(e){function i(e,n,i){this.getBeeHive().getService("Api").request(new t({target:e,options:{type:"POST",data:i,done:function(e){n.model.set(e,{silent:!0}),n.model.trigger("change")},fail:function(e){n.model.set({successMessage:"",errorMessage:e.responseJSON.error},{silent:!0}),n.model.trigger("change")}}}))}function r(e,t){t.$("button.import-all-libraries").addClass("disabled").html('<i class="fa fa-lg fa-spinner fa-pulse"></i> Working...'),this.getBeeHive().getObject("LibraryController").importLibraries(e).done(function(e){var n={};n.updated=e.filter(function(e){return"updated"===e.action}).map(function(e){return{name:e.name,link:"#user/libraries/"+e.library_id}}),n.created=e.filter(function(e){return"created"===e.action}).map(function(e){return{name:e.name,link:"#user/libraries/"+e.library_id}}),t.model.set({successMessage:s(n),errorMessage:""},{silent:!0}),t.model.trigger("change")}).fail(function(){t.model.set({successMessage:"",errorMessage:"There was a problem and libraries were not imported."},{silent:!0}),t.model.trigger("change")})}this.view=new d;var a=this;i=i.bind(this),this.view.classicView.on("submit-credentials",function(e){i(n.LIBRARY_IMPORT_CLASSIC_AUTH,a.view.classicView,e)}),this.view.ads2View.on("submit-credentials",function(e){i(n.LIBRARY_IMPORT_ADS2_AUTH,a.view.ads2View,e)}),r=r.bind(this),this.view.classicView.on("library-import",function(){r("classic",a.view.classicView)}),this.view.ads2View.on("library-import",function(){r(l,a.view.ads2View)}),this.view.ads2View.on("bibtex-import",function(e){var i="LIBRARY_IMPORT_"+e.target.toUpperCase();a.getBeeHive().getService("Api").request(new t({target:n[i],options:{done:function(){var e='<iframe style="display:none;" src="'+arguments[0].url+'"></iframe>';$(document.body).append(e),setTimeout(function(){$(e).remove()},1e3)}}}))})},activate:function(e){this.setBeeHive(e),_.bindAll(this);var i=this;this.getPubSub();i.getBeeHive().getService("Api").request(new t({target:n.LIBRARY_IMPORT_CLASSIC_MIRRORS,options:{done:function(e){e.indexOf("adsabs.harvard.edu")>-1&&(e=_.without(e,"adsabs.harvard.edu")).unshift("adsabs.harvard.edu"),i.view.classicView.model.set({mirrors:e})},fail:function(){console.error("couldn't load classic mirrors")}}})),i.getBeeHive().getService("Api").request(new t({target:n.LIBRARY_IMPORT_CREDENTIALS,options:{done:function(e){i.view.classicView.model.set(e),i.view.ads2View.model.set(e)},fail:function(e,t){"This user has not set up an ADS Classic account"!=e.responseJSON.error&&console.error(e)}}}))}})}),define("hbs!js/widgets/filter_visualizer/templates/widget-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="filter-visualizer">\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/filter_visualizer/templates/widget-view",n),n}),define("hbs!js/widgets/filter_visualizer/templates/item-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"category",{name:"compare",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?r:"")+"\n"},2:function(e,t,n,i){return"\n         <h5>"+this.escapeExpression(this.lambda(null!=e?e.display:e,e))+"</h5>\n\n"},4:function(e,t,n,i){return'\n            <span class="filter-'+this.escapeExpression(this.lambda(null!=e?e.type:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.display:e,e))+'</span>\n              <button class="btn btn-xs filter-'+this.escapeExpression(this.lambda(null!=e?e.type:e,e))+'-remove" value="'+this.escapeExpression(this.lambda(null!=e?e.value:e,e))+'" title="remove this filter">\n                <i class="fa fa-remove"></i></button>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n"+(null!=(r=t.each.call(e,null!=e?e.elements:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/filter_visualizer/templates/item-view",n),n}),define("js/widgets/filter_visualizer/widget",["underscore","jquery","backbone","marionette","js/components/api_query","js/components/pubsub_events","hbs!js/widgets/filter_visualizer/templates/widget-view","hbs!js/widgets/filter_visualizer/templates/item-view","js/components/api_feedback","js/mixins/dependon"],function(e,t,n,i,r,a,s,o,l,c){var u=n.Model.extend({}),d=n.Collection.extend({model:u}),h=i.ItemView.extend({tagName:"span",className:"filter-topic-group",template:o,events:{"click button":"onClick"},onClick:function(e){e.preventDefault();var n=t(e.target);this.trigger("filter-event",n.attr("value")?n.attr("value"):n.parent().attr("value"))}}),p=i.CompositeView.extend({template:s,childView:h,childViewContainer:"#filter-visualizer",events:{}}),f=i.Controller.extend({activate:function(t){e.bindAll(this,"processFeedback","onFilterEvent"),this.setBeeHive(t),pubsub=t.getService("PubSub"),pubsub.subscribe(pubsub.FEEDBACK,this.processFeedback)},initialize:function(t){t=e.defaults(t,{withoutOperators:!0,maxNumberOfTokens:5,maxQueryLen:100}),this.collection=new d({}),this.view=new p({collection:this.collection}),this.listenTo(this.view,"childview:filter-event",this.onFilterEvent),this.knownFilters={fq_author:"Author",fq_database:"Collection",fq_property:"Property",fq_facets180:"Status",fq_keyword_facet:"Keywords",fq_bibstem_facet:"Publication",fq_bibgroup_facet:"BibGroup",fq_data_facet:"Data",fq_vizier_facet:"Vizier",fq_simbad_object_facet_hier:"Object",fq_grant:"Grant",fq_visualization_author:"Author Network",fq_visualization_paper:"Paper Network",fq_wordcloud:"Concept Cloud",fq_bubble_chart:"Results Graph",fq_doctype:"Pubtype"},this.currentQuery=null,this.withoutOperators=t.withoutOperators,this.maxNumberOfTokens=t.maxNumberOfTokens,this.maxQueryLen=t.maxQueryLen},render:function(){return this.view.render(),this.view.el},processFeedback:function(e){switch(e.code){case l.CODES.SEARCH_CYCLE_STARTED:this.processQuery({numFound:e.numFound,q:e.query.clone()})}},processQuery:function(e){var t=e.q;numFound=e.numFound;var n=this.extractFilters(t);this._saveInfo(t,n);var i=this.prepareGUIData(n);this.collection.reset(i)},_saveInfo:function(t,n){this.currentQuery=t,this.currentFilters={},e.each(n,function(e){this.currentFilters[e.filter_name]=e},this)},extractFilters:function(t){var n=t.toJSON(),i=[];if(!n.fq&&!t.get("__qid"))return i;n.fq;var r=e.keys(n);return e.each(r,function(t){if(0==t.indexOf("fq_")){if(!this.knownFilters[t])return;var a={category:this.knownFilters[t],filter_name:t,filter_query:n[t][0]};if(n[t].length>1)return void console.warn("Breach of an api contract, filter contains too many values",t,n[t]);var s=e.filter(r,function(e){if(e.indexOf(t)>-1&&e!==t)return!0});1==s.length?(a.filter_key=s[0],a.filter_value=n[s[0]]):console.warn("no fq metadata available, so presumably query is being loaded from url (if not, there is a problem!) "),i.push(a)}},this),i=e.sortBy(i,function(t){var n=e.indexOf(self.knownFilters,t.category);return n>-1?n:1e3})},prepareGUIData:function(t){if(this.withoutOperators)return this._prepareGUIDataWithoutOperators(t);var n=[];return e.each(t,function(t){var i=[];if(i.push({type:"category",display:t.category,value:t.filter_name+"|category|"+t.category}),t.filter_value.length-1>this.maxNumberOfTokens||t.filter_value.join(" ").length>this.maxQueryLen)return i.push({type:"control",display:t.filter_value.length-1+" custom values",value:t.filter_name+"|control|x"}),void n.push({elements:i});var r=0,a=t.filter_value[0];e.each(t.filter_value.slice(1),function(e){++r>1&&i.push({type:"operator",display:a,value:t.filter_name+"|operator|"+a}),i.push({type:"operand",display:this.beautifyOperand(t.filter_name,e),value:t.filter_name+"|operand|"+e})},this),i.push({type:"control",display:"",value:t.filter_name+"|control|x"}),n.push({elements:i})},this),n},_prepareGUIDataWithoutOperators:function(t){var n=[];return e.each(t,function(t){var i=[];if(i.push({type:"category",display:t.category,value:t.filter_name+"|category|"+t.category}),!t.filter_value||t.filter_value.length-1>this.maxNumberOfTokens||t.filter_value.join(" ").length>this.maxQueryLen)return i.push({type:"operand",display:"custom filter",value:t.filter_name+"|control|x"}),void n.push({elements:i});var r=0,a=t.filter_value[0],s="";"NOT"==a?s="-":"AND"==a&&(s="+"),e.each(t.filter_value.slice(1),function(o){var l=e.clone(i),c=0==r++&&"NOT"==a?"":s;l.push({type:"operand",display:c+this.beautifyOperand(t.filter_name,o),value:t.filter_name+"|operand|"+o}),n.push({elements:l})},this)},this),n},beautifyOperand:function(e,t){for(var n=t;0==n.indexOf("(")&&n.indexOf(")")==n.length-1;)n=n.substr(1,n.length-2);switch(n=n.replace(/0\/|1\/[^/]+\//,""),e){case"fq_author":n=(n=n.replace(/author_facet_hier:/g,"")).replace(/\d+\//g,"");break;case"fq_database":n=n.replace(/database:/g,"");break;case"fq_facets180":n=n.replace(/property:/g,"");break;case"fq_keyword_facet":n=(n=n.replace(/keyword_facet:/g,"")).replace(/\\/g,"");break;case"fq_bibstem_facet":n=n.replace(/bibstem_facet:/g,"");break;case"fq_bibgroup_facet":n=n.replace(/bibgroup_facet:/g,"");break;case"fq_data_facet":n=n.replace(/data_facet:/g,"");break;case"fq_vizier_facet":n=n.replace(/vizier_facet:/g,"");break;case"fq_grant":n=n.replace(/grant:/g,"");break;case"fq_simbad_object_facet_hier":n=n.replace(/simbad_object_facet_hier:0\\\//g,"");break;case"fq_doctype":n=n.replace(/doctype:/g,"")}return n=n.replace(/\\?"/g,""),n=n.replace(/\*:\*/,"any")},createModifiedQuery:function(t){var n=t.split("|"),i={};i.name=n[0],i.part=n[1],i.value=n[2];var a=this.currentQuery.toJSON();if(a.fq||a.fq[i.name]){switch(i.part){case"operand":if(a[this.currentFilters[i.name].filter_key].length>2){var s=a[this.currentFilters[i.name].filter_key];if(-1==e.indexOf(s,i.value))throw console.error("Cannot find/remove the value: "+i.value,s),Error("Error in modifying the query");var o;if((s=e.reject(s,function(e){return e==i.value})).length>2){var l=" "+s[0]+" ";o="("+s.slice(1).join(l)+")"}else o=s[1];a[i.name]=o,a[this.currentFilters[i.name].filter_key]=s;break}case"control":delete a[i.name],delete a[this.currentFilters[i.name].filter_key],a.fq=e.filter(a.fq,function(e){if(-1==e.indexOf("v=$"+i.name))return!0})}return a.fq&&0==a.fq.length&&delete a.fq,new r(a)}console.error("The current query has no filter: "+i.name)},onLoad:function(e){this.collection?this.collection.reset(this.getData(e)):this.initialize(e)},onFilterEvent:function(e,t){var n=this.createModifiedQuery(t),i=this.getBeeHive().getService("PubSub");i&&i.publish(i.START_SEARCH,n)}});return e.extend(f.prototype,c.BeeHive),f}),define("hbs!js/widgets/navbar/template/navbar",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <a class="navbar-brand s-navbar-brand" href="#"><img class="s-ads-icon" src="styles/img/transparent_logo.svg" alt="ads icon"/>\n                <h1> <b>ads</b>beta</h1>\n            </a>\n'},3:function(e,t,n,i){return'            <div class="s-hourly-warning">\n                <a class="navbar-brand s-navbar-brand" href="#"><i class="icon-danger fa-2x"></i> ADS TEST</a>\n                <span> Nothing you do here will be saved!  <a href="https://ui.adsabs.harvard.edu/">I want the real ADS <i class="fa fa-arrow-right"></i></a>\n                </span>\n            </div>\n'},5:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=e?e.orcidModeOn:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(11,i,0),data:i}))?r:"")+'                \x3c!--end "if/else orcidModeOn"--\x3e\n\n'},6:function(e,t,n,i){var r;return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class=" btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title">\n                         <img src="../../styles/img/orcid-active.svg" alt="orcid symbol"/>\n                            ORCID\n                            <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style">\n                            '+(null!=(r=t.if.call(e,null!=e?e.orcidLastName:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'\n                            <div class="s-orcid-mode-label"><b>ORCID Mode</b></div>\n                            <div class="s-orcid-label-container">\n                                off\n                                <div class="switch">\n                                    <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round orcid-mode" type="checkbox" checked="checked">\n                                    <label for="cmn-toggle-1"></label>\n                                </div>\n                                on\n                            </div>\n                        </li>\n\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-link" href="#user/orcid" >View my ORCID papers in ADS </a>\n                        </li>\n'+(null!=(r=t.if.call(e,null!=e?e.orcidURI:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'                        <li>\n                            <a href="#orcid-instructions"> <i class="fa fa-info-circle"></i> Learn how to make ORCID claims using ADS</a>\n                        </li>\n                        <li class="divider"></li>\n                        <li>\n                            <a href="#" class="orcid-logout" >Log out from ORCID in ADS</a>\n                        <li>\n\n                    </ul>\n                </li>\n\n'},7:function(e,t,n,i){var r;return" <h4> Signed in to ORCID as <br/> <strong>"+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidFirstName||(null!=e?e.orcidFirstName:e))?r:t.helperMissing)?r.call(e,{name:"orcidFirstName",hash:{},data:i}):r)+" "+this.escapeExpression("function"==typeof(r=null!=(r=t.orcidLastName||(null!=e?e.orcidLastName:e))?r:t.helperMissing)?r.call(e,{name:"orcidLastName",hash:{},data:i}):r)+"</strong></h4> "},9:function(e,t,n,i){return'                        <li>\n                            <a href="https://orcid.org/my-orcid" target="_blank" >View my ORCID profile on orcid.org </a>\n                        </li>\n'},11:function(e,t,n,i){var r;return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title"> <img src="../../styles/img/orcid_inactive.png"\n                                                          alt="orcid symbol"/> ORCID  <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style">\n                            '+(null!=(r=t.if.call(e,null!=e?e.orcidLastName:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'\n                            <div class="s-orcid-mode-label"><b>ORCID Mode</b></div>\n                            <div class="s-orcid-label-container">\n                                off\n                                <div class="switch clearfix">\n                                    <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round orcid-mode" type="checkbox">\n                                    <label for="cmn-toggle-1"></label>\n                                </div>\n                                on\n                            </div>\n                        </li>\n                        <li style="clear:both" class="no-hover-style">You have turned off the ORCID view for the ADS search results page, but are still logged in.</li>\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-link" href="#user/orcid" > View my ORCID papers in ADS</a>\n                        </li>\n'+(null!=(r=t.if.call(e,null!=e?e.orcidURI:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'                        <li>\n                            <a href="#orcid-instructions"> <i class="fa fa-info-circle"></i> Learn how to claim ORCID papers</a>\n                        </li>\n                        <li class="divider"></li>\n                        <li>\n                            <a class="orcid-logout" >Log out from ORCID</a>\n                        </li>\n                    </ul>\n                </li>\n\n'},13:function(e,t,n,i){return'\n                <li class="dropdown orcid-dropdown s-orcid-dropdown">\n                    <button class="dropdown-toggle btn-link" data-toggle="dropdown" aria-expanded="false">\n                        <span class="s-orcid-title"> <img src="../../styles/img/orcid_inactive.png"\n                                                          alt="orcid symbol"/>  ORCID  <span class="caret"></span></button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style" >\n                            <button class="btn-link orcid-sign-in"> Sign in to ORCID to claim papers in the ADS. </button>\n                        </li>\n                        <li class="no-hover-style">\n                            This functionality is still experimental.\n                        </li>\n                    </ul>\n                </li>\n\n                \x3c!--end "if/else orcidLoggedIn"--\x3e\n\n'},15:function(e,t,n,i){var r;return'\n                \x3c!-- Single button --\x3e\n                <li class="dropdown">\n                    <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                     <i class="fa fa-user"></i> Account <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li class="no-hover-style" style="padding:15px 10px;">You are signed in as <br/> <b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.currentUser||(null!=e?e.currentUser:e))?r:t.helperMissing)?r.call(e,{name:"currentUser",hash:{},data:i}):r)+'</b></li>\n                        <li ><a href="#/user/home"> <i class="fa fa-user"></i> My Home Page</a></li>\n                        <li><a href="#/user/libraries"> <i class="fa fa-book"></i> ADS Libraries</a></li>\n                        <li><a href="#/user/settings"> <i class="fa fa-cog"></i> Customize Settings</a></li>\n                        <li class="divider"></li>\n                        <li><a href="#" class="logout">Log Out</a></li>\n                    </ul>\n                </li>\n\n'},17:function(e,t,n,i){return'                <li class="register"><a href="#user/account/register">Sign Up</a></li>\n                <li class="login"><a href="#user/account/login">Log In</a></li>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<nav class="navbar fluid navbar-inverse">\n        \x3c!-- Brand and toggle get grouped for better mobile display --\x3e\n        <div class="navbar-header">\n            <button type="button" class="navbar-toggle" data-toggle="collapse"\n                    data-target="#bs-example-navbar-collapse-1">\n                <span class="sr-only">Toggle navigation</span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n                <span class="icon-bar"></span>\n            </button>\n'+(null!=(r=t.unless.call(e,null!=e?e.hourly:e,{name:"unless",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+'        </div>\n\n        \x3c!-- Collect the nav links, forms, and other content for toggling --\x3e\n        <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">\n\n            <ul class="nav navbar-nav navbar-right">\n\n                <li>\n                    <button type="button" class="btn btn-primary-faded feedback-button" data-toggle="modal" data-target="#feedback-modal">\n                        <i class="fa fa-comment"></i> Feedback\n                    </button>\n                </li>\n\n'+(null!=(r=t.if.call(e,null!=e?e.orcidLoggedIn:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.program(13,i,0),data:i}))?r:"")+'\n                <li class="dropdown">\n                    <button type="button" class="btn btn-link dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n                      <i class="fa fa-graduation-cap"></i> Learn <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n                        <li> <a href="https://adsabs.github.io/blog/" target="_blank"> <i class="fa fa-newspaper-o"></i> ADS Blog </a></li>\n                        <li>  <a href="http://adsabs.github.io/help/" target="_blank"> <i class="fa fa-info-circle"></i> ADS Help Pages </a></li>\n                    </ul>\n                </li>\n\n\n'+(null!=(r=t.if.call(e,null!=e?e.currentUser:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.program(17,i,0),data:i}))?r:"")+"\n            </ul>\n\n        </div>\n        \x3c!-- /.navbar-collapse --\x3e\n    </div>\n</nav>\n\x3c!-- /.container-fluid --\x3e"},useData:!0});return t.registerPartial("js/widgets/navbar/template/navbar",n),n}),define("hbs!js/widgets/navbar/template/feedback",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="modal fade" id="feedback-modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>\n                <h4 class="modal-title">Feedback Form</h4>\n            </div>\n            <div class="modal-body">\n                <form class="feedback-form">\n\n                    <input type="hidden" name="_subject" value="Bumblebee Feedback" />\n                    <input type="hidden" name="feedback-type" value="feedback" />\n\n                    <input type="text" name="_gotcha" style="display:none" />\n\n                    <div class="form-group half-width">\n                        <label> Name\n                            <input class="form-control" type="text" name="name" required>\n                        </label>\n                    </div>\n                    <div class="form-group half-width">\n                        <label> Email\n                            <input class="form-control" type="email" name="_replyto" required>\n                        </label>\n                    </div>\n\n                    <div class="form-group">\n                        <label>Feedback <br/>\n                        <textarea rows="8" cols="50" name="comments" required/>\n                        </label>\n\n                    </div>\n                    <div class="form-group">\n                        <div class="g-recaptcha"></div>\n                    </div>\n                    <button class="btn btn-success" type="submit" value="Send">Submit</button>\n                </form>\n\n                <br/>\n                <p>You can also reach us at <b>adshelp [at] cfa.harvard.edu</b></p>\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default" data-dismiss="modal">Close without submitting</button>\n            </div>\n        </div>\x3c!-- /.modal-content --\x3e\n    </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e\n'},useData:!0});return t.registerPartial("js/widgets/navbar/template/feedback",n),n}),define("js/widgets/navbar/widget",["marionette","js/widgets/base/base_widget","hbs!js/widgets/navbar/template/navbar","hbs!js/widgets/navbar/template/feedback","js/components/api_query_updater","js/components/api_query","js/components/api_request","js/components/api_targets","bootstrap"],function(e,t,n,i,r,a,s,o,l){var c,u;return u=Backbone.Model.extend({defaults:function(){return{orcidModeOn:!1,orcidLoggedIn:!1,currentUser:void 0,orcidFirstName:void 0,orcidLastName:void 0,hourly:!1}}}),c=e.ItemView.extend({template:n,modelEvents:{change:"render"},events:{"click .orcid-dropdown ul":"stopPropagation","click button.orcid-sign-in":"orcidSignIn","change .orcid-mode":"changeOrcidMode","click .orcid-link":function(){this.trigger("navigate-to-orcid-link")},"click .orcid-logout":function(e){e.preventDefault(),this.trigger("logout-only-orcid")},"click .logout":function(e){e.preventDefault(),this.trigger("logout")},"click .login":function(){this.trigger("navigate-login")},"click .register":function(){this.trigger("navigate-register")},"click button.search-author-name":function(e){this.trigger("search-author")}},stopPropagation:function(e){if("button"==e.target.tagName.toLowerCase()||"a"==e.target.tagName.toLowerCase()||"code"==e.target.tagName.toLowerCase())return!0;e.stopPropagation()},orcidSignIn:function(){this.model.set("orcidModeOn",!0),this.trigger("user-change-orcid-mode")},changeOrcidMode:function(){var e=this;setTimeout(function(){e.$(".orcid-mode").is(":checked")?e.model.set("orcidModeOn",!0):e.model.set("orcidModeOn",!1),e.trigger("user-change-orcid-mode"),e.render()},400)},onRender:function(){var e=this;if(!this.formAttached){$("body").append(i());var t=$("#feedback-modal");t.on("hidden.bs.modal",function(){t.find(".modal-body").html($(i()).find("form"))}),t.on("shown.bs.modal",function(){e.trigger("activate-recaptcha")}),$(".feedback-form").submit(function(n){n.preventDefault(),e.trigger("feedback-form-submit",$(n.target),t)}),this.formAttached=!0}}}),t.extend({initialize:function(e){e=e||{},this.model=new u,this.view=new c({model:this.model}),t.prototype.initialize.apply(this,arguments),this.qUpdater=new r("NavBar")},activate:function(e){this.setBeeHive(e),_.bindAll(this,["handleUserAnnouncement","getOrcidUserInfo","storeLatestPage"]);var t=this.getPubSub();t.subscribe(t.USER_ANNOUNCEMENT,this.handleUserAnnouncement),t.subscribe(t.APP_STARTED,this.getOrcidUserInfo),t.subscribe(t.NAVIGATE,this.storeLatestPage),this.setInitialVals()},storeLatestPage:function(e){this._latestPage=e},viewEvents:{"navigate-login":function(){this._navigate("authentication-page",{subView:"login"})},"navigate-register":function(){this._navigate("authentication-page",{subView:"register"})},"navigate-settings":function(){this._navigate("UserPreferences")},logout:function(){this.getBeeHive().getObject("Session").logout(),this.orcidLogout()},"feedback-form-submit":"submitForm","navigate-to-orcid-link":"navigateToOrcidLink","user-change-orcid-mode":"toggleOrcidMode","logout-only-orcid":"orcidLogout","search-author":"searchAuthor","activate-recaptcha":"activateRecaptcha"},submitForm:function(e,t){var n=e.serialize();n+="&user-agent-string="+encodeURIComponent(navigator.userAgent);var i=new s({target:o.FEEDBACK,options:{method:"POST",data:n,dataType:"json",done:function(n){e.find("button[type=submit]").html('<i class="icon-success"></i> Message sent!'),setTimeout(function(){t.modal("hide")},500)},fail:function(t){e.find("button[type=submit]").addClass("btn-danger").html('<i class="icon-danger"></i> There was an error!')},beforeSend:function(){e.find("button[type=submit]").html('<i class="icon-loading"></i> Sending form...')}}});this.getBeeHive().getService("Api").request(i)},navigateToOrcidLink:function(){this._navigate("orcid-page")},_navigate:function(e,t){var n=this.getPubSub();n.publish(n.NAVIGATE,e,t)},setInitialVals:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi").hasAccess();this.model.set({orcidModeOn:e.isOrcidModeOn()&&t,orcidLoggedIn:t}),this.model.set("currentUser",e.getUserName())},getOrcidUserInfo:function(){var e=this.getBeeHive().getService("OrcidApi");if(this.model.get("orcidLoggedIn")){var t=this;e.getUserProfile().done(function(e){try{var n=e["orcid-bio"]["personal-details"]["given-names"].value,i=e["orcid-bio"]["personal-details"]["family-name"].value;t.model.set("orcidFirstName",n),t.model.set("orcidLastName",i),t.model.set("orcidQueryName",i+", "+n)}catch(e){t.model.unset("orcidFirstName",n),t.model.unset("orcidLastName",i),t.model.unset("orcidQueryName",i+", "+n),t.model.unset("orcidName","unknown")}t.model.set("orcidURI",e["orcid-identifier"].uri)})}var n=this.getBeeHive().getObject("AppStorage").getConfigCopy().hourly;this.model.set("hourly",n)},handleUserAnnouncement:function(e,t){var n=this.getBeeHive().getService("OrcidApi"),i=this.getBeeHive().getObject("User");e==i.USER_SIGNED_IN?this.model.set("currentUser",t):e==i.USER_SIGNED_OUT?this.model.set("currentUser",void 0):e==i.USER_INFO_CHANGE&&_.has(t,"isOrcidModeOn")&&(this.model.set({orcidModeOn:t.isOrcidModeOn,orcidLoggedIn:n.hasAccess()}),this.model.get("orcidLoggedIn")&&this.getOrcidUserInfo())},toggleOrcidMode:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi"),n=this.model.get("orcidModeOn");e.setOrcidMode(n),n&&(t.hasAccess()||t.signIn())},searchAuthor:function(){var e=this.getPubSub();e.publish(e.START_SEARCH,new a({q:"author:"+this.qUpdater.quote(this.model.get("orcidQueryName"))}))},signOut:function(){var e=this.getBeeHive().getObject("User"),t=this.getBeeHive().getService("OrcidApi");t&&t.signOut(),e.setOrcidMode(!1)},orcidLogout:function(){var e=this.getPubSub();this.getBeeHive().getService("OrcidApi").signOut(),this.model.set("orcidLoggedIn",!1),this.getBeeHive().getObject("User").setOrcidMode(!1),"orcid-page"===this._latestPage&&e.publish(e.NAVIGATE,"index-page")},activateRecaptcha:function(){var t=new e.ItemView({el:"#feedback-modal"});this.getBeeHive().getObject("RecaptchaManager").activateRecaptcha(t)}})}),define("hbs!js/widgets/user_navbar/nav_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return' class="active" '},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<ul class="nav nav-pills user-pill-nav s-user-pill-nav">\n\n    <li role="presentation"  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"home-page",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' >\n        <a href="#/user/home">\n            <i class="fa fa-user"></i> My Home Page\n        </a>\n    </li>\n    <li  role="presentation" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"libraries-page",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>\n        <a href="#/user/libraries">\n            <i class="fa fa-book"></i> ADS Libraries\n        </a>\n    </li>\n    <li role="presentation" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.page:e,"settings-page",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>\n        <a href="#/user/settings"><i class="fa fa-cog">\n            </i> Customize Settings\n        </a>\n    </li>\n</ul>'},useData:!0});return t.registerPartial("js/widgets/user_navbar/nav_template",n),n}),define("js/widgets/user_navbar/widget",["marionette","hbs!js/widgets/user_navbar/nav_template","js/mixins/dependon"],function(e,t,n){var i=Backbone.Model.extend({defaults:function(){return{page:void 0,userName:void 0}}}),r=e.ItemView.extend({template:t,modelEvents:{change:"render"}}),a=e.Controller.extend({initialize:function(e){e=e||{},this.model=new i,this.view=new r({model:this.model})},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");_.bindAll(this),t.subscribe(t.PAGE_CHANGE,this.updateCurrentView),t.subscribe(t.USER_ANNOUNCEMENT,this.updateUser)},updateCurrentView:function(e){this.model.set("page",e)},updateUser:function(e,t){var n=this.getBeeHive().getObject("User");if(e==n.USER_SIGNED_IN){var i=t;i&&i.indexOf("@")>-1&&(i=i.split("@")[0]),this.model.set("user",i)}else e==n.USER_SIGNED_OUT&&this.model.set("user",void 0)},render:function(){return this.view.render(),this.view.el}});return _.extend(a.prototype,n.BeeHive),a}),define("hbs!js/widgets/alerts/templates/modal_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'                    <i class="icon-danger fa-2x"></i>\n'},3:function(e,t,n,i){return'                    <i class="icon-success fa-2x"></i>\n'},5:function(e,t,n,i){return""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\n\x3c!--html for modal alerts--\x3e\n\n<div class="modal-dialog '+this.escapeExpression("function"==typeof(a=null!=(a=t.type||(null!=e?e.type:e))?a:t.helperMissing)?a.call(e,{name:"type",hash:{},data:i}):a)+'">\n        <div class="modal-content" id="modal-alert-content">\n            <div class="modal-header">\n                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>\n\n                <h4 class="modal-title" id="alert-modal-label">\n'+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"danger",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"success",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.type:e,"warning",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+"\n                    "+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+'\n\n                </h4>\n            </div>\n            <div class="modal-body">\n                '+(null!=(r="function"==typeof(a=null!=(a=t.msg||(null!=e?e.msg:e))?a:t.helperMissing)?a.call(e,{name:"msg",hash:{},data:i}):a)?r:"")+'\n            </div>\n            <div class="modal-footer">\n                <button type="button" class="btn btn-default btn-sm" data-dismiss="modal">Close</button>\n            </div>\n        </div>\n    </div>\n'},useData:!0});return t.registerPartial("js/widgets/alerts/templates/modal_template",n),n}),define("js/widgets/alerts/modal_view",["marionette","hbs!js/widgets/alerts/templates/modal_template"],function(e,t){return e.ItemView.extend({id:"#alert-modal-content",template:t,showModal:function(){$("#alert-modal").modal("show")},closeModal:function(){$("#alert-modal").modal("hide")},modelEvents:{change:"render"},render:function(){if($("#modal-alert-content").length||($("body").append('<div class="modal fade" id="alert-modal" tabindex="-1" role="dialog" aria-labelledby="alert-modal-label" aria-hidden="true"></div>'),this.setElement($("#alert-modal")[0])),this.model.get("modal"))return"danger"===this.model.get("type")&&console.error("error feedback: ",this.model.get("title"),this.model.get("msg")),e.ItemView.prototype.render.apply(this,arguments)},onRender:function(){this.showModal()}})}),define("hbs!js/widgets/alerts/templates/page_top_alert",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r,a;return'    <div class="alert alert-'+this.escapeExpression("function"==typeof(a=null!=(a=t.type||(null!=e?e.type:e))?a:t.helperMissing)?a.call(e,{name:"type",hash:{},data:i}):a)+'" id="page-top-alert">\n        <div>\n            '+(null!=(r="function"==typeof(a=null!=(a=t.msg||(null!=e?e.msg:e))?a:t.helperMissing)?a.call(e,{name:"msg",hash:{},data:i}):a)?r:"")+'\n        </div>\n        <div>\n            <button type="button" class="close"><span aria-hidden="true"><i class="fa fa-2x fa-times"></i></span><span class="sr-only">Close</span></button>\n        </div>\n    </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.msg:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:""},useData:!0});return t.registerPartial("js/widgets/alerts/templates/page_top_alert",n),n}),define("js/widgets/alerts/page_top_alert",["marionette","hbs!js/widgets/alerts/templates/page_top_alert"],function(e,t){return e.ItemView.extend({tagName:"span",className:"alert-banner",template:t,modelEvents:{change:"render"},events:{"click #page-top-alert button.close":"close"},close:function(){this.$(".alert").css("display","none")},render:function(){return this.model.get("modal")?this:this.model.get("msg")||this.model.get("title")?e.ItemView.prototype.render.apply(this,arguments):(this.$el.html(""),this)}})}),define("js/widgets/alerts/widget",["marionette","js/widgets/base/base_widget","js/components/api_query","js/components/api_feedback","js/components/alerts","./modal_view","./page_top_alert","jquery","jquery-ui","bootstrap"],function(e,t,n,i,r,a,s,o,l,c){function u(){var e=this,t=this.model.get("events"),n=/^(\S+)\s*(.*)$/;this.$el&&this.$el.off(".customEvents"+this.mid),t&&_.each(t,function(t,i){var r=i.match(n),a=r[1],s=r[2],o=i,l=function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.model.get("promise"),n=this.model.get("events");n[o]?t.resolve(n[o]):t.resolve(o),this.model.get("modal")||this.model.set("msg",null)};l=_.bind(l,e),a+=".customEvents"+this.mid,""===s?e.$el.on(a,l):e.$el.on(a,s,l)})}var d=Backbone.Model.extend({defaults:{type:"info",msg:void 0,title:void 0,events:void 0,modal:!1}}),h=a.prototype.onRender;a.prototype.onRender=function(){u.apply(this,arguments),h&&h.apply(this,arguments)};var p=s.prototype.onRender;return s.prototype.onRender=function(){u.apply(this,arguments),p&&p.apply(this,arguments)},t.extend({initialize:function(e){this.model=new d,this.view=new s({model:this.model}),this.modalView=new a({model:this.model}),t.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.NAVIGATE,this.modalView.closeModal)},alert:function(e){var t=o.Deferred();return this.model.set({msg:e.msg,events:e.events,title:e.title,type:e.type||"info",modal:e.modal,promise:t}),t.promise()},closeView:function(){this.view.close(),this.modalView.closeModal()}})}),define("hbs!js/widgets/classic_form/form",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<form action="">\n    <div class="pull-right">\n        <button style="position: relative;top: -13px;" class="btn btn-primary" type="submit" disabled="true"><i class="fa fa-search"></i> Search</button>\n    </div>\n\n    <div data-field="database">\n        Databases to query : <label> <input type="checkbox" checked="true" name="astronomy"/> Astronomy </label>&nbsp;&nbsp; <label> <input type="checkbox"  name="physics"/> Physics </label>\n    </div>\n    <div class="clearfix">\n        <div class="col-sm-6"  data-field="author" data-textInput="true">\n            <div class="classic-form__logic-group logic-group">\n                <label> <input type="radio" name="author-logic" value="AND" checked="true"/> and </label>\n                <label> <input type="radio" name="author-logic" value="OR"/> or </label>\n                <label> <input type="radio" name="author-logic" value="BOOLEAN"/> boolean </label>\n            </div>\n            <div>\n                <label class="classic-author-label" for="#classic-author">Author</label>\n                <textarea id="classic-author"name="author-names"cols="30" rows="2" placeholder="(Last, First M) one per line"></textarea>\n            </div>\n        </div>\n        <div class="col-sm-6"  data-field="object" data-textInput="true">\n           <div class="pull-right-sm">\n            <div class="classic-form__logic-group logic-group">\n                <label> <input type="radio" name="object-logic" value="AND" checked="true"/> and </label>\n                <label> <input type="radio" name="object-logic" value="OR" /> or </label>\n                <label> <input type="radio" name="object-logic" value="BOOLEAN" /> boolean </label>\n            </div>\n            <div>\n                <label class="classic-object-label" for="#classic-object">Object</label>\n                <textarea id="classic-object" name="object-names" id="" cols="30" rows="2" placeholder="SIMBAD object search"></textarea>\n            </div>\n           </div>\n       </div>\n    </div>\n    <div data-field="date">\n        <div>\n         <b>Publication date</b> between <br/>\n            <input  class="form-control  date-control" maxlength="2" placeholder="MM" type="text" value="" name="month_from" style="margin-top:6px">/\n            <input  class="form-control  date-control" maxlength="4" placeholder="YYYY" type="text" value="" name="year_from">and\n            <input  class="form-control  date-control" maxlength="2" placeholder="MM" type="text" value="" name="month_to">/\n            <input  class="form-control  date-control" maxlength="4" placeholder="YYYY" type="text" value="" name="year_to">\n        </div>\n    </div>\n    <div data-field="title" data-textInput="true">\n        <div class="classic-form__logic-group logic-group pull-right" >\n            <label> <input type="radio" name="title-logic" value="AND" checked="true"/> and </label>\n            <label> <input type="radio" name="title-logic" value="OR" /> or </label>\n            <label> <input type="radio" name="title-logic" value="BOOLEAN"/> boolean </label>\n        </div>\n        <div>\n            <label for="#classic_title_input"> Title</label>\n            <input id="classic_title_input" class="form-control" name="title" type="text"/>\n        </div>\n    </div>\n    <div  data-field="abs" data-textInput="true">\n        <div class="classic-form__logic-group logic-group pull-right">\n            <label> <input type="radio" name="abstract-logic" value="AND" checked="true"/> and </label>\n            <label> <input type="radio" name="abstract-logic" value="OR"/> or </label>\n            <label> <input type="radio" name="abstract-logic" value="BOOLEAN"/> boolean </label>\n        </div>\n        <div>\n        <label for="#classic_abstract_input"> Abstract/Keywords</label>\n        <input id="clasic_abstract_input" class="form-control" name="abs" type="text"/>\n        </div>\n    </div>\n    <div data-field="property">\n        <label>\n            <input type="checkbox" name="refereed">&nbsp;Refereed only&nbsp;\n        </label>\n        &nbsp;&nbsp;&nbsp;\n        <label>\n            <input type="checkbox" name="article">&nbsp;Articles only&nbsp;\n        </label>\n    </div>\n    <div data-field="bibstem" data-textInput="true">\n        <div class="logic-group">\n            <input type="checkbox" class="hidden" value="OR" checked="true"/>\n        </div>\n        <label for="#classic-bibstem">Publication</label>\n        <input id="classic-bibstem" type="text" class="form-control" name="bibstem" placeholder="Comma-separated bibstems of journal titles" autocomplete="off"/>\n    </div>\n\n    <div class="pull-right">\n        <button class="btn" type="reset"><i class="fa fa-times"></i> Clear</button>\n        <button class="btn btn-primary" type="submit" disabled="true"><i class="fa fa-search"></i> Search</button>\n    </div>\n</form>\n'},useData:!0});return t.registerPartial("js/widgets/classic_form/form",n),n}),define("js/widgets/paper_search_form/topterms",[],function(){return[{value:"A&A",label:"Astronomy and Astrophysics (A&A)"},{value:"A&AS",label:"Astronomy and Astrophysics Supplement Series (A&AS)"},{value:"AAS",label:"American Astronomical Society Meeting Abstracts (AAS)"},{value:"AcA",label:"Acta Astronomica (AcA)"},{value:"AcAau",label:"Acta Astronautica (AcAau)"},{value:"AcCrA",label:"Acta Crystallographica Section A (AcCrA)"},{value:"AcOpt",label:"Optica Acta (AcOpt)"},{value:"ACP",label:"Atmospheric Chemistry & Physics (ACP)"},{value:"ACPD",label:"Atmospheric Chemistry & Physics Discussions (ACPD)"},{value:"AcPPB",label:"Acta Physica Polonica B (AcPPB)"},{value:"AcSpA",label:"Spectrochimica Acta Part A: Molecular Spectroscopy (AcSpA)"},{value:"AcSpe",label:"Spectrochimica Acta (AcSpe)"},{value:"AdAtS",label:"Advances in Atmospheric Sciences (AdAtS)"},{value:"AdSpR",label:"Advances in Space Research (AdSpR)"},{value:"AdWR",label:"Advances in Water Resources (AdWR)"},{value:"AGAb",label:"Astronomische Gesellschaft Abstract Series (AGAb)"},{value:"AGUFM",label:"AGU Fall Meeting Abstracts (AGUFM)"},{value:"AGUSM",label:"AGU Spring Meeting Abstracts (AGUSM)"},{value:"AIAAJ",label:"AIAA Journal (AIAAJ)"},{value:"AIPC",label:"American Institute of Physics Conference Series (AIPC)"},{value:"AJ",label:"The Astronomical Journal (AJ)"},{value:"AmJPh",label:"American Journal of Physics (AmJPh)"},{value:"AMM",label:"Applied Mechanics and Materials (AMM)"},{value:"AN",label:"Astronomische Nachrichten (AN)"},{value:"Ana",label:"The Analyst (Ana)"},{value:"AnGeo",label:"Annales Geophysicae (AnGeo)"},{value:"AnGla",label:"Annals of Glaciology (AnGla)"},{value:"AnP",label:"Annalen der Physik (AnP)"},{value:"AnPhy",label:"Annals of Physics (AnPhy)"},{value:"Ap&SS",label:"Astrophysics and Space Science (Ap&SS)"},{value:"Ap",label:"Astrophysics (Ap)"},{value:"APExp",label:"Applied Physics Express (APExp)"},{value:"APh",label:"Astroparticle Physics (APh)"},{value:"APhy",label:"Acoustical Physics (APhy)"},{value:"ApJ",label:"The Astrophysical Journal (ApJ)"},{value:"ApJS",label:"The Astrophysical Journal Supplement Series (ApJS)"},{value:"ApOpt",label:"Applied Optics (ApOpt)"},{value:"ApPhA",label:"Applied Physics A: Materials Science & Processing (ApPhA)"},{value:"ApPhB",label:"Applied Physics B: Lasers and Optics (ApPhB)"},{value:"ApPhL",label:"Applied Physics Letters (ApPhL)"},{value:"APS",label:"APS Meeting Abstracts (APS)"},{value:"ApSpe",label:"Applied Spectroscopy (ApSpe)"},{value:"ApSS",label:"Applied Surface Science (ApSS)"},{value:"AReg",label:"Astronomical register (AReg)"},{value:"ARep",label:"Astronomy Reports (ARep)"},{value:"ArRMA",label:"Archive for Rational Mechanics and Analysis (ArRMA)"},{value:"ASAJ",label:"Acoustical Society of America Journal (ASAJ)"},{value:"ASIC",label:"NATO Advanced Science Institutes (ASI) Series C (ASIC)"},{value:"ASPC",label:"Astronomical Society of the Pacific Conference Series (ASPC)"},{value:"ASSL",label:"Astrophysics and Space Science Library (ASSL)"},{value:"AstL",label:"Astronomy Letters (AstL)"},{value:"Astr",label:"The Astronomer (Astr)"},{value:"ATel",label:"The Astronomer's Telegram (ATel)"},{value:"AtmEn",label:"Atmospheric Environment (AtmEn)"},{value:"AtmRe",label:"Atmospheric Research (AtmRe)"},{value:"ATsir",label:"Astronomicheskij Tsirkulyar (ATsir)"},{value:"AuJES",label:"Australian Journal of Earth Sciences (AuJES)"},{value:"AuJPh",label:"Australian Journal of Physics (AuJPh)"},{value:"AZh",label:"Astronomicheskii Zhurnal (AZh)"},{value:"BAAA",label:"Boletin de la Asociacion Argentina de Astronomia La Plata Argentina (BAAA)"},{value:"BAAS",label:"Bulletin of the American Astronomical Society (BAAS)"},{value:"BAICz",label:"Bulletin of the Astronomical Institutes of Czechoslovakia (BAICz)"},{value:"BAMS",label:"Bulletin of the American Meteorological Society (BAMS)"},{value:"BASI",label:"Bulletin of the Astronomical Society of India (BASI)"},{value:"BGD",label:"Biogeosciences Discussions (BGD)"},{value:"BGeo",label:"Biogeosciences (BGeo)"},{value:"BJAP",label:"British Journal of Applied Physics (BJAP)"},{value:"BoLMe",label:"Boundary-Layer Meteorology (BoLMe)"},{value:"BpJ",label:"Biophysical Journal (BpJ)"},{value:"BRASP",label:"Bulletin of the Russian Academy of Science, Phys. (BRASP)"},{value:"BrJPh",label:"Brazilian Journal of Physics (BrJPh)"},{value:"BuAsI",label:"Bulletin Astronomique, Serie I (BuAsI)"},{value:"BuSSA",label:"The Bulletin of the Seismological Society of America (BuSSA)"},{value:"BVol",label:"Bulletin of Volcanology (BVol)"},{value:"C&T",label:"Ciel et Terre (C&T)"},{value:"CaJES",label:"Canadian Journal of Earth Sciences (CaJES)"},{value:"CaJPh",label:"Canadian Journal of Physics (CaJPh)"},{value:"CAP",label:"Current Applied Physics (CAP)"},{value:"CBET",label:"Central Bureau Electronic Telegrams (CBET)"},{value:"CCM",label:"Clays and Clay Minerals (CCM)"},{value:"CeMDA",label:"Celestial Mechanics and Dynamical Astronomy (CeMDA)"},{value:"CeMec",label:"Celestial Mechanics (CeMec)"},{value:"CG",label:"Computers and Geosciences (CG)"},{value:"Chaos",label:"Chaos (Chaos)"},{value:"ChPhB",label:"Chinese Physics B (ChPhB)"},{value:"ChPhL",label:"Chinese Physics Letters (ChPhL)"},{value:"ChPhy",label:"Chinese Physics (ChPhy)"},{value:"CIBu",label:"COSPAR Information Bulletin (CIBu)"},{value:"ClDy",label:"Climate Dynamics (ClDy)"},{value:"CMAME",label:"Computer Methods in Applied Mechanics and Engineering (CMAME)"},{value:"CMaPh",label:"Communications in Mathematical Physics (CMaPh)"},{value:"CNSNS",label:"Communications in Nonlinear Science and Numerical Simulations (CNSNS)"},{value:"CoMP",label:"Contributions to Mineralogy and Petrology (CoMP)"},{value:"CompM",label:"Computational Mechanics (CompM)"},{value:"ConPh",label:"Contemporary Physics (ConPh)"},{value:"CoPhC",label:"Computer Physics Communications (CoPhC)"},{value:"CosRe",label:"Cosmic Research (CosRe)"},{value:"CoTPh",label:"Communications in Theoretical Physics (CoTPh)"},{value:"CP",label:"Chemical Physics (CP)"},{value:"CPL",label:"Chemical Physics Letters (CPL)"},{value:"CQGra",label:"Classical and Quantum Gravity (CQGra)"},{value:"CRASM",label:"Academie des Sciences Paris Comptes Rendus Serie Sciences Mathematiques (CRASM)"},{value:"Cryo",label:"Cryogenics (Cryo)"},{value:"CryRp",label:"Crystallography Reports (CryRp)"},{value:"CSF",label:"Chaos Solitons and Fractals (CSF)"},{value:"CSR",label:"Continental Shelf Research (CSR)"},{value:"CzJPh",label:"Czechoslovak Journal of Physics (CzJPh)"},{value:"CzJPS",label:"Czechoslovak Journal of Physics Supplement (CzJPS)"},{value:"DokES",label:"Doklady Earth Sciences (DokES)"},{value:"DokPh",label:"Physics - Doklady (DokPh)"},{value:"DoSSR",label:"Akademiia Nauk SSSR Doklady (DoSSR)"},{value:"DPS",label:"AAS/Division for Planetary Sciences Meeting Abstracts (DPS)"},{value:"DRM",label:"Diamond and Related Materials (DRM)"},{value:"DSRA",label:"Deep Sea Research A (DSRA)"},{value:"DSRI",label:"Deep Sea Research Part I: Oceanographic Research (DSRI)"},{value:"DSRII",label:"Deep Sea Research Part II: Topical Studies in Oceanography (DSRII)"},{value:"DSROA",label:"Deep Sea Research and Oceanographic Abstracts (DSROA)"},{value:"E&ES",label:"IOP Conference Series: Earth and Environmental Science (E&ES)"},{value:"E&PSL",label:"Earth and Planetary Science Letters (E&PSL)"},{value:"EAEJA",label:"EGS - AGU - EUG Joint Assembly (EAEJA)"},{value:"EAS",label:"EAS Publications Series (EAS)"},{value:"ECSS",label:"Estuarine Coastal and Shelf Science (ECSS)"},{value:"EGSGA",label:"EGS General Assembly Conference Abstracts (EGSGA)"},{value:"EGUGA",label:"EGU General Assembly Conference Abstracts (EGUGA)"},{value:"EJPh",label:"European Journal of Physics (EJPh)"},{value:"EL",label:"EPL (Europhysics Letters) (EL)"},{value:"ElL",label:"Electronics Letters (ElL)"},{value:"EM&P",label:"Earth Moon and Planets (EM&P)"},{value:"EnMan",label:"Environmental Management (EnMan)"},{value:"EnST",label:"Environmental Science Technology (EnST)"},{value:"EOSTr",label:"EOS Transactions (EOSTr)"},{value:"EP&S",label:"Earth, Planets, and Space (EP&S)"},{value:"EPJA",label:"European Physical Journal A (EPJA)"},{value:"EPJAP",label:"European Physical Journal Applied Physics (EPJAP)"},{value:"EPJB",label:"European Physical Journal B (EPJB)"},{value:"EPJC",label:"European Physical Journal C (EPJC)"},{value:"EPJD",label:"European Physical Journal D (EPJD)"},{value:"EPJST",label:"European Physical Journal Special Topics (EPJST)"},{value:"EPJWC",label:"European Physical Journal Web of Conferences (EPJWC)"},{value:"ER",label:"Environmental Research (ER)"},{value:"ESASP",label:"ESA Special Publication (ESASP)"},{value:"ESOC",label:"European Southern Observatory Conference and Workshop Proceedings (ESOC)"},{value:"ESPL",label:"Earth Surface Processes and Landforms (ESPL)"},{value:"ESRv",label:"Earth Science Reviews (ESRv)"},{value:"ExFl",label:"Experiments in Fluids (ExFl)"},{value:"FaDi",label:"Faraday Discussions (FaDi)"},{value:"FBS",label:"Few-Body Systems (FBS)"},{value:"FlDy",label:"Fluid Dynamics (FlDy)"},{value:"FoPh",label:"Foundations of Physics (FoPh)"},{value:"ForPh",label:"Fortschritte der Physik (ForPh)"},{value:"Freq",label:"Frequenz (Freq)"},{value:"GCN",label:"GRB Coordinates Network (GCN)"},{value:"Ge&Ae",label:"Geomagnetism and Aeronomy (Ge&Ae)"},{value:"GeCAS",label:"Geochimica et Cosmochimica Acta Supplement (GeCAS)"},{value:"GeCoA",label:"Geochimica et Cosmochimica Acta (GeCoA)"},{value:"Geo",label:"Geology (Geo)"},{value:"GeoJ",label:"Geophysical Journal (GeoJ)"},{value:"GeoJI",label:"Geophysical Journal International (GeoJI)"},{value:"Geomo",label:"Geomorphology (Geomo)"},{value:"Geop",label:"Geophysics (Geop)"},{value:"GeopP",label:"Geophysical Prospecting (GeopP)"},{value:"GeoRL",label:"Geophysical Research Letters (GeoRL)"},{value:"GeoRu",label:"Geologische Rundschau (GeoRu)"},{value:"GGG",label:"Geochemistry, Geophysics, Geosystems (GGG)"},{value:"GMS",label:"Washington DC American Geophysical Union Geophysical Monograph Series (GMS)"},{value:"GPC",label:"Global and Planetary Change (GPC)"},{value:"GReGr",label:"General Relativity and Gravitation (GReGr)"},{value:"GSAB",label:"Geological Society of America Bulletin (GSAB)"},{value:"GSLSP",label:"Geological Society of London Special Publications (GSLSP)"},{value:"HEAD",label:"AAS/High Energy Astrophysics Division (HEAD)"},{value:"HESS",label:"Hydrology and Earth System Sciences (HESS)"},{value:"HESSD",label:"Hydrology and Earth System Sciences Discussions (HESSD)"},{value:"HiA",label:"Highlights of Astronomy (HiA)"},{value:"HMT",label:"Heat and Mass Transfer (HMT)"},{value:"HyInt",label:"Hyperfine Interactions (HyInt)"},{value:"HyPr",label:"Hydrological Processes (HyPr)"},{value:"IAM",label:"International Applied Mechanics (IAM)"},{value:"IAPM",label:"IEEE Antennas Propagation Magazine (IAPM)"},{value:"IAUC",label:"International Astronomical Union Circular (IAUC)"},{value:"IAUJD",label:"IAU Joint Discussion (IAUJD)"},{value:"IAUS",label:"IAU Symposium (IAUS)"},{value:"IAWPL",label:"IEEE Antennas and Wireless Propagation Letters (IAWPL)"},{value:"IBVS",label:"Information Bulletin on Variable Stars (IBVS)"},{value:"Icar",label:"Icarus (Icar)"},{value:"ICRC",label:"International Cosmic Ray Conference (ICRC)"},{value:"IEDL",label:"IEEE Electron Device Letters (IEDL)"},{value:"IEITC",label:"IEICE Transactions on Communications (IEITC)"},{value:"IEITE",label:"IEICE Transactions on Electronics (IEITE)"},{value:"IEITF",label:"IEICE Transactions on Fundamentals of Electronics Communications and Computer Sciences (IEITF)"},{value:"IEITI",label:"IEICE Transactions on Information and Systems (IEITI)"},{value:"IGRSL",label:"IEEE Geoscience and Remote Sensing Letters (IGRSL)"},{value:"IJBC",label:"International Journal of Bifurcation and Chaos (IJBC)"},{value:"IJBm",label:"International Journal of Biometeorology (IJBm)"},{value:"IJCA",label:"International Journal of Computer Applications (IJCA)"},{value:"IJCli",label:"International Journal of Climatology (IJCli)"},{value:"IJIMW",label:"International Journal of Infrared and Millimeter Waves (IJIMW)"},{value:"IJMPA",label:"International Journal of Modern Physics A (IJMPA)"},{value:"IJMPB",label:"International Journal of Modern Physics B (IJMPB)"},{value:"IJMPC",label:"International Journal of Modern Physics C (IJMPC)"},{value:"IJMPD",label:"International Journal of Modern Physics D (IJMPD)"},{value:"IJMPE",label:"International Journal of Modern Physics E (IJMPE)"},{value:"IJMSI",label:"International Journal of Mass Spectrometry and Ion Processes (IJMSI)"},{value:"IJMSp",label:"International Journal of Mass Spectrometry (IJMSp)"},{value:"IJNLM",label:"International Journal of Non Linear Mechanics (IJNLM)"},{value:"IJNME",label:"International Journal for Numerical Methods in Engineering (IJNME)"},{value:"IJNMF",label:"International Journal for Numerical Methods in Fluids (IJNMF)"},{value:"IJQE",label:"IEEE Journal of Quantum Electronics (IJQE)"},{value:"IJRS",label:"International Journal of Remote Sensing (IJRS)"},{value:"IJSEd",label:"International Journal of Science Education (IJSEd)"},{value:"IJT",label:"International Journal of Thermophysics (IJT)"},{value:"IJTP",label:"International Journal of Theoretical Physics (IJTP)"},{value:"InfPh",label:"Infrared Physics (InfPh)"},{value:"InMat",label:"Inventiones Mathematicae (InMat)"},{value:"InvPr",label:"Inverse Problems (InvPr)"},{value:"IPTL",label:"IEEE Photonics Technology Letters (IPTL)"},{value:"IREdu",label:"International Review of Education (IREdu)"},{value:"ISPL",label:"IEEE Signal Processing Letters (ISPL)"},{value:"ITAES",label:"IEEE Transactions on Aerospace Electronic Systems (ITAES)"},{value:"ITAP",label:"IEEE Transactions on Antennas and Propagation (ITAP)"},{value:"ITAS",label:"IEEE Transactions on Applied Superconductivity (ITAS)"},{value:"ITED",label:"IEEE Transactions on Electron Devices (ITED)"},{value:"ITEdu",label:"IEEE Transactions on Education (ITEdu)"},{value:"ITEIS",label:"IEEJ Transactions on Electronics, Information and Systems (ITEIS)"},{value:"ITGRS",label:"IEEE Transactions on Geoscience and Remote Sensing (ITGRS)"},{value:"ITIP",label:"IEEE Transactions on Image Processing (ITIP)"},{value:"ITM",label:"IEEE Transactions on Magnetics (ITM)"},{value:"ITMTT",label:"IEEE Transactions on Microwave Theory Techniques (ITMTT)"},{value:"ITNS",label:"IEEE Transactions on Nuclear Science (ITNS)"},{value:"ITPS",label:"IEEE Transactions on Plasma Science (ITPS)"},{value:"ITSP",label:"IEEE Transactions on Signal Processing (ITSP)"},{value:"IzMat",label:"Izvestiya: Mathematics (IzMat)"},{value:"JAESc",label:"Journal of Asian Earth Sciences (JAESc)"},{value:"JAfES",label:"Journal of African Earth Sciences (JAfES)"},{value:"JaJAP",label:"Japanese Journal of Applied Physics (JaJAP)"},{value:"JAM",label:"Journal of Applied Mechanics (JAM)"},{value:"JAMTP",label:"Journal of Applied Mechanics and Technical Physics (JAMTP)"},{value:"JAP",label:"Journal of Applied Physics (JAP)"},{value:"JApMe",label:"Journal of Applied Meteorology (JApMe)"},{value:"JApMM",label:"Journal of Applied Mathematics and Mechanics (JApMM)"},{value:"JApSc",label:"Journal of Applied Sciences (JApSc)"},{value:"JApSp",label:"Journal of Applied Spectroscopy (JApSp)"},{value:"JASTP",label:"Journal of Atmospheric and Solar-Terrestrial Physics (JASTP)"},{value:"JAtOT",label:"Journal of Atmospheric and Oceanic Technology (JAtOT)"},{value:"JATP",label:"Journal of Atmospheric and Terrestrial Physics (JATP)"},{value:"JAtS",label:"Journal of Atmospheric Sciences (JAtS)"},{value:"JBAA",label:"Journal of the British Astronomical Association (JBAA)"},{value:"JBIS",label:"Journal of the British Interplanetary Society (JBIS)"},{value:"JBO",label:"Journal of Biomedical Optics (JBO)"},{value:"JCAP",label:"Journal of Cosmology and Astro-Particle Physics (JCAP)"},{value:"JChEd",label:"Journal of Chemical Education (JChEd)"},{value:"JChPh",label:"Journal of Chemical Physics (JChPh)"},{value:"JCHyd",label:"Journal of Contaminant Hydrology (JCHyd)"},{value:"JCli",label:"Journal of Climate (JCli)"},{value:"JCoAM",label:"Journal of Computational and Applied Mathematics (JCoAM)"},{value:"JCoMa",label:"Journal of Composite Materials (JCoMa)"},{value:"JCoPh",label:"Journal of Computational Physics (JCoPh)"},{value:"JCrGr",label:"Journal of Crystal Growth (JCrGr)"},{value:"JDE",label:"Journal of Differential Equations (JDE)"},{value:"JEMat",label:"Journal of Electronic Materials (JEMat)"},{value:"JEP",label:"Journal of Engineering Physics (JEP)"},{value:"JEPT",label:"Journal of Engineering Physics and Thermophysics (JEPT)"},{value:"JETP",label:"Soviet Journal of Experimental and Theoretical Physics (JETP)"},{value:"JETPL",label:"Soviet Journal of Experimental and Theoretical Physics Letters (JETPL)"},{value:"JFM",label:"Journal of Fluid Mechanics (JFM)"},{value:"JFS",label:"Journal of Fluids and Structures (JFS)"},{value:"JG",label:"Journal of Geology (JG)"},{value:"JGCD",label:"Journal of Guidance Control Dynamics (JGCD)"},{value:"JGlac",label:"Journal of Glaciology (JGlac)"},{value:"JGP",label:"Journal of Geometry and Physics (JGP)"},{value:"JGR",label:"Journal of Geophysical Research (JGR)"},{value:"JGRA",label:"Journal of Geophysical Research (Space Physics) (JGRA)"},{value:"JGRB",label:"Journal of Geophysical Research (Solid Earth) (JGRB)"},{value:"JGRC",label:"Journal of Geophysical Research (Oceans) (JGRC)"},{value:"JGRD",label:"Journal of Geophysical Research (Atmospheres) (JGRD)"},{value:"JGRE",label:"Journal of Geophysical Research (Planets) (JGRE)"},{value:"JHA",label:"Journal for the History of Astronomy (JHA)"},{value:"JHEP",label:"Journal of High Energy Physics (JHEP)"},{value:"JHyd",label:"Journal of Hydrology (JHyd)"},{value:"JIEEJ",label:"Journal of The Institute of Electrical Engineers of Japan (JIEEJ)"},{value:"JInst",label:"Journal of Instrumentation (JInst)"},{value:"JIPM",label:"Journal of Information Processing and Management (JIPM)"},{value:"JJAPS",label:"Japanese Journal of Applied Physics Supplement (JJAPS)"},{value:"JKPS",label:"Journal of Korean Physical Society (JKPS)"},{value:"JLTP",label:"Journal of Low Temperature Physics (JLTP)"},{value:"JLum",label:"Journal of Luminescence (JLum)"},{value:"JLwT",label:"Journal of Lightwave Technology (JLwT)"},{value:"JMAA",label:"Journal of Mathematical Analysis and Applications (JMAA)"},{value:"JMagR",label:"Journal of Magnetic Resonance (JMagR)"},{value:"JMatR",label:"Journal of Materials Research (JMatR)"},{value:"JMatS",label:"Journal of Materials Science (JMatS)"},{value:"JMEP",label:"Journal of Materials Engineering and Performance (JMEP)"},{value:"JMiMi",label:"Journal of Micromechanics and Microengineering (JMiMi)"},{value:"JMMM",label:"Journal of Magnetism and Magnetic Materials (JMMM)"},{value:"JMOp",label:"Journal of Modern Optics (JMOp)"},{value:"JMoSp",label:"Journal of Molecular Spectroscopy (JMoSp)"},{value:"JMoSt",label:"Journal of Molecular Structure (JMoSt)"},{value:"JMP",label:"Journal of Mathematical Physics (JMP)"},{value:"JMPSo",label:"Journal of Mechanics Physics of Solids (JMPSo)"},{value:"JMS",label:"Journal of Marine Systems (JMS)"},{value:"JNCS",label:"Journal of Non Crystalline Solids (JNCS)"},{value:"JNuM",label:"Journal of Nuclear Materials (JNuM)"},{value:"JOM",label:"JOM - Journal of the Minerals, Metals and Materials Society (JOM)"},{value:"JOpt",label:"Journal of Optics (JOpt)"},{value:"JOptT",label:"Journal of Optical Technology (JOptT)"},{value:"JOSA",label:"Journal of the Optical Society of America (1917-1983) (JOSA)"},{value:"JOSAA",label:"Journal of the Optical Society of America A (JOSAA)"},{value:"JOSAB",label:"Journal of the Optical Society of America B Optical Physics (JOSAB)"},{value:"JPCA",label:"Journal of Physical Chemistry A (JPCA)"},{value:"JPCM",label:"Journal of Physics Condensed Matter (JPCM)"},{value:"JPCS",label:"Journal of Physics and Chemistry of Solids (JPCS)"},{value:"JPhA",label:"Journal of Physics A Mathematical General (JPhA)"},{value:"JPhB",label:"Journal of Physics B Atomic Molecular Physics (JPhB)"},{value:"JPhC",label:"Journal of Physics C Solid State Physics (JPhC)"},{value:"JPhCS",label:"Journal of Physics Conference Series (JPhCS)"},{value:"JPhD",label:"Journal of Physics D Applied Physics (JPhD)"},{value:"JPhE",label:"Journal of Physics E Scientific Instruments (JPhE)"},{value:"JPhF",label:"Journal of Physics F Metal Physics (JPhF)"},{value:"JPhG",label:"Journal of Physics G Nuclear Physics (JPhG)"},{value:"JPhy4",label:"Journal de Physique IV (JPhy4)"},{value:"JPlPh",label:"Journal of Plasma Physics (JPlPh)"},{value:"JPO",label:"Journal of Physical Oceanography (JPO)"},{value:"JPoSA",label:"Journal of Polymer Science A Polymer Chemistry (JPoSA)"},{value:"JPoSB",label:"Journal of Polymer Science B Polymer Physics (JPoSB)"},{value:"JPoSc",label:"Journal of Polymer Science (JPoSc)"},{value:"JPoSL",label:"Journal of Polymer Science: Polymer Letters Edition (JPoSL)"},{value:"JPS",label:"Journal of Power Sources (JPS)"},{value:"JPSJ",label:"Journal of the Physical Society of Japan (JPSJ)"},{value:"JQSRT",label:"Journal of Quantitative Spectroscopy and Radiative Transfer (JQSRT)"},{value:"JRASC",label:"Journal of the Royal Astronomical Society of Canada (JRASC)"},{value:"JRheo",label:"Journal of Rheology (JRheo)"},{value:"JRPC",label:"Journal of Reinforced Plastics and Composites (JRPC)"},{value:"JRScT",label:"Journal of Research in Science Teaching (JRScT)"},{value:"JRSp",label:"Journal of Raman Spectroscopy (JRSp)"},{value:"JScI",label:"Journal of Scientific Instruments (JScI)"},{value:"JSedR",label:"Journal of Sedimentary Research (JSedR)"},{value:"JSG",label:"Journal of Structural Geology (JSG)"},{value:"JSMTE",label:"Journal of Statistical Mechanics: Theory and Experiment (JSMTE)"},{value:"JSP",label:"Journal of Statistical Physics (JSP)"},{value:"JSpRo",label:"Journal of Spacecraft and Rockets (JSpRo)"},{value:"JSSCh",label:"Journal of Solid State Chemistry France (JSSCh)"},{value:"JSV",label:"Journal of Sound Vibration (JSV)"},{value:"JTePh",label:"Journal of Technical Physics (JTePh)"},{value:"JVGR",label:"Journal of Volcanology and Geothermal Research (JVGR)"},{value:"JVSJ",label:"Journal of the Vacuum Society of Japan (JVSJ)"},{value:"JVST",label:"Journal of Vacuum Science Technology (JVST)"},{value:"JVSTB",label:"Journal of Vacuum Science Technology B: Microelectronics and Nanometer Structures (JVSTB)"},{value:"KNAB",label:"Koninklijke Nederlandse Akademie van Wetenschappen Proceedings Series B Physical Sciences (KNAB)"},{value:"KosIs",label:"Kosmicheskie Issledovaniia (KosIs)"},{value:"KvanE",label:"Kvantovaia Elektronika Moscow (KvanE)"},{value:"LanB",label:"Landolt B&ouml;rnstein (LanB)"},{value:"LaPhy",label:"Laser Physics (LaPhy)"},{value:"LAstr",label:"L'Astronomie (LAstr)"},{value:"Litho",label:"Lithos (Litho)"},{value:"LMaPh",label:"Letters in Mathematical Physics (LMaPh)"},{value:"LNCS",label:"Lecture Notes in Computer Science (LNCS)"},{value:"LNP",label:"Lecture Notes in Physics, Berlin Springer Verlag (LNP)"},{value:"LPI",label:"Lunar and Planetary Institute Science Conference Abstracts (LPI)"},{value:"LPICo",label:"LPI Contributions (LPICo)"},{value:"LPSC",label:"Lunar and Planetary Science Conference Proceedings (LPSC)"},{value:"LTP",label:"Low Temperature Physics (LTP)"},{value:"M&PS",label:"Meteoritics and Planetary Science (M&PS)"},{value:"M&PSA",label:"Meteoritics and Planetary Science Supplement (M&PSA)"},{value:"MaMol",label:"Macromolecules (MaMol)"},{value:"MedPh",label:"Medical Physics (MedPh)"},{value:"MeScT",label:"Measurement Science and Technology (MeScT)"},{value:"Metic",label:"Meteoritics (Metic)"},{value:"Metro",label:"Metrologia (Metro)"},{value:"MiMic",label:"Microscopy and Microanalysis (MiMic)"},{value:"MinDe",label:"Mineralium Deposita (MinDe)"},{value:"MitAG",label:"Mitteilungen der Astronomischen Gesellschaft Hamburg (MitAG)"},{value:"MMAS",label:"Mathematical Methods in the Applied Sciences (MMAS)"},{value:"MmSAI",label:"Memorie della Societa Astronomica Italiana (MmSAI)"},{value:"MMTA",label:"Metallurgical and Materials Transactions A (MMTA)"},{value:"MNRAS",label:"Monthly Notices of the Royal Astronomical Society (MNRAS)"},{value:"MNSSA",label:"Monthly Notes of the Astronomical Society of South Africa (MNSSA)"},{value:"MolPh",label:"Molecular Physics (MolPh)"},{value:"MPC",label:"Minor Planet Circulars (MPC)"},{value:"MPCPS",label:"Mathematical Proceedings of the Cambridge Philosophical Society (MPCPS)"},{value:"MPEC",label:"Minor Planet Electronic Circulars (MPEC)"},{value:"MPLA",label:"Modern Physics Letters A (MPLA)"},{value:"MPLB",label:"Modern Physics Letters B (MPLB)"},{value:"MS&E",label:"Materials Science and Engineering Conference Series (MS&E)"},{value:"Msngr",label:"The Messenger (Msngr)"},{value:"MSSP",label:"Mechanical Systems and Signal Processing (MSSP)"},{value:"MsT",label:"Masters Thesis (MsT)"},{value:"MTA",label:"Metallurgical Transactions A (MTA)"},{value:"MWRv",label:"Monthly Weather Review (MWRv)"},{value:"NanoL",label:"Nano Letters (NanoL)"},{value:"Nanos",label:"Nanoscale (Nanos)"},{value:"Nanot",label:"Nanotechnology (Nanot)"},{value:"NaPho",label:"Nature Photonics (NaPho)"},{value:"NASCP",label:"NASA Conference Publication (NASCP)"},{value:"NASSP",label:"NASA Special Publication (NASSP)"},{value:"NatCo",label:"Nature Communications (NatCo)"},{value:"NatMa",label:"Nature Materials (NatMa)"},{value:"NatPh",label:"Nature Physics (NatPh)"},{value:"NatSR",label:"Scientific Reports (NatSR)"},{value:"Natur",label:"Nature (Natur)"},{value:"NCimA",label:"Nuovo Cimento A Serie (NCimA)"},{value:"NCimB",label:"Nuovo Cimento B Serie (NCimB)"},{value:"NCimD",label:"Nuovo Cimento D Serie (NCimD)"},{value:"NewA",label:"New Astronomy (NewA)"},{value:"NewSc",label:"New Scientist (NewSc)"},{value:"NHTA",label:"Numerical Heat Transfer Part A - Applications (NHTA)"},{value:"NIMPA",label:"Nuclear Instruments and Methods in Physics Research A (NIMPA)"},{value:"NIMPB",label:"Nuclear Instruments and Methods in Physics Research B (NIMPB)"},{value:"NIMPR",label:"Nuclear Instruments and Methods in Physics Research (NIMPR)"},{value:"NJPh",label:"New Journal of Physics (NJPh)"},{value:"Nonli",label:"Nonlinearity (Nonli)"},{value:"NRL",label:"Nanoscale Research Letters (NRL)"},{value:"NucFu",label:"Nuclear Fusion (NucFu)"},{value:"NucIM",label:"Nuclear Instruments and Methods (NucIM)"},{value:"NucPh",label:"Nuclear Physics (NucPh)"},{value:"NuPhA",label:"Nuclear Physics A (NuPhA)"},{value:"NuPhB",label:"Nuclear Physics B (NuPhB)"},{value:"NuPhS",label:"Nuclear Physics B Proceedings Supplements (NuPhS)"},{value:"NuPhS..51",label:"Nuclear Physics B Proceedings Supplements, Vol. 51 (NuPhS..51)"},{value:"NW",label:"Naturwissenschaften (NW)"},{value:"NYASA",label:"Annals of the New York Academy of Sciences (NYASA)"},{value:"Obs",label:"The Observatory (Obs)"},{value:"OExpr",label:"Optics Express (OExpr)"},{value:"OptCo",label:"Optics Communications (OptCo)"},{value:"OptEn",label:"Optical Engineering (OptEn)"},{value:"Optik",label:"Optik (Optik)"},{value:"OptL",label:"Optics Letters (OptL)"},{value:"OptLE",label:"Optics and Lasers in Engineering (OptLE)"},{value:"OptLT",label:"Optics Laser Technology (OptLT)"},{value:"OptMa",label:"Optical Materials (OptMa)"},{value:"OptPN",label:"Optics & Photonics News (OptPN)"},{value:"OptSp",label:"Optics and Spectroscopy (OptSp)"},{value:"P&SS",label:"Planetary and Space Science (P&SS)"},{value:"PA",label:"Popular Astronomy (PA)"},{value:"PAAS",label:"Publications of the American Astronomical Society (PAAS)"},{value:"PAN",label:"Physics of Atomic Nuclei (PAN)"},{value:"PApGe",label:"Pure and Applied Geophysics (PApGe)"},{value:"PASJ",label:"Publications of the Astronomical Society of Japan (PASJ)"},{value:"PASP",label:"Publications of the Astronomical Society of the Pacific (PASP)"},{value:"PCCP",label:"Physical Chemistry Chemical Physics (Incorporating Faraday Transactions) (PCCP)"},{value:"PCE",label:"Physics and Chemistry of the Earth (PCE)"},{value:"PCM",label:"Physics and Chemistry of Minerals (PCM)"},{value:"PCPS",label:"Proceedings of the Cambridge Philosophical Society (PCPS)"},{value:"PDSS",label:"NASA Planetary Data System (PDSS)"},{value:"PEPI",label:"Physics of the Earth and Planetary Interiors (PEPI)"},{value:"PhDT",label:"Ph.D. Thesis (PhDT)"},{value:"PhFl",label:"Physics of Fluids (PhFl)"},{value:"PhL",label:"Physics Letters (PhL)"},{value:"PhLA",label:"Physics Letters A (PhLA)"},{value:"PhLB",label:"Physics Letters B (PhLB)"},{value:"PhPl",label:"Physics of Plasmas (PhPl)"},{value:"PhPro",label:"Physics Procedia (PhPro)"},{value:"PhR",label:"Physics Reports (PhR)"},{value:"PhRv",label:"Physical Review (PhRv)"},{value:"PhRvA",label:"Physical Review A (PhRvA)"},{value:"PhRvB",label:"Physical Review B (PhRvB)"},{value:"PhRvC",label:"Physical Review C (PhRvC)"},{value:"PhRvD",label:"Physical Review D (PhRvD)"},{value:"PhRvE",label:"Physical Review E (PhRvE)"},{value:"PhRvL",label:"Physical Review Letters (PhRvL)"},{value:"PhRvS",label:"Physical Review Special Topics Accelerators and Beams (PhRvS)"},{value:"PhSS",label:"Physics of the Solid State (PhSS)"},{value:"PhST",label:"Physica Scripta Volume T (PhST)"},{value:"PhT",label:"Physics Today (PhT)"},{value:"PhTea",label:"The Physics Teacher (PhTea)"},{value:"PhuZ",label:"Physik in unserer Zeit (PhuZ)"},{value:"Phy",label:"Physica (Phy)"},{value:"PhyA",label:"Physica A Statistical Mechanics and its Applications (PhyA)"},{value:"PhyB",label:"Physica B Condensed Matter (PhyB)"},{value:"PhyBC",label:"Physica B+C (PhyBC)"},{value:"PhyC",label:"Physica C Superconductivity (PhyC)"},{value:"PhyD",label:"Physica D Nonlinear Phenomena (PhyD)"},{value:"PhyE",label:"Physica E Low-Dimensional Systems and Nanostructures (PhyE)"},{value:"PhyEd",label:"Physics Education (PhyEd)"},{value:"PhyS",label:"Physica Scripta (PhyS)"},{value:"PhyU",label:"Physics Uspekhi (PhyU)"},{value:"PLoSO",label:"PLoS ONE (PLoSO)"},{value:"PlPhR",label:"Plasma Physics Reports (PlPhR)"},{value:"PLSCB",label:"PLoS Computational Biology (PLSCB)"},{value:"PMag",label:"Philosophical Magazine (PMag)"},{value:"PMagA",label:"Philosophical Magazine, Part A (PMagA)"},{value:"PMagB",label:"Philosophical Magazine, Part B (PMagB)"},{value:"PMagL",label:"Philosophical Magazine Letters (PMagL)"},{value:"PMB",label:"Physics in Medicine and Biology (PMB)"},{value:"PNAS",label:"Proceedings of the National Academy of Science (PNAS)"},{value:"PPCF",label:"Plasma Physics and Controlled Fusion (PPCF)"},{value:"PPS",label:"Proceedings of the Physical Society (PPS)"},{value:"Prama",label:"Pramana (Prama)"},{value:"PrOce",label:"Progress in Oceanography (PrOce)"},{value:"PrPNP",label:"Progress in Particle and Nuclear Physics (PrPNP)"},{value:"PSSAR",label:"Physica Status Solidi Applied Research (PSSAR)"},{value:"PSSBR",label:"Physica Status Solidi B Basic Research (PSSBR)"},{value:"PSSCR",label:"Physica Status Solidi C Current Topics (PSSCR)"},{value:"PSST",label:"Plasma Sources Science Technology (PSST)"},{value:"PThPh",label:"Progress of Theoretical Physics (PThPh)"},{value:"PThPS",label:"Progress of Theoretical Physics Supplement (PThPS)"},{value:"QJRAS",label:"Quarterly Journal of the Royal Astronomical Society (QJRAS)"},{value:"QJRMS",label:"Quarterly Journal of the Royal Meteorological Society (QJRMS)"},{value:"QSRv",label:"Quaternary Science Reviews (QSRv)"},{value:"QuEle",label:"Quantum Electronics (QuEle)"},{value:"QuInt",label:"Quaternary International (QuInt)"},{value:"QuRes",label:"Quaternary Research (QuRes)"},{value:"R&QE",label:"Radiophysics and Quantum Electronics (R&QE)"},{value:"RaEl",label:"Radiotekhnika i Elektronika (RaEl)"},{value:"RaF",label:"Radiofizika (RaF)"},{value:"RaPC",label:"Radiation Physics and Chemistry (RaPC)"},{value:"RaSc",label:"Radio Science (RaSc)"},{value:"REDS",label:"Radiation Effects and Defects in Solids (REDS)"},{value:"RMxAA",label:"Revista Mexicana de Astronomia y Astrofisica (RMxAA)"},{value:"RMxAA...3",label:"Revista Mexicana de Astronomia y Astrofisica, vol.  3 (RMxAA...3)"},{value:"RMxAA...6",label:"Revista Mexicana de Astronomia y Astrofisica, vol.  6 (RMxAA...6)"},{value:"RMxAA...7",label:"Revista Mexicana de Astronomia y Astrofisica, vol.  7 (RMxAA...7)"},{value:"RMxAA..10",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 10 (RMxAA..10)"},{value:"RMxAA..12",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 12 (RMxAA..12)"},{value:"RMxAA..14",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 14 (RMxAA..14)"},{value:"RMxAA..18",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 18 (RMxAA..18)"},{value:"RMxAA..19",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 19 (RMxAA..19)"},{value:"RMxAA..21",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 21 (RMxAA..21)"},{value:"RMxAA..23",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 23 (RMxAA..23)"},{value:"RMxAA..26",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 26 (RMxAA..26)"},{value:"RMxAA..29",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 29 (RMxAA..29)"},{value:"RMxAC",label:"Revista Mexicana de Astronomia y Astrofisica Conference Series (RMxAC)"},{value:"RMxAC..27",label:"Revista Mexicana de Astronomia y Astrofisica, vol. 27 (RMxAC..27)"},{value:"RpMP",label:"Reports on Mathematical Physics (RpMP)"},{value:"RPPh",label:"Reports on Progress in Physics (RPPh)"},{value:"RScI",label:"Review of Scientific Instruments (RScI)"},{value:"RSPS",label:"Royal Society of London Proceedings Series I (RSPS)"},{value:"RSPSA",label:"Royal Society of London Proceedings Series A (RSPSA)"},{value:"RSPSB",label:"Royal Society of London Proceedings Series B (RSPSB)"},{value:"RSPT",label:"Royal Society of London Philosophical Transactions Series I (RSPT)"},{value:"RSPTA",label:"Royal Society of London Philosophical Transactions Series A (RSPTA)"},{value:"RSPTB",label:"Royal Society of London Philosophical Transactions Series B (RSPTB)"},{value:"RuCRv",label:"Russian Chemical Reviews (RuCRv)"},{value:"RuMaS",label:"Russian Mathematical Surveys (RuMaS)"},{value:"RuPhJ",label:"Russian Physics Journal (RuPhJ)"},{value:"RvMP",label:"Reviews of Modern Physics (RvMP)"},{value:"S&T",label:"Sky and Telescope (S&T)"},{value:"S&W",label:"Sterne und Weltraum (S&W)"},{value:"SbMat",label:"Sbornik: Mathematics (SbMat)"},{value:"ScChA",label:"Science in China A: Mathematics (ScChA)"},{value:"Sci",label:"Science (Sci)"},{value:"SciAm",label:"Scientific American (SciAm)"},{value:"SciEd",label:"Science Education (SciEd)"},{value:"SciMo",label:"The Scientific Monthly (SciMo)"},{value:"SedG",label:"Sedimentary Geology (SedG)"},{value:"Sedim",label:"Sedimentology (Sedim)"},{value:"Semic",label:"Semiconductors (Semic)"},{value:"SeScT",label:"Semiconductor Science Technology (SeScT)"},{value:"SMaS",label:"Smart Material Structures (SMaS)"},{value:"SMat",label:"Soft Matter (SMat)"},{value:"SoEn",label:"Solar Energy (SoEn)"},{value:"SoPh",label:"Solar Physics (SoPh)"},{value:"SpecL",label:"Spectroscopy Letters (SpecL)"},{value:"SPhD",label:"Soviet Physics Doklady (SPhD)"},{value:"SPIE",label:"Society of Photo-Optical Instrumentation Engineers (SPIE) Conference Series (SPIE)"},{value:"SPTP",label:"Soviet Physics Technical Physics (SPTP)"},{value:"SRL",label:"Surface Review and Letters (SRL)"},{value:"SSCom",label:"Solid State Communications (SSCom)"},{value:"SSEle",label:"Solid State Electronics (SSEle)"},{value:"SSRv",label:"Space Science Reviews (SSRv)"},{value:"SSSci",label:"Solid State Sciences (SSSci)"},{value:"STIA",label:"NASA STI/Recon Technical Report A (STIA)"},{value:"STIN",label:"NASA STI/Recon Technical Report N (STIN)"},{value:"SuMi",label:"Superlattices and Microstructures (SuMi)"},{value:"SurSc",label:"Surface Science (SurSc)"},{value:"SurSL",label:"Surface Science Letters (SurSL)"},{value:"SuScT",label:"Superconductor Science Technology (SuScT)"},{value:"SvA",label:"Soviet Astronomy (SvA)"},{value:"SvAL",label:"Soviet Astronomy Letters (SvAL)"},{value:"SvApM",label:"Soviet Applied Mechanics (SvApM)"},{value:"SvPhJ",label:"Soviet Physics Journal (SvPhJ)"},{value:"SvPhU",label:"Soviet Physics Uspekhi (SvPhU)"},{value:"Tecto",label:"Tectonics (Tecto)"},{value:"Tectp",label:"Tectonophysics (Tectp)"},{value:"TeMAE",label:"Terrestrial Magnetism and Atmospheric Electricity (Journal of Geophysical Research) (TeMAE)"},{value:"TePhL",label:"Technical Physics Letters (TePhL)"},{value:"ThApC",label:"Theoretical and Applied Climatology (ThApC)"},{value:"TMP",label:"Theoretical and Mathematical Physics (TMP)"},{value:"TrAGU",label:"Transactions, American Geophysical Union (TrAGU)"},{value:"TSF",label:"Thin Solid Films (TSF)"},{value:"TSICE",label:"Transactions of the Society of Instrument and Control Engineers (TSICE)"},{value:"WRR",label:"Water Resources Research (WRR)"},{value:"WtFor",label:"Weather and Forecasting (WtFor)"},{value:"Wthr",label:"Weather (Wthr)"},{value:"ZaMM",label:"Zeitschrift Angewandte Mathematik und Mechanik (ZaMM)"},{value:"ZaMP",label:"Zeitschrift Angewandte Mathematik und Physik (ZaMP)"},{value:"ZhPmR",label:"ZhETF Pisma Redaktsiiu (ZhPmR)"},{value:"ZhTFi",label:"Zhurnal Tekhnicheskoi Fiziki (ZhTFi)"},{value:"ZK",label:"Zeitschrift fur Kristallographie (ZK)"},{value:"ZNatA",label:"Zeitschrift Naturforschung Teil A (ZNatA)"},{value:"ZPhy",label:"Zeitschrift fur Physik (ZPhy)"},{value:"ZPhyA",label:"Zeitschrift fur Physik A Hadrons and Nuclei (ZPhyA)"},{value:"ZPhyB",label:"Zeitschrift fur Physik B Condensed Matter (ZPhyB)"},{value:"ZPhyC",label:"Zeitschrift fur Physik C Particles and Fields (ZPhyC)"},{value:"ZPhyD",label:"Zeitschrift fur Physik D Atoms Molecules Clusters (ZPhyD)"}]}),define("js/widgets/classic_form/widget",["js/widgets/base/base_widget","js/components/api_query","js/components/api_query_updater","hbs!js/widgets/classic_form/form","jquery-ui","js/widgets/paper_search_form/topterms","analytics"],function(e,t,n,i,r,a,s){function o(e){return e.split(/,\s*/)}function l(e){return o(e).pop()}var c=Marionette.ItemView.extend({template:i,className:"classic-form",events:{"click button[type=submit]":"submitForm","input input":"checkValid","input textarea":"checkValid"},checkValid:function(){this.$("input[type=text], textarea").map(function(){return $(this).val()}).get().join("")?this.$("button[type=submit]").prop("disabled",!1):this.$("button[type=submit]").prop("disabled",!0)},submitForm:function(e){e.preventDefault();var t=this.serializeClassic();t.q.length||t.q.push("*"),this.trigger("submit",t),this.$("button[type=submit]").each(function(){$(this).html('<i class="icon-loading"/>  Loading...')})},serializeClassic:function(){var e,t,i,r,a={q:[],fq:[]},s={month_from:"01",year_from:"0000",month_to:"12",year_to:"9999"};return 2==(e=this.$("div[data-field=database] input:checked").map(function(){return $(this).attr("name")})).length?a.fq.push("database:(astronomy OR physics)"):1==e.length&&a.fq.push("database:"+e[0]),this.$("div[data-field=property] input:checked").each(function(){a.q.push("property:"+$(this).attr("name"))}),this.$("div[data-field=date] input").map(function(){return $(this).val()}).get().join("")&&(i="["+(t=this.$("div[data-field=date] input").map(function(){var e=$(this);return e.val()||s[e.attr("name")]}))[1]+"-"+t[0]+" TO "+t[3]+"-"+t[2]+"]",a.q.push("pubdate:"+i)),r={default:/=?"[^"]+"|[=\w]+/g,author:/.+/gm,object:/.+/gm,bibstem:/[^,^\s]+/g},this.$("div[data-textInput=true]").each(function(){var e,t,i,s,o=$(this),l=o.find("input[type=text], textarea").val();if(""!==l)if(e=o.find(".logic-group input:checked").val(),t=o.data("field"),"BOOLEAN"===e){var c=new n(" "),u=l.split(/(?:\n)/);l=(u=$.map(u,$.trim)).reduce(function(e,t){return t=/[+\-]/.test(t[0])?t[0]+c.quoteIfNecessary(t.slice(1))+" ":"+"+c.quoteIfNecessary(t)+" ",e+=t},""),a.q.push(t+":("+l.trim()+")")}else e=" "+e+" ",i=r[t]?r[t]:r.default,s=l.match(i),s=(s="author"==t||"object"==t?_.map(s,function(e){return'"'+e+'"'}):s).length>1?s.join(e):s[0],a.q.push(t+":("+s+")")}),a},onRender:function(e){this.$("input[name=bibstem]").on("keydown",function(e){e.keyCode===$.ui.keyCode.TAB&&$(this).autocomplete("instance").menu.active&&e.preventDefault()}).autocomplete({source:a,minLength:2,autoFocus:!0,source:function(e,t){t($.ui.autocomplete.filter(a,l(e.term)))},focus:function(){return!1},select:function(e,t){var n=o(this.value);return n.pop(),n.push(t.item.value),n.push(""),this.value=n.join(", "),!1}})}});return FormWidget=e.extend({initialize:function(e){e=e||{},this.view=new c,this.listenTo(this.view,"submit",this.submitForm)},activate:function(e){this.setBeeHive(e)},onShow:function(){this.view.$("button[type=submit]").each(function(){$(this).html('<i class="fa fa-search"></i> Search')}),this.view.$("#classic-author").focus()},submitForm:function(e){var n={q:e.q.join(" "),sort:"date desc"};e.fq.length&&(n.fq=e.fq.join(" ")),n=new t(n),this.getPubSub().publish(this.getPubSub().START_SEARCH,n),s("send","event","interaction","classic-form-submit",JSON.stringify(e))},dontKillMe:!0}),FormWidget}),define("hbs!js/widgets/search_bar/templates/search_bar_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r,a;return" "+(null!=(r=t.if.call(e,null!=e?e.libraryName:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?r:"")+'            <input type="text" class="form-control q hasbigquery" name="q" autofocus aria-label="Start typing a query here to begin an ADS Search" autocomplete="off" value='+this.escapeExpression("function"==typeof(a=null!=(a=t.currentQueryVal||(null!=e?e.currentQueryVal:e))?a:t.helperMissing)?a.call(e,{name:"currentQueryVal",hash:{},data:i}):a)+'>\n            <i class="icon-clear s-clear-control"></i> '},2:function(e,t,n,i){var r;return'\n            <div class="btn btn-xs btn-info bigquery-tag"><i class="fa fa-book" />&nbsp;<span>'+this.escapeExpression("function"==typeof(r=null!=(r=t.libraryName||(null!=e?e.libraryName:e))?r:t.helperMissing)?r.call(e,{name:"libraryName",hash:{},data:i}):r)+'</span>&nbsp;<i class="fa fa-close fa-lg bigquery-close" title="click to remove" /></div>\n'},4:function(e,t,n,i){return'            <div class="btn btn-xs btn-info bigquery-tag"><i class="fa fa-list-ul" />&nbsp;&nbsp;Bulk query&nbsp;&nbsp;<i class="fa fa-close fa-lg bigquery-close" title="click to remove" /></div>\n'},6:function(e,t,n,i){var r;return'\n            <input type="text" class="form-control q" name="q" autofocus aria-label="Start typing a query here to begin an ADS Search" autocomplete="off" value='+this.escapeExpression("function"==typeof(r=null!=(r=t.currentQueryVal||(null!=e?e.currentQueryVal:e))?r:t.helperMissing)?r.call(e,{name:"currentQueryVal",hash:{},data:i}):r)+'>\n            <i class="icon-clear s-clear-control"></i> '},8:function(e,t,n,i){var r;return'\n    <span class="search-bar__citation-count"> with <b><span class="citation-count-container">'+this.escapeExpression("function"==typeof(r=null!=(r=t.citationCount||(null!=e?e.citationCount:e))?r:t.helperMissing)?r.call(e,{name:"citationCount",hash:{},data:i}):r)+'</span></b>\n    <span class="s-light-font description">total citations</span> '},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div role="search">\n  <div class="row">\n    <h2 class="sr-only">Search Bar to Enter New Query</h2>\n    <div class="col-sm-12 s-quick-add" aria-label="quick add fields">\n      <div id="expanded-search-form" class="unselectable">\n        <div id="field-options">\n          <span class="s-field-options">quick field:</span>\n          <button class="btn btn-link btn-sm" title=\'search for an author, e.g. author:"Kurtz,M"\' data-toggle="tooltip" data-field="author" data-punc=\'"\'>Author\n                </button>\n          <button class="btn btn-link btn-sm" title=\'search for a first author, e.g. author:"^Kurtz,M"\' data-toggle="tooltip" data-field="first-author" data-punc=\'"\'>First Author\n                </button>\n          <button class="btn btn-link btn-sm" title="limit search to abstract, title and keyword fields" data-toggle="tooltip" data-field="abs" data-punc=\'"\'>Abstract\n                </button>\n          <button class="btn btn-link btn-sm" title="e.g. year:1999 or year:1999-2016" data-toggle="tooltip" data-field="year">Year\n                </button>\n          <button class="btn btn-link btn-sm" title="search titles, abstract, text, keywords and acknowledgements of the articles" data-toggle="tooltip" data-field="full" data-punc=\'"\'>Fulltext\n                </button>\n          \x3c!--container for additional fields/operators--\x3e\n          <span id="option-dropdown-container"></span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class="row">\n    <div class="col-sm-12 search-bar-input-row s-search-bar-input-row">\n      <form name="main-query">\n        <div class="form-group has-feedback">\n          <div class="input-group">\n            '+(null!=(r=t.if.call(e,null!=e?e.bigquery:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(6,i,0),data:i}))?r:"")+'\n            <span class="input-group-btn">\n                       <button type="submit" class="btn btn-primary search-submit s-search-submit" aria-label="submit">\n                           <i class="fa fa-search"></i></button>\n                  </span>\n\n          </div>\n          \x3c!-- /input-group --\x3e\n        </div>\n        \x3c!-- /form-group--\x3e\n      </form>\n    </div>\n  </div>\n</div>\n<div class="row">\n  <div class="only-show-on-landing">\n    <div class="quick-reference">\n      <div class="col-sm-6">\n        <dl class="dl-horizontal">\n          <dt>author</dt>\n          <dd>author:"huchra, john"</dd>\n          <dt>first author</dt>\n          <dd>author:"^huchra, john"</dd>\n          <dt>abstract + title</dt>\n          <dd>abs:"dark energy"</dd>\n          <dt>year</dt>\n          <dd>year:2000</dd>\n          <dt>year range</dt>\n          <dd>year:2000-2005</dd>\n          <dt>full text</dt>\n          <dd>full:"gravitational waves"</dd>\n          <dt>publication</dt>\n          <dd>bibstem:ApJ <i class="icon-help" data-toggle="tooltip" title="this field requires the bibstem, or journal abbreviation--try going to the \'Paper\' tab above for an easy-to-use form version"></i></dd>\n        </dl>\n      </div>\n      <div class="col-sm-6  quick-reference">\n        <dl class="dl-horizontal">\n          <dt>citations</dt>\n          <dd>citations(author:"huchra, j") <i class="icon-help" data-toggle="tooltip" title="finds all papers that cite a given set of papers"></i></dd>\n          <dt>references</dt>\n          <dd>references(author:"huchra, j") <i class="icon-help" data-toggle="tooltip" title="finds all papers referenced by a given set of papers"></i></dd>\n          <dt>reviews</dt>\n          <dd>reviews("gamma-ray bursts") <i class="icon-help" data-toggle="tooltip" title="finds articles citing the most relevant papers on the topic being researched"></i></dd>\n          <hr/>\n          <dt>refereed</dt>\n          <dd>property:refereed <i class="icon-help" data-toggle="tooltip" title="limit to non-refereed papers by searching property:notrefereed"></i></dd>\n          <dt>astronomy</dt>\n          <dd>database:astronomy <i class="icon-help" data-toggle="tooltip" title="limit to physics papers by searching database:physics"></i></dd>\n          <dt>OR</dt>\n          <dd>abs:(planet OR star) <i class="icon-help" data-toggle="tooltip" title="default logic is AND, e.g. abs:(planet star) would be interpreted as abs:(planet AND star)"></i></dd>\n        </dl>\n      </div>\n    </div>\n\n  </div>\n\n  <div class="s-num-found">\n    <span class="s-light-font description">Your search returned</span> <b><span class="num-found-container">'+this.escapeExpression("function"==typeof(a=null!=(a=t.numFound||(null!=e?e.numFound:e))?a:t.helperMissing)?a.call(e,{name:"numFound",hash:{},data:i}):a)+'</span></b><span class="s-light-font"> results</span> '+(null!=(r=t.if.call(e,null!=e?e.citationCount:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?r:"")+"\n    </span>\n  </div>\n</div>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/search_bar/templates/search_bar_template",n),n}),define("hbs!js/widgets/search_bar/templates/search_form_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div id="search-gui"><span style="text-align:right;font-size:small;float:right;">This tool is still experimental.</span>\n</div>\n\n\n\n'},useData:!0});return t.registerPartial("js/widgets/search_bar/templates/search_form_template",n),n}),define("hbs!js/widgets/search_bar/templates/option-dropdown",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<select class="quick-add-dropdown">\n<optgroup label="fields">\n  <option value="aff">affiliation</option>\n  <option value="abstract">abstract only</option>\n  <option value="arxiv_class">arXiv category</option>\n  <option value="bibcode">bibcode</option>\n  <option value="bibgroup">bibliographic group</option>\n  <option value="bibstem">bib abbrev, e.g. ApJ</option>\n  <option value="body">body of article</option>\n  <option value="data">data archive</option>\n  <option value="database">database</option>\n  <option value="doctype">doctype</option>\n  <option value="doi">doi</option>\n  <option value="identifier">identifier</option>\n  <option value="keyword">keyword</option>\n  <option value="orcid">orcid</option>\n  <option value="page">page</option>\n  <option value="property">property</option>\n  <option value="pub">publication full name</option>\n  <option value="pubdate" data-default-value="[2000-01-01 TO 2010-01-01]">date published</option>\n  <option value="title">title</option>\n  <option value="volume">volume</option>\n</optgroup>\n<optgroup label="operators">\n  <option value="citations">citations()</option>\n  <option value="references">references()</option>\n  <option value="reviews">reviews()</option>\n  <option value="topn">topn()</option>\n  <option value="trending">trending()</option>\n  <option value="useful">useful()</option>\n</optgroup>\n<optgroup label="special characters">\n  <option value="?">single wildcard: ?</option>\n  <option value="*">wildcard: *</option>\n  <option value="=">exact match: =</option>\n</optgroup>\n</select>\n'},useData:!0});return t.registerPartial("js/widgets/search_bar/templates/option-dropdown",n),n}),function(e){define("jquery-querybuilder",["jquery"],function(){return function(){!function(e){"use strict";var t=["string","integer","double","date","time","datetime"],n=["text","radio","checkbox","select"],i=function(t,n){var r=this;"extend"in n&&(e.extend(this,n.extend),delete n.extend),this.$el=t,this.settings=e.extend(!0,{},i.DEFAULTS,n),this.filters=this.settings.filters,this.lang=this.settings.lang,this.operators=this.settings.operators,this.template=this.settings.template,this.status={group_id:0,rule_id:0,generatedId:!1},null===this.template.group&&(this.template.group=this.getGroupTemplate),null===this.template.rule&&(this.template.rule=this.getRuleTemplate),this.$el.attr("id")||(this.$el.attr("id","qb_"+Math.floor(99999*Math.random())),this.status.generatedId=!0),this.$el_id=this.$el.attr("id"),(!this.filters||this.filters.length<1)&&e.error("Missing filters list"),this.checkFilters(),this.$el.on("change.queryBuilder",".rules-group-header input[name$=_cond]",function(){var t=e(this);t.is(":checked")&&(t.parent().addClass("active"),t.parent().siblings().removeClass("active"))}),this.$el.on("change.queryBuilder",".rule-filter-container select[name$=_filter]",function(){var t=e(this),n=t.closest(".rule-container");r.createRuleOperators(n,t.val()),r.createRuleInput(n,t.val())}),this.$el.on("change.queryBuilder",".rule-operator-container select[name$=_operator]",function(){var t=e(this),n=t.closest(".rule-container");r.updateRuleOperator(n,t.val())}),this.$el.on("click.queryBuilder","[data-add=rule]",function(){var t=e(this).closest(".rules-group-container").find(">.rules-group-body>.rules-list");r.addRule(t)}),this.$el.on("click.queryBuilder","[data-add=group]",function(){var t=e(this).closest(".rules-group-container").find(">.rules-group-body>.rules-list");r.addGroup(t)}),this.$el.on("click.queryBuilder","[data-delete=rule]",function(){e(this).closest(".rule-container").remove()}),this.$el.on("click.queryBuilder","[data-delete=group]",function(){var t=e(this),n=t.closest(".rules-group-container");t[0].id!=r.$el_id+"_group_0"&&n.remove()}),this.settings.sortable&&this.initSortable(),this.$el.addClass("query-builder"),this.addGroup(this.$el)};i.DEFAULTS={onValidationError:null,onAfterAddGroup:null,onAfterAddRule:null,conditions:["AND","OR"],default_condition:"AND",sortable:!1,filters:[],template:{group:null,rule:null},lang:{add_rule:"Add rule",add_group:"Add group",delete_rule:"Delete",delete_group:"Delete",and_condition:"AND",or_condition:"OR",filter_select_placeholder:"------",operator_equal:"equal",operator_not_equal:"not equal",operator_in:"in",operator_not_in:"not in",operator_less:"less",operator_less_or_equal:"less or equal",operator_greater:"greater",operator_greater_or_equal:"greater or equal",operator_begins_with:"begins with",operator_not_begins_with:"doesn't begin with",operator_contains:"contains",operator_not_contains:"doesn't contain",operator_ends_with:"ends with",operator_not_ends_with:"doesn't end with",operator_is_empty:"is empty",operator_is_not_empty:"is not empty",operator_is_null:"is null",operator_is_not_null:"is not null"},operators:[{type:"equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_equal",accept_values:!0,apply_to:["string","number","datetime"]},{type:"in",accept_values:!0,apply_to:["string","number","datetime"]},{type:"not_in",accept_values:!0,apply_to:["string","number","datetime"]},{type:"less",accept_values:!0,apply_to:["number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"greater",accept_values:!0,apply_to:["number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"begins_with",accept_values:!0,apply_to:["string"]},{type:"not_begins_with",accept_values:!0,apply_to:["string"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"not_contains",accept_values:!0,apply_to:["string"]},{type:"ends_with",accept_values:!0,apply_to:["string"]},{type:"not_ends_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!1,apply_to:["string"]},{type:"is_not_empty",accept_values:!1,apply_to:["string"]},{type:"is_null",accept_values:!1,apply_to:["string","number","datetime"]},{type:"is_not_null",accept_values:!1,apply_to:["string","number","datetime"]}]},i.prototype.destroy=function(){this.status.generatedId&&this.$el.removeAttr("id"),this.$el.empty().off("click.queryBuilder change.queryBuilder").removeClass("query-builder").removeData("queryBuilder")},i.prototype.reset=function(){this.status.group_id=1,this.status.rule_id=0,this.addRule(this.$el.find(">.rules-group-container>.rules-group-body>.rules-list").empty())},i.prototype.clear=function(){this.status.group_id=0,this.status.rule_id=0,this.$el.empty()},i.prototype.getRules=function(){this.markRuleAsError(this.$el.find(".rule-container"),!1);var t=this;return function n(i){var r={},a=i.find(">.rules-group-body>.rules-list>*");r.condition=i.find(">.rules-group-header input[name$=_cond]:checked").val(),r.rules=[];for(var s=0,o=a.length;s<o;s++){var l,c=a.eq(s);if(c.hasClass("rule-container")){var u=t.getRuleFilter(c);if("-1"==u)continue;var d=t.getFilterById(u),h=t.getOperatorByType(t.getRuleOperator(c)),p=null;if(h.accept_values){p=t.getRuleValue(c,d),d.valueParser&&(p=d.valueParser.call(this,c,p,d,h));var f=t.validateValue(p,d);if(!0!==f)return t.markRuleAsError(c,!0),t.triggerValidationError(f,c,p,d,h),{}}l={id:d.id,field:d.field,type:d.type,input:d.input,operator:h.type,value:p},r.rules.push(l)}else{if(l=n(c),e.isEmptyObject(l))return{};r.rules.push(l)}}return 0===r.rules.length?{}:r}(this.$el.find(">.rules-group-container"))},i.prototype.setRules=function(t){this.clear();var n=this;!function t(i,r){var a=n.addGroup(r,!1),s=a.find(">.rules-group-body>.rules-list"),o=a.find(">.rules-group-header input[name$=_cond]");if(!i.rules)throw new Error("Missing data.rules element");i.condition||(i.condition=n.settings.default_condition);for(var l,c=n.settings.conditions.length,u=0;u<c;u++)l=n.settings.conditions[u],o.filter("[value="+l+"]").prop("checked",i.condition.toUpperCase()==l);o.trigger("change"),e.each(i.rules,function(i,r){if(r.rules&&r.rules.length>0)t(r,s);else{r.id||e.error("Missing rule field id"),r.value||(r.value=""),r.operator||(r.operator="equal");var a=n.addRule(s),o=n.getFilterById(r.id),l=n.getOperatorByType(r.operator),c=a.find(".rule-value-container");a.find(".rule-filter-container select[name$=_filter]").val(r.id).trigger("change");var u=a.find(".rule-operator-container select[name$=_operator]");if(0==u.children('option[value="'+r.operator+'"]').length){if(!o.createOperatorIfNecessary)throw"Unknown operator: "+r.operator;u.append(e('<option value="'+r.operator+'">'+(n.lang["operator_"+r.operator]||r.operator)+"</option>"))}if(u.val(r.operator).trigger("change"),l.accept_values)switch(o.input){case"radio":c.find('input[name$=_value][value="'+r.value+'"]').prop("checked",!0).trigger("change");break;case"checkbox":e.isArray(r.value)||(r.value=[r.value]),e.each(r.value,function(e,t){c.find('input[name$=_value][value="'+t+'"]').prop("checked",!0).trigger("change")});break;case"select":c.find("select[name$=_value]").val(r.value).trigger("change");break;case"text":default:c.find("input[name$=_value]").val(r.value).trigger("change")}o.onAfterSetValue&&o.onAfterSetValue.call(this,a,r.value,o,l)}})}(t,this.$el)},i.prototype.checkFilters=function(){var i=[];e.each(this.filters,function(r,a){switch(a.id||e.error("Missing filter id: "+r),-1!=i.indexOf(a.id)&&e.error("Filter already defined: "+a.id),i.push(a.id),a.type||e.error("Missing filter type: "+a.id),-1==t.indexOf(a.type)&&e.error("Invalid type: "+a.type),a.input?"function"!=typeof a.input&&-1==n.indexOf(a.input)&&e.error("Invalid input: "+a.input):a.input="text",a.field||(a.field=a.id),a.label||(a.label=a.field),a.type){case"string":a.internalType="string";break;case"integer":case"double":a.internalType="number";break;case"date":case"time":case"datetime":a.internalType="datetime"}switch(a.input){case"radio":case"checkbox":(!a.values||a.values.length<1)&&e.error("Missing values for filter: "+a.id)}})},i.prototype.addGroup=function(t,n){var i=this.nextGroupId(),r=e(this.template.group.call(this,i));return t.append(r),this.settings.onAfterAddGroup&&this.settings.onAfterAddGroup.call(this,r),void 0!==n&&!0!==n||this.addRule(r.find(">.rules-group-body>.rules-list")),r},i.prototype.addRule=function(t){var n=this.nextRuleId(),i=e(this.template.rule.call(this,n)),r=e(this.getRuleFilterSelect(n));return t.append(i),i.find(".rule-filter-container").append(r),this.settings.onAfterAddRule&&this.settings.onAfterAddRule.call(this,i),i},i.prototype.createRuleOperators=function(t,n){var i=t.find(".rule-operator-container").empty();if("-1"!=n){var r=this.getOperators(n),a=e(this.getRuleOperatorSelect(t.attr("id"),r));i.html(a)}},i.prototype.createRuleInput=function(t,n){var i=t.find(".rule-value-container").empty();if("-1"!=n&&this.getOperatorByType(this.getRuleOperator(t)).accept_values){var r=this.getFilterById(n),a=e(this.getRuleInput(t.attr("id"),r));i.append(a).show(),r.onAfterCreateRuleInput&&r.onAfterCreateRuleInput.call(this,t,r),r.plugin&&a[r.plugin](r.plugin_config||{})}},i.prototype.updateRuleOperator=function(e,t){var n=e.find(".rule-value-container"),i=this.getFilterById(this.getRuleFilter(e)),r=this.getOperatorByType(t);r.accept_values?(n.show(),n.is(":empty")&&this.createRuleInput(e,i.id)):n.hide(),i.onAfterChangeOperator&&i.onAfterChangeOperator.call(this,e,i,r)},i.prototype.validateValue=function(e,t){var n=t.validation||{};if(n.callback)return n.callback.call(this,e,t);switch(t.input){case"radio":if(void 0===e)return"radio_empty";break;case"checkbox":if(0===e.length)return"checkbox_empty";break;case"select":if(t.multiple){if(0===e.length)return"select_empty"}else if(void 0===e)return"select_empty";break;case"text":default:switch(t.internalType){case"string":if(void 0!==n.min){if(e.length<n.min)return"string_exceed_min_length"}else if(0===e.length)return"string_empty";if(void 0!==n.max&&e.length>n.max)return"string_exceed_max_length";if(n.format&&!n.format.test(e))return"string_invalid_format";break;case"number":if(isNaN(e))return"number_nan";if("integer"==t.type){if(parseInt(e)!=e)return"number_not_integer"}else if(parseFloat(e)!=e)return"number_not_double";if(void 0!==n.min&&e<n.min)return"number_exceed_min";if(void 0!==n.max&&e>n.max)return"number_exceed_max";if(n.step){var i=e/n.step;if(parseInt(i)!=i)return"number_wrong_step"}break;case"datetime":if(window.moment&&n.format){var r=moment(e,n.format);if(!r.isValid())return"datetime_invalid";if(n.min&&r<moment(n.min,n.format))return"datetime_exceed_min";if(n.max&&r>moment(n.max,n.format))return"datetime_exceed_max"}}}return!0},i.prototype.markRuleAsError=function(e,t){t?e.addClass("has-error"):e.removeClass("has-error")},i.prototype.triggerValidationError=function(e,t,n,i,r){i.onValidationError&&i.onValidationError.call(this,t,e,n,i,r),this.settings.onValidationError&&this.settings.onValidationError.call(this,t,e,n,i,r);var a=jQuery.Event("validationError.queryBuilder",{error:e,filter:i,operator:r,value:n,targetRule:t[0],builder:this});this.$el.trigger(a)},i.prototype.initSortable=function(){e.event.props.push("dataTransfer");var t,n,i=!1;this.$el.on("mousedown",".drag-handle",function(e){i=!0}),this.$el.on("mouseup",".drag-handle",function(e){i=!1}),this.$el.on("dragstart","[draggable]",function(r){r.stopPropagation(),i?(i=!1,r.dataTransfer.setData("text","drag"),n=e(r.target),(t=e('<div class="rule-placeholder">&nbsp;</div>')).css("min-height",n.height()),t.insertAfter(n),setTimeout(function(){n.hide()},0)):r.preventDefault()}),this.$el.on("dragenter","[draggable]",function(n){n.preventDefault(),n.stopPropagation();var i,r=e(n.target);(i=r.closest(".rule-container")).length?t.detach().insertAfter(i):(i=r.closest(".rules-group-container")).length&&t.detach().appendTo(i.find(".rules-list").eq(0))}),this.$el.on("dragover","[draggable]",function(e){e.preventDefault(),e.stopPropagation()}),this.$el.on("drop",function(t){t.preventDefault(),t.stopPropagation();var i,r=e(t.target);(i=r.closest(".rule-container")).length?n.detach().insertAfter(i):(i=r.closest(".rules-group-container")).length&&n.detach().appendTo(i.find(".rules-list").eq(0))}),this.$el.on("dragend","[draggable]",function(e){e.preventDefault(),e.stopPropagation(),n.show(),t.remove()})},i.prototype.nextGroupId=function(){return this.$el_id+"_group_"+this.status.group_id++},i.prototype.nextRuleId=function(){return this.$el_id+"_rule_"+this.status.rule_id++},i.prototype.getOperators=function(e){"string"==typeof e&&(e=this.getFilterById(e));var t,n=[];if(e.operators&&e.operators.length>0)for(var i=0,r=e.operators.length;i<r;i++){t=e.operators[i];for(var a=0,s=this.operators.length;a<s;a++)if(this.operators[a].type==t&&this.operators[a].apply_to.indexOf(e.internalType)>-1){n.push({type:t,label:this.lang["operator_"+t]});break}}if(n.length>0)return n;for(var i=0,r=this.operators.length;i<r;i++)-1!=this.operators[i].apply_to.indexOf(e.internalType)&&n.push({type:this.operators[i].type,label:this.lang["operator_"+this.operators[i].type]});return e.operators&&n.sort(function(t,n){return e.operators.indexOf(t.type)-e.operators.indexOf(n.type)}),n},i.prototype.getFilterById=function(e){for(var t=0,n=this.filters.length;t<n;t++)if(this.filters[t].id==e)return this.filters[t];throw"Undefined filter: "+e},i.prototype.getOperatorByType=function(e){for(var t=0,n=this.operators.length;t<n;t++)if(this.operators[t].type==e)return this.operators[t];throw"Undefined operator: "+e},i.prototype.getRuleFilter=function(e){return e.find(".rule-filter-container select[name$=_filter]").val()},i.prototype.getRuleOperator=function(e){return e.find(".rule-operator-container select[name$=_operator]").val()},i.prototype.getRuleValue=function(t,n){n=n||this.getFilterByType(this.getRulefilter(t));var i,r=t.find(".rule-value-container");switch(n.input){case"radio":i=r.find("input[name$=_value]:checked").val();break;case"checkbox":i=[],r.find("input[name$=_value]:checked").each(function(){i.push(e(this).val())});break;case"select":n.multiple?(i=[],r.find("select[name$=_value] option:selected").each(function(){i.push(e(this).val())})):i=r.find("select[name$=_value] option:selected").val();break;case"text":default:i=r.find("input[name$=_value]").val()}return i},i.prototype.getGroupTemplate=function(e){for(var t,n=[],i=this.settings.conditions.length,r=0;r<i;r++)t=this.settings.conditions[r],n.push('<label class="btn btn-xs btn-primary '+(this.settings.default_condition==t?"active":"")+'"><input type="radio" name="'+e+'_cond" value="'+t+'"'+(this.settings.default_condition==t?"checked":"")+">"+(this.lang[t.toLowerCase()+"_condition"]||t)+"</label>");return n=n.join("\n"),'<dl id="'+e+'" class="rules-group-container" '+(this.settings.sortable?'draggable="true"':"")+'>   <dt class="rules-group-header">     <div class="btn-group pull-right">       <button type="button" class="btn btn-xs btn-success" data-add="rule"><i class="glyphicon glyphicon-plus"></i> '+this.lang.add_rule+'</button>       <button type="button" class="btn btn-xs btn-success" data-add="group"><i class="glyphicon glyphicon-plus-sign"></i> '+this.lang.add_group+'</button>       <button type="button" class="btn btn-xs btn-danger" data-delete="group"><i class="glyphicon glyphicon-remove"></i> '+this.lang.delete_group+'</button>     </div>     <div class="btn-group">       '+n+"    </div>     "+(this.settings.sortable?'<div class="drag-handle"><i class="glyphicon glyphicon-sort"></i></div>':"")+"   </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>"},i.prototype.getRuleTemplate=function(e){return'<li id="'+e+'" class="rule-container" '+(this.settings.sortable?'draggable="true"':"")+'>   <div class="rule-header">     <div class="btn-group pull-right">       <button type="button" class="btn btn-xs btn-danger" data-delete="rule"><i class="glyphicon glyphicon-remove"></i> '+this.lang.delete_rule+"</button>     </div>   </div>   "+(this.settings.sortable?'<div class="drag-handle"><i class="glyphicon glyphicon-sort"></i></div>':"")+'   <div class="rule-filter-container"></div>   <div class="rule-operator-container"></div>   <div class="rule-value-container"></div> </li>'},i.prototype.getRuleFilterSelect=function(t){var n='<select name="'+t+'_filter">';return n+='<option value="-1">'+this.lang.filter_select_placeholder+"</option>",e.each(this.filters,function(e,t){n+='<option value="'+t.id+'">'+t.label+"</option>"}),n+="</select>"},i.prototype.getRuleOperatorSelect=function(e,t){for(var n='<select name="'+e+'_operator">',i=0,r=t.length;i<r;i++)n+='<option value="'+t[i].type+'">'+t[i].label+"</option>";return n+="</select>"},i.prototype.getRuleInput=function(t,n){if("function"==typeof n.input){var i=this.$el.find("#"+t);return n.input.call(this,i,n)}var r,a=n.validation||{},s="";switch(n.input){case"radio":r=n.vertical?" class=block":"",e.each(n.values,function(e,n){s+="<label"+r+'><input type="radio" name="'+t+'_value" value="'+e+'"> '+n+"</label> "});break;case"checkbox":r=n.vertical?" class=block":"",e.each(n.values,function(e,n){s+="<label"+r+'><input type="checkbox" name="'+t+'_value" value="'+e+'"> '+n+"</label> "});break;case"select":s+='<select name="'+t+'_value"'+(n.multiple?" multiple":"")+">",n.values&&e.each(n.values,function(e,t){s+='<option value="'+e+'"> '+t+"</option> "}),s+="</select>";break;case"text":default:switch(n.internalType){case"number":s+='<input type="number" name="'+t+'_value"',a.step&&(s+=' step="'+a.step+'"'),a.min&&(s+=' min="'+a.min+'"'),a.max&&(s+=' max="'+a.max+'"'),n.placeholder&&(s+=' placeholder="'+n.placeholder+'"'),s+=">";break;case"datetime":case"text":default:s+='<input type="text" name="'+t+'_value"',n.placeholder&&(s+=' placeholder="'+n.placeholder+'"'),s+=">"}}return s},e.fn.queryBuilder=function(t){this.length>1&&e.error("Unable to initialize multiple instances on the same target");var n=this.data("queryBuilder"),r="object"==typeof t&&t||{};return n||"destroy"!=t?(n||this.data("queryBuilder",new i(this,r)),"string"==typeof t?n[t].apply(n,Array.prototype.slice.call(arguments,1)):this):this},e.fn.queryBuilder.defaults={set:function(t){e.extend(!0,i.DEFAULTS,t)},get:function(t){var n=i.DEFAULTS;return t&&(n=n[t]),e.extend(!0,{},n)}}}(jQuery)}.apply(e,arguments)})}(this),define("js/components/query_builder/rules_translator",["underscore","js/components/generic_module","js/components/api_query_updater"],function(e,t,n){var i=function(e,t){this.operator=e,this.value=t,this.children=[]};i.prototype.addChild=function(e){this.children.push(e)},i.prototype.addChildren=function(t){this.children=e.union(this.children,t)},i.prototype.toString=function(t){if(e.isUndefined(t)&&(t=0),this.value)return this.value;var n=[];e.each(this.children,function(e,i,r){n.push(e.toString(t+1))});var i=this.operator?n.join(" "+this.operator+" "):n.join(" ");return t>0&&(i="("+i+")"),i};var r=function(){this.validOperators={AND:"AND",OR:"OR",DEFOP:"DEFOP"}};return e.extend(r.prototype,{setCondition:function(e){if(this.rules=this.rules||[],e){if(!this.validOperators.hasOwnProperty(e))throw new Error("Unknown operator: "+e);this.condition=this.validOperators[e]}else this.condition=this.validOperators.DEFOP||"AND"},_serializeValue:function(){if(this.value){var e=this.value;return this.fuzzy&&(e+="~"+this.fuzzy),this.boost&&(e+="^"+this.boost),e}},_modifyOperator:function(e){return this.modifier&&("-"==this.modifier?e.operator=e.operator+"_not":"="==this.modifier&&(e.operator=e.operator+"_exactly")),e},toJSON:function(){var t=e.clone(e.pick(this,["condition","id","field","type","input","operator"])),n=this._serializeValue();return n&&(t.value=n),this._modifyOperator(t),this.rules&&(t.rules=[],e.each(this.rules,function(e){t.rules.push(e.toJSON())})),t},setValue:function(e,t){this.value=e,this.type=t||"string"},setOffset:function(e){this.offset=e},setType:function(e){this.type=e},setEnd:function(e){this.end=e},getField:function(){return this.field},setField:function(e){this.field=e,this.id=e},setModifier:function(e){this.modifier=e},getModifier:function(){return this.modifier},setFuzzy:function(e){this.fuzzy=e.replace("~","")},setBoost:function(e){this.boost=e.replace("^","")},setOperator:function(e){this.operator=e},addChild:function(e){this.rules=this.rules||[],this.rules.push(e)}}),t.extend({initialize:function(e){this.apiQueryUpdater=new n("rulesTranslator"),this.validFunctions={"topn()":!0,"citations()":!0,"references()":!0,"instructive()":!0,"trending()":!0}},convertQTreeToRules:function(e){if(!e)throw new Error("Empty qtree");this._parentize(e);var t=this._extractRules(e);if(!t.rules){var n=new r;n.addChild(t),t=n}return t.toJSON()},_parentize:function(t,n){var i=this;t.parent=n,e.each(t.children,function(e){i._parentize(e,t)})},_extractRules:function(e){var t=new r;return this._extractRule(e,t),t},_extractRule:function(t,n){var n,i=this;switch(t.name){case"OPERATOR":if(1==t.children.length){this._extractRule(t.children[0],n);break}n.setCondition(t.label),e.each(t.children,function(e){var t=new r;this._extractRule(e,t),n.addChild(t)},this);break;case"CLAUSE":for(var a=t;a.children&&1==a.children.length&&"OPERATOR"==a.children[0].name;)a=a.children[0];if(a!==t){n.setCondition(a.label),e.each(a.children,function(e){var t=new r;this._extractRule(e,t),n.addChild(t)},this);break}e.each(a.children,function(e){this._extractRule(e,n)},this);break;case"FIELD":if(2==t.children.length)if("CLAUSE"==t.children[1].name){var s=t.children[0].input,o=[];e.each(t.children[1].children,function(e){var t=new r;this._extractRule(e,t),o.push(this.buildQuery(t))},this);var l=new r;l.setField(s),l.setValue(o.join(" ")),l.setOperator("contains"),n.addChild(l)}else n.setField(t.children[0].input),this._extractRule(t.children[t.children.length-1],n);else n.setField("__all__"),this._extractRule(t.children[t.children.length-1],n);break;case"MODIFIER":2==t.children.length&&n.setModifier(t.children[0].name),this._extractRule(t.children[t.children.length-1],n);break;case"TMODIFIER":e.each(t.children,function(e){i._extractRule(e,n)});break;case"BOOST":t.children.length>0&&n.setBoost(t.children[0].label);break;case"FUZZY":t.children.length>0&&n.setFuzzy(t.children[0].label);break;case"QNORMAL":n.setValue(t.children[0].input),n.setOffset(t.children[0].start),n.setEnd(t.children[0].end),n.setOperator("is");break;case"QPHRASE":c=t.children[0].input;n.setValue(c.substring(1,c.length-1)),n.setOffset(t.children[0].start+1),n.setEnd(t.children[0].end-1),n.setOperator("is_phrase");break;case"QPHRASETRUNC":"*"==(c=t.children[0].input.trim()).substring(c.length-1)?(c=c.substring(0,c.length-1),n.setOperator("starts_with")):n.setOperator("is_wildcard"),n.setValue(c),n.setOffset(t.children[0].start+1),n.setEnd(t.children[0].end-1);break;case"QTRUNCATED":"*"==(c=t.children[0].input.trim()).substring(c.length-1)?(c=c.substring(0,c.length-1),n.setOperator("starts_with")):n.setOperator("is_wildcard"),n.setValue(c),n.setOffset(t.children[0].start),n.setEnd(t.children[0].end);break;case"QRANGEEX":case"QRANGEIN":case"QANYTHING":n.setOperator("is_not_empty");break;case"QDATE":break;case"QPOSITION":if("AUTHOR_SEARCH"==t.children[0].name){var c=t.children[0].input.trim();n.setValue(c.replace("^","")),n.setField("^author"),n.setOperator("is")}else e.each(t.children,function(e){this._extractRule(e,n)},this);break;case"QFUNC":var u=t.children[0].input.replace("(","()"),d=this.extractFunctionValues(u,t.children[1]);if(d)n.setValue(d.join("|")),n.setField(u),"MINUS"==n.getModifier()?n.setOperator("is_not_function"):n.setOperator("is_function");else{var h=this._getOriginalQuery(t);if(!h)throw new Error("Eeeek, we can't extract function values - bummmmmmer! Sorry boss");var p=t.children[0].end+1,f=t.children[t.children.length-1].end;if(!p||!f)throw new Error("Eeeek, this is a weird query tree, i don't know how to parse it");n.setValue(t.children[0].input+h.substring(p,f)+")"),n.setField("black_hole"),n.setOperator("is_literal")}break;case"QDELIMITER":break;case"QIDENTIFIER":n.setField(t.children[0].label),n.setValue(t.children[1].input),n.setOffset(t.children[1].start),n.setEnd(t.children[1].end),n.setOperator("is");break;case"QCOORDINATE":case"QREGEX":throw new Error("Not yet ready for: "+JSON.stringify(t));default:console.log("skipping",t)}return n},buildQuery:function(e){if(e.rules){t=new i(e.condition);if(n=this._buildQueryTree(t,e.rules))return n.toString().split(" DEFOP ").join(" ").split("__all__:").join("")}else{var t=new i("DEFOP"),n=this._buildQueryTree(t,[e]);if(n)return n.toString().split(" DEFOP ").join(" ").split("__all__:").join("")}return null},_buildQueryTree:function(t,n){var r=this;return n&&n.length>0&&e.each(n,function(e){if(e.condition){var n=new i(e.condition);t.addChild(n),r._buildQueryTree(n,e.rules)}else e.rules?r._buildQueryTree(t,e.rules):(n=r._buildOneRule(e))&&t.addChild(n)}),t},_buildOneRule:function(e){var t,n;if("string"==e.type){var r=this._cleanupFieldValue(e.field,e.value),a=r.value;switch(n=r.field,e.operator){case"is_phrase":case"is_not_phrase":case"contains_phrase":case"contains_not_phrase":t=n+":"+this.apiQueryUpdater.quote(a),e.operator.indexOf("_not")>-1&&(t="-"+t);break;case"is":case"is_not":t=n+":"+this.apiQueryUpdater.quoteIfNecessary(a),e.operator.indexOf("_not")>-1&&(t="-"+t);break;case"contains":case"contains_not":t=n+":"+(a.indexOf(" ")>-1?this.apiQueryUpdater.quoteIfNecessary(a,"(",")"):this.apiQueryUpdater.quoteIfNecessary(a,'"','"')),e.operator.indexOf("_not")>-1&&(t="-"+t);break;case"is_exactly":case"is_not_exactly":t="="+n+":"+this.apiQueryUpdater.quoteIfNecessary(a),e.operator.indexOf("_not_")>-1&&(t="NOT "+t);break;case"is_wildcard":case"is_not_wildcard":case"starts_with":case"starts_not_with":if(a.indexOf("*")>-1||a.indexOf("?")>-1)a=this.apiQueryUpdater.quoteIfNecessary(a);else{var s=this.apiQueryUpdater.quoteIfNecessary(a);s.length!=a.length?a=s.substring(0,s.length-1)+'*"':a+="*"}t=n+":"+a,e.operator.indexOf("_not_")>-1&&(t="-"+t);break;case"regex":t="__all__"==n?"regex(all,"+a+")":"regex("+n+", "+a+")";break;case"is_not_empty":t="__all__"==n?"*:*":n+":?";break;case"is_function":case"is_not_function":switch(n){case"topn()":t="topn("+a.split("|").join(", ")+")";break;default:t=n.replace("()","(")+a.split("|").join(", ")+")"}e.operator.indexOf("_not_")>-1&&(t="-"+t);break;case"is_literal":t=a;break;default:throw new Error("Unknown operator: "+e.operator)}return new i("",t)}throw new Error("Not knowing what to do with: "+JSON.stringify(e))},_cleanupFieldValue:function(e,t){return t=t.trim(),"^"===(e=(e||"__all__").trim()).substring(0,1)&&(t="^"+t,e=e.substring(1,e.length)),{field:e,value:t}},extractFunctionValues:function(t,n){if(!this.validFunctions[t])return null;var i=[];return e.each(n.children,function(e){var t=new r;this._extractRule(e,t),(t.value||t.rules)&&i.push(this.buildQuery(t))},this),i},_getOriginalQuery:function(e){for(var t=e;t.parent;)t=t.parent;return t.originalQuery?t.originalQuery:""},addValidFunctions:function(t){this.validFunctions=e.extend(this.validFunctions,t)},setValidFunctions:function(e){this.validFunctions=e},getValidFunctions:function(){return this.validFunctions}})}),define("hbs!js/components/query_builder/templates/group_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return' draggable="true" '},3:function(e,t,n,i){return'    <div class="drag-handle"><i class="fa fa-sort"></i></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div class="group-options">\n    <div class="btn-group logic-buttons"  data-toggle="buttons" >\n        '+(null!=(r="function"==typeof(a=null!=(a=t.conditions||(null!=e?e.conditions:e))?a:t.helperMissing)?a.call(e,{name:"conditions",hash:{},data:i}):a)?r:"")+'\n     </div>\n    <button type="button" class="btn btn-xs btn-danger btn-inverse" data-delete="group"><i class="fa fa-times"></i> remove group</button>\n\n</div>\n<dl id="'+this.escapeExpression("function"==typeof(a=null!=(a=t.group_id||(null!=e?e.group_id:e))?a:t.helperMissing)?a.call(e,{name:"group_id",hash:{},data:i}):a)+'" class="rules-group-container" '+(null!=(r=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' >\n<dt class="rules-group-header">\n\n<div>\n    <button type="button" class="btn btn-xs btn-success" data-add="rule"><i class="fa fa-plus"></i>  '+this.escapeExpression("function"==typeof(a=null!=(a=t.addRule||(null!=e?e.addRule:e))?a:t.helperMissing)?a.call(e,{name:"addRule",hash:{},data:i}):a)+'</button>\n    <button type="button" class="btn btn-xs btn-success" data-add="group"><i class="fa fa-plus-circle"></i> '+this.escapeExpression("function"==typeof(a=null!=(a=t.addGroup||(null!=e?e.addGroup:e))?a:t.helperMissing)?a.call(e,{name:"addGroup",hash:{},data:i}):a)+" </button>\n</div>\n"+(null!=(r=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"</dt>\n<dd class=rules-group-body>\n    <ul class=rules-list></ul>\n</dd>\n</dl>"},useData:!0});return t.registerPartial("js/components/query_builder/templates/group_template",n),n}),define("hbs!js/components/query_builder/templates/rule_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return' draggable="true" '},3:function(e,t,n,i){return'            <div class="drag-handle"><i class="fa fa-sort"></i></div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<li id="'+this.escapeExpression("function"==typeof(a=null!=(a=t.rule_id||(null!=e?e.rule_id:e))?a:t.helperMissing)?a.call(e,{name:"rule_id",hash:{},data:i}):a)+'" class="rule-container" '+(null!=(r=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' >\n        <div class="rule-header">\n            <div class="btn-group pull-right">\n                <button type="button" class="btn btn-xs btn-danger" data-delete="rule"><i class="fa fa-minus"></i> </button>\n            </div>\n        </div>\n'+(null!=(r=t.if.call(e,null!=e?e.sortable:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'\n        <div class="rule-filter-container"></div>\n        <div class="rule-operator-container"></div>\n        <div class="rule-value-container"></div>\n</li>'},useData:!0});return t.registerPartial("js/components/query_builder/templates/rule_template",n),n}),define("js/components/query_builder/plugin",["underscore","bootstrap","jquery","jquery-querybuilder","js/components/generic_module","js/components/query_builder/rules_translator","js/components/api_query","hbs!js/components/query_builder/templates/group_template","hbs!js/components/query_builder/templates/rule_template","js/mixins/dependon"],function(e,t,n,i,r,a,s,o,l,c){var u=r.extend({initialize:function(t){if(this._rules=null,this.rulesTranslator=new a,this.rulesTranslator.setValidFunctions({"topn()":!0,"citations()":!0,"references()":!0,"instructive()":!0,"trending()":!0,"pos()":!0}),this.qtreeGetter=t.qtreeGetter||null,this.qtreeGetter&&!this.qtreeGetter.getQTree)throw new Error("qtreeGetter must provide method 'getQTree'");t.el?this.$el=n(t.el):this.$el=n("<div/>"),n.fn.queryBuilder.defaults.set({conditions:["AND","OR"],lang:{defop_condition:"Space",operator_is:"is",operator_is_not:"is not",operator_is_exactly:"is exactly",operator_is_function:"matches",operator_is_not_function:"doesn't match",operator_contains:"has words",operator_contains_not:"excludes words",operator_is_wildcard:"starts with",operator_is_not_wildcard:"doesn't start with",operator_is_phrase:"has phrase",operator_is_wildphrase:"has wildcard",operator_is_not_phrase:"excludes phrase",operator_is_not_empty:"is not empty","operator_pos()":"Limit by Position","operator_citations()":"Get Citations","operator_references()":"Get References","operator_trending()":"Find Trending Papers","operator_instructive()":"Find Instructive Papers",delete_rule:"remove",delete_group:"group",add_rule:"term",add_group:"group"},operators:[{type:"is",accept_values:!0,apply_to:["string","number","datetime"]},{type:"is_not",accept_values:!0,apply_to:["string","number","datetime"]},{type:"is_exactly",accept_values:!0,apply_to:["string","number","datetime"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"contains_not",accept_values:!0,apply_to:["string"]},{type:"is_literal",accept_values:!0,apply_to:["string"]},{type:"is_function",accept_values:!0,apply_to:["string"]},{type:"is_not_function",accept_values:!0,apply_to:["string"]},{type:"is_phrase",accept_values:!0,apply_to:["string"]},{type:"is_wildphrase",accept_values:!0,apply_to:["string"]},{type:"is_not_phrase",accept_values:!0,apply_to:["string"]},{type:"is_wildcard",accept_values:!0,apply_to:["string"]},{type:"is_not_wildcard",accept_values:!0,apply_to:["string"]},{type:"starts_with",accept_values:!0,apply_to:["string"]},{type:"starts_not_with",accept_values:!0,apply_to:["string"]},{type:"is_empty",accept_values:!1,apply_to:["string"]},{type:"is_not_empty",accept_values:!1,apply_to:["string"]},{type:"less",accept_values:!0,apply_to:["number","datetime"]},{type:"less_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"greater",accept_values:!0,apply_to:["number","datetime"]},{type:"greater_or_equal",accept_values:!0,apply_to:["number","datetime"]},{type:"contains",accept_values:!0,apply_to:["string"]},{type:"contains_not",accept_values:!0,apply_to:["string"]},{type:"contains_phrase",accept_values:!0,apply_to:["string"]},{type:"contains_not_phrase",accept_values:!0,apply_to:["string"]},{type:"is_not_empty",accept_values:!1,apply_to:["string"]},{type:"pos()",accept_values:!0,apply_to:["string"]},{type:"citations()",accept_values:!0,apply_to:["string"]},{type:"references()",accept_values:!0,apply_to:["string"]},{type:"trending()",accept_values:!0,apply_to:["string"]},{type:"instructive()",accept_values:!0,apply_to:["string"]}]});var i=["is","is_wildcard","is_exactly","is_not","is_not_wildcard"],r=["contains","is_phrase","contains_not","is_not_phrase","is_wildcard"],s=["is_function","is_not_function"];this.singleTokenOperators=i,this.multiTokenOperators=r,this.functionOperators=s,this.$el.queryBuilder({sortable:!1,filters:[{id:"__all__",label:"Index",type:"string",operators:r,createOperatorIfNecessary:!0,placeholder:"e.g. capillary surfaces"},{id:"author",label:"Author",type:"string",placeholder:"Planck, Max",operators:i,createOperatorIfNecessary:!0},{id:"^author",label:"First Author",type:"string",placeholder:"Einstein, A",operators:i,createOperatorIfNecessary:!0},{id:"title",label:"Title",type:"string",operators:r,createOperatorIfNecessary:!0,placeholder:"e.g. energy survey"},{id:"abstract",label:"Abstract",type:"string",operators:r,createOperatorIfNecessary:!0,placeholder:"e.g. foo bar"},{id:"keyword",label:"Keyword",type:"string",operators:i,createOperatorIfNecessary:!0},{id:"full",label:"Fulltext",type:"string",operators:r,createOperatorIfNecessary:!0},{id:"pos()",label:"position()",type:"string",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"},{id:"start",label:"start",type:"number",placeholder:"start position, e.g. 1"},{id:"end",label:"end",type:"number",placeholder:"end:optional, e.g. 100"}])},onAfterSetValue:function(e,t,n,i){var r=t.split("|");e.find("input[name=query]").val(r[0]),e.find("input[name=start]").val(r[1]),r[2]&&e.find("input[name=end]").val(r[2])}},{id:"citations()",label:"citations()",type:"string",placeholder:"query",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var r=t.split("|");e.find("input[name=query]").val(r[0])}},{id:"references()",label:"references()",type:"string",placeholder:"instructive(title:&quot;monte carlo&quot;)",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var r=t.split("|");e.find("input[name=query]").val(r[0])}},{id:"trending()",label:"trending()",type:"string",placeholder:"(any valid query)",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var r=t.split("|");e.find("input[name=query]").val(r[0])}},{id:"reviews()",label:"reviews()",type:"string",placeholder:"(any valid query)",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden target"},{id:"query",label:"query",type:"text",placeholder:"any valid query"}])},onAfterSetValue:function(e,t,n,i){var r=t.split("|");e.find("input[name=query]").val(r[0])}},{id:"topn()",label:"topn()",type:"string",operators:s,input:function(e,t){return this.createFunctionInputs([{id:e.attr("id"),label:"function",type:"text",placeholder:"hidden"},{id:"query",label:"query",type:"text",placeholder:"any valid query"},{id:"number",label:"number",type:"number",placeholder:"how many results, e.g 50"},{id:"sorting",label:"sorting",type:"string",input:"select",values:{"citation_count desc":"Pick first n most cited","citation_count asc":"Pick first n least cited","date desc":"Pick first n newest","date asc":"Pick first n oldest",relevance:"Pick first n most relevant"}}])},onAfterSetValue:function(e,t,n,i){var r=t.split("|");e.find("input[name=number]").val(r[0]),e.find("input[name=query]").val(r[1]),r[2]&&e.find("input[name=sorting]").val(r[3])}},{id:"_version_",label:"Version",type:"string",placeholder:"xxx",operators:i,createOperatorIfNecessary:!0},{id:"ack",label:"Acknowledgements",type:"string",placeholder:"ADS",operators:i,createOperatorIfNecessary:!0},{id:"aff",label:"Affiliation",type:"string",placeholder:"Harvard",operators:i,createOperatorIfNecessary:!0},{id:"alternate_bibcode",label:"Alternate Bibcode",type:"string",placeholder:"e.g. 2015ASPC..492..208G",operators:i,createOperatorIfNecessary:!0},{id:"alternate_title",label:"Alternate Title",type:"string",placeholder:"e.g. freisetzen (de)",operators:i,createOperatorIfNecessary:!0},{id:"arxiv_class",label:"Arxiv category",type:"string",placeholder:"e.g. phys",operators:i,createOperatorIfNecessary:!0},{id:"author_facet",label:"Author Facet",type:"string",placeholder:"e.g. 1/Einstein, A./Einstein, Albert",operators:i,createOperatorIfNecessary:!0},{id:"bibgroup",label:"Bibliographic Group",type:"string",placeholder:"e.g. CFA",operators:i,createOperatorIfNecessary:!0},{id:"body",label:"Body",type:"string",placeholder:"will search in full text (minus title, abstract...)",operators:i,createOperatorIfNecessary:!0},{id:"citation",label:"Citation",type:"string",placeholder:"e.g. 2015SPIE*",operators:i,createOperatorIfNecessary:!0},{id:"citation_count",label:"Citation count",type:"string",placeholder:"e.g. [0 TO 100]",operators:i,createOperatorIfNecessary:!0},{id:"comment",label:"Comment",type:"string",placeholder:"# reserved for librarians",operators:i,createOperatorIfNecessary:!0},{id:"copyright",label:"Copyright",type:"string",placeholder:"e.g. ",operators:i,createOperatorIfNecessary:!0},{id:"data",label:"Data",type:"string",placeholder:"# reserved for librarians",operators:i,createOperatorIfNecessary:!0},{id:"database",label:"Database",type:"string",placeholder:"e.g. physics",operators:i,createOperatorIfNecessary:!0},{id:"date",label:"Date",type:"string",placeholder:"# e.g. 1976-01-02T00:30:00Z",operators:i,createOperatorIfNecessary:!0},{id:"doctype",label:"Document Type",type:"string",placeholder:"e.g. book",operators:i,createOperatorIfNecessary:!0},{id:"doi",label:"DOI",type:"string",placeholder:"e.g. 010.1038/srep04183",operators:i,createOperatorIfNecessary:!0},{id:"eid",label:"Electronic ID",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"email",label:"Email",type:"string",placeholder:"e.g. adsabs@harvard.edu",operators:i,createOperatorIfNecessary:!0},{id:"facility",label:"Facility",type:"string",placeholder:"e.g. CERN",operators:i,createOperatorIfNecessary:!0},{id:"grant",label:"Grant ID",type:"string",placeholder:"e.g. NNX12AG54G",operators:i,createOperatorIfNecessary:!0},{id:"id",label:"ID",type:"string",placeholder:"e.g. 15",operators:i,createOperatorIfNecessary:!0},{id:"identifier",label:"Identifier",type:"string",placeholder:"any bibcode, eid, doi or other ids",operators:i,createOperatorIfNecessary:!0},{id:"indexstamp",label:"Indexstamp",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"isbn",label:"ISBN",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"issn",label:"ISSN",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"issue",label:"Issue",type:"string",placeholder:"1",operators:i,createOperatorIfNecessary:!0},{id:"lang",label:"Language",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"orcid",label:"ORCID",type:"string",placeholder:"0000-0001-8178-9506",operators:i,createOperatorIfNecessary:!0},{id:"page",label:"Page",type:"string",placeholder:"2",operators:i,createOperatorIfNecessary:!0},{id:"property",label:"Property",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"pub",label:"Publication",type:"string",placeholder:"apj",operators:i,createOperatorIfNecessary:!0},{id:"pubdate",label:"Publ. Date",type:"string",placeholder:"2014-08",operators:i,createOperatorIfNecessary:!0},{id:"read_count",label:"Times read",type:"string",placeholder:"[10 TO 20]",operators:i,createOperatorIfNecessary:!0},{id:"reference",label:"Reference",type:"string",placeholder:"e.g. 2015SPIE*",operators:i,createOperatorIfNecessary:!0},{id:"simbid",label:"SIMBAD ID",type:"string",placeholder:"# internal use",operators:i,createOperatorIfNecessary:!0},{id:"thesis",label:"Thesis",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"vizier",label:"Vizier",type:"string",placeholder:"",operators:i,createOperatorIfNecessary:!0},{id:"volume",label:"Volume",type:"string",placeholder:"e.g. v1",operators:i,createOperatorIfNecessary:!0},{id:"year",label:"Year",type:"string",placeholder:"e.g. 2015",operators:i,createOperatorIfNecessary:!0},{id:"black_hole",label:"Literal Input",type:"string",operators:s,createOperatorIfNecessary:!0,placeholder:'e.g. ^"$%^&*"'}],extend:{createFunctionInputs:function(t){var i,r,a;a=n("<span/>"),(i=n(this.getRuleInput(t[0].id,t[0]))).addClass("hide");for(var s=1;s<t.length;s++){var o=this.getRuleInput(t[s].id,t[s]);(r=n(o.replace('_value"','"'))).attr("index",s-1),r.change(function(){var t=i.val();if(e.isString(t)){var r=t.split("|");r[parseInt(n(this).attr("index"))||0]=n(this).val(),i.val(r.join("|"))}}),a.append(r)}return a.append(i),a},getGroupTemplate:function(e){for(var t,n=[],i=this.settings.conditions.length,r=0;r<i;r++)t=this.settings.conditions[r],n.push('<label class="btn btn-xs btn-primary-faded logic-button '+(this.settings.default_condition==t?"active":"")+'"><input type="radio" name="'+e+'_cond" value="'+t+'"'+(this.settings.default_condition==t?"checked":"")+">"+(this.lang[t.toLowerCase()+"_condition"]||t)+"</label>");return n=n.join("\n"),'<dl id="'+e+'" class="rules-group-container" '+(this.settings.sortable?'draggable="true"':"")+'>   <dt class="rules-group-header">     <div class="btn-group">       '+n+'      &nbsp;&nbsp;    </div>     <div class="btn-group">       <button type="button" class="btn btn-xs btn-success" data-add="rule"><i class="fa fa-plus"></i> '+this.lang.add_rule+'</button>       <button type="button" class="btn btn-xs btn-success" data-add="group"><i class="fa fa-plus-square"></i> '+this.lang.add_group+'</button>       <button type="button" class="btn btn-xs btn-danger" data-delete="group"><i class="fa fa-minus"></i> '+this.lang.delete_group+"</button>     </div>     "+(this.settings.sortable?'<div class="drag-handle"><i class="fa fa-sort"></i></div>':"")+"   </dt>   <dd class=rules-group-body>     <ul class=rules-list></ul>   </dd> </dl>"},getRuleTemplate:function(e){return l({rule_id:e,sortable:this.settings.sortable,deleteRule:this.lang.delete_rule})}}}),this.$el.on("click.queryBuilder","[data-delete=rule]",function(e){e.stopPropagation()}),this.$el.on("click.queryBuilder","[data-delete=group]",function(e){e.stopPropagation()})},loadCss:function(){var e=require.toUrl("jquery-querybuilder")+".css";if(0==n(document.getElementsByTagName("head")[0]).find("link[href='"+e+"']").length){var t=document.createElement("link");t.type="text/css",t.rel="stylesheet",t.href=e,document.getElementsByTagName("head")[0].appendChild(t)}},setRules:function(e){this._rules=e,this.$el.queryBuilder("setRules",e)},getRules:function(){return this.$el.queryBuilder("getRules")},reset:function(){this._rules=null,this.$el.queryBuilder("reset")},getQuery:function(t){return t||(t=this.getRules()),e.isEmpty(t)?"":this.rulesTranslator.buildQuery(t)||""},getRulesFromQTree:function(e){var t=this.rulesTranslator.convertQTreeToRules(e);return this.checkRulesConstraints(t)},updateQueryBuilder:function(e){if(!this.qtreeGetter)throw new Error("You must provide qtreeGetter object for this to work");var t=this;return this.qtreeGetter.getQTree(e).done(function(n){n.originalQuery=e;var i=t.getRulesFromQTree(n);t.setRules(i)})},checkRulesConstraints:function(e){return this._checkRulesConstraints(e),e},_checkRulesConstraints:function(t){t.rules&&e.each(t.rules,function(e){this._checkRulesConstraints(e)},this)},isDirty:function(e){if(!this.$el.data("queryBuilder"))return!1;try{var t=this.getQuery();return!(!e||!t||t==e)||""!=t&&!(!this._rules||this.getQuery(this._rules)==t)}catch(e){console.trace(e)}return!0},setQTreeGetter:function(e){this.qtreeGetter=e},attachHeartBeat:function(t,n){n||(n=100);var i=e.debounce(t,n);this.$el.on("change.queryBuilder",function(e){i()}),this.$el.on("click.queryBuilder",function(e){i()}),this.$el.on("keypress.input",function(e){i()})},destroy:function(){this.$el.off("change.queryBuilder"),this.$el.off("click.queryBuilder"),this.$el.off("keypress.input")}});return u.buildQTreeGetter=function(t){var i=function(e){this.activate(e)};return e.extend(i.prototype,{activate:function(t){this.setBeeHive(t);var n=this.getPubSub();n.subscribe(n.DELIVERING_RESPONSE,e.bind(this.getResponse,this))},getQTree:function(e){return this.promise=n.Deferred(),this.getPubSub().publish(this.getPubSub().GET_QTREE,new s({q:e})),this.promise},getResponse:function(e){if(e.has("qtree")){var t=JSON.parse(e.get("qtree"));this.promise&&t&&this.promise.resolve(t)}}},c.BeeHive),new i(t)},u}),define("js/mixins/formatter",[],function(){var e={};return e.formatNum=function(e){var t=[];return(e+="").length<4?e:(e=e.split("").reverse(),_.each(e,function(n,i){t.unshift(n),(i+1)%3==0&&i!==e.length-1&&t.unshift(",")}),t.join(""))},e}),define("js/widgets/search_bar/autocomplete",[],function(){return[{value:'author:""',label:"Author",match:'author:"'},{value:'author:"^"',label:"First Author",match:'author:"'},{value:'author:"^"',label:"First Author",match:"first author"},{value:'author:"^"',label:"First Author",match:"^author"},{value:'author:"^"',label:"First Author",match:'author:"^'},{value:'bibstem:""',label:"Publication (must use bibstem)",desc:"e.g. bibstem:ApJ",match:'bibstem:"'},{value:'bibstem:""',label:"Publication (must use bibstem)",desc:"e.g. bibstem:ApJ",match:"publication (bibstem)"},{value:"arXiv:",label:"arXiv ID",match:"arxiv:"},{value:"doi:",label:"DOI",match:"doi:"},{value:'full:""',label:"Full text search",desc:"title, abstract, and body",match:"full:"},{value:'full:""',label:"Full text search",desc:"itle, abstract, and body",match:"fulltext"},{value:'full:""',label:"Full text search",desc:"title, abstract, and body",match:"text"},{value:"year:",label:"Year",match:"year"},{value:"year:",label:"Year Range",desc:"e.g. 1999-2005",match:"year range"},{value:'aff:""',label:"Affiliation",match:"affiliation"},{value:'aff:""',label:"Affiliation",match:"aff:"},{value:'abs:""',label:"Search abstract + title + keywords",match:"abs:"},{value:"database:astronomy",label:"Limit to papers in the astronomy database",match:"database:astronomy"},{value:"database:physics",label:"Limit to papers in the physics database",match:"database:physics"},{value:'title:""',label:"Title",match:"title:("},{value:"orcid:",label:"ORCiD identifier",match:"orcid:"},{value:"object:",label:"SIMBAD object (e.g. object:LMC)",match:"object:"},{value:"citations()",label:"Citations",desc:"Get papers citing your search result set",match:"citations("},{value:"references()",label:"References",desc:"Get papers referenced by your search result set",match:"references("},{value:"trending()",label:"Trending",desc:"the list of documents most read by users who read recent papers on the topic being researched",match:"trending("},{value:"reviews()",label:"Review Articles",desc:"review articles citing most relevant papers",match:"reviews("},{value:"useful()",label:"Useful",desc:"documents frequently cited by the most relevant papers on the topic being researched",match:"useful("},{value:"property:refereed",label:"Limit to refereed",desc:"(property:refereed)",match:"refereed"},{value:"property:refereed",label:"Limit to refereed",desc:"(property:refereed)",match:"property:refereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"non-refereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"property:notrefereed"},{value:"property:notrefereed",label:"Limit to non-refereed",desc:"(property:notrefereed)",match:"notrefereed"},{value:"property:eprint",label:"Limit to eprints",desc:"(property:eprint)",match:"eprint"},{value:"property:eprint",label:"Limit to eprints",desc:"(property:eprint)",match:"property:eprint"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"open access"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"property:openaccess"},{value:"property:openaccess",label:"Limit to open access",desc:"(property:openaccess)",match:"openaccess"},{value:"property:software",label:"Limit to software",desc:"(property:software)",match:"software"},{value:"property:software",label:"Limit to software",desc:"(property:software)",match:"property:software"},{value:"property:inproceedings",label:"Limit to papers in conference proceedings",desc:"(property:inproceedings)",match:"conference proceedings"},{value:"property:inproceedings",label:"Limit to papers in conference proceedings",desc:"(property:inproceedings)",match:"property:inproceedings"}]}),define("js/components/query_validator",["underscore"],function(e){function t(e,t){var n=new RegExp(e,t);return function(e){return n.test(e)?null:e}}function n(e,t,n){this.field=e,this.value=t,this.token=n}return function(){var i=function(e){for(var t=new RegExp(/[:(]/),i=e.split(/\s+/),r=[],a=0;a<i.length;a++){var s=i[a].split(t);2===s.length&&(s[1]=s[1].replace(")",""),r.push(new n(s[0],s[1],i[a])))}return r},r=function(e){return!!e},a=function(t,n){var i=[];for(var r in n){var a=e.compose.apply(e,t)(n[r].value);a||i.push({token:n[r].token,result:a})}return i};this.validate=function(n){var s={result:!0},o=[r,new t(/^("")?$/),new t(/^"?\^"?$/)];try{var l=n.get("q").join(" ").trim();if(!l.length)return s;var c=i(l)}catch(e){return s}var u=a(o,c);return s.result=e.every(e.pluck(u,"result")),u.length&&(s.tests=u),s}}}),define("libs/select2/matcher",["jquery"],function(e){return function(t){return function(n,i){var r=e.extend(!0,{},i);if(null==n.term||""===e.trim(n.term))return r;if(i.children){for(var a=i.children.length-1;a>=0;a--){var s=i.children[a];t(n.term,s.text,s)||r.children.splice(a,1)}if(r.children.length>0)return r}return t(n.term,i.text,i)?r:null}}}),define("js/widgets/search_bar/search_bar_widget",["underscore","marionette","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/search_bar/templates/search_bar_template","hbs!js/widgets/search_bar/templates/search_form_template","hbs!js/widgets/search_bar/templates/option-dropdown","js/components/query_builder/plugin","js/components/api_request","js/components/api_targets","js/components/api_feedback","js/mixins/formatter","./autocomplete","bootstrap","jquery-ui","js/mixins/dependon","analytics","js/components/query_validator","select2","libs/select2/matcher"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p,f,g,m,b,v,y){function w(e){var t="";return window.getSelection?t=e.value.substring(e.selectionStart,e.selectionEnd):document.selection&&"Control"!=document.selection.type&&(t=document.selection.createRange().text),t}function _(t){var n=e.filter(t.split(/\s+/),function(e){if(e)return!0}),i={active:n[n.length-1]};return n.length>1?(n.pop(),i.inactive=n.join(" ")):i.inactive="",i}$.fn.getCursorPosition=function(){var e=this.get(0);if(e){if("selectionStart"in e)return e.selectionStart;if(document.selection){e.focus();var t=document.selection.createRange(),n=document.selection.createRange().text.length;return t.moveStart("character",-e.value.length),t.text.length-n}}},$.fn.selectRange=function(e,t){return t||(t=e),this.each(function(){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else if(this.createTextRange){var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",t),n.moveStart("character",e),n.select()}})};var x=Backbone.Model.extend({defaults:function(){return{citationCount:void 0,numFound:void 0,bigquery:!1,bigquerySource:void 0}}}),S=t.ItemView.extend({template:r,className:"s-search-bar-widget",initialize:function(t){e.bindAll(this,"fieldInsert"),this.queryBuilder=new o,this.queryValidator=new b},activate:function(e){this.setBeeHive(e),this.queryBuilder.setQTreeGetter(o.buildQTreeGetter(e));var t=this;this.queryBuilder.attachHeartBeat(function(){t.onBuilderChange()})},onBuilderChange:function(){if(this.queryBuilder.isDirty(this.getFormVal())){var e=this.queryBuilder.getQuery();this.setFormVal(e)}},modelEvents:{change:"render"},onRender:function(){var t=this;this.$("#option-dropdown-container").append(s);var n=this.$(".quick-add-dropdown");n.select2({placeholder:"All Search Terms",matcher:y(function(e,t){return 0==t.toUpperCase().indexOf(e.toUpperCase())})}).on("change",function(e){var i=e.target.value;if(i){var r=$(this).find('option[value="'+e.target.value+'"]'),a=r.data("defaultValue"),s=r.closest("optgroup").attr("label");n.val(null).trigger("change"),setTimeout(function(){t.selectFieldInsert(i,s,a)},100)}}).val(null).trigger("change"),this.$("#search-gui").append(this.queryBuilder.$el);var i=this.$("input.q");this.$input=i;var r=!0;i.autocomplete({minLength:1,autoFocus:!0,delay:0,source:function(t,n){var a,s,o;r&&i.getCursorPosition()===i.val().length?(a=_(t.term).active)&&(s=new RegExp("^"+$.ui.autocomplete.escapeRegex(a),"i"),o=$.grep(h,function(e){return s.test(e.match)}),n(o=e.uniq(o,!1,function(e){return e.label}))):i.autocomplete("close")},focus:function(e,t){var n,r,a,s,o=i.val().replace(/^\s+/,""),l=t.item.value,c=w(i[0]);if(n=c?o.slice(0,o.length-c.length):o,s=_(n),r=s.active,a=s.inactive,i.data("ui-autocomplete").suggestedQ=a?a+" "+t.item.value:t.item.value,0==l.indexOf(r)){var u,d;d=(u=a?a+" "+r:r)+l.slice(r.length),i.val(d),i.selectRange(u.length,d.length)}else i.val(n);return!1},select:function(e,t){i.val(i.data("ui-autocomplete").suggestedQ);var n=t.item.value.split("").reverse()[0];return'"'==n||")"==n?i.selectRange(i.val().length-1):i.selectRange(i.val().length),m("send","event","interaction","autocomplete-used",t.item.value),!1}}),i.data("ui-autocomplete")._renderItem=function(e,t){return t.desc?$("<li>").append("<a>"+t.label+'<span class="s-auto-description">&nbsp;&nbsp;'+t.desc+"</span></a>").appendTo(e):$("<li>").append("<a>"+t.label+"</a>").appendTo(e)},i.keydown(function(e){r=8!=e.keyCode&&32!=e.keyCode}),this.$('[data-toggle="tooltip"]').tooltip()},events:{"click #field-options button":"fieldInsert","keyup .q":"toggleClear","click .show-form":"onShowForm","submit form[name=main-query]":"submitQuery","click .icon-clear":"clearInput","keyup .q":"storeCursorInfo","select .q":"storeCursorInfo","click .q":"storeCursorInfo","click .bigquery-close":"clearBigquery"},toggleClear:function(){Boolean(this.$input.val())?this.$(".icon-clear").removeClass("hidden"):this.$(".icon-clear").addClass("hidden")},clearInput:function(e){this.$input.val(""),this.toggleClear()},getFormVal:function(){return this.$input.val()},setFormVal:function(e){this.model.get("bigquery")&&"*:*"===e?this.$(".q").val(""):this.$(".q").val(e),this.toggleClear()},serializeData:function(){var e=this.model.toJSON();return e.numFound=e.numFound?this.formatNum(e.numFound):0,this.model.get("bigquerySource")&&this.model.get("bigquerySource").match(/library/i)&&this.model.set({libraryName:this.model.get("bigquerySource").match(/library:(.*)/i)[1]}),e},onShowForm:function(){var t=this.getFormVal();t.trim().length>0?this.queryBuilder.isDirty(this.getFormVal())||e.isEmpty(this.queryBuilder.getRules())?this.queryBuilder.updateQueryBuilder(t):this.queryBuilder.setRules(this.queryBuilder.getRules()):this.queryBuilder.setRules({condition:"AND",rules:[{id:"author",field:"author",type:"string",input:"text",operator:"is",value:""}]}),this.specifyFormWidth()},toggleFormSection:function(e){var t=$(e.target).parent();t.next().toggleClass("hide"),t.toggleClass("search-form-header-active")},_cursorInfo:{selected:"",startIndex:0},storeCursorInfo:function(e){var t=w(e.currentTarget),n=this.$input.getCursorPosition();this._cursorInfo={selected:t,startIndex:n},this.toggleClear()},selectFieldInsert:function(e,t,n){var i,r,a=this._cursorInfo.selected,s=this._cursorInfo.startIndex,o=this.getFormVal(),l='"'+a+'"';switch(0===a.length&&n&&(l=n),t){case"fields":i=e+":"+l;break;case"operators":i=e+"("+l+")";break;case"special characters":i="="===e?e+l:l+e,r=!0}if(a.length)this.setFormVal(o.substr(0,s)+i+o.substr(s+l.length));else{var c=o?o+" "+i:i;this.setFormVal(c),r?this.$input.selectRange(c.length):this.$input.selectRange(c.length-1)}},fieldInsert:function(e){e.preventDefault();var t,n,i=this.getFormVal(),r=$(e.target),a=r.attr("data-field"),s=r.attr("data-punc"),o=this._cursorInfo.startIndex,l=this._cursorInfo.selected;if(a.indexOf("operator-")>-1){if(n=a.split("-").reverse()[0],s="(",!l)return t=n+"("+i+")",i="",void this.setFormVal(t);t=n+"("+l+")"}else"first-author"==a?t=' author:"^'+l+'"':'"'==s?t=a+':"'+l+'"':"("==s?t=a+":("+l+")":s||(t=a+":"+l);if(l)this.setFormVal(i.substr(0,o)+t+i.substr(o+l.length));else{var c=i+" "+t;this.setFormVal(c),s?this.$input.selectRange(c.length-1):this.$input.selectRange(c.length)}m("send","event","interaction","field-insert-button-pressed",a)},submitQuery:function(t){var i,r,a;t.preventDefault(),t.stopPropagation(),a=this.getFormVal(),a=a.replace(/([A-Z])\w+:/g,function(e){return e.toLowerCase()}),this.original_query=a,!a&&this.model.get("bigquery")&&(a="*:*");var s=new n({q:a}),o=this.queryValidator.validate(s);if(o.result)this.trigger("start_search",s),i=e.chain(h).pluck("value").map(function(e){var t=e.match(/\w+:|\w+\(/);if(t&&t.length)return t[0]}).unique().value(),r=!1,e.each(i,function(e){a.indexOf(e)>-1&&(r=!0)}),r?m("send","event","interaction","fielded-query-submitted-from-search-bar",a):m("send","event","interaction","unfielded-query-submitted-from-search-bar",a),this._queryBuilderUsed&&m("send","event","interaction","querybuilder-used",a),this._queryBuilderUsed=!1;else{var l=e.pluck(o.tests,"token");l=l.length>1?l.join(", "):l[0];var c=this.getPubSub();c.publish(c.ALERT,new u({code:0,msg:'<p><i class="fa fa-exclamation-triangle fa-2x" aria-hidden="true"></i> Sorry! We aren\'t able to understand: <strong><i>'+l+'</i></strong></p><p><strong><a href="/">Try looking at the search examples on the home page</a></strong> or <strong><a href="https://adsabs.github.io/help/search/search-syntax">reading our help page.</a></strong></p>',type:"info",fade:!0}))}},clearBigquery:function(){this.trigger("clear_big_query")}});e.extend(S.prototype,d,g.BeeHive);var E=i.extend({initialize:function(e){this.model=new x,this.view=new S({model:this.model}),this.listenTo(this.view,"start_search",function(e){this.changeDefaultSort(e),this.navigate(e)}),this.listenTo(this.view,"clear_big_query",function(e){(e=this._currentQuery.clone()).unset("__qid"),e.unset("__bigquerySource"),e.set("__clearBiqQuery","true"),this.navigate(e)}),this.listenTo(this.view,"render",function(){var e=this.getCurrentQuery(),t=e.get("q");if(t)var n=e.get("__original_query")?e.get("__original_query")[0]:t.join(" ");n&&this.view.setFormVal(n),this.view.toggleClear()}),i.prototype.initialize.call(this,e)},activate:function(t){this.setBeeHive(t);var n=this.getPubSub();n.subscribe(n.FEEDBACK,e.bind(this.handleFeedback,this)),n.subscribe(n.NAVIGATE,e.bind(this.focusInput,this)),this.view.activate(t.getHardenedInstance()),n.subscribe(n.INVITING_REQUEST,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse)},processResponse:function(e){if(e.toJSON().stats&&e.get("responseHeader.params").sort){var t=e.get("stats.stats_fields.citation_count.sum");t=!!e.get("responseHeader.params.sort").match(/citation_count/)?t:void 0,this.model.set({citationCount:t})}},defaultQueryArguments:{stats:"true","stats.field":"citation_count",fl:"id"},focusInput:function(e){"index-page"==e&&this.view.$("input.q").focus()},handleFeedback:function(e){if(e.code===u.CODES.SEARCH_CYCLE_STARTED||e.code===u.CODES.SEARCH_CYCLE_FAILED_TO_START){var t=e.query?e.query:e.request.get("query"),n=t.get("__original_query")?t.get("__original_query")[0]:t.get("q").join(" ");this.setCurrentQuery(t),this.model.set({bigquerySource:t.get("__bigquerySource")?t.get("__bigquerySource")[0]:"Bulk query",bigquery:!!t.get("__qid"),numFound:e.numFound}),this.view.setFormVal(n)}},changeDefaultSort:function(t){if(!t.has("sort")){var n=t.get("q")[0],i=["trending(","instructive(","useful(","references(","reviews("],r=e.find(i,function(e){if(-1!==n.indexOf(e))return e});"references("==r?t.set("sort","first_author asc"):r?t.set("sort","score desc"):r||t.set("sort","date desc")}},navigate:function(e){this.getPubSub().publish(this.getPubSub().START_SEARCH,e)},openQueryAssistant:function(e){e&&this.view.setFormVal(e),this.view.$el.find(".show-form").click()},onShow:function(){this.view.$("input[name=q]").focus()},onDestroy:function(){this.view.queryBuilder.destroy(),this.view.destroy()}});return e.extend(E.prototype,g.BeeHive),E}),define("hbs!js/widgets/paper_search_form/form",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'        <div class="form-group">\n            <label for="#bibcode-textarea">List of Bibcodes</label>\n            <div class="s-light-font">\n                Enter Bibcodes (e.g. 1989ApJ...342L..71R), one per line.\n            </div>\n            <textarea class="form-control" name="" id="bibcode-textarea" cols="30" rows="12"></textarea>\n        </div>\n        <div class="form-group">\n            <div class="button-div pull-right" style="padding-top: 7px;">\n                <button class="btn clear"><fa class="fa fa-times"></fa> Clear</button>\n                <button class="btn btn-primary author-submit" disabled="true" type="submit"><i class="fa fa-search"></i> Search</button>\n            </div>\n        </div>\n'},3:function(e,t,n,i){return'        <b>List of Bibcodes Form</b>\n        <div style="padding-top:20px">\n            <a href="#user/account/login" class="btn btn-success"> <i class="fa fa-sign-in"></i> log in to ADS to use this form</a>\n        </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="row">\n\n    <form class="paper-form s-paper-form col-md-6 clearfix">\n        <div class="form-group">\n\n            <label for="pub-input">Publication </label>\n            <button class="btn btn-link" style="top:-3px;position:relative" type="button" data-toggle="collapse" data-target="#collapseExample" aria-expanded="false" aria-controls="collapseExample">\n                <span class="s-light-font">type publication name to find bibstem  <i class="fa fa-question-circle"/></span>\n            </button>\n            <div class="collapse" id="collapseExample">\n                <div class="well">\n                    A bibstem is an abbreviation that the ADS uses to identify a journal.\n                    <a href="http://adsabs.harvard.edu/abs_doc/journals1.html#">A full list is available here.</a>\n                    The input field below will autocomplete on the 500 most popular journal names, allowing you to type\n                    "Astrophysical Journal", for instance, to find the bibstem "AJ".\n                </div>\n            </div>\n            <input type="text" class="form-control" id="pub-input" data-term="bibstem" placeholder="e.g Astrophysical Journal">\n        </div>\n        <div class="form-group">\n            <label for="year-input">Year</label>\n            <input type="text" class="form-control" id="year-input" data-term="year">\n        </div>\n        <div class="form-group">\n            <label for="volume-input">Volume</label>\n            <input type="text" class="form-control" id="volume-input" data-term="volume">\n        </div>\n        <div class="form-group">\n            <label for="page-input">Page</label>\n            <input type="text" class="form-control" id="page-input" data-term = "page">\n        </div>\n        <div class="form-group">\n            <div class="button-div pull-right">\n                <button class="btn clear"><fa class="fa fa-times"></fa> Clear</button>\n                <button class="btn btn-primary author-submit" disabled="true" type="submit"><i class="fa fa-search"></i> Search</button>\n            </div>\n        </div>\n    </form>\n\n    <form class="bibcode-form col-md-6 clearfix">\n'+(null!=(r=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"    </form>\n\n\n</div>"},useData:!0});return t.registerPartial("js/widgets/paper_search_form/form",n),n}),define("js/widgets/paper_search_form/widget",["js/widgets/base/base_widget","js/components/api_query","js/components/api_feedback","hbs!js/widgets/paper_search_form/form","./topterms","jquery-ui"],function(e,t,n,i,r,a){var s=Backbone.Model.extend({defaults:function(){return{loggedIn:void 0}}}),o=Marionette.ItemView.extend({template:i,className:"paper-search-form",events:{"keyup .paper-form input":"checkPaperFormDisabled","click .paper-form button[type=submit]":"submitPaperForm","keyup .bibcode-form textarea":"checkBibcodeFormDisabled","click .bibcode-form button[type=submit]":"submitBibcodeForm"},onRender:function(e){this.$("#pub-input").autocomplete({source:r,minLength:2,autoFocus:!0})},checkPaperFormDisabled:function(){this.$("input:not(.parse-reference)").map(function(){return $(this).val()}).get().join("").match(/\w+/)?this.$(".paper-form button[type=submit]").prop("disabled",!1):this.$(".paper-form button[type=submit]").prop("disabled",!0)},checkBibcodeFormDisabled:function(){this.$(".bibcode-form textarea").val().match(/\w+/)?this.$(".bibcode-form button[type=submit]").prop("disabled",!1):this.$(".bibcode-form button[type=submit]").prop("disabled",!0)},submitPaperForm:function(e){this.$(".paper-form button[type=submit]").html('<i class="icon-loading"/>  Loading...');var t=this.$(".paper-form input:not(.parse-reference)").map(function(){var e=$(this);return e.val()?toReturn=e.data("term")+":"+e.val():toReturn=void 0,toReturn}).get();t=_.filter(t,function(e){if(e)return e}),this.trigger("submit",t.join(" ")),e.preventDefault()},submitBibcodeForm:function(e){e.preventDefault(),this.$(".bibcode-form button[type=submit]").html('<i class="icon-loading"/>  Loading...');var t=this.$(".bibcode-form textarea").val().split(/\s+/);t=_.filter(t,function(e){if(e)return e}),this.trigger("submit-bigquery",t)}});return FormWidget=e.extend({initialize:function(e){e=e||{},this.model=new s,this.view=new o({model:this.model}),this.listenTo(this.view,"submit",this.submitForm),this.listenTo(this.view,"submit-bigquery",this.submitBigQuery)},activate:function(e){this.setBeeHive(e)},submitForm:function(e){var n=new t({q:e});this.getPubSub().publish(this.getPubSub().START_SEARCH,n)},submitBigQuery:function(e){var n=new t({__bigquery:e});this.getPubSub().publish(this.getPubSub().START_SEARCH,n)},onShow:function(){var e=this.getBeeHive().getObject("User").isLoggedIn();this.model.set({loggedIn:e}),this.view.render(),this.view.$("input#pub-input").focus()}}),FormWidget}),define("hbs!js/widgets/list_of_things/templates/item-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" chosen "},3:function(e,t,n,i){return" checked "},5:function(e,t,n,i){var r;return'        <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?r:t.helperMissing)?r.call(e,{name:"encodedIdentifier",hash:{},data:i}):r)+'/citations" title="citation count">cited: '+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+"</a>\n"},7:function(e,t,n,i){var r;return'\n                <div class="letter-icon s-letter-icon">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.program(12,i,0),data:i}))?r:"")+'\n            </div>\n\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.program(17,i,0),data:i}))?r:"")+'\n            </div>\n            <div class="letter-icon s-letter-icon">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.program(22,i,0),data:i}))?r:"")+"\n            </div>\n"},8:function(e,t,n,i){var r;return'\n                        <a href="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.links:e)?r.text:r)?r[0]:r)?r.link:r,e))+'" target="_blank" class="btn-link active-link s-active-link" aria-disabled="false">\n                            <i class="s-text-icon" aria-label="quick access to full text links"></i>\n                        </a>\n                        <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"each",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+"                        </ul>\n\n"},9:function(e,t,n,i){var r;return"                            <li><a "+(null!=(r=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'"\n                                target="_blank">'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a></li>\n"},10:function(e,t,n,i){return' class="s-open-access"'},12:function(e,t,n,i){return'\n                    <div title="full text links (none)">\n                        <a href="#" class="btn-link disabled" aria-disabled="true" aria-label="full text links">\n                            <i class="s-text-icon" aria-hidden="true"></i>\n                        </a>\n                    </div>\n\n'},14:function(e,t,n,i){var r;return'\n                <a href="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.links:e)?r.list:r)?r[0]:r)?r.link:r,e))+'" class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-list-icon" aria-label="quick links to lists of references, citations and more"></i>\n                </a>\n\n                <ul class="hidden list-unstyled list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"each",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?r:"")+"                </ul>\n\n"},15:function(e,t,n,i){return'                    <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a></li>\n"},17:function(e,t,n,i){return'                <div title="references, citations (none)">\n                    <a href="#" class="btn-link disabled" aria-disabled="true" aria-label="quick links to lists of references, citations etc">\n                        <i class="s-list-icon" aria-hidden="true"></i>\n                    </a>\n                </div>\n\n\n'},19:function(e,t,n,i){var r;return'\n                <a href="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.links:e)?r.data:r)?r[0]:r)?r.link:r,e))+'" target="_blank"  class="btn-link active-link s-active-link" aria-disabled="false">\n                    <i class="s-data-icon" aria-label="quick links to data associated with this article"></i>\n                </a>\n\n                <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"each",hash:{},fn:this.program(20,i,0),inverse:this.noop,data:i}))?r:"")+"                </ul>\n\n"},20:function(e,t,n,i){var r;return"                    <li><a "+(null!=(r=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'" target="_blank"\n                        >'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a></li>\n"},22:function(e,t,n,i){return'                    <div title="data products (none)">\n                        <a href="#" class="btn-link disabled" aria-disabled="true" aria-label="quick links to data associated with this article">\n                            <i class="s-data-icon" aria-hidden="true"></i>\n                        </a>\n                    </div>\n\n'},24:function(e,t,n,i){var r;return'        <ul class="list-inline just-authors s-results-authors" aria-label="authors">\n'+(null!=(r=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(25,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(27,i,0),inverse:this.noop,data:i}))?r:"")+"        </ul>\n"},25:function(e,t,n,i){return'            <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},27:function(e,t,n,i){var r;return"            <li><em>and "+this.escapeExpression("function"==typeof(r=null!=(r=t.extraAuthors||(null!=e?e.extraAuthors:e))?r:t.helperMissing)?r.call(e,{name:"extraAuthors",hash:{},data:i}):r)+" more</em></li>\n"},29:function(e,t,n,i){return'            <span class="text-faded">no author information available</span>\n'},31:function(e,t,n,i){var r;return'<div class="row">\n    <div class="col-sm-10 col-sm-offset-1">\n        <div class="s-results-orcid-container">\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.pending:r,{name:"if",hash:{},fn:this.program(32,i,0),inverse:this.program(34,i,0),data:i}))?r:"")+" \x3c!--orcid.pending--\x3e\n    </div>\n\n</div>\n"},32:function(e,t,n,i){return'            <button class="btn btn-default btn-sm s-orcid-loading" aria-disabled="true">\n                <i class="fa fa-lg fa-spinner fa-pulse"></i> Working...\n            </button>\n'},34:function(e,t,n,i){var r;return"            \x3c!-- if provenance, it has been added by us or someone else--\x3e\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.provenance:r,{name:"if",hash:{},fn:this.program(35,i,0),inverse:this.program(49,i,0),data:i}))?r:"")+"\x3c!--orcid.provenance --\x3e\n            "},35:function(e,t,n,i){var r;return'\n            <div class="'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.program(38,i,0),data:i}))?r:"")+" s-orcid-alert s-orcid-provenance-"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.orcid:e)?r.provenance:r,e))+'" role="alert">\n                <div class="btn-group">\n                    <button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown"\n                            aria-expanded="false" '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(40,i,0),inverse:this.noop,data:i}))?r:"")+'>\n                        <img src="../../styles/img/orcid-active.svg" alt="orcid logo active" class="s-orcid-img"/> Actions <span class="caret"></span>\n                    </button>\n                    <ul class="dropdown-menu" role="menu">\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.orcid:e)?r.actions:r,{name:"each",hash:{},fn:this.program(42,i,0),inverse:this.noop,data:i}))?r:"")+"                        </li>\n                    </ul>\n                </div>\n\n                "+(null!=(r=t.if.call(e,null!=e?e.source_name:e,{name:"if",hash:{},fn:this.program(47,i,0),inverse:this.noop,data:i}))?r:"")+'\n                <span class="text-success s-orcid-success pull-right"> <i class="icon-success"></i>&nbsp;In ORCID&nbsp;</span>\n\n            </div>\n\n\n\n            '},36:function(e,t,n,i){return"alert-danger"},38:function(e,t,n,i){return"alert-success"},40:function(e,t,n,i){var r;return'title="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.orcid:e)?r.error:r,e))+'"'},42:function(e,t,n,i){var r;return'                        <li>\n\n                            <a class="orcid-action '+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'" data-action="'+this.escapeExpression(this.lambda(null!=e?e.action:e,e))+'"\n                               title="'+this.escapeExpression(this.lambda(null!=e?e.caption:e,e))+'">\n                                <i class="\n'+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-update",{name:"compare",hash:{},fn:this.program(43,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.action:e,"orcid-delete",{name:"compare",hash:{},fn:this.program(45,i,0),inverse:this.noop,data:i}))?r:"")+'                            "></i>\n                                '+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a>\n"},43:function(e,t,n,i){return"                            icon-reload-c\n"},45:function(e,t,n,i){return"                            icon-clear-c\n"},47:function(e,t,n,i){var r;return'<span class="s-orcid-source">('+this.escapeExpression("function"==typeof(r=null!=(r=t.source_name||(null!=e?e.source_name:e))?r:t.helperMissing)?r.call(e,{name:"source_name",hash:{},data:i}):r)+")</span>"},49:function(e,t,n,i){var r;return"\x3c!-- add this paper to ORCID--\x3e\n\n"+(null!=(r=t.if.call(e,null!=e?e.bibcode:e,{name:"if",hash:{},fn:this.program(50,i,0),inverse:this.program(55,i,0),data:i}))?r:"")+"\n\n            "},50:function(e,t,n,i){var r;return'            <button class="btn '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(51,i,0),inverse:this.program(53,i,0),data:i}))?r:"")+" btn-sm orcid-action "+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.orcid:e)?r.actions:r)?r.add:r)?r.action:r,e))+'"  data-action="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.orcid:e)?r.actions:r)?r.add:r)?r.action:r,e))+'" '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(40,i,0),inverse:this.noop,data:i}))?r:"")+'>\n               <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title="'+this.escapeExpression(this.lambda(null!=(r=null!=(r=null!=(r=null!=e?e.orcid:e)?r.actions:r)?r.add:r)?r.caption:r,e))+'"/>\n                Claim in ORCID\n            </button>\n'},51:function(e,t,n,i){return"btn-danger"},53:function(e,t,n,i){return"btn-default"},55:function(e,t,n,i){var r;return'            <button class="btn '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(51,i,0),inverse:this.program(53,i,0),data:i}))?r:"")+' btn-sm orcid-action"  data-action="orcid-view" '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.orcid:e)?r.error:r,{name:"if",hash:{},fn:this.program(40,i,0),inverse:this.noop,data:i}))?r:"")+'>\n                <img src="../../styles/img/orcid-inactive.svg" alt="orcid logo inactive" class="s-orcid-img" title=""/>\n                Record not known to ADS\n            </button>\n'},57:function(e,t,n,i){var r;return'        <div class="col-xs-10 col-xs-offset-1 s-more-info">\n'+(null!=(r=t.if.call(e,null!=e?e.highlights:e,{name:"if",hash:{},fn:this.program(58,i,0),inverse:this.noop,data:i}))?r:"")+"        </div>\n"},58:function(e,t,n,i){var r;return'                    <h4 class="sr-only">Search Highlights</h4>\n                    <ul aria-label="search snippets" class="s-search-snippets">\n'+(null!=(r=t.each.call(e,null!=e?e.highlights:e,{name:"each",hash:{},fn:this.program(59,i,0),inverse:this.noop,data:i}))?r:"")+"                    </ul>\n"},59:function(e,t,n,i){var r;return"                        <li>"+(null!=(r=this.lambda(e,e))?r:"")+"</li>\n"},61:function(e,t,n,i){var r;return'        <div class="col-xs-9 col-xs-offset-1 s-more-info">\n'+(null!=(r=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(62,i,0),inverse:this.noop,data:i}))?r:"")+"        </div>\n"},62:function(e,t,n,i){var r,a;return'                    <h4 aria-label="read full abstract below"><a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.identifier||(null!=e?e.identifier:e))?a:t.helperMissing)?a.call(e,{name:"identifier",hash:{},data:i}):a)+'">Abstract</a></h4>\n'+(null!=(r=t.if.call(e,null!=e?e.shortAbstract:e,{name:"if",hash:{},fn:this.program(63,i,0),inverse:this.program(65,i,0),data:i}))?r:"")},63:function(e,t,n,i){var r,a;return'\n                    <div class="short-abstract" aria-label="a truncated version of the abstract">\n                        '+(null!=(r="function"==typeof(a=null!=(a=t.shortAbstract||(null!=e?e.shortAbstract:e))?a:t.helperMissing)?a.call(e,{name:"shortAbstract",hash:{},data:i}):a)?r:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default show-full-abstract">more</button>\n                    </div>\n                    <div class="full-abstract hidden">\n                        '+(null!=(r="function"==typeof(a=null!=(a=t.abstract||(null!=e?e.abstract:e))?a:t.helperMissing)?a.call(e,{name:"abstract",hash:{},data:i}):a)?r:"")+'\n                        &nbsp; <button class="btn btn-xs btn-default hide-full-abstract">less</button>\n                    </div>\n'},65:function(e,t,n,i){var r,a;return"                        \x3c!--the abstract is short enough to be shown all at once--\x3e\n                        "+(null!=(r="function"==typeof(a=null!=(a=t.abstract||(null!=e?e.abstract:e))?a:t.helperMissing)?a.call(e,{name:"abstract",hash:{},data:i}):a)?r:"")+"\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div class="col-sm-12 '+(null!=(r=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'">\n<div class="row s-top-row">\n    <div class="col-xs-1 s-checkbox-col s-top-row-col">\n        <label>\n            '+this.escapeExpression("function"==typeof(a=null!=(a=t.indexToShow||(null!=e?e.indexToShow:e))?a:t.helperMissing)?a.call(e,{name:"indexToShow",hash:{},data:i}):a)+'\n            <input type="checkbox" value='+this.escapeExpression("function"==typeof(a=null!=(a=t.identifier||(null!=e?e.identifier:e))?a:t.helperMissing)?a.call(e,{name:"identifier",hash:{},data:i}):a)+' name="identifier" '+(null!=(r=t.if.call(e,null!=e?e.chosen:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'>\n        </label>\n    </div>\n\n    <div class="hidden-xs hidden-sm col-md-3 s-top-row-col identifier s-identifier">\n        <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/abstract" aria-label="bibcode">\n            '+this.escapeExpression("function"==typeof(a=null!=(a=t.identifier||(null!=e?e.identifier:e))?a:t.helperMissing)?a.call(e,{name:"identifier",hash:{},data:i}):a)+'\n        </a>\n    </div>\n    <div class="col-xs-2 col-md-2 col-md-offset-0 s-top-row-col" aria-label="date published">\n        '+this.escapeExpression("function"==typeof(a=null!=(a=t.formattedDate||(null!=e?e.formattedDate:e))?a:t.helperMissing)?a.call(e,{name:"formattedDate",hash:{},data:i}):a)+'\n    </div>\n    <div class="col-xs-3 col-sm-4 col-md-2 s-top-row-col">\n'+(null!=(r=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+'    </div>\n    <div class="col-xs-4 col-sm-4 pull-right">\n        <div class="s-results-links">\n\n'+(null!=(r=t.if.call(e,null!=e?e.links:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'      </div>\n    </div>\n\n</div>\n<div class="row">\n\n    <div class="col-xs-10 col-xs-offset-1">\n        <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.encodedIdentifier||(null!=e?e.encodedIdentifier:e))?a:t.helperMissing)?a.call(e,{name:"encodedIdentifier",hash:{},data:i}):a)+'/abstract">\n            <h3 class="s-results-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+'</h3>\n        </a>\n    </div>\n</div>\n\n<div class="row">\n    <div class="col-xs-10 col-xs-offset-1">\n'+(null!=(r=t.if.call(e,null!=e?e.authorFormatted:e,{name:"if",hash:{},fn:this.program(24,i,0),inverse:this.program(29,i,0),data:i}))?r:"")+"\n    </div>\n\n</div>\n\n"+(null!=(r=t.if.call(e,null!=e?e.orcid:e,{name:"if",hash:{},fn:this.program(31,i,0),inverse:this.noop,data:i}))?r:"")+'\n    <div class="row highlight-row">\n'+(null!=(r=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(57,i,0),inverse:this.noop,data:i}))?r:"")+'    </div>\n\n    <div class="row abstract-row">\n'+(null!=(r=t.if.call(e,null!=e?e.showAbstract:e,{name:"if",hash:{},fn:this.program(61,i,0),inverse:this.noop,data:i}))?r:"")+"    </div>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/item-template",n),n}),define("hbs!js/widgets/list_of_things/templates/pagination-partial",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <i class="icon-loading"></i>&nbsp;Loading more papers...\n'},3:function(e,t,n,i){var r;return'    <div class="col-sm-12 pagination-controls s-pagination-controls">\n        <div class="col-xs-5 per-page-container">\n'+(null!=(r=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'        </div>\n        <div class="col-xs-6">\n            <nav>\n                <ul class="pager">\n                    <li class="'+(null!=(r=t.unless.call(e,null!=(r=null!=e?e.pageData:e)?r.previousPossible:r,{name:"unless",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'"><a href="#" class="page-control previous-page"><i class="fa fa-chevron-circle-left"></i> prev</a></li>\n                    <input type="text" value="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.pageData:e)?r.currentPage:r,e))+'" class="form-control page-control" style="display:inline-block;width:60px"> of '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.pageData:e)?r.totalPages:r,e))+'\n                    <li class="'+(null!=(r=t.unless.call(e,null!=(r=null!=e?e.pageData:e)?r.nextPossible:r,{name:"unless",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+'"><a href="#" class="page-control next-page">next <i class="fa fa-chevron-circle-right"></i></a></li>\n                </ul>\n            </nav>\n\n        </div>\n    </div>\n'},4:function(e,t,n,i){var r;return'            per page:\n            <a href="#" class="btn btn-sm '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,25,{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?r:"")+' per-page">25</a>\n            <a href="#" class="btn btn-sm  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,50,{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?r:"")+' per-page">50</a>\n            <a href="#" class="btn btn-sm '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=(r=null!=e?e.pageData:e)?r.perPage:r,100,{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?r:"")+' per-page">100</a>\n'},5:function(e,t,n,i){return" per-page--active "},7:function(e,t,n,i){return" btn-link "},9:function(e,t,n,i){return" disabled "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="row">\n    <div class="col-sm-12 page-loading" style="text-align:center">\n'+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'    </div>\n</div>\n<div class="row">\n'+(null!=(r=t.if.call(e,null!=e?e.pageData:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"</div>"},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/pagination-partial",n),t.registerPartial("js/widgets/list_of_things/templates/pagination-partial",n),n}),define("hbs!js/widgets/list_of_things/templates/results-container-template",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'    <div>\n        <h4 class="s-list-description">'+this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)+"</h4>\n    </div>\n"},3:function(e,t,n,i){var r,a;return'    <div>\n        <h2 class="s-article-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+"</h2>\n    </div>\n"},5:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.citation_discrepancy:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:""},6:function(e,t,n,i){var r;return'        <div>\n           <i class="fa fa-exclamation-triangle"></i>\n            This list is missing <b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_discrepancy||(null!=e?e.citation_discrepancy:e))?r:t.helperMissing)?r.call(e,{name:"citation_discrepancy",hash:{},data:i}):r)+"</b> records, which could not be matched to papers in ADS.\n        </div>\n        <br>\n"},8:function(e,t,n,i){var r;return'        <div class="s-operator">\n            <a href="'+this.escapeExpression("function"==typeof(r=null!=(r=t.queryURL||(null!=e?e.queryURL:e))?r:t.helperMissing)?r.call(e,{name:"queryURL",hash:{},data:i}):r)+'" class="btn btn-sm btn-inverse btn-primary-faded"><i class="fa fa-search"></i> view this list in a search results page</a>\n         </div>\n'},10:function(e,t,n,i){var r;return null!=(r=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"         ",helpers:t,partials:n}))?r:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="s-list-controls">\n\n    <div class="s-results-border-bottom">\n\n        <div class="col-sm-1">\n        </div>\n\n        <div class="col-sm-6">\n        </div>\n\n        <div class="col-sm-4 sort-container">\n        </div>\n\n        <div class="col-sm-1"></div>\n\n</div>\n\n<div class="s-list-title">\n\n'+(null!=(r=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"\n    \x3c!--citation widget should show info if [citations] and citation_count don't match--\x3e\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.queryOperator:e,"citations",{name:"compare",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.queryOperator:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?r:"")+'\n</div>\n\n    <ul class="results-list  s-results-list list-unstyled s-display-block" aria-label="list of results"></ul>\n\n\n'+(null!=(r=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/results-container-template",n),n}),define("js/mixins/add_stable_index_to_collection",["underscore"],function(e){return{getPageStart:function(e,t,n){return n?Math.min(e*t,n):e*t},getPageEnd:function(e,t,n){var i=this.getPageStart(e,t)+t;return i>n?n:i},getPageVal:function(e,t){return Math.floor(e/t)},addPaginationToDocs:function(t,n){var i=e.isArray(n)?n[0]:parseInt(n);return e.each(t,function(e){e.resultsIndex=i,e.indexToShow=i+1,i+=1}),t}}}),define("js/widgets/list_of_things/model",["backbone","underscore","js/mixins/add_stable_index_to_collection"],function(e,t,n){var i=e.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,details:void 0,links_data:void 0,resultsIndex:void 0,visible:!1,actionsVisible:!0}},idAttribute:"resultsIndex"}),r=e.Collection.extend({initialize:function(e,t){this.numVisible=0,this.currentStartIndex=0,this.currentEndIndex=0,this.lastIndex=-1,this.lastMissingTrigger=null,t&&t.paginationModel&&(this.paginationModel=t.paginationModel,this.listenTo(this.paginationModel,"change:page",this._onPaginationChange),this.listenTo(this.paginationModel,"change:perPage",this._onPaginationChange))},model:i,numFound:void 0,comparator:"resultsIndex",_updateStartAndEndIndex:function(){var e=this.paginationModel.get("page"),t=this.paginationModel.get("perPage"),n=this.paginationModel.get("numFound");this.currentStartIndex=this.getPageStart(e,t),this.currentEndIndex=this.getPageEnd(e,t,n)},_onPaginationChange:function(){this._updateStartAndEndIndex(),this.trigger("pagination:change")},reset:function(){this.lastMissingTrigger=null,this.lastIndex=-1,e.Collection.prototype.reset.apply(this,arguments)},getStartIndex:function(){return this.currentStartIndex},getEndIndex:function(){return this.paginationModel.get("perPage")},_incrementLastIndex:function(){return this.lastIndex+=1,this.lastIndex},_prepareModel:function(t,n){return void 0===t.resultsIndex&&(t.resultsIndex=this._incrementLastIndex()),(t.title||t.bibcode||t.identifier)&&(t.emptyPlaceholder=!1),e.Collection.prototype._prepareModel.call(this,t,n)},getVisibleModels:function(){return t.filter(this.models,function(e){return e.attributes.visible})},updateIndexes:function(e,n){var i,e=t.isNumber(e)?e:this.currentStartIndex,n=t.isNumber(n)?n:this.currentEndIndex+1,r=0,a=null,s=0,o=[],l=null;if(this.each(function(c){i=c.attributes.resultsIndex,null!==l&&i!=l+1&&t.each(t.range(l+1,i),function(e){o.push(e)}),l=i,i>=e&&i<=n?(c.set("visible",!0),null===a&&(a=i),r+=1,s=i):c.set("visible",!1)}),r!==n-e+1&&t.each(t.range((l||e+o.length)+1,n+1),function(e){this.get(e)||o.push(e)},this),o.length){for(var c=0,u=o.length,d=0;d<o.length;d++){if(o[d]>n){u=d;break}o[d]<e&&(c=d+1)}o=o.slice(c,u),o=this._compressGaps(o),JSON.stringify(o)!=this.lastMissingTrigger&&(this.lastMissingTrigger=JSON.stringify(o),this.trigger("show:missing",o))}return this.numVisible=r,this.currentStartIndex=a||0,this.currentEndIndex=s,r},_compressGaps:function(e){for(var t=e[0],n=t,i=e.length,r=[],a=0;a<i;a++){for(var s=a+1;s<i&&e[s]==t+(s-a);)n=e[s],s+=1;r.push({start:t,end:n}),a=s-1,s<i&&(t=n=e[s])}return r},showRange:function(e,t){if(e<0)throw new Error("Start cannot be negative");if(t<e)throw new Error("End cannot be smaller than start");return this.updateIndexes(e,t)},getNumVisible:function(){return this.numVisible},showMore:function(e){if(null===e)return this.updateIndexes(0,this.model.length);var t=this.getNumVisible();return this.updateIndexes(this.currentStartIndex,0==this.currentEndIndex?e-1:this.currentEndIndex+e)-t}});return t.extend(r.prototype,n),r}),define("hbs!js/widgets/list_of_things/templates/empty-view-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="col-sm-12" style="padding:1% 0; text-align: center">\n    Nothing to display (yet...)\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/empty-view-template",n),n}),define("hbs!js/widgets/list_of_things/templates/initial-view-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return"Requesting data..."},useData:!0});return t.registerPartial("js/widgets/list_of_things/templates/initial-view-template",n),n}),define("js/widgets/list_of_things/item_view",["marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","analytics","mathjax"],function(e,t,n,i,r,a,s,o){return e.ItemView.extend({tagName:"li",template:a,constructor:function(t){return t&&_.defaults(t,_.pick(this,["model","collectionEvents","modelEvents"])),_.bindAll(this,"resetToggle"),e.ItemView.prototype.constructor.apply(this,arguments)},render:function(){return this.model.get("visible")?e.ItemView.prototype.render.apply(this,arguments):(this.$el&&this.$el.empty(),this)},onRender:function(){o&&o.Hub.Queue(["Typeset",o.Hub,this.el])},events:{"change input[name=identifier]":"toggleSelect","focus .letter-icon":"showLinks","mouseenter .letter-icon":"showLinks","mouseleave .letter-icon":"hideLinks","focusout .letter-icon":"hideLinks","click .letter-icon a":"emitAnalyticsEvent","click .show-full-abstract":"showFullAbstract","click .hide-full-abstract":"hideFullAbstract","click .orcid-action":"orcidAction"},modelEvents:{"change:visible":"render","change:showAbstract":"render","change:showHighlights":"render","change:orcid":"render","change:chosen":"render"},collectionEvents:{add:"render","change:visible":"render"},emitAnalyticsEvent:function(e){s("send","event","interaction","letter-link-followed",$(e.target).text())},showFullAbstract:function(){this.$(".short-abstract").addClass("hidden"),this.$(".full-abstract").removeClass("hidden")},hideFullAbstract:function(){this.$(".short-abstract").removeClass("hidden"),this.$(".full-abstract").addClass("hidden")},toggleSelect:function(){var e=!this.model.get("chosen");this.trigger("toggleSelect",{selected:e,data:this.model.attributes}),this.model.set("chosen",e)},resetToggle:function(){this.setToggleTo(!1)},setToggleTo:function(e){var t=$("input[name=identifier]");e?(this.$el.addClass("chosen"),this.model.set("chosen",!0),t.prop("checked",!0)):(this.$el.removeClass("chosen"),this.model.set("chosen",!1),t.prop("checked",!1))},removeActiveQuickLinkState:function(e){e.find("i").removeClass("s-icon-draw-attention"),e.find(".link-details").addClass("hidden"),e.find("ul").attr("aria-expanded",!1)},addActiveQuickLinkState:function(e){e.find("i").addClass("s-icon-draw-attention"),e.find(".link-details").removeClass("hidden"),e.find("ul").attr("aria-expanded",!0)},deactivateOtherQuickLinks:function(e){var t=this.$(".letter-icon").filter(function(){if($(this).find("i").hasClass("s-icon-draw-attention"))return!0}).eq(0);t.length&&t[0]!==e[0]&&this.removeActiveQuickLinkState(t)},showLinks:function(e){var t=$(e.currentTarget);t.find(".active-link").length&&(this.deactivateOtherQuickLinks(t),this.addActiveQuickLinkState(t))},hideLinks:function(e){var t=$(e.currentTarget);this.removeActiveQuickLinkState(t)},orcidAction:function(e){if(e){e.preventDefault(),e.stopPropagation();var t=$(e.currentTarget),n={action:t.data("action")?t.data("action"):t.text().trim(),model:this.model,view:this,target:t};this.trigger("OrcidAction",n)}}})}),define("js/widgets/list_of_things/paginated_view",["marionette","backbone","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/link_generator_mixin","js/mixins/add_stable_index_to_collection","hbs!js/widgets/list_of_things/templates/empty-view-template","hbs!js/widgets/list_of_things/templates/initial-view-template","./item_view","analytics","mathjax"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p){var f=t.Model.extend({defaults:function(){return{mainResults:!1,title:void 0,showAbstract:"closed",showHighlights:!1,pagination:!0,start:0}}});return e.CompositeView.extend({childView:d,initialize:function(t){this.EmptyViewClass=e.ItemView.extend({template:c}),this.InitialViewClass=e.ItemView.extend({template:u}),this.model=new f},serializeData:function(){var e=this.model.toJSON();return e.queryOperator&&(e.queryURL="#search/q="+e.queryOperator+"(",e.queryURL+=encodeURIComponent("bibcode:"+e.bibcode)+")",e.removeSelf&&(e.queryURL+=encodeURIComponent(" -bibcode:"+e.bibcode)),e.sortOrder&&(e.queryURL+="&sort="+encodeURIComponent(e.sortOrder))),e},onRender:function(){p&&p.Hub.Queue(["Typeset",p.Hub,this.el])},className:"list-of-things",alreadyRendered:!1,getEmptyView:function(){return this.alreadyRendered?this.EmptyViewClass:(this.alreadyRendered=!0,this.InitialViewClass)},childViewContainer:".results-list",events:{"click .show-highlights":"toggleHighlights","click .show-abstract":"toggleAbstract","click a.page-control":"changePageWithButton","keyup input.page-control":"tabOrEnterChangePageWithInput","click .per-page":"changePerPage"},toggleHighlights:function(){"open"==this.model.get("showHighlights")?this.model.set("showHighlights","closed"):"closed"==this.model.get("showHighlights")&&this.model.set("showHighlights","open")},toggleAbstract:function(){"open"==this.model.get("showAbstract")?this.model.set("showAbstract","closed"):"closed"==this.model.get("showAbstract")&&(this.model.set("showAbstract","open"),h("send","event","interaction","abstracts-toggled-on"))},modelEvents:{change:"render","change:showHighlights":"toggleChildrenHighlights","change:showAbstract":"toggleChildrenAbstracts"},collectionEvents:{reset:"resetViewModel"},template:s,resetViewModel:function(){var e=this.model.defaults();this.model.set({showAbstract:e.showAbstract,showHighlights:e.showHighlights})},toggleChildrenHighlights:function(){var e="open"===this.model.get("showHighlights");this.collection.each(function(t){t.set("showHighlights",e)})},toggleChildrenAbstracts:function(){var e="open"===this.model.get("showAbstract");this.collection.each(function(t){t.set("showAbstract",e)})},changePageWithButton:function(e){e.preventDefault();var t=$(e.currentTarget);if(!t.parent().hasClass("disabled")){var n=t.hasClass("next-page")?1:-1,i=this.model.get("page")+n;this.trigger("pagination:select",i),this.resultsWidget&&h("send","event","interaction","results-list-pagination",i)}},tabOrEnterChangePageWithInput:function(e){var t=parseInt($(e.target).val()-1);13!=e.keyCode&&9!=e.keyCode||this.trigger("pagination:select",t),this.resultsWidget&&h("send","event","interaction","results-list-pagination",t)},changePerPage:function(e){e.preventDefault();var t=parseInt($(e.target).text().trim());t!==this.model.get("perPage")&&this.trigger("pagination:changePerPage",t)}})}),define("js/widgets/list_of_things/widget",["marionette","backbone","js/components/api_request","js/components/api_query","js/components/api_feedback","js/widgets/base/base_widget","hbs!js/widgets/list_of_things/templates/item-template","hbs!js/widgets/list_of_things/templates/results-container-template","js/mixins/add_stable_index_to_collection","./model","./paginated_view"],function(e,t,n,i,r,a,s,o,l,c,u){var d=a.extend({initialize:function(e){e=e||{},_.defaults(e,_.pick(this,["view","collection","pagination","model","description","childView"])),this.pagination={pagination:!0,perPage:25,numFound:void 0,currentQuery:void 0,start:0,pageData:void 0},e.collection=e.collection||new c,e.view||(e.view=new u({collection:e.collection,model:e.model,childView:e.childView})),e.view.model.set(this.pagination,{silent:!0}),e.view.model.set({sortOrder:e.sortOrder,removeSelf:e.removeSelf,queryOperator:e.queryOperator,description:e.description},{silent:!0}),_.extend(this,{model:e.view.model,view:e.view}),this.hiddenCollection=new c,this.listenTo(this.hiddenCollection,"all",this.onAllInternalEvents),this.listenTo(this.view,"all",this.onAllInternalEvents),this.on("all",this.onAllInternalEvents),a.prototype.initialize.call(this,e)},activate:function(e){if(this.setBeeHive(e),_.bindAll(this,["updatePaginationPreferences"]),this.getPubSub().subscribe(this.getPubSub().USER_ANNOUNCEMENT,this.updatePaginationPreferences),this.getBeeHive().getObject("User")&&this.getBeeHive().getObject("User").getLocalStorage){var t=this.getBeeHive().getObject("User").getLocalStorage().perPage;t&&(this.pagination.perPage=t,this.model.set(this.pagination))}},updatePaginationPreferences:function(e,t){"user_info_change"==e&&t.perPage&&t.perPage!==this.pagination.perPage&&this.updatePagination({perPage:t.perPage})},processResponse:function(e){var t=this.extractDocs(e),n=this.getPaginationInfo(e,t);(t=this.processDocs(e,t,n))&&t.length&&(this.hiddenCollection.add(t,{merge:!0}),n.showRange&&(this.model.set(n),this.hiddenCollection.showRange(n.showRange[0],n.showRange[1])),this.view.collection.reset(this.hiddenCollection.getVisibleModels())),this.trigger("page-manager-event","widget-ready",{numFound:e.has("response.numFound")?e.get("response.numFound"):this.hiddenCollection.length}),this.model.get("perPage")===this.collection.length||this.hiddenCollection.length===e.get("response.numFound")?this.model.set("loading",!1):this.model.set("loading",!0)},extractDocs:function(e){var t=e.get("response.docs");return t=_.map(t,function(e){return e.identifier=e.bibcode,e})},getPaginationInfo:function(e,t){var n=e.getApiQuery(),i=e.get("response.numFound")||0,r=this.model.get("perPage")||(n.has("rows")?n.get("rows")[0]:10),a=this.model.get("start")||0,s=l.getPageVal(a,r),o=[s*r,(s+1)*r-1];return n.has("__fetch_missing")?{start:a,showRange:o}:{numFound:i,perPage:r,start:a,page:s,showRange:o,pageData:this._getPaginationData(s,r,i),currentQuery:n}},_getPaginationData:function(e,t,n){return{perPage:t,totalPages:Math.ceil(n/t),currentPage:e+1,previousPossible:e>0,nextPossible:(e+1)*t<n}},processDocs:function(e,t,n){if(!e.has("response"))return[];var i=e.get("response").start||n.start||0;return t=l.addPaginationToDocs(t,i)},defaultQueryArguments:{fl:"id",start:0},updateLocalStorage:function(e){e.hasOwnProperty("perPage")&&_.contains([25,50,100],e.perPage)&&(this.getBeeHive().getObject("User").setLocalStorage({perPage:e.perPage}),console.log("set user's page preferences in localStorage: "+e.perPage))},updatePagination:function(e){var t,n=e.numFound||this.model.get("numFound"),a=e.currentQuery||this.model.get("currentQuery")||new i,s=e.perPage||this.model.get("perPage");if(e.perPage&&!e.hasOwnProperty("page")&&(e.page=0),void 0!==e.page){if(e.hasOwnProperty("page")&&(!_.isNumber(e.page)||isNaN(e.page))){var o=this.getPubSub();return void o.publish(o.ALERT,new r({code:r.CODES.ALERT,msg:"Please enter a page number between 1 and "+Math.ceil(n/s),type:"danger",modal:!0}))}t=e.page<0?0:e.page>Math.ceil(n/s)-1?Math.ceil(n/s)-1:parseInt(e.page)}else t=null;var c=this.getPageStart(t,s,n);if(null===t&&this.collection.length){var u=this.collection.models[0].get("resultsIndex");t=l.getPageVal(u,s)}null===t&&(t=l.getPageVal(this.model.get("start"),s));var d=this._getPaginationData(t,s,n),h=[t*s,t*s+s-1];this.pagination.perPage=s,this.model.set({start:c,perPage:s,page:t,numFound:n,pageData:d,currentQuery:a,showRange:h}),this.view.render(),this.hiddenCollection.showRange(h[0],h[1]),this.collection.reset(this.hiddenCollection.getVisibleModels()),document.body.scrollTop=document.documentElement.scrollTop=0},onAllInternalEvents:function(e,t,n){try{var i=this.getPubSub()}catch(e){}if("pagination:changePerPage"===e)this.updateLocalStorage({perPage:t});else{if("pagination:select"===e)return this.updatePagination({page:t});"show:missing"===e?_.each(t,function(e){var t=this.model.get("numFound"),n=e.start;this.model.get("perPage");if(!(n>=t)){var i=this.model.get("currentQuery").clone();i.set("__fetch_missing","true"),i.set("start",n),i.set("rows",25);var r=this.composeRequest(i);this.executeRequest(r)}},this):"childview:toggleSelect"==e&&i.publish(i.PAPER_SELECTION,n.data.identifier)}},executeRequest:function(e){this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,e)},reset:function(){this.collection.reset(),this.hiddenCollection.reset(),this.model.set(_.defaults(this.pagination,this.model.defaults()))}});return _.extend(d.prototype,l),d}),define("hbs!js/widgets/abstract/templates/abstract_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'<a target="prev">prev</a>'},3:function(e,t,n,i){return' <a target="next">next</a>'},5:function(e,t,n,i){return'\n    <h2 class="s-abstract-title">Abstract Not Found</h2>\n    <div class="s-abstract-text">\n        No valid abstract selected for retrieval or abstract not yet indexed in ADS.\n    </div>\n'},7:function(e,t,n,i){var r,a;return'\n<h2 class="s-abstract-title">\n    '+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+'\n    <a href="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.titleLink:e)?r.href:r,e))+'">'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.titleLink:e)?r.text:r,e))+"</a>\n</h2>\n\n\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.authorAff:e)?r.length:r,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?r:"")+'\n<div class="s-abstract-text">\n    <h4 class="sr-only">Abstract</h4>\n    <p>\n'+(null!=(r=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.program(27,i,0),data:i}))?r:"")+'    </p>\n</div>\n\n<br>\n<dl class="s-abstract-dl-horizontal">\n\n'+(null!=(r=t.if.call(e,null!=e?e.pub_raw:e,{name:"if",hash:{},fn:this.program(29,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.formattedDate:e,{name:"if",hash:{},fn:this.program(31,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.doi:e,{name:"if",hash:{},fn:this.program(33,i,0),inverse:this.noop,data:i}))?r:"")+"\n    <dt>Bibcode</dt>\n    <dd>"+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+' <i class="icon-help" data-toggle="popover" data-content="The bibcode is assigned by the ADS as a unique identifier for the paper."></i></dd>\n\n'+(null!=(r=t.if.call(e,null!=e?e.keyword:e,{name:"if",hash:{},fn:this.program(35,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n</dl>\n\n\n"},8:function(e,t,n,i){var r;return(null!=(r=t.if.call(e,null!=e?e.hasAffiliation:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.hasMoreAuthors:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'\n<div id="authors-and-aff" class="s-authors-and-aff">\n    <ul class="list-inline">\n'+(null!=(r=t.each.call(e,null!=e?e.authorAff:e,{name:"each",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.hasMoreAuthors:e,{name:"if",hash:{},fn:this.program(18,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.each.call(e,null!=e?e.authorAffExtra:e,{name:"each",hash:{},fn:this.program(20,i,0),inverse:this.noop,data:i}))?r:"")+"    </ul>\n</div>\n"},9:function(e,t,n,i){return'<button class="btn btn-xs btn-default-flat s-toggle-aff" id="toggle-aff">Show affiliations</button>\n'},11:function(e,t,n,i){return'<button class="btn btn-xs btn-default-flat s-toggle-authors" id="toggle-more-authors">Show all authors</button>\n'},13:function(e,t,n,i){var r;return null!=(r=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(14,i,0),inverse:this.program(16,i,0),data:i}))?r:""},14:function(e,t,n,i){return'        <li class="author"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span></li>\n"},16:function(e,t,n,i){return'        <li class="author"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span>;</li>\n"},18:function(e,t,n,i){return'        <li class="author extra-dots">; <a data-target="more-authors" title="Show all authors">...</a></li>\n'},20:function(e,t,n,i){var r;return null!=(r=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.program(23,i,0),data:i}))?r:""},21:function(e,t,n,i){return'        <li class="author extra hide"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span></li>\n"},23:function(e,t,n,i){return'        <li class="author extra hide"><a href="#search/q=author:'+this.escapeExpression(this.lambda(null!=e?e[2]:e,e))+'&sort=date%20desc,%20bibcode%20desc">'+this.escapeExpression(this.lambda(null!=e?e[0]:e,e))+'</a><span class="affiliation hide"> (<i>'+this.escapeExpression(this.lambda(null!=e?e[1]:e,e))+"</i>)</span>;</li>\n"},25:function(e,t,n,i){var r,a;return"        "+(null!=(r="function"==typeof(a=null!=(a=t.abstract||(null!=e?e.abstract:e))?a:t.helperMissing)?a.call(e,{name:"abstract",hash:{},data:i}):a)?r:"")+"\n"},27:function(e,t,n,i){return"        <i>No abstract</i>\n"},29:function(e,t,n,i){var r,a;return'    <dt>Publication</dt>\n    <dd>\n        <div id="article-publication">'+(null!=(r="function"==typeof(a=null!=(a=t.pub_raw||(null!=e?e.pub_raw:e))?a:t.helperMissing)?a.call(e,{name:"pub_raw",hash:{},data:i}):a)?r:"")+"</div>\n    </dd>\n"},31:function(e,t,n,i){var r;return"    <dt>Pub Date:</dt>\n    <dd>"+this.escapeExpression("function"==typeof(r=null!=(r=t.formattedDate||(null!=e?e.formattedDate:e))?r:t.helperMissing)?r.call(e,{name:"formattedDate",hash:{},data:i}):r)+"</dd>\n"},33:function(e,t,n,i){var r;return'    <dt>DOI:</dt>\n    <dd><a href="'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.doi:e)?r.href:r,e))+'" target="_blank">'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.doi:e)?r.doi:r,e))+"</a></dd>\n"},35:function(e,t,n,i){var r;return'    <div id="keywords">\n        <dt>Keywords</dt>\n        <dd>\n            <ul class="list-inline">\n'+(null!=(r=t.each.call(e,null!=e?e.keyword:e,{name:"each",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?r:"")+"            </ul>\n        </dd>\n    </div>\n"},36:function(e,t,n,i){var r;return null!=(r=t.if.call(e,i&&i.last,{name:"if",hash:{},fn:this.program(37,i,0),inverse:this.program(39,i,0),data:i}))?r:""},37:function(e,t,n,i){var r;return"                <li>"+(null!=(r=this.lambda(e,e))?r:"")+"</li>\n"},39:function(e,t,n,i){var r;return"                <li>"+(null!=(r=this.lambda(e,e))?r:"")+";</li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\x3c!--<div id="article-navigation">'+(null!=(r=t.if.call(e,null!=e?e.hasPrev:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"|"+(null!=(r=t.if.call(e,null!=e?e.hasNext:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"</div>--\x3e\n\n"+(null!=(r=t.unless.call(e,null!=e?e.bibcode:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.program(7,i,0),data:i}))?r:"")+"\n\n"},useData:!0});return t.registerPartial("js/widgets/abstract/templates/abstract_template",n),n}),define("js/mixins/papers_utils",["underscore","jquery-ui","jquery"],function(e,t,n){return{formatDate:function(t,i){if(i&&!e.isObject(i))throw new Error("format must be an object of string formats");var r,a,s,o=["day","month"];if(s=(i=e.defaults(i||{},{format:"yy/mm/dd",missing:{day:"yy/mm",month:"yy"},separator:"-",junk:"-00"})).format,a=new Date(t),e.isNaN(a.getYear())){for(var l=0,c=t,u=i.junk;c.indexOf(u)>-1;){c=c.substring(0,c.lastIndexOf(u));try{if(a=new Date(c),!e.isNaN(a.getYear())&&!(s=i.missing[o[l]]))throw new Error("format is missing: "+o[l])}catch(e){}l+=1}if(e.isNaN(a.getYear()))throw new Error("Error parsing input: "+t)}else{var d=i.separator;if(t.indexOf(d)>-1){var h=t.split(d);if(2==h.length?s=i.missing[o[0]]:1==h.length&&(s=i.missing[o[1]]),!s)throw new Error("format is missing: missing."+o[l])}}return r=new Date(a.getTime()+6e4*a.getTimezoneOffset()),n.datepicker.formatDate(s,r)},shortenAbstract:function(e,t){if(t=t||300,!(e.length<=t)){var n=e.slice(0,t).lastIndexOf(" ");return e.slice(0,n+1)+"..."}},prepareDocForViewing:function(t){var n;if(t.author&&t.author.length>3?(t.extraAuthors=t.author.length-3,n=t.author.slice(0,3)):t.author&&(n=t.author),t.author){var i=n.length-1;t.authorFormatted=e.map(n,function(e,t){return t==i||0==i?e:e+";"})}return t.formattedDate=t.formattedDate||(t.pubdate?this.formatDate(t.pubdate):void 0),t.shortAbstract=t.abstract?this.shortenAbstract(t.abstract):void 0,t.details=t.details||{shortAbstract:t.shortAbstract,pub:t.pub,abstract:t.abstract},t.num_citations=t["[citations]"]?t["[citations]"].num_citations:void 0,t.identifier=t.bibcode,t.encodedIdentifier=encodeURIComponent(t.identifier),(t.pubdate||t.shortAbstract)&&(t.popover=!0),this.model&&(t.orderNum=this.model.get("resultsIndex")+1),t}}}),define("js/widgets/abstract/widget",["marionette","backbone","jquery","underscore","cache","js/widgets/base/base_widget","hbs!js/widgets/abstract/templates/abstract_template","js/components/api_query","js/mixins/link_generator_mixin","js/mixins/papers_utils","mathjax","bootstrap"],function(e,t,n,i,r,a,s,o,l,c,u,d){var h=t.Model.extend({defaults:function(){return{abstract:void 0,title:void 0,authorAff:void 0,page:void 0,pub:void 0,pubdate:void 0,keywords:void 0,bibcode:void 0,pub_raw:void 0,doi:void 0,citation_count:void 0,titleLink:void 0}},parse:function(e,t){var t=t||20;if(e.doi&&(e.doi={doi:e.doi,href:l.adsUrlRedirect("doi",e.doi)}),e.aff=e.aff||[],e.aff.length?(e.hasAffiliation=i.without(e.aff,"-").length,e.authorAff=i.zip(e.author,e.aff)):e.author&&(e.hasAffiliation=!1,e.authorAff=i.zip(e.author,i.range(e.author.length))),e.page&&e.page.length&&(e.page=e.page[0]),e.authorAff&&(i.each(e.authorAff,function(t,n){e.authorAff[n][2]=encodeURIComponent('"'+t[0]+'"').replace(/%20/g,"+")}),e.authorAff.length>t&&(e.authorAffExtra=e.authorAff.slice(t,e.authorAff.length),e.authorAff=e.authorAff.slice(0,t)),e.hasMoreAuthors=e.authorAffExtra&&e.authorAffExtra.length),e.pubdate&&(e.formattedDate=c.formatDate(e.pubdate,{format:"MM d yy",missing:{day:"MM yy",month:"yy"}})),e.title&&e.title.length){e.title=e.title[0];var n=e.title.match(/<a.*href="(.*?)".*?>(.*)<\/a>/i);n&&(e.title=e.title.replace(n[0],"").trim(),e.titleLink={href:n[1],text:n[2]},e.titleLink.href.match(/^\/abs/)&&(e.titleLink.href="#"+e.titleLink.href.slice(1)))}return e}}),p=e.ItemView.extend({tagName:"article",className:"s-abstract-metadata",modelEvents:{change:"render"},template:s,events:{"click #toggle-aff":"toggleAffiliation","click #toggle-more-authors":"toggleMoreAuthors",'click a[data-target="more-authors"]':"toggleMoreAuthors",'click a[target="prev"]':"onClick",'click a[target="next"]':"onClick"},toggleMoreAuthors:function(e){e&&e.stopPropagation(),this.$(".author.extra").toggleClass("hide"),this.$(".author.extra-dots").toggleClass("hide"),this.$(".author.extra").hasClass("hide")?this.$("#toggle-more-authors").text("Show all authors"):this.$("#toggle-more-authors").text("Hide authors")},toggleAffiliation:function(e){e&&e.preventDefault(),this.$(".affiliation").toggleClass("hide"),this.$(".affiliation").hasClass("hide")?this.$("#toggle-aff").text("Show affiliations"):this.$("#toggle-aff").text("Hide affiliations")},onClick:function(e){e.preventDefault(),this.trigger(n(e.target).attr("target"))},onRender:function(){this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0}),u&&u.Hub.Queue(["Typeset",u.Hub,this.el]),document.title=n("<div>"+this.model.get("title")+"</div>").text()}});return a.extend({initialize:function(e){e=e||{},this.model=e.data?new h(e.data,{parse:!0}):new h,this.view=new p({model:this.model}),this.listenTo(this.view,"all",this.onAllInternalEvents),a.prototype.initialize.apply(this,arguments),this._docs={},this.maxAuthors=20},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");i.bindAll(this,["onNewQuery","dispatchRequest","processResponse","onDisplayDocuments"]),t.subscribe(t.START_SEARCH,this.onNewQuery),t.subscribe(t.INVITING_REQUEST,this.dispatchRequest),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments)},defaultQueryArguments:{fl:"title,abstract,bibcode,author,keyword,id,citation_count,[citations],pub,aff,volume,pubdate,doi,pub_raw,page",rows:40},mergeStashedDocs:function(e){i.each(e,function(e){this._docs[e.bibcode]||(this._docs[e.bibcode]=this.model.parse(e))},this)},onNewQuery:function(e){var t=e.toJSON(),n=i.pick(this.getCurrentQuery().toJSON(),i.keys(t));JSON.stringify(t)!=JSON.stringify(n)&&(this._docs={})},dispatchRequest:function(e){this.setCurrentQuery(e),a.prototype.dispatchRequest.apply(this,arguments)},displayBibcode:function(e){this.model.clear({silent:!0}),this.model.set(this._docs[e]),this._current=e;var t=this._docs[e]["[citations]"],n=t?t.num_citations:0;this.trigger("page-manager-event","broadcast-payload",{title:this._docs[e].title,bibcode:e,citation_discrepancy:this._docs[e].citation_count-n,citation_count:this._docs[e].citation_count})},onDisplayDocuments:function(e){this.mergeStashedDocs(this.getBeeHive().getObject("DocStashController").getDocs());var t;if((n=e.get("q")).length>0&&n[0].indexOf("bibcode:")>-1)var n=n[0].replace("bibcode:","");if(this._docs[n])this.displayBibcode(n);else{if(e.has("__show"))return;(t=e.clone()).set("__show",n),this.dispatchRequest(t)}},onAllInternalEvents:function(e){if(("next"==e||"prev"==e)&&this._current){var t=i.keys(this._docs),n=this.getPubSub(),r=i.indexOf(t,this._current);r>-1&&("next"==e&&r+1<t.length?n.publish(n.DISPLAY_DOCUMENTS,t[r+1]):r-1>0&&n.publish(n.DISPLAY_DOCUMENTS,t[r-1]))}},processResponse:function(e){var t,n,r=e.toJSON();r.response&&r.response.docs&&(i.each(r.response.docs,function(e){t=this.model.parse(e,this.maxAuthors),this._docs[t.bibcode]=t},this),e.has("responseHeader.params.__show")&&(n=e.get("responseHeader.params.__show"),this.displayBibcode(n))),this.trigger("page-manager-event","widget-ready",{numFound:e.get("response.numFound")})}})}),define("hbs!js/widgets/results/templates/container-template",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.showHighlights:e,"open",{name:"compare",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?r:""},2:function(e,t,n,i){return'                    <button class="btn  btn-primary  btn-sm show-highlights"> Hide highlights</button>\n'},4:function(e,t,n,i){return'                    <button class="btn btn-primary btn-sm btn-inverse show-highlights"> Show highlights</button>\n'},6:function(e,t,n,i){return'                <button class="btn show-abstract btn-sm btn-primary"> Hide abstracts</button>\n'},8:function(e,t,n,i){return'                <button class="btn show-abstract btn-sm btn-inverse btn-primary"> Show abstracts</button>\n'},10:function(e,t,n,i){var r,a;return'    <div class="col-sm-12">\n        <h2 class="s-article-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+"</h2>\n    </div>\n"},12:function(e,t,n,i){var r;return null!=(r=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"        ",helpers:t,partials:n}))?r:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="s-results-widget results-widget">\n<div class="row s-list-controls">\n\n    <div class="s-results-border-bottom">\n\n        <div class="col-xs-1 s-checkbox-col">\n            <label for="#select-all-docs" class="sr-only">\n               select all on this page\n            </label>\n            <input title="select all on this page" type="checkbox" id="select-all-docs"/>\n        </div>\n\n        <div class="col-xs-6">\n\n\n            <div class="s-show-details-container">\n'+(null!=(r=t.if.call(e,null!=e?e.showHighlights:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.showAbstract:e,"open",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+'            </div>\n\n        </div>\n\n\n        <div class="col-xs-2 sort-container">\n\n        </div>\n\n        <div class="col-xs-3">\n\n        </div>\n\n    </div>\n\n</div>\n\n<div class="row">\n    <h2 class="sr-only">Search Results</h2>\n\n\n'+(null!=(r=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+'    <ul class="col-sm-12 results-list  s-results-list list-unstyled s-display-block" aria-label="list of results">\n    </ul>\n\n</div>\n'+(null!=(r=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/results/templates/container-template",n),n}),define("js/modules/orcid/extension",["underscore","js/components/api_query","js/components/api_request","js/components/api_query_updater","js/components/api_targets","js/mixins/dependon"],function(e,t,n,i,r){return function(a){var s=new i("OrcidExtension"),o=a.prototype.processDocs,l=a.prototype.activate,c=a.prototype.onAllInternalEvents;return a.prototype.activate=function(e){this.setBeeHive(e),l.apply(this,arguments);e.getService("OrcidApi")},a.prototype._getOrcidInfo=function(e){var t={actions:{},provenance:null};return e.isCreatedByOthers&&e.isCreatedByUs?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"},t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):e.isCreatedByOthers&&!e.isCreatedByUs?(t.actions.add={title:"add ADS version ORCID",caption:"ORCID already has a record for this article (we don't have rights to update it).",action:"orcid-add"},t.actions.view={title:"view in ORCID",caption:"Another version exists (we don't have rights to update it)",action:"orcid-view"}):!e.isCreatedByOthers&&e.isCreatedByUs?(t.actions.update={title:"update in ORCID",caption:"Update ADS version with latest data",action:"orcid-update"},t.actions.delete={title:"delete from ORCID",caption:"Delete ADS version from ORCID",action:"orcid-delete"}):t.actions.add={title:"add to ORCID",caption:"Add ADS version to ORCID",action:"orcid-add"},e.isCreatedByUs&&e.isCreatedByOthers?t.provenance="ads":e.isCreatedByUs?t.provenance="ads":e.isCreatedByOthers?t.provenance="others":t.provenance=null,t},a.prototype.addOrcidInfo=function(t){var n=this,i=this.getBeeHive().getService("OrcidApi");if(!i||!i.hasAccess())return t;var r,a=0;return e.each(t,function(t){"pending"==(r=i.getRecordInfo(t)).state()?(a+=1,r.done(function(e){a-=1;var i=n._getOrcidInfo(e);if(n.collection&&n.collection.findWhere){var r=n.collection.findWhere({bibcode:t.bibcode});r&&r.set("orcid",i)}0==a&&n.trigger("orcid-update-finished")}),r.fail(function(i){if(a-=1,n.collection&&n.collection.findWhere){var r=n.collection.findWhere({bibcode:t.bibcode});if(r){var s=e.extend({},r.get("orcid")||{});delete s.pending,s.error="Orcid API reported error",r.set("orcid",s)}}0==a&&n.trigger("orcid-update-finished")}),t.orcid={pending:!0}):r.done(function(e){t.orcid=n._getOrcidInfo(e),!t.identifier&&e.bibcode&&(t.identifier=e.bibcode)})}),0==a&&n.trigger("orcid-update-finished",t),t},a.prototype.processDocs=function(t,n,i){var n=o.apply(this,arguments),r=this.getBeeHive().getObject("User");if(r&&r.isOrcidModeOn()||this.orcidWidget){var a=this.addOrcidInfo(n);return i.numFound!=a.length&&e.extend(i,this.getPaginationInfo(t,n)),a}return n},a.prototype.mergeADSAndOrcidData=function(i){var a=this,o=$.Deferred();if(i.get("bibcode")&&i.get("source_name"))return o.resolve(i),o.promise();if(i.get("source_name")){var l,c;l=new t({q:"identifier:"+s.quoteIfNecessary(i.get("identifier")),fl:"title,abstract,bibcode,author,keyword,id,links_data,property,pub,aff,email,volume,pubdate,doi"}),c=new n({query:l,target:r.SEARCH,options:{done:function(t){if(t.response&&t.response.docs&&t.response.docs[0]){var n=i.attributes.source_name?i.attributes.source_name+"; NASA ADS":"NASA ADS";i.attributes=e.extend(i.attributes,t.response.docs[0],{source_name:n})}o.resolve(i)},fail:function(){o.fail()}}}),a.getPubSub().publish(a.getPubSub().EXECUTE_REQUEST,c)}else a.getBeeHive().getService("OrcidApi").getOrcidProfileInAdsFormat().done(function(t){e.each(t.response.docs,function(t){t.bibcode&&t.bibcode==i.attributes.bibcode&&(i.attributes=e.defaults(i.attributes,t))}),o.resolve(i)}).fail(function(){o.fail()});return o.promise()},a.prototype.onAllInternalEvents=function(t,n,i){if("childview:OrcidAction"!=t)return c.apply(this,arguments);var r=this,a=i,s=this.getBeeHive().getService("OrcidApi"),o=function(t,n){r.mergeADSAndOrcidData(n).done(function(n){var i=e.clone(n.get("orcid")||{});n.set("orcid",{pending:!0}),s.updateOrcid(t,a.model.attributes).done(function(e){if("delete"==t){var i=n.attributes.source_name.split("; ");i.indexOf("NASA ADS")>-1&&i.splice(i.indexOf("NASA ADS"),1),n.attributes.source_name=i.join("; ")}else n.set(n.attributes,{silent:!0});n.set("orcid",r._getOrcidInfo(e)),"delete"==t&&n.get("source_name")||r.trigger("orcidAction:"+t,n)}).fail(function(){n.set("orcid",e.extend(i,{pending:null,error:"Error updaing record, please retry"}))})}).fail(function(){console.log("Failed merging data, we need to handle this error");var t=e.clone(n.get("orcid"));t.error="Failed merging ORCID data with ADS data",delete t.pending,n.set("orcid",t)})},l=a.action;if(l.indexOf("add")>-1)o("add",a.model);else if(l.indexOf("delete")>-1)o("delete",a.model);else if(l.indexOf("update")>-1)o("update",a.model);else if(l.indexOf("view")>-1)console.log("Viewing of individual records not implemented (by ORCID)");else if(l.indexOf("login")>-1)s.signIn();else{if(!(l.indexOf("logout")>-1))throw new Error("Unknown action: "+l);s.signOut()}},a}}),define("js/widgets/results/widget",["js/widgets/list_of_things/widget","js/widgets/abstract/widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/formatter","hbs!js/widgets/results/templates/container-template","js/mixins/papers_utils","js/modules/orcid/extension","js/mixins/dependon","analytics"],function(e,t,n,i,r,a,s,o,l,c){var u=e.extend({initialize:function(n){e.prototype.initialize.apply(this,arguments),this.view.template=a,this.view.model.defaults=function(){return{mainResults:!0,title:void 0,showAbstract:"closed",showHighlights:!1,pagination:!0}},this.model.set(this.model.defaults(),{silent:!0}),this.view.toggleAll=function(e){var t=e.target.checked?"add":"remove";this.trigger("toggle-all",t)},_.extend(this.view.events,{"click input#select-all-docs":"toggleAll"}),this.view.resultsWidget=!0,this.view.delegateEvents(),this.listenTo(this.collection,"reset",this.checkDetails),this.listenTo(this.view,"toggle-all",this.triggerBulkAction);var i=t.prototype.defaultQueryArguments.fl.split(","),r=this.defaultQueryArguments.fl.split(",");r=_.union(i,r),this.defaultQueryArguments.fl=r.join(",")},defaultQueryArguments:{hl:"true","hl.fl":"title,abstract,body,ack","hl.maxAnalyzedChars":"150000","hl.requireFieldMatch":"true","hl.usePhraseHighlighter":"true",fl:"title,abstract,bibcode,author,keyword,id,links_data,property,citation_count,[citations],pub,aff,email,volume,pubdate,doi",rows:25,start:0},activate:function(t){e.prototype.activate.apply(this,[].slice.apply(arguments));var n=t.getService("PubSub");_.bindAll(this,"dispatchRequest","processResponse","onUserAnnouncement","onStoragePaperUpdate","onCustomEvent"),n.subscribe(n.INVITING_REQUEST,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),n.subscribe(n.USER_ANNOUNCEMENT,this.onUserAnnouncement),n.subscribe(n.STORAGE_PAPER_UPDATE,this.onStoragePaperUpdate),n.subscribe(n.CUSTOM_EVENT,this.onCustomEvent)},onUserAnnouncement:function(e,t){if("user_info_change"==e&&_.has(t,"isOrcidModeOn")){var n=this.hiddenCollection.toJSON(),i=_.map(n,function(e){return delete e.orcid,e});t.isOrcidModeOn&&this.addOrcidInfo(i),this.hiddenCollection.reset(i),this.view.collection.reset(this.hiddenCollection.getVisibleModels())}},onCustomEvent:function(e){if("add-all-on-page"==e){var t=this.collection.pluck("bibcode"),n=this.getPubSub();n.publish(n.BULK_PAPER_SELECTION,t)}},dispatchRequest:function(t){this.reset(),e.prototype.dispatchRequest.call(this,t)},customizeQuery:function(e){var t=e.clone();t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t));var n=t.get("q")[0];return n.match(/\W\*\W/)||t.set("hl.q",n),t},checkDetails:function(){for(var e=!1,t=0;t<this.collection.models.length;t++)if(this.collection.models[t].attributes.highlights){e=!0;break}e?this.model.set("showHighlights","open"):this.model.set("showHighlights",!1)},processDocs:function(e,t,i){var r=e.get("responseHeader.params").start||0,t=n.addPaginationToDocs(t,r),a=e.has("highlighting")?e.get("highlighting"):{},s=this,o=this.getBeeHive().getObject("User").getUserData("USER_DATA").link_server,l=null;return this.hasBeeHive()&&this.getBeeHive().hasObject("AppStorage")&&(l=this.getBeeHive().getObject("AppStorage")),this.getBeeHive().getObject("DocStashController").stashDocs(t),t=_.map(t,function(e){e.link_server=o,e.identifier=e.bibcode,e.encodedIdentifier=encodeURIComponent(e.identifier);var t={};_.keys(a).length&&(t=function(){var t=a[e.id],n=[];return _.each(_.pairs(t),function(e){n=n.concat(e[1])}),1===n.length&&""===n[0].trim()?{}:{highlights:n}}());if(e.author&&e.author.length>3?(e.extraAuthors=e.author.length-3,shownAuthors=e.author.slice(0,3)):e.author&&(shownAuthors=e.author),e.author){var n=shownAuthors.length-1;e.authorFormatted=_.map(shownAuthors,function(e,t){return t===n||0===n?e:e+";"})}return t.highlights&&t.highlights.length>0&&(e.highlights=t.highlights),e.formattedDate=e.pubdate?s.formatDate(e.pubdate,{format:"yy/mm",missing:{day:"yy/mm",month:"yy"}}):void 0,e.shortAbstract=e.abstract?s.shortenAbstract(e.abstract):void 0,l&&l.isPaperSelected(e.identifier)&&(e.chosen=!0),e}),t=this.parseLinksData(t)},onStoragePaperUpdate:function(){var e;this.hasBeeHive()&&this.getBeeHive().hasObject("AppStorage")?(e=this.getBeeHive().getObject("AppStorage"),this.collection.each(function(t){e.isPaperSelected(t.get("identifier"))?t.set("chosen",!0):t.set("chosen",!1)}),this.hiddenCollection.each(function(t){e.isPaperSelected(t.get("identifier"))?t.set("chosen",!0):t.set("chosen",!1)}),0==this.collection.where({chosen:!0}).length&&(this.view.$("input#select-all-docs")[0].checked=!1)):console.warn("AppStorage object disapperared!")},triggerBulkAction:function(e){var t=this.collection.pluck("bibcode");this.getPubSub().publish(this.getPubSub().BULK_PAPER_SELECTION,t,e)}});return _.extend(u.prototype,i),_.extend(u.prototype,r),_.extend(u.prototype,s,l.BeeHive),o(u)}),define("hbs!js/widgets/query_info/query_info_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'        &nbsp;&nbsp;<button class="btn btn-xs btn-default clear-selected"> <i class="fa fa-times"></i> clear all</button>\n'},3:function(e,t,n,i,r,a){var s,o;return'<div class="s-library-area">\n    <div class="s-library-add-title library-add-title"  type="button" data-toggle="collapse" data-target="#library-console" aria-expanded="false" aria-controls="collapseExample">\n        <i class="fa fa-book fa-lg"></i> Add papers to library &nbsp; <i class="fa fa-lg fa-caret-down"></i>\n    </div>\n    <div class="collapse '+(null!=(s=t.if.call(e,null!=e?e.libraryDrawerOpen:e,{name:"if",hash:{},fn:this.program(4,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'" id="library-console">\n\n'+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selected:e,0,{name:"compare",hash:{operator:">"},fn:this.program(6,i,0,r,a),inverse:this.program(9,i,0,r,a),data:i}))?s:"")+'\n\n        <div class="libraries-container">\n\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(11,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'\n            <label for="#create-new">create a new library </label>\n            <input id="create-new"\n                   class="form-control input-sm new-library-name s-display-inline"\n                   type="text"\n                   name="new-library-name"\n                   placeholder="New Library Name"\n                   value="'+this.escapeExpression("function"==typeof(o=null!=(o=t.newLibraryName||(null!=e?e.newLibraryName:e))?o:t.helperMissing)?o.call(e,{name:"newLibraryName",hash:{},data:i}):o)+'"\n                   style="max-width:166px;margin-bottom:10px;"/>\n            <button class="btn btn-sm btn-success submit-create-library"></i>submit</button>\n\n        </div>\n\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(15,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'\n        <div style="margin-top:6px" class="feedback s-feedback">\n\n'+(null!=(s=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(17,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"\n\n        </div>\n\n    </div>\n\n\n    \x3c!--end 'library area' if user is signed in--\x3e\n</div>\n"},4:function(e,t,n,i){return" in "},6:function(e,t,n,i){var r;return'        add\n        <select class="form-control input-sm s-all-vs-selected" name="all-vs-selected" id="all-vs-selected">\n            <option value="selected" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedVsAll:e,"selected",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'> selected papers only </option>\n            <option value="all"  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selectedVsAll:e,"all",{name:"compare",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+"> all results</option>\n        </select>\n"},7:function(e,t,n,i){return' selected="true"'},9:function(e,t,n,i){return'        add  <b>all results</b> <i class="icon-help" data-toggle="popover" data-content="All papers in your search results will be added, up to 1,000 records. To add only selected papers, click on the checkboxes next to the paper titles."></i>\n        from this query\n'},11:function(e,t,n,i,r,a){var s;return'            <div style="margin-top: 8px" class="">\n                <label for="#library-select">to an <b>existing library:</b></label>\n                <select id="library-select" name="library-select" class="form-control input-sm s-library-select">\n'+(null!=(s=t.each.call(e,null!=e?e.libraries:e,{name:"each",hash:{},fn:this.program(12,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'                </select>\n                <button class="btn btn-sm btn-success submit-add-to-library">submit</button>\n            </div>\n            <div style="margin:10px 0 4px 0">\n                OR\n            </div>\n'},12:function(e,t,n,i,r,a){var s;return'                    <option value="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.id:e,null!=a[1]?a[1].selectedLibrary:a[1],{name:"compare",hash:{},fn:this.program(13,i,0,r,a),inverse:this.noop,data:i}))?s:"")+">"+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</option>\n"},13:function(e,t,n,i){return' selected="true" '},15:function(e,t,n,i){return'          <div style="margin-top:10px">\n            <a href="#user/libraries">Go to my libraries</a>\n          </div>\n\n'},17:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.success:r,{name:"if",hash:{},fn:this.program(18,i,0),inverse:this.program(24,i,0),data:i}))?r:"")+"\n"},18:function(e,t,n,i){var r;return'\n              <div class="alert alert-success alert-dismissable" role="alert">\n                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.create:r,{name:"if",hash:{},fn:this.program(19,i,0),inverse:this.program(21,i,0),data:i}))?r:"")+"              </div>\n\n"},19:function(e,t,n,i){var r;return'                  <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.id:r,e))+'"> Library <b>'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b></a> was successfully created and "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numRecords:r,e))+" new records were added.\n"},21:function(e,t,n,i){var r;return"                  "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numRecords:r,e))+' new records were added to  <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.id:r,e))+'"> library <b>'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b></a>.\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.numAlreadyInLib:r,{name:"if",hash:{},fn:this.program(22,i,0),inverse:this.noop,data:i}))?r:"")},22:function(e,t,n,i){var r;return"                  ("+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numAlreadyInLib:r,e))+" were already in the library).\n"},24:function(e,t,n,i){var r;return'\n              <div class="alert alert-danger alert-dismissable" role="alert">\n                  <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.create:r,{name:"if",hash:{},fn:this.program(25,i,0),inverse:this.program(27,i,0),data:i}))?r:"")+"              </div>\n\n"},25:function(e,t,n,i){var r;return"                  <b>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b> was not created, error occured.\n                  <em>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.error:r,e))+"</em>\n"},27:function(e,t,n,i){var r;return"                  Records were not added to <b>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b>, error occurred.\n                  <em>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.error:r,e))+"</em>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,r,a){var s,o;return'<div class="s-right-col-widget-container">\n    <div class="currently-selected">\n        <b>'+this.escapeExpression("function"==typeof(o=null!=(o=t.selected||(null!=e?e.selected:e))?o:t.helperMissing)?o.call(e,{name:"selected",hash:{},data:i}):o)+'</b> <span class="s-light-font">selected</span>\n'+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.selected:e,0,{name:"compare",hash:{operator:">"},fn:this.program(1,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"    </div>\n</div>\n\n"+(null!=(s=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(3,i,0,r,a),inverse:this.noop,data:i}))?s:"")},useData:!0,useDepths:!0});return t.registerPartial("js/widgets/query_info/query_info_template",n),n}),define("js/widgets/query_info/query_info_widget",["marionette","backbone","underscore","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","hbs!js/widgets/query_info/query_info_template","js/mixins/formatter","bootstrap","js/components/api_feedback"],function(e,t,n,i,r,a,s,o,l,c){var u=t.Model.extend({defaults:{selected:0,libraryDrawerOpen:!1,libraries:[],loggedIn:!1,feedback:void 0,newLibraryName:void 0,selectedLibrary:void 0}}),d=e.ItemView.extend({className:"query-info-widget s-query-info-widget",template:s,serializeData:function(){var e=this.model.toJSON();return e.selected=this.formatNum(e.selected),e},modelEvents:{"change:selected":"render","change:loggedIn":"render","change:libraries":"render","change:feedback":"render"},triggers:{"click .clear-selected":"clear-selected"},events:{"change #all-vs-selected":"recordAllVsSelected","change #library-select":"recordLibrarySelection","keyup .new-library-name":"recordNewLibraryName","click .library-add-title":"toggleLibraryDrawer","click .submit-add-to-library":"libraryAdd","click .submit-create-library":"libraryCreate"},recordLibrarySelection:function(e){this.model.set("selectedLibrary",$(e.currentTarget).val())},recordNewLibraryName:function(e){this.model.set("newLibraryName",$(e.currentTarget).val())},recordAllVsSelected:function(e){this.model.set("selectedVsAll",$(e.currentTarget).val())},libraryAdd:function(){this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse"></i>');var e={};e.libraryID=this.$("#library-select").val(),this.model.get("selected")?e.recordsToAdd=this.$("#all-vs-selected").val():e.recordsToAdd="all",this.trigger("library-add",e)},libraryCreate:function(){this.$(".submit-create-library").html('<i class="fa fa-spinner fa-pulse"></i>');var e={};this.model.get("selected")?e.recordsToAdd=this.$("#all-vs-selected").val():e.recordsToAdd="all",e.name=this.model.get("newLibraryName")||"",e.name=e.name.trim(),this.trigger("library-create",e)},toggleLibraryDrawer:function(){this.model.set("libraryDrawerOpen",!this.model.get("libraryDrawerOpen"),{silent:!0})},onRender:function(){this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0})}});return n.extend(d.prototype,o),a.extend({modelConstructor:u,viewConstructor:d,initialize:function(e){e=e||{},this.model=new u,this.view=new d({model:this.model,template:e.template}),a.prototype.initialize.call(this,e)},viewEvents:{"clear-selected":"clearSelected","library-add":"libraryAddSubmit","library-create":"libraryCreateSubmit"},activate:function(e){this.setBeeHive(e),n.bindAll(this);var t=this,i=this.getPubSub();if(i.subscribe(i.STORAGE_PAPER_UPDATE,this.onStoragePaperChange),i.subscribe(i.LIBRARY_CHANGE,this.processLibraryInfo),i.subscribe(i.USER_ANNOUNCEMENT,this.handleUserAnnouncement),this.getBeeHive().getObject("User").isLoggedIn()){this.model.set("loggedIn",!0);this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.processLibraryInfo(e)})}},handleUserAnnouncement:function(e,t){var n=this.getBeeHive().getObject("User");e==n.USER_SIGNED_IN?this.model.set("loggedIn",!0):e==n.USER_SIGNED_OUT&&this.model.set("loggedIn",!1)},onStoragePaperChange:function(e){this.model.set("selected",e)},processLibraryInfo:function(e){e.sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}),this.model.set("libraries",e)},clearSelected:function(){this.getBeeHive().getObject("AppStorage").clearSelectedPapers()},libraryAddSubmit:function(e){var t={},i=this;t.library=e.libraryID,this.abstractPage?t.bibcodes=[this._bibcode]:t.bibcodes=e.recordsToAdd;var r=n.findWhere(this.model.get("libraries"),{id:e.libraryID}).name;this.getBeeHive().getObject("LibraryController").addBibcodesToLib(t).done(function(t,n){var a=t.numBibcodesRequested-parseInt(t.number_added);i.model.set("feedback",{success:!0,name:r,id:e.libraryID,numRecords:t.number_added,numAlreadyInLib:a})}).fail(function(t){i.model.set("feedback",{success:!1,name:r,id:e.libraryID,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},libraryCreateSubmit:function(e){var t={},n=this;this.abstractPage?t.bibcodes=[this._bibcode]:t.bibcodes=e.recordsToAdd,t.name=e.name,this.getBeeHive().getObject("LibraryController").createLibAndAddBibcodes(t).done(function(t,i){n.model.set("newLibraryName",void 0),n.model.set("feedback",{create:!0,success:!0,name:e.name,id:t.id,numRecords:t.bibcode.length})}).fail(function(t){n.model.set("feedback",{success:!1,name:e.name,create:!0,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},clearFeedbackWithDelay:function(){var e=this;setTimeout(function(){e.model.unset("feedback")},3e4)},processResponse:function(e){var t=e.getApiQuery(),i=[];n.each(t.keys(),function(e){"fq"==e.substring(0,2)&&n.each(t.get(e),function(e){-1==e.indexOf("{!")&&i.push(e)})}),this.view.model.set("fq",i)}})}),define("hbs!js/widgets/api_query/templates/widget-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div id="api-query" class="well well-small">\n    <h5>Query Inspection</h5>\n    <form>\n        <input type="text" placeholder="Copy&Paste serialized query here" id="api-query-input" value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.initialValue||(null!=e?e.initialValue:e))?r:t.helperMissing)?r.call(e,{name:"initialValue",hash:{},data:i}):r)+'"/>\n        <button id="api-query-load">Load</button>\n        <button id="api-query-add">Add</button>\n        <button id="api-query-run">Run</button>\n\n    <table id="api-query-values">\n\n    </table>\n\n    Result: <pre id="api-query-result"></pre>\n    </form>\n</div>'},useData:!0});return t.registerPartial("js/widgets/api_query/templates/widget-view",n),n}),define("hbs!js/widgets/api_query/templates/item-view",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<td class="key"><input type="text" name="key" value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.key||(null!=e?e.key:e))?r:t.helperMissing)?r.call(e,{name:"key",hash:{},data:i}):r)+'"/></td>\n<td class="value"><input type="text" name="value" value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.value||(null!=e?e.value:e))?r:t.helperMissing)?r.call(e,{name:"value",hash:{},data:i}):r)+'"/></td>\n<td> <a class="remove">remove</a></td>'},useData:!0});return t.registerPartial("js/widgets/api_query/templates/item-view",n),n}),define("js/widgets/api_query/widget",["underscore","jquery","backbone","marionette","js/components/api_query","js/components/pubsub_events","hbs!js/widgets/api_query/templates/widget-view","hbs!js/widgets/api_query/templates/item-view","js/mixins/dependon"],function(e,t,n,i,r,a,s,o,l){var c=n.Model.extend({}),u=n.Collection.extend({model:c}),d=i.ItemView.extend({tagName:"tr",template:o,events:{"click .remove":"removeItem","blur input[name=key]":"onChange","blur input[name=value]":"onChange"},onChange:function(n){var i=t(n.target),r=e.clone(this.model.attributes),a=t(n.target).val();"key"==i.attr("name")&&r.key!=a?this.trigger("key-changed",this.model,a):"value"==i.attr("name")&&r.value!=a&&this.trigger("value-changed",this.model,a)},removeItem:function(e){e.preventDefault(),this.trigger("remove-clicked",this.model)}}),h=i.CompositeView.extend({template:s,childView:d,childViewContainer:"#api-query-values",events:{"click button#api-query-load":"loadApiQuery","click button#api-query-add":"addNewItem","click button#api-query-run":"runApiQuery","submit form":"loadApiQuery"},addNewItem:function(e){e&&e.preventDefault(),this.trigger("add-new-item",this)},loadApiQuery:function(t){t&&t.preventDefault();var n=this.$el.find("input#api-query-input").val();n&&e.isString(n)&&n.trim().length>0&&this.trigger("load-api-query",n)},runApiQuery:function(t){t&&t.preventDefault();var n=new r;e.map(this.collection.models,function(e){var t=e.attributes;t.key&&n.set(t.key,t.value.split("|"))}),this.$el.find("#api-query-result").text(n.url()),this.trigger("run-api-query",n)},updateInputBox:function(e){this.$el.find("input#api-query-input").val(e)},removeKey:function(e){this.trigger("remove-key",e)}}),p=i.Controller.extend({initialize:function(e){return e&&e instanceof r||(e=new r),this.collection=new u(this.getData(e)),this.view=new h({collection:this.collection,model:new c({initialValue:e.url()||"q=planet"})}),this.listenTo(this.view,"all",this.onAll),this},render:function(){return this.view.render(),this.view},onLoad:function(e){this.collection?this.collection.reset(this.getData(e)):this.initialize(e)},onAll:function(){var e=arguments[0];"childview:remove-clicked"==e?arguments[2].destroy():"childview:key-changed"==e?arguments[2].set("key",arguments[3]):"childview:value-changed"==e?arguments[2].set("value",arguments[3]):"add-new-item"==e?arguments[1].collection.add({key:"",value:""}):"load-api-query"==e?this.onLoad(arguments[1]):"run-api-query"==e&&(this.view.updateInputBox(arguments[1].url()),this.onRun(arguments[1]))},getData:function(t){if(!t)throw Error("Wrong input!");return e.isString(t)&&(t=(new r).load(t)),e.map(t.pairs(),function(e){return{key:e[0],value:e[1].join("|")}})},activate:function(t){this.setBeeHive(t),this.getPubSub().subscribe("all",e.bind(this.onAllPubSub,this))},onAllPubSub:function(){var e=arguments[0];e!=a.START_SEARCH&&e!=a.INVITING_REQUEST||(console.log("[debug:ApiQueryWidget]",arguments[0]),this.view.updateInputBox(arguments[1].url()))},onRun:function(e){this.hasPubSub()&&this.getPubSub().publish(this.getPubSub().START_SEARCH,e)}});return e.extend(p.prototype,l.BeeHive),p}),define("hbs!js/widgets/export/templates/export_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'     <div class="alert alert-danger" role="alert"> '+this.escapeExpression("function"==typeof(r=null!=(r=t.error||(null!=e?e.error:e))?r:t.helperMissing)?r.call(e,{name:"error",hash:{},data:i}):r)+"</div>\n"},3:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=e?e.export:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(18,i,0),data:i}))?r:"")+"\n\n"},4:function(e,t,n,i){var r,a;return'\n        <h3 class="s-light-font">Currently viewing <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.current||(null!=e?e.current:e))?a:t.helperMissing)?a.call(e,{name:"current",hash:{},data:i}):a)+"</b>\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.current:e,1,{name:"compare",hash:{operator:">"},fn:this.program(5,i,0),inverse:this.program(14,i,0),data:i}))?r:"")+"        </h3>\n\n"+(null!=(r=t.if.call(e,null!=e?e.query:e,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?r:"")+'\n        <div class="s-spacer-top-large">\n            <button class="btn btn-default-flat s-btn-download" id="btn-download">\n                <i class="fa fa-lg fa-download"></i>\n                Download file\n            </button>\n            <button class="btn btn-default-flat" id="btn-copy" data-clipboard-target="#exportData">\n                <i class="fa fa-lg fa-clipboard"></i>\n                Copy to clipboard\n            </button>\n\n            <textarea id="exportData" class="s-export-data" readonly >'+this.escapeExpression("function"==typeof(a=null!=(a=t.export||(null!=e?e.export:e))?a:t.helperMissing)?a.call(e,{name:"export",hash:{},data:i}):a)+"</textarea>\n"},5:function(e,t,n,i){var r;return"            records in <b>\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"bibtex",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"endnote",{name:"compare",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"aastex",{name:"compare",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"ris",{name:"compare",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?r:"")+"            </b> format.\n"},6:function(e,t,n,i){return"                BibTeX\n"},8:function(e,t,n,i){return"                EndNote\n"},10:function(e,t,n,i){return"                AASTeX\n"},12:function(e,t,n,i){return"                RIS\n"},14:function(e,t,n,i){var r;return"            record in <b>\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"bibtex",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"endnote",{name:"compare",hash:{},fn:this.program(8,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"aastex",{name:"compare",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.format:e,"ris",{name:"compare",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?r:"")+"            </b> format.\n"},16:function(e,t,n,i){var r;return'        <div class="change-rows">\n            Change to first\n            <input type="number" class="form-control user-input s-display-inline input-sm" min="1" max="'+this.escapeExpression("function"==typeof(r=null!=(r=t.max||(null!=e?e.max:e))?r:t.helperMissing)?r.call(e,{name:"max",hash:{},data:i}):r)+'" style="width: 70px"/>\n            record(s) (max is '+this.escapeExpression("function"==typeof(r=null!=(r=t.max||(null!=e?e.max:e))?r:t.helperMissing)?r.call(e,{name:"max",hash:{},data:i}):r)+').\n            <button class="submit-rows btn btn-sm btn-info"> Submit </button>\n        </div>\n\n'},18:function(e,t,n,i){return'        <div style="margin:20px">\n            <i class="fa fa-spinner fa-2x fa-pulse"></i> Loading data...\n        </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<span class="s-large-close close-widget">x</span>\n\n'+(null!=(r=t.if.call(e,null!=e?e.error:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/export/templates/export_template",n),n}),define("hbs!js/widgets/loading/loading-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n\n<div class="modal">\n    <div class="modal-dialog">\n        <div class="modal-content">\n            <div class="modal-header">\n                <h4 class="modal-title">Loading...</h4>\n            </div>\n            <div class="modal-body">\n\n                <div class="progress">\n                <div class="progress-bar progress-bar-striped active"\n                     role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" style="width: 0%">\n                    <span class="sr-only"></span>\n                </div>\n            </div>\n\n            </div>\n            \x3c!--<div class="modal-footer">--\x3e\n                \x3c!--<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>--\x3e\n                \x3c!--<button type="button" class="btn btn-primary">Save changes</button>--\x3e\n            \x3c!--</div>--\x3e\n        </div>\x3c!-- /.modal-content --\x3e\n    </div>\x3c!-- /.modal-dialog --\x3e\n</div>\x3c!-- /.modal --\x3e'},useData:!0});return t.registerPartial("js/widgets/loading/loading-template",n),n}),define("hbs!js/widgets/export/templates/classic_submit_form",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <input type="hidden" name="bibcode" value="'+this.escapeExpression(this.lambda(e,e))+'"/>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<form action="http://adsabs.harvard.edu/cgi-bin/nph-abs_connect" target="_blank" method="post" class="hidden">\n    <input type="hidden" name="nr_to_return" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.exportLimit||(null!=e?e.exportLimit:e))?a:t.helperMissing)?a.call(e,{name:"exportLimit",hash:{},data:i}):a)+'"/>\n'+(null!=(r=t.each.call(e,null!=e?e.bibcodes:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"</form>\n"},useData:!0});return t.registerPartial("js/widgets/export/templates/classic_submit_form",n),n}),function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define("clipboard",[],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).Clipboard=e()}}(function(){return function e(t,n,i){function r(s,o){if(!n[s]){if(!t[s]){var l="function"==typeof require&&require;if(!o&&l)return l(s,!0);if(a)return a(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){var n=t[s][1][e];return r(n||e)},u,u.exports,e,t,n,i)}return n[s].exports}for(var a="function"==typeof require&&require,s=0;s<i.length;s++)r(i[s]);return r}({1:[function(e,t,n){var i=e("matches-selector");t.exports=function(e,t,n){for(var r=n?e:e.parentNode;r&&r!==document;){if(i(r,t))return r;r=r.parentNode}}},{"matches-selector":5}],2:[function(e,t,n){function i(e,t,n,i){return function(n){n.delegateTarget=r(n.target,t,!0),n.delegateTarget&&i.call(e,n)}}var r=e("closest");t.exports=function(e,t,n,r,a){var s=i.apply(this,arguments);return e.addEventListener(n,s,a),{destroy:function(){e.removeEventListener(n,s,a)}}}},{closest:1}],3:[function(e,t,n){n.node=function(e){return void 0!==e&&e instanceof HTMLElement&&1===e.nodeType},n.nodeList=function(e){var t=Object.prototype.toString.call(e);return void 0!==e&&("[object NodeList]"===t||"[object HTMLCollection]"===t)&&"length"in e&&(0===e.length||n.node(e[0]))},n.string=function(e){return"string"==typeof e||e instanceof String},n.fn=function(e){return"[object Function]"===Object.prototype.toString.call(e)}},{}],4:[function(e,t,n){function i(e,t,n){return e.addEventListener(t,n),{destroy:function(){e.removeEventListener(t,n)}}}function r(e,t,n){return Array.prototype.forEach.call(e,function(e){e.addEventListener(t,n)}),{destroy:function(){Array.prototype.forEach.call(e,function(e){e.removeEventListener(t,n)})}}}function a(e,t,n){return o(document.body,e,t,n)}var s=e("./is"),o=e("delegate");t.exports=function(e,t,n){if(!e&&!t&&!n)throw new Error("Missing required arguments");if(!s.string(t))throw new TypeError("Second argument must be a String");if(!s.fn(n))throw new TypeError("Third argument must be a Function");if(s.node(e))return i(e,t,n);if(s.nodeList(e))return r(e,t,n);if(s.string(e))return a(e,t,n);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}},{"./is":3,delegate:2}],5:[function(e,t,n){var i=Element.prototype,r=i.matchesSelector||i.webkitMatchesSelector||i.mozMatchesSelector||i.msMatchesSelector||i.oMatchesSelector;t.exports=function(e,t){if(r)return r.call(e,t);for(var n=e.parentNode.querySelectorAll(t),i=0;i<n.length;++i)if(n[i]==e)return!0;return!1}},{}],6:[function(e,t,n){t.exports=function(e){var t;if("INPUT"===e.nodeName||"TEXTAREA"===e.nodeName)e.focus(),e.setSelectionRange(0,e.value.length),t=e.value;else{e.hasAttribute("contenteditable")&&e.focus();var n=window.getSelection(),i=document.createRange();i.selectNodeContents(e),n.removeAllRanges(),n.addRange(i),t=n.toString()}return t}},{}],7:[function(e,t,n){function i(){}i.prototype={on:function(e,t,n){var i=this.e||(this.e={});return(i[e]||(i[e]=[])).push({fn:t,ctx:n}),this},once:function(e,t,n){function i(){r.off(e,i),t.apply(n,arguments)}var r=this;return i._=t,this.on(e,i,n)},emit:function(e){var t=[].slice.call(arguments,1),n=((this.e||(this.e={}))[e]||[]).slice(),i=0,r=n.length;for(i;i<r;i++)n[i].fn.apply(n[i].ctx,t);return this},off:function(e,t){var n=this.e||(this.e={}),i=n[e],r=[];if(i&&t)for(var a=0,s=i.length;a<s;a++)i[a].fn!==t&&i[a].fn._!==t&&r.push(i[a]);return r.length?n[e]=r:delete n[e],this}},t.exports=i},{}],8:[function(e,t,n){!function(i,r){if(void 0!==n)r(t,e("select"));else{var a={exports:{}};r(a,i.select),i.clipboardAction=a.exports}}(this,function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(e){return e&&e.__esModule?e:{default:e}}(t),r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=function(){function e(t){n(this,e),this.resolveOptions(t),this.initSelection()}return e.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=e.action,this.emitter=e.emitter,this.target=e.target,this.text=e.text,this.trigger=e.trigger,this.selectedText=""},e.prototype.initSelection=function(){this.text?this.selectFake():this.target&&this.selectTarget()},e.prototype.selectFake=function(){var e=this,t="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return e.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="fixed",this.fakeElem.style[t?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=(0,i.default)(this.fakeElem),this.copyText()},e.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},e.prototype.selectTarget=function(){this.selectedText=(0,i.default)(this.target),this.copyText()},e.prototype.copyText=function(){var e=void 0;try{e=document.execCommand(this.action)}catch(t){e=!1}this.handleResult(e)},e.prototype.handleResult=function(e){e?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},e.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},e.prototype.destroy=function(){this.removeFake()},a(e,[{key:"action",set:function(){var e=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=e,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(e){if(void 0!==e){if(!e||"object"!==(void 0===e?"undefined":r(e))||1!==e.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&e.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(e.hasAttribute("readonly")||e.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=e}},get:function(){return this._target}}]),e}();e.exports=s})},{select:6}],9:[function(e,t,n){!function(i,r){if(void 0!==n)r(t,e("./clipboard-action"),e("tiny-emitter"),e("good-listener"));else{var a={exports:{}};r(a,i.clipboardAction,i.tinyEmitter,i.goodListener),i.clipboard=a.exports}}(this,function(e,t,n,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){var n="data-clipboard-"+e;if(t.hasAttribute(n))return t.getAttribute(n)}var c=r(t),u=r(n),d=r(i),h=function(e){function t(n,i){a(this,t);var r=s(this,e.call(this));return r.resolveOptions(i),r.listenClick(n),r}return o(t,e),t.prototype.resolveOptions=function(){var e=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof e.action?e.action:this.defaultAction,this.target="function"==typeof e.target?e.target:this.defaultTarget,this.text="function"==typeof e.text?e.text:this.defaultText},t.prototype.listenClick=function(e){var t=this;this.listener=(0,d.default)(e,"click",function(e){return t.onClick(e)})},t.prototype.onClick=function(e){var t=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new c.default({action:this.action(t),target:this.target(t),text:this.text(t),trigger:t,emitter:this})},t.prototype.defaultAction=function(e){return l("action",e)},t.prototype.defaultTarget=function(e){var t=l("target",e);if(t)return document.querySelector(t)},t.prototype.defaultText=function(e){return l("text",e)},t.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},t}(u.default);e.exports=h})},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)});var saveAs=saveAs||function(e){"use strict";if(!(void 0===e||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var t=function(){return e.URL||e.webkitURL||e},n=e.document.createElementNS("http://www.w3.org/1999/xhtml","a"),i="download"in n,r=function(e){var t=new MouseEvent("click");e.dispatchEvent(t)},a=/constructor/i.test(e.HTMLElement)||e.safari,s=/CriOS\/[\d]+/.test(navigator.userAgent),o=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},l=function(e){setTimeout(function(){"string"==typeof e?t().revokeObjectURL(e):e.remove()},4e4)},c=function(e,t,n){for(var i=(t=[].concat(t)).length;i--;){var r=e["on"+t[i]];if("function"==typeof r)try{r.call(e,n||e)}catch(e){o(e)}}},u=function(e){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e},d=function(o,d,h){h||(o=u(o));var p,f=this,g="application/octet-stream"===o.type,m=function(){c(f,"writestart progress write writeend".split(" "))};if(f.readyState=f.INIT,i)return p=t().createObjectURL(o),void setTimeout(function(){n.href=p,n.download=d,r(n),m(),l(p),f.readyState=f.DONE});!function(){if((s||g&&a)&&e.FileReader){var n=new FileReader;return n.onloadend=function(){var t=s?n.result:n.result.replace(/^data:[^;]*;/,"data:attachment/file;");e.open(t,"_blank")||(e.location.href=t),t=void 0,f.readyState=f.DONE,m()},n.readAsDataURL(o),void(f.readyState=f.INIT)}p||(p=t().createObjectURL(o)),g?e.location.href=p:e.open(p,"_blank")||(e.location.href=p),f.readyState=f.DONE,m(),l(p)}()},h=d.prototype;return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(e,t,n){return t=t||e.name||"download",n||(e=u(e)),navigator.msSaveOrOpenBlob(e,t)}:(h.abort=function(){},h.readyState=h.INIT=0,h.WRITING=1,h.DONE=2,h.error=h.onwritestart=h.onprogress=h.onwrite=h.onabort=h.onerror=h.onwriteend=null,function(e,t,n){return new d(e,t||e.name||"download",n)})}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define("FileSaver.js",[],function(){return saveAs}),define("filesaver",function(){}),define("js/widgets/export/widget",["marionette","js/widgets/base/base_widget","js/components/api_query","hbs!js/widgets/export/templates/export_template","hbs!js/widgets/loading/loading-template","hbs!js/widgets/export/templates/classic_submit_form","js/components/api_feedback","js/components/api_targets","jquery","jquery-ui","module","js/components/api_targets","js/mixins/dependon","clipboard","filesaver"],function(e,t,n,i,r,a,s,o,l,c,u,o,d,h){var p,f=Backbone.Model.extend({initialize:function(){this.on("change:numFound",this.updateMax),this.on("change:max",this.updateCurrent)},updateMax:function(){var e=_.min([this.get("defaultMax"),this.get("numFound")]);this.set("max",e)},defaults:function(){return{format:"bibtex",export:void 0,query:void 0,msg:void 0,identifiers:[],defaultMax:o._limits.ExportWidget.limit,default:o._limits.ExportWidget.default,numFound:void 0,current:void 0,max:void 0,userVal:void 0}},reset:function(){this.clear({silent:!0}).set(this.defaults(),{silent:!0}),this.trigger("change:export")}}),g=e.ItemView.extend({className:"s-export",ui:{triggerDownload:"#btn-download"},template:i,loadingTemplate:r,events:{"click @ui.triggerDownload":"downloadRecords","click .close-widget":"signalCloseWidget","click .submit-rows":"setUserVal"},modelEvents:{"change:export":"render","change:error":"render"},setUserVal:function(){this.model.set("userVal",_.min([parseInt(l(".user-input").val()),this.model.get("max")]))},contentTypes:{endnote:"application/x-endnote-refer",bibtex:"application/x-bibtex",aastex:"text/plain",ris:"text/plain"},downloadRecords:function(){var e,t,n=this;e=this.contentTypes[this.model.get("format")],t=new Blob([this.model.get("export")],{type:e}),saveAs(t,this.model.get("format")+"-records.txt"),this.ui.triggerDownload.html('<i class="fa fa-lg fa-download"></i> Downloaded!'),setTimeout(function(){n.ui.triggerDownload.html('<i class="fa fa-lg fa-download"></i> Download file')},2e3)},signalCloseWidget:function(e){this.trigger("close-widget")},onDestroy:function(){p&&p.destroy()},onRender:function(){var e=this;p&&p.destroy(),e.model.get("export")&&((p=new h("#btn-copy")).on("success",function(t){this.$("#btn-copy").html('<i class="fa fa-lg fa-clipboard"></i> Copied!'),t.clearSelection(),setTimeout(function(){e.$("#btn-copy").html('<i class="fa fa-lg fa-clipboard"></i> Copy to Clipboard')},800)}),p.on("error",function(t){this.$("#btn-copy").html('<i class="fa fa-lg fa-clipboard"></i> Now press Ctrl+C (or Cmd+C for Mac) to copy'),setTimeout(function(){e.$("#btn-copy").html('<i class="fa fa-lg fa-clipboard"></i> Copy to Clipboard')},2e3)}))}}),m=t.extend({initialize:function(e){this.model=new f,this.view=new g({model:this.model}),t.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e),this.getPubSub().subscribe(this.getPubSub().INVITING_REQUEST,_.bind(this.setCurrentQuery,this))},viewEvents:{"export-records":"renderWidgetForListOfBibcodes","export-query":"renderWidgetForCurrentQuery","close-widget":"closeWidget"},modelEvents:{"change:userVal":"changeRows"},changeRows:function(){this.model.set("export",void 0);var e=this.model.get("query");(e=e.clone()).unlock(),e.set("rows",this.model.get("userVal")),e.set("fl","bibcode"),this.initiateQueryBasedRequest(e)},renderWidgetForCurrentQuery:function(e){if(!_.isObject(e))throw new Error("info must be an object!");if(!e.format||!e.numFound)throw new Error('info must contain the keys "format" and "numFound" ');this.model.reset(),this.model.set({query:this.getCurrentQuery(),format:e.format,numFound:e.numFound}),-1==this.model.get("numFound")&&self.model.set("error","Unknown number of results");var t=this.model.get("query").clone();t.unlock(),t.set("rows",this.model.get("default")),t.set("fl","bibcode"),this.initiateQueryBasedRequest(t)},initiateQueryBasedRequest:function(e){var t=this;this._executeApiRequest(e).done(function(e){var n=_.map(e.get("response.docs"),function(e){return e.bibcode});t.model.set("current",n.length),t._getExports(t.model.get("format")||"bibtex",n)})},renderWidgetForListOfBibcodes:function(e,t){if(!_.isObject(t))throw new Error("data must be an object!");if(this.model.reset(),!_.isArray(e))throw new Error("Identifiers must be an array");if(e.length<=0&&console.warn("Do you want to export nothing? Let me be!"),!t||!t.format)throw new Error("no export format was provided");"classic"!==t.format?(this.model.set("current",e.length),this.model.set("format",t.format),this.model.set("rows",o._limits.ExportWidget.default),this._getExports(t.format,e)):this.openClassicExports({bibcodes:e,libid:t.libid})},openClassicExports:function(e){if(e.bibcodes)l(a({bibcodes:e.bibcodes,exportLimit:o._limits.ExportWidget.limit})).submit();else{if(!e.currentQuery)throw new Error("can't export with no bibcodes or query");var t=e.currentQuery.clone();t.set("rows",this.model.get("defaultMax")),t.set("fl","bibcode"),this._executeApiRequest(t).done(function(e){var t=_.map(e.get("response.docs"),function(e){return e.bibcode}),n=l(a({bibcodes:t,exportLimit:t.length}));l("body").append(n),n.submit(),n.remove()})}e.libid?this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{subView:"library",id:e.libid}):this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},_getExports:function(e,t){if(e={endnote:"endnote",aastex:"aastex",bibtex:"bibtex",ris:"ris"}[(e=e||this.model.get("format")||"bibtex").toLowerCase()]||e.toLowerCase(),!_.isArray(t))throw new Error("Identifiers must be an array");if(t.length<=0)throw new Error("Do you want to export nothing? Let me be!");var i=new n;i.set("bibcode",t),i.set("sort","NONE");var r=this.composeRequest(i);r.set("target",o.EXPORT+e);var a={type:"POST",contentType:"application/json"};if(r.set("options",a),!r)throw new Error("Well, this is unexpected behaviour! Who wrote this software?");var s=this.getPubSub();s.subscribeOnce(s.DELIVERING_RESPONSE,_.bind(function(e){e&&e.has("export")?this.model.set("export",e.get("export")):console.error("The export did return some garbage, tfuj!",e)},this)),s.publish(s.EXECUTE_REQUEST,r),this.model.set("identifiers",t)},_executeApiRequest:function(e){if(!e)throw new Error("Damn, and I thought you knew what you do!");var t=this.composeRequest(e),n=l.Deferred();if(!t)throw new Error("Well, this is unexpected behaviour! Who wrote this software?");var i=this.getPubSub();return i.subscribeOnce(i.DELIVERING_RESPONSE,_.bind(function(e){n.resolve(e)}),this),i.publish(i.EXECUTE_REQUEST,t),n},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")}});return _.extend(m.prototype,d.BeeHive),m}),define("hbs!js/widgets/sort/templates/sort_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" selected "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="btn-group sort-widget s-sort-widget">\n    <label for="sort-select" class="sort-label"> sort: </label>\n    <select class="form-control" id="sort-select" style="display:inline; width:165px">\n        <optgroup label="descending">\n            <option value="citation_count desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"citation_count desc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Citation Count desc</option>\n            <option value="date desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date desc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Date desc</option>\n            <option value="read_count desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"read_count desc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Read Count desc</option>\n            <option value="classic_factor desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"classic_factor desc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Relevancy desc</option>\n            <option value="first_author desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"first_author desc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>First Author desc</option>\n            <option value="bibcode desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"bibcode desc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Bibcode desc</option>\n        </optgroup>\n        <optgroup label="ascending">\n            <option value="citation_count asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"citation_count asc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Citation Count asc</option>\n            <option value="date asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date asc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Date asc</option>\n            <option value="read_count asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"read_count asc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Read Count asc</option>\n            <option value="classic_factor asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"classic_factor asc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>Relevancy asc</option>\n            <option value="first_author asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"first_author asc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'>First Author asc</option>\n            <option value="bibcode asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"bibcode asc",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+">Bibcode asc</option>\n        </optgroup>\n    </select>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/sort/templates/sort_template",n),n}),define("js/widgets/sort/widget",["marionette","backbone","jquery","js/widgets/base/base_widget","hbs!js/widgets/sort/templates/sort_template","bootstrap","js/components/api_feedback","analytics"],function(e,t,n,i,r,a,s,o){var l=t.Model.extend(),c=e.ItemView.extend({template:r,modelEvents:{change:"render"},events:{"change #sort-select":"changeSort"},changeSort:function(e){this.trigger("change-sort",e.target.value)}});return i.extend({initialize:function(e){this.model=new l,this.view=new c({model:this.model}),this.listenTo(this.view,"change-sort",this.submitQuery),i.prototype.initialize.apply(this,arguments)},activate:function(e){_.bindAll(this,"handleFeedback"),this.setBeeHive(e),this.getPubSub().subscribe(this.getPubSub().FEEDBACK,_.bind(this.handleFeedback,this))},submitQuery:function(e){var t=this.getCurrentQuery().clone();t.set("sort",e),this.getPubSub().publish(this.getPubSub().START_SEARCH,t),o("send","event","interaction","sort-applied",e)},extractSort:function(e){return e.split(",")[0]||"relevancy desc"},handleFeedback:function(e){if(e.code===s.CODES.SEARCH_CYCLE_STARTED)try{this.setCurrentQuery(e.query),this.model.set("sort",this.extractSort(e.query.get("sort")[0]))}catch(e){console.warn("sort widget could not detect any query sort")}}})}),define("hbs!js/widgets/dropdown-menu/templates/dropdown",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return"pull-right"},3:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.selectedPapers:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:""},4:function(e,t,n,i){var r,a;return'                <div class="s-divider-bottom">\n                    <label><input class="papers" type="radio" '+(null!=(r=t.if.call(e,null!=e?e.onlySelected:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+' name="papers-'+this.escapeExpression("function"==typeof(a=null!=(a=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?a:t.helperMissing)?a.call(e,{name:"dropdownTitle",hash:{},data:i}):a)+'" value="selected"/> selected papers</label>\n                    <label><input class="papers" type="radio" '+(null!=(r=t.unless.call(e,null!=e?e.onlySelected:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+' name="papers-'+this.escapeExpression("function"==typeof(a=null!=(a=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?a:t.helperMissing)?a.call(e,{name:"dropdownTitle",hash:{},data:i}):a)+'" value="all"/> all papers</label>\n                </div>\n'},5:function(e,t,n,i){return" checked "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\x3c!-- Single button --\x3e\n    <button type="button" class="btn '+this.escapeExpression("function"==typeof(a=null!=(a=t.btnType||(null!=e?e.btnType:e))?a:t.helperMissing)?a.call(e,{name:"btnType",hash:{},data:i}):a)+' dropdown-toggle" data-toggle="dropdown" aria-expanded="false">\n       <i class="'+this.escapeExpression("function"==typeof(a=null!=(a=t.iconClass||(null!=e?e.iconClass:e))?a:t.helperMissing)?a.call(e,{name:"iconClass",hash:{},data:i}):a)+'"></i> <h2>'+this.escapeExpression("function"==typeof(a=null!=(a=t.dropdownTitle||(null!=e?e.dropdownTitle:e))?a:t.helperMissing)?a.call(e,{name:"dropdownTitle",hash:{},data:i}):a)+'</h2> <span class="caret"></span>\n    </button>\n    <div class="dropdown-menu '+(null!=(r=t.if.call(e,null!=e?e.pullRight:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'" role="menu">\n'+(null!=(r=t.if.call(e,null!=e?e.selectedOption:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'        <ul class="link-container">\n        </ul>\n    </div>\n'},useData:!0});return t.registerPartial("js/widgets/dropdown-menu/templates/dropdown",n),n}),define("hbs!js/widgets/dropdown-menu/templates/dropdown-item",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<a href="'+this.escapeExpression(this.lambda(null!=e?e.href:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.description:e,e))+"</a>\n\n"},useData:!0});return t.registerPartial("js/widgets/dropdown-menu/templates/dropdown-item",n),n}),define("js/widgets/dropdown-menu/widget",["marionette","js/widgets/base/base_widget","hbs!js/widgets/dropdown-menu/templates/dropdown","hbs!js/widgets/dropdown-menu/templates/dropdown-item"],function(e,t,n,i){var r=Backbone.Model.extend({defaults:function(){return{selected:!1,href:void 0,description:void 0,navEvent:void 0}}}),a=Backbone.Collection.extend({initialize:function(e,t){this.on("change:selected",this.removeOtherSelected)},model:r,removeOtherSelected:function(e,t){!1!==t&&this.each(function(t){t!==e&&t.set("selected",!1)})}}),s=e.ItemView.extend({tagName:"li",events:{click:"setSelected"},setSelected:function(e){e.preventDefault(),this.model.set("selected",!0)},template:i}),o=Backbone.Model.extend({defaults:function(){return{selectedOption:!1,selectedPapers:!1,onlySelected:!0}}}),l=e.CompositeView.extend({initialize:function(e){e=e||{}},modelEvents:{"change:selectedOption":"render","change:selectedPapers":"render"},collectionEvents:{"change:selected":function(){this.$el.removeClass("open")}},className:"btn-group dropdown-widget s-dropdown-widget",childView:s,childViewContainer:".link-container",template:n,serializeData:function(){var t=this.model.toJSON();return t.btnType=e.getOption(this,"btnType")||"btn-default",t.dropdownTitle=e.getOption(this,"dropdownTitle"),t.iconClass=e.getOption(this,"iconClass"),t.pullRight=e.getOption(this,"rightAlign"),t},events:{"change input.papers":function(e){"all"==$(e.target).attr("value")?this.model.set("onlySelected",!1):this.model.set("onlySelected",!0)},"click .dropdown-menu label":function(e){e.stopPropagation()}}});return t.extend({initialize:function(e){if(!(e=e||{}).links)throw new Error("Dropdown menu will be empty!");this.model=new o({selectedOption:e.selectedOption}),this.collection=new a(e.links),this.view=new l(_.extend({collection:this.collection,model:this.model},e)),this.listenTo(this.collection,"change:selected",this.emitNavigateEvent)},activate:function(e){_.bindAll(this),this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.STORAGE_PAPER_UPDATE,this.onStoragePaperChange)},onStoragePaperChange:function(e){e?this.model.set("selectedPapers",!0):this.model.set("selectedPapers",!1)},emitNavigateEvent:function(e,t){var n=this.model.get("selectedOption")&&this.model.get("selectedPapers")&&this.model.get("onlySelected");if(t){var i=_.extend({onlySelected:n},e.get("params"));this.getPubSub().publish(this.getPubSub().NAVIGATE,e.get("navEvent"),i)}e.set("selected",!1)}})}),define("js/wraps/export_dropdown",["js/widgets/dropdown-menu/widget"],function(e){var t=[{description:"in BibTeX",navEvent:"export",params:{format:"bibtex"}},{description:"in AASTeX",navEvent:"export",params:{format:"aastex"}},{description:"in EndNote",navEvent:"export",params:{format:"endnote"}},{description:"in RIS",navEvent:"export",params:{format:"ris"}},{description:"in ADS Classic",navEvent:"export",params:{format:"classic"}}];return function(){return new e({links:t,btnType:"btn-primary-faded",dropdownTitle:"Export",iconClass:"icon-export",rightAlign:!0,selectedOption:!0})}}),define("js/wraps/visualization_dropdown",["js/widgets/dropdown-menu/widget"],function(e){var t=[{description:"Citation Metrics",navEvent:"show-metrics"},{description:"Author Network",navEvent:"show-author-network"},{description:"Paper Network",navEvent:"show-paper-network"},{description:"Concept Cloud",navEvent:"show-concept-cloud"},{description:"Results Graph",navEvent:"show-bubble-chart"}];return function(){return new e({links:t,btnType:"btn-primary-faded",dropdownTitle:"Explore",iconClass:"icon-explore",rightAlign:!0,selectedOption:!0})}}),define("js/mixins/user_change_rows",["marionette","js/components/api_targets"],function(e,t){var n={};return n.Model=Backbone.Model.extend({initialize:function(e){if(this.on("change:numFound",this.updateMax),this.on("change:rows",this.updateCurrent),!e.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var n={rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0};_.extend(n,t._limits[e.widgetName]),this.defaults=function(){return n},this.set(this.defaults())},updateMax:function(){var e=_.min([this.get("limit"),this.get("numFound")]);this.set("max",e)},updateCurrent:function(){this.set("current",_.min([this.get("rows"),this.get("numFound")]))}}),n}),define("hbs!js/widgets/network_vis/templates/author-details-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <button class="btn btn-sm  btn-default filter-remove"><i class="s-filter-image"></i>remove from filter</button>\n'},3:function(e,t,n,i){return'            <button class="btn btn-sm btn-default filter-add"> <i class="s-filter-image"></i> add to filter</button>\n'},5:function(e,t,n,i){var r,a;return'        <li>\n            <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'"  target="_blank"><b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+"</b></a> "+(null!=(r=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+" "+(null!=(r=t.if.call(e,null!=e?e.numAuthors:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"        </li>\n"},6:function(e,t,n,i){var r;return"\n            <small> "+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+" citations</small>\n"},8:function(e,t,n,i){return"            <small>no citations</small>\n            "},10:function(e,t,n,i){var r;return"\n            <small>("+this.escapeExpression("function"==typeof(r=null!=(r=t.numAuthors||(null!=e?e.numAuthors:e))?r:t.helperMissing)?r.call(e,{name:"numAuthors",hash:{},data:i}):r)+" authors from this group)</small>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div class="author-detail-header">\n    <div style="border-bottom:4px solid '+this.escapeExpression("function"==typeof(a=null!=(a=t.groupColor||(null!=e?e.groupColor:e))?a:t.helperMissing)?a.call(e,{name:"groupColor",hash:{},data:i}):a)+'" >\n        <h4>'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+"</h4>\n"+(null!=(r=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"    </div>\n    <div>\n        Total Papers: "+this.escapeExpression("function"==typeof(a=null!=(a=t.total||(null!=e?e.total:e))?a:t.helperMissing)?a.call(e,{name:"total",hash:{},data:i}):a)+"\n        Most recent Paper: "+this.escapeExpression("function"==typeof(a=null!=(a=t.mostRecentYear||(null!=e?e.mostRecentYear:e))?a:t.helperMissing)?a.call(e,{name:"mostRecentYear",hash:{},data:i}):a)+'\n    </div>\n    <button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(a=null!=(a=t.dataQuery||(null!=e?e.dataQuery:e))?a:t.helperMissing)?a.call(e,{name:"dataQuery",hash:{},data:i}):a)+'">View author network for this author</button>\n\n\n</div>\n<div class="paper-description">\n<h5> Papers by this author </h5>\n    <ul class="list-unstyled">\n'+(null!=(r=t.each.call(e,null!=e?e.papers:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+"    </ul>\n</div>\n"},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/author-details-template",n),n}),define("hbs!js/widgets/network_vis/templates/container-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="container-fluid">\n<div class="row s-control-row">\n        <div class="col-sm-5">\n            <div class="network-metadata s-network-metadata"></div>\n        </div>\n        <div class="col-sm-6">\n            <div class="network-filter-container s-network-filter-container"></div>\n        </div>\n        <div class="col-sm-1">\n            <div class="s-large-close close-widget close">x</div>\n         </div>\n</div>\n     <div class="network-container s-network-container row">\n         <div class="col-md-7 graph-container">\n\n         </div>\n         <div class="col-md-5 details-container">\n\n             \x3c!--tabs--\x3e\n\n             <div role="tabpanel">\n\n                 \x3c!-- Nav tabs --\x3e\n                 <ul class="nav nav-tabs" role="tablist">\n                     <li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">Summary</a></li>\n                     <li role="presentation"><a href="#selected-item" aria-controls="profile" role="tab" data-toggle="tab">Detail </a></li>\n                 </ul>\n\n                 \x3c!-- Tab panes --\x3e\n                 <div class="tab-content">\n                     <div role="tabpanel" class="tab-pane active" id="home"></div>\n                     <div role="tabpanel" class="tab-pane" id="selected-item">\n                         <br/>\n                         <br/>\n                         <b>No item selected</b>\n                         <p> Click on a section in the visualization on the left to see the papers\n                         associated with an author or group of authors.</p>\n                     </div>\n\n                 </div>\n\n             </div>\n\n\n\n         </div>\n\n     </div>\n </div>\n'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/container-template",n),n}),define("hbs!js/widgets/network_vis/templates/filter-container-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return null!=(r=t.each.call(e,null!=e?e.limit:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:""},2:function(e,t,n,i){var r;return"            "+this.escapeExpression(this.lambda(e,e))+" "+(null!=(r=t.unless.call(e,i&&i.last,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"\n"},3:function(e,t,n,i){return" OR "},5:function(e,t,n,i){return'        select an author or group of authors in the visualization below and click the "add to filter" button\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div>\n    <b><i class="s-filter-image"></i> Filter current search:</b>\n    <button class="btn btn-default btn-xs clear-filter"> X clear</button>\n\n</div>\n<div class="s-filter-names-container ">\n'+(null!=(r=t.if.call(e,null!=e?e.limit:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(5,i,0),data:i}))?r:"")+'\n\n</div>\n\n\n<div class="s-filter-buttons-container">\n    <div>\n        <button class="btn btn-success apply-filter"> <i class="icon-go fa-lg"></i></button>\n    </div>\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/filter-container-template",n),n}),define("hbs!js/widgets/network_vis/templates/graph-container-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-network-control-panel">\n    <div class="detail-panel s-detail-panel">\n        <h4 style="display:inline-block">Size wedges based on:</h4>\n        <div class="btn-group network-sizes" data-toggle="buttons">\n        <label class="btn btn-primary active">\n            <input type="radio" name="mode" value="size" checked autocomplete="off"> Author Occurrences\n        </label>\n        <label class="btn btn-primary">\n            <input type="radio" name="mode" value="citation_count" autocomplete="off"> Paper Citations\n        </label>\n        <label class="btn btn-primary">\n            <input type="radio" name="mode" value="read_count" autocomplete="off"> Paper Downloads\n        </label>\n        </div>\n        <br/>\n        <label>\n            <input type="checkbox" name="show-link" value="true"> View Link Overlay\n        </label>\n    </div>\n</div>\n\n<div class="s-network-graph-div">\n    <svg id="network-viz-main-chart"\n         class="network-chart s-network-chart"\n         viewBox="0 0 900 900"\n         style="font-family:helvetica,arial,san-serif"\n    >\n    </svg>\n\n</div>\n\n\n\n\n\n\n\n'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/graph-container-template",n),n}),define("hbs!js/widgets/network_vis/templates/group-details-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'            <button class="btn btn-sm btn-default filter-remove"><i class="s-filter-image"></i>remove from filter</button>\n'},3:function(e,t,n,i){return'            <button class="btn btn-sm btn-default filter-add"> <i class="s-filter-image"></i> add to filter</button>\n'},5:function(e,t,n,i){var r,a;return'        <li>\n            <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.bibcode||(null!=e?e.bibcode:e))?a:t.helperMissing)?a.call(e,{name:"bibcode",hash:{},data:i}):a)+'" data-bypass="" target="_blank"><b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+"</b></a> "+(null!=(r=t.if.call(e,null!=e?e.citation_count:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+" "+(null!=(r=t.if.call(e,null!=e?e.numAuthors:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"\n        </li>\n"},6:function(e,t,n,i){var r;return"\n            <small> "+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+" citations</small> "},8:function(e,t,n,i){return"\n            <small>no citations</small> "},10:function(e,t,n,i){var r;return"\n            <small>("+this.escapeExpression("function"==typeof(r=null!=(r=t.numAuthors||(null!=e?e.numAuthors:e))?r:t.helperMissing)?r.call(e,{name:"numAuthors",hash:{},data:i}):r)+" authors from this group)</small> "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\n<div class="author-detail-header">\n    <div style="border-bottom:4px solid '+this.escapeExpression("function"==typeof(a=null!=(a=t.groupColor||(null!=e?e.groupColor:e))?a:t.helperMissing)?a.call(e,{name:"groupColor",hash:{},data:i}):a)+'">\n        <h4>Group '+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+'</h4>\n        <span class="pull-right">\n'+(null!=(r=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"        </span>\n    </div>\n    <small>Total papers: "+this.escapeExpression("function"==typeof(a=null!=(a=t.total||(null!=e?e.total:e))?a:t.helperMissing)?a.call(e,{name:"total",hash:{},data:i}):a)+"</small>\n    <small>Most recent: "+this.escapeExpression("function"==typeof(a=null!=(a=t.mostRecentYear||(null!=e?e.mostRecentYear:e))?a:t.helperMissing)?a.call(e,{name:"mostRecentYear",hash:{},data:i}):a)+'</small>\n</div>\n<div class="paper-description">\n\n    <ul class="list-unstyled">\n'+(null!=(r=t.each.call(e,null!=e?e.papers:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+"    </ul>\n</div>\n\n"},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/group-details-template",n),n}),define("hbs!js/widgets/network_vis/templates/not-enough-data-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'    <button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(r=null!=(r=t.cachedQuery||(null!=e?e.cachedQuery:e))?r:t.helperMissing)?r.call(e,{name:"cachedQuery",hash:{},data:i}):r)+'">\n        <i class="fa fa-arrow-left"></i>\n        Go back to previous author network. ('+this.escapeExpression("function"==typeof(r=null!=(r=t.cachedQuery||(null!=e?e.cachedQuery:e))?r:t.helperMissing)?r.call(e,{name:"cachedQuery",hash:{},data:i}):r)+")\n    </button>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="col-xs-12">\n    <br>\n    <p>  The network grouping algorithm could not generate group data for your network.</p>\n    <p> This might be because the list of papers was too small or sparse to produce multiple meaningful groups.</p>\n    <p><a href="https://adsabs.github.io/help/actions/visualize">\n        Learn more about how ADS networks are created and how they can be used.\n    </a></p>\n\n'+(null!=(r=t.if.call(e,null!=e?e.cachedQuery:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"</div>\n\n\n"},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/not-enough-data-template",n),n}),define("hbs!js/widgets/network_vis/templates/network_metadata",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'<form action="">\nChange to first <input type="text" class="network-rows s-network-rows form-control input-sm"/> papers (max is '+this.escapeExpression("function"==typeof(r=null!=(r=t.max||(null!=e?e.max:e))?r:t.helperMissing)?r.call(e,{name:"max",hash:{},data:i}):r)+').\n<button type="submit" class="submit-rows btn btn-sm btn-info"> Submit </button>\n</form>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return"<h4>Currently viewing data for "+this.escapeExpression("function"==typeof(a=null!=(a=t.current||(null!=e?e.current:e))?a:t.helperMissing)?a.call(e,{name:"current",hash:{},data:i}):a)+" papers.</h4><br/>\n"+(null!=(r=t.if.call(e,null!=e?e.max:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/network_metadata",n),n}),define("hbs!js/widgets/network_vis/templates/loading-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div><i class="icon-loading"></i> <p>Loading data...</p></div>\n\n'},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/loading-template",n),n}),define("hbs!js/widgets/network_vis/templates/default-details-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'<h3><span class="s-light-font">Author Network</span></h3>\n\n<p>This network visualization finds groups of authors within your search results.\n    You can click on the segments to view the papers connected with a group or a particular author.\n</p>\n\n<h5>Group Activity Over Time (measured in papers published)</h5>\n <div class="time-series-container">\n <svg viewBox="0 0 960 500" id="network-viz-time-series"></svg>\n </div>\n\n<br/>\n<div>\n    <a href="http://adsabs.github.io/help/actions/visualize#author-network" target="_blank">Learn more about the author network.</a>\n</div>\n\n\n'+(null!=(r=t.if.call(e,null!=e?e.cachedQuery:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?r:"")+"\n\n\n\n</div>\n\n"},2:function(e,t,n,i){var r;return'<button class="btn btn-default load-author-network" data-query="'+this.escapeExpression("function"==typeof(r=null!=(r=t.cachedQuery||(null!=e?e.cachedQuery:e))?r:t.helperMissing)?r.call(e,{name:"cachedQuery",hash:{},data:i}):r)+'">\n    <i class="fa fa-arrow-left"></i>\n    Go back to previous author network ('+this.escapeExpression("function"==typeof(r=null!=(r=t.cachedQuery||(null!=e?e.cachedQuery:e))?r:t.helperMissing)?r.call(e,{name:"cachedQuery",hash:{},data:i}):r)+")\n</button>\n"},4:function(e,t,n,i){return"\x3c!--only show this for first time view of network--\x3e\n\n<p>If you are interested in seeing the author network for another author, you can do that directly\n    by clicking on the author in the ring visualization, then clicking the button at the top.</p>\n\n<p>You can zoom and drag the visualization to reposition it.</p>\n\n"},6:function(e,t,n,i){var r;return'<h3><span class="s-light-font">Paper Network for Query</span> '+this.escapeExpression("function"==typeof(r=null!=(r=t.currentQuery||(null!=e?e.currentQuery:e))?r:t.helperMissing)?r.call(e,{name:"currentQuery",hash:{},data:i}):r)+'</h3>\n\n<p>The segments of the visualization to the left represent groups of papers from your result set which cite similar papers. </p>\n\n<h5>Group Activity Over Time (measured in papers published)</h5>\n<div class="time-series-container">\n    <svg id="network-chart-main-visualization" viewBox="0 0 960 500"></svg>\n</div>\n\n<br/>\n<p>Click on a group to learn more about the papers within the group, as well as the papers cited by those papers.</p>\n<a href="http://adsabs.github.io/help/actions/visualize#paper-network" target="_blank">Learn more about the paper network.</a>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.networkType:e,"author",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.networkType:e,"paper",{name:"compare",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/network_vis/templates/default-details-template",n),n}),define("js/widgets/network_vis/network_widget",["marionette","d3","js/components/api_targets","js/mixins/user_change_rows","js/components/api_request","js/components/api_query","js/widgets/base/base_widget","js/components/api_query_updater","hbs!js/widgets/network_vis/templates/author-details-template","hbs!js/widgets/network_vis/templates/container-template","hbs!js/widgets/network_vis/templates/filter-container-template","hbs!js/widgets/network_vis/templates/graph-container-template","hbs!js/widgets/network_vis/templates/group-details-template","hbs!js/widgets/network_vis/templates/not-enough-data-template","hbs!js/widgets/network_vis/templates/network_metadata","hbs!js/widgets/network_vis/templates/loading-template","hbs!js/widgets/network_vis/templates/default-details-template","bootstrap"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p,f,g,m){function b(e){return!isNaN(e)&&function(e){return(0|e)===e}(parseFloat(e))}var v=Backbone.Model.extend({defaults:{name:void 0},idAttribute:"name"}),y=Backbone.Collection.extend({model:v}),w=e.ItemView.extend({initialize:function(e){this.listenTo(this.collection,"add",this.render),this.listenTo(this.collection,"remove",this.render),this.listenTo(this.collection,"reset",this.render)},serializeData:function(){var e=this,t={};return t.limit=this.collection.pluck("name"),_.each(t.limit,function(n,i){b(n)&&"author"==e.options.networkType?t.limit[i]="at least one member of Group "+n:b(n)&&"paper"==e.options.networkType&&(t.limit[i]="Group "+n)}),t},template:u,childViewContainer:".dropdown-menu",events:{"click .apply-filter":"initiateFilter","click .clear-filter":"clearFilter"},initiateFilter:function(){this.trigger("filter:initiated")},clearFilter:function(){this.collection.reset()}}),x=e.ItemView.extend({template:m,serializeData:function(){return{currentQuery:e.getOption(this,"query"),networkType:e.getOption(this,"networkType"),cachedQuery:e.getOption(this,"cachedQuery")}},getData:function(){if("author"==e.getOption(this,"networkType")){r=[];_.each(e.getOption(this,"graphData").root.children,function(e,n){var i=n;if(!(n>6)){var a=[];_.each(e.children,function(e,t){Array.prototype.push.apply(a,e.papers)}),a=_.uniq(a);var s=_.map(a,function(e){return parseInt(e.slice(0,4))});a=_.countBy(a,function(e){return e.slice(0,4)});var o=_.range.apply(void 0,t.extent(s)),l={};_.each(o,function(e){l[e]=0}),a=_.extend(l,a),a=_.map(a,function(e,t){return{year:parseInt(t),amount:e}}),r.push({name:i,values:a})}})}else if("paper"==e.getOption(this,"networkType")){var n=e.getOption(this,"graphData").summaryGraph,i=e.getOption(this,"graphData").fullGraph,r=[],a={},s=_.pluck(n.nodes,"id"),o=_.pluck(n.nodes,"node_name");_.each(s,function(e,t){var n=[];_.each(i.nodes,function(t,i){t.group===e&&n.push(t.node_name)}),a[o[t]]=n}),_.each(a,function(e,n){if(!(n>6)){o=_.uniq(e);var i=_.map(o,function(e){return parseInt(e.slice(0,4))});o=_.countBy(o,function(e){return e.slice(0,4)});var a=_.range.apply(void 0,t.extent(i)),s={};_.each(a,function(e){s[e]=0});var o=_.extend(s,o);o=_.map(o,function(e,t){return{year:parseInt(t),amount:e}}),r.push({name:parseInt(n)-1,values:o})}})}return r},onRender:function(){var e=this.getData(),n=!0;if(_.each(e,function(e){1!==e.values.length&&(n=!1)}),n){var i=e[0].values[0].year;this.$(".time-series-container").html("Not enough data to show a graph: All papers are from the year "+i)}else{var r=[],a=[];_.each(e,function(e){_.each(e.values,function(e){r.push(e.year),a.push(e.amount)})}),r=_.uniq(r);var s={top:20,right:80,bottom:30,left:50},o=960-s.left-s.right,l=500-s.top-s.bottom,c=t.scale.linear().range([0,o]),u=t.scale.linear().range([l,0]),d=t.svg.axis().scale(c).orient("bottom").tickFormat(t.format("0f")).ticks(5);r.length<=10&&d.tickValues(r);var h=t.svg.axis().scale(u).tickFormat(t.format("d")).orient("left"),p=t.svg.line().interpolate("bundle").x(function(e){return c(e.year)}).y(function(e){return u(e.amount)}),f=t.select(this.$("svg")[0]).attr("width",o+s.left+s.right).attr("height",l+s.top+s.bottom).attr("style","font-family:helvetica,arial,san-serif").attr("id","network-viz-time-series").append("g").attr("transform","translate("+s.left+","+s.top+")"),g=t.scale.ordinal().domain([0,1,2,3,4,5,6]).range(["hsla(282, 80%, 52%, 1)","hsla(1, 80%, 51%, 1)","hsla(42, 97%, 48%, 1)","hsla(152, 80%, 40%, 1)","hsla(193, 80%, 48%, 1)","hsla(220, 80%, 56%, 1)","hsla(250, 69%, 47%, 1)"]);c.domain(t.extent(r)),u.domain([0,_.max(a)]),f.append("g").attr("class","axis").attr("transform","translate(0,"+l+")").call(d),f.append("g").attr("class","axis").call(h);var m=f.selectAll(".group").data(e).enter().append("g").attr("class","group");m.append("path").attr("class","line").attr("d",function(e){return p(e.values)}).style("stroke",function(e){return g(e.name)}),m.append("text").datum(function(e){return{name:e.name,value:e.values[e.values.length-1]}}).attr("transform",function(e){return"translate("+c(e.value.year)+","+u(e.value.amount)+")"}).attr("x",3).attr("dy",".35em").text(function(e){return e.name+1});n=_.filter(e,function(e){if(1==e.values.length)return!0});f.selectAll(".one-year").data(n).enter().append("circle").classed("one-year",!0).attr("r",5).attr("cx",function(e){return c(e.values[0].year)}).attr("cy",function(e){return u(e.values[0].amount)}).attr("fill",function(e){return g(e.name)})}}}),S=e.ItemView.extend({template:c,className:function(){return"network-widget s-network-widget "+e.getOption(this,"networkType")},serializeData:function(t){var n=e.getOption(this,"networkType");return n=n[0].toUpperCase()+n.slice(1),{networkType:n,helpText:e.getOption(this,"helpText")}},ui:{filterContainer:".network-filter-container",graphContainer:".graph-container",detailsContainerSelected:".details-container #selected-item",detailsContainerHome:".details-container #home"},events:{"click .load-author-network":"forwardNewQueryRequest","click button.limit":"addItem","click .submit-rows":"changeRows","click .close":"triggerClose","click .filter-remove":function(t){if("paper"==e.getOption(this,"networkType")){n=this.graphModel.get("selectedEntity").__data__.data.node_name;e.getOption(this,"filterCollection").remove({id:n}),this.graphView.showSelectedEntity(this.graphModel.get("selectedEntity"))}else{var n=this.graphModel.get("selectedEntity").__data__.name;e.getOption(this,"filterCollection").remove({id:n}),this.showDetailView(this.graphModel.get("selectedEntity"))}},"click .filter-add":function(t){if("paper"==e.getOption(this,"networkType")){var n=this.graphModel.get("selectedEntity").__data__.data.node_name;e.getOption(this,"filterCollection").add({name:n}),this.graphView.showSelectedEntity(this.graphModel.get("selectedEntity"))}else{var i=[],r=this.graphModel.get("selectedEntity").__data__;r.papers?i=r.papers:_.each(r.children,function(e){[].push.apply(i,e.papers)}),e.getOption(this,"filterCollection").add({name:r.name,papers:i}),this.showDetailView(this.graphModel.get("selectedEntity"))}}},triggerClose:function(){this.trigger("close")},forwardNewQueryRequest:function(e){this.ui.graphContainer.html(g()),this.trigger("new-network-requested",$(e.target).data("query"))},changeRows:function(e){e.preventDefault();var t=parseInt(this.$(".network-rows").val());this.$(".network-metadata").html(g),t&&this.model.set("userVal",_.min([this.model.get("max"),t]))},modelEvents:{"change:graphData":"render","change:max":"renderMetadata","change:current":"renderMetadata"},onRender:function(){var t,n;try{n=this.model.get("cachedQuery").get("q")[0]}catch(e){}return this.model.get("loading")?(this.$(".network-metadata").html(""),void this.$(".network-container").html(g())):!this.model.get("graphData")||_.isEmpty(this.model.get("graphData"))?(this.$(".network-metadata").html(""),void this.$(".network-container").html(p({cachedQuery:n}))):this.model.get("graphData").summaryGraph||this.model.get("graphData").root?(this.graphModel=new k({graphData:this.model.get("graphData")}),this.filterView=new w({collection:e.getOption(this,"filterCollection"),networkType:e.getOption(this,"networkType")}),this.listenTo(this.filterView,"filter:initiated",function(){this.trigger("filter:initiated")}),t=this.options.graphView?this.options.graphView:A,this.graphView=new t({model:this.graphModel,filterCollection:e.getOption(this,"filterCollection")}),this.graphView.on("show-detail-view",_.bind(this.showDetailView,this)),this.ui.filterContainer.append(this.filterView.render().el),this.ui.graphContainer.append(this.graphView.render().el),this.ui.detailsContainerHome.append(new x({graphData:this.model.get("graphData"),query:this.model.get("query"),networkType:e.getOption(this,"networkType"),cachedQuery:n}).render().el),this.$(".nav-tabs a[href='#home']").tab("show"),void this.renderMetadata()):(this.$(".network-metadata").html(""),void this.$(".network-container").html(p({cachedQuery:n})))},showDetailView:function(n){var i=n.__data__;(n=t.select(n)).select(".node-label").classed("selected-label",!0),n.select(".node-path").classed("selected-node",!0);var r,a=[],s={},o=[],c=this.model.get("graphData");if(i.children){r=i.children,_.each(r,function(e){Array.prototype.push.apply(a,e.papers)});f=_.sortBy(a,function(e){return e.slice(0,4)}).reverse()[0].slice(0,4);a=_.pairs(_.countBy(a));var u=_.chain(a).map(function(e){return e[1]}).sortBy(function(e){return e}).value(),d=_.chain(a).map(function(e){return e[1]/c.bibcode_dict[e[0]].authors.length}).sortBy(function(e){return e}).value(),p=_.chain(a).map(function(e){return c.bibcode_dict[e[0]].citation_count/c.bibcode_dict[e[0]].authors.length}).sortBy(function(e){return e}).value();a=_.sortBy(a,function(e){return(e[1]-u[0])/(u[u.length-1]-u[0])*(e[1]/c.bibcode_dict[e[0]].authors.length-d[0])/(d[d.length-1]-d[0])*(c.bibcode_dict[e[0]].citation_count/c.bibcode_dict[e[0]].authors.length-p[0])/(p[p.length-1]-p[0])}).reverse(),bibcodes=_.map(a,function(e){return e[0]}),o=_.map(bibcodes,function(e,t){var n={};return n.bibcode=e,n.title=c.bibcode_dict[e].title,n.citation_count=c.bibcode_dict[e].citation_count,n.numAuthors=a[t][1],n}),s.bibcodes=bibcodes,s.papers=o,s.groupColor=i.color,s.total=a.length,s.mostRecentYear=f,s.name=i.name,s.inFilter=!!e.getOption(this,"filterCollection").get(i.name),this.ui.detailsContainerSelected.empty().append(h(s))}else{o=_.map(i.papers,function(e){var t=c.bibcode_dict[e];return t.bibcode=e,_.isArray(t.title)&&(t.title=t.title[0]),t}),o=_.sortBy(o,function(e){return e.citation_count}).reverse();var f=_.chain(o).pluck("bibcode").sortBy(function(e){return e.slice(0,4)}).value().reverse()[0].slice(0,4);s.bibcodes=i.papers,s.mostRecentYear=f,s.papers=o,s.total=o.length,s.name=i.name,s.groupColor=i.parent.color,s.inFilter=!!e.getOption(this,"filterCollection").get(i.name),s.dataQuery='author:"'+i.name+'"',this.ui.detailsContainerSelected.empty().append(l(s))}this.$(".nav-tabs a[href='#selected-item']").tab("show")},renderMetadata:function(){var e={};e.max=this.model.get("max"),e.current=this.model.get("current"),this.$(".network-metadata").html(f(e))}}),E=i.Model.extend({initialize:function(e){var e=e||{};if(this.on("newMetadata",function(){this.updateCurrent(),this.updateMax()}),!e.widgetName)throw new Error("need to configure with widget name so we can get limit/default info from api_targets._limits");var t={graphData:{},rows:void 0,numFound:void 0,current:void 0,max:void 0,userVal:void 0,cachedQuery:void 0,loading:!0};_.extend(t,n._limits[e.widgetName]),this.defaults=function(){return t},this.set(this.defaults())}}),A=e.ItemView.extend({initialize:function(e){this.listenTo(e.filterCollection,"reset",this.showSelectedEntity)},template:d,events:{"change input[name=mode]":function(e){this.model.set("mode",e.target.value)},"change input[name=show-link]":function(e){this.model.set("linkLayer",e.target.checked)}},modelEvents:{"change:graphData":"renderGraph","change:selectedEntity":"showSelectedEntity","change:linkLayer":"changeLinkLayer","change:mode":"changeMode"},onRender:function(){this.model.get("graphData")&&this.renderGraph()},getConfig:function(){this.config={numberOfLabelsToShow:100,width:900,height:900,noGroupColor:"#a6a6a6"},this.config.radius=Math.min(this.config.width,this.config.height)/3},cachedVals:{partition:void 0,line:void 0,computeLabelPosition:void 0,svg:void 0,arc:void 0},renderGraph:function(){function e(e){var n=(e.x+e.x+e.dx)/2*180/Math.PI-90,r=parseInt(i.config.radius)+10,a=n>90?180:0;return a?t.select(this).attr("text-anchor","end"):t.select(this).attr("text-anchor","start"),"rotate("+n+")translate("+r+")rotate("+a+")"}var n=this.model.get("graphData"),i=this;this.cachedVals.svg=t.select(this.$("svg")[0]),this.getConfig(),this.customizeScales(n),this.cachedVals.computeLabelPosition=e;var r=i.cachedVals.svg.attr("width",i.config.width).attr("height",i.config.height).append("g").classed("network-g",!0),a=r.append("g").classed("real-container-of-stuff",!0),s=t.behavior.zoom().scaleExtent([.7,3]).on("zoom",function(){a.attr("transform","translate("+t.event.translate+")scale("+t.event.scale+")")});r.call(s),r.on("dblclick.zoom",null),r.attr("transform","translate("+i.config.width/2+","+i.config.height/2.1+")");var o=t.layout.partition().value(function(e){return e.size}).size([2*Math.PI,i.config.radius*i.config.radius]).sort(function(e,t){return t.value-e.value});this.cachedVals.partition=o;var l=t.svg.arc().startAngle(function(e){return e.x}).endAngle(function(e){return e.x+e.dx}).innerRadius(function(e){return 1==e.depth?Math.sqrt(e.y)+40:Math.sqrt(e.y)}).outerRadius(function(e){return Math.sqrt(e.y+e.dy)});this.cachedVals.arc=l,a.append("circle").attr("r",i.config.radius).attr("fill","#fff").style("cursor","move");var c=a.selectAll("g").data(o.nodes(n.root)).enter().append("g").classed("node-containers",!0).each(function(e){e.sortVal=e.value}),u={};c.append("path").attr("d",l).classed("node-path",function(e){return 0!=e.depth}).style("cursor",function(e){if(0==e.depth)return"move"}).style("fill",function(e){if(0==e.depth)return"white";if(1==e.depth){var t=e.parent.children.indexOf(e);return t<7?(e.color=i.scales.color(t),u[e.name]=e.color,e.color):i.config.noGroupColor}return 2==e.depth?e.parent.color?e.parent.color:i.config.noGroupColor:void 0}).each(function(e){e.x0=e.x,e.dx0=e.dx});c.filter(function(e){return!e.children}).classed("author-node",!0).append("text").text(function(e){return e.name}).classed("node-label",!0).on("mouseover",function(e){if(i.model.get("linkLayer")){var n=e;t.selectAll(".link").filter(function(e){if(e[0]==n||e[e.length-1]==n)return!0}).classed("selected-link",!0),t.selectAll(".link").each(function(e){e[0]==n?t.selectAll(".node-label").filter(function(t){return t.name==e[e.length-1].name}).classed("linked-label",!0):e[e.length-1]==n&&t.selectAll(".node-label").filter(function(t){return t.name==e[0].name}).classed("linked-label",!0)})}}).on("mouseout",function(){t.selectAll(".link").classed("selected-link",!1),t.selectAll(".node-label").classed("linked-label",!1)}).attr("font-size",function(e){return i.scales.occurrencesFontScale(e.size)+"px"}).attr("transform",e),_.each(n.root.name,function(e,t){a.append("text").classed("s-connector-node",!0).attr("y",function(){return 25*t-25*n.root.name.length/2}).text(e.nodeName)}),c.on("click",function(e,t){0!=e.depth&&(i.model.get("linkLayer")||(i.model.get("selectedEntity")===this?i.model.set("selectedEntity",null):i.model.set("selectedEntity",this)))}),this.renderLinkLayer()},renderLinkLayer:function(){var e=this;svg=t.select(e.$(".real-container-of-stuff")[0]),tooltip=t.select(e.$(".d3-tooltip")[0]),bibDict=this.model.get("graphData").bibcode_dict;var n,i,r,a;n=_.map(e.model.get("graphData").link_data,function(e){var t={};return t.source=svg.selectAll(".node-path").filter(function(t){return t.numberName==e[0]})[0][0].__data__,t.target=svg.selectAll(".node-path").filter(function(t){return t.numberName==e[1]})[0][0].__data__,t.weight=e[2],t}),i=t.layout.bundle(),r=t.svg.line.radial().interpolate("bundle").tension(.9).radius(function(e){return Math.sqrt(e.y+e.dy)}).angle(function(e){return(e.x+e.x+e.dx)/2}),this.cachedVals.line=r,(a=svg.append("g").classed("link-container",!0)).append("circle").attr("r",e.config.radius).classed("link-background",!0),a.selectAll(".link").data(i(n)).enter().append("path").attr("class","link").attr("d",function(e){return r(e)}).attr("stroke-width",function(t){var i=_.filter(n,function(e){return e.source==t[0]&&e.target==t[t.length-1]||e.target==t[0]&&e.source==t[t.length-1]})[0].weight;return e.scales.linkScale(i)})},customizeScales:function(e){this.scales={},this.scales.color=t.scale.ordinal().domain([0,1,2,3,4,5,6]).range(["hsla(282, 60%, 52%, 1)","hsla(349, 61%, 47%, 1)","hsla(26, 95%, 67%, 1)","hsla(152, 60%, 40%, 1)","hsla(193, 64%, 61%, 1)","hsla(220, 70%, 56%, 1)","hsla(250, 50%, 47%, 1)"]);var n=[],i=[],r=[];_.each(e.root.children,function(e){_.each(e.children,function(e){n.push(e.size),i.push(e.citation_count),r.push(e.read_count)})}),i=_.sortBy(i,function(e){return e}).reverse(),r=_.sortBy(r,function(e){return e}).reverse(),this.scales.citationLimit=i[this.config.numberOfLabelsToShow]||i[i.length-1],this.scales.readLimit=r[this.config.numberOfLabelsToShow]||r[r.length-1],this.scales.occurrencesFontScale=t.scale.log().domain([t.min(n),t.max(n)]).range([8,20]),this.scales.citationFontScale=t.scale.linear().domain([t.min(i),t.max(i)]).range([8,20]),this.scales.readFontScale=t.scale.linear().domain([t.min(r),t.max(r)]).range([8,20]);var a=_.map(e.link_data,function(e){return e[2]});this.scales.linkScale=t.scale.pow().exponent(8).domain([t.min(a),t.max(a)]).range([.5,3.5])},showSelectedEntity:function(){var e=this.model.get("selectedEntity"),t=this.$(".network-detail-area");this.cachedVals.svg.selectAll(".node-path").classed("selected-node",!1),this.cachedVals.svg.selectAll(".node-label").classed("selected-label",!1),t.empty(),e&&this.trigger("show-detail-view",e)},changeLinkLayer:function(e,n){if(n){this.model.set("cachedEntity",this.model.get("selectedEntity")),this.model.set("selectedEntity",void 0);var i;t.select(this.$(".link-container")[0]).style("display","block").selectAll(".link").call(function(e){i=3e3/e[0].length}).sort(function(e){return e.weight}).style("display","block")}else this.model.set("selectedEntity",this.model.get("cachedEntity")),t.select(this.$(".link-container")[0]).style("display","none")},changeMode:function(e,n){var i=this,r=i.cachedVals.svg.selectAll(".node-containers"),a=i.cachedVals.partition.sort(function(e,t){return t.sortVal-e.sortVal}).value(function(e){return e[n]}).nodes(i.model.get("graphData").root);r.data(a,function(e){return e.name}).selectAll("path").transition().duration(1500).attrTween("d",function(e){var n=t.interpolate({x:e.x0,dx:e.dx0},e);return function(t){var r=n(t);return e.x0=r.x,e.dx0=r.dx,i.cachedVals.arc(r)}}),r.selectAll("text").attr("opacity","0").attr("display",function(e){return"size"==n?"block":"citation_count"==n&&e.citation_count>i.scales.citationLimit?"block":"read_count"==n&&e.read_count>i.scales.readLimit?"block":"none"}).attr("font-size",function(e){return"size"==n?i.scales.occurrencesFontScale(e.size)+"px":"citation_count"==n?i.scales.citationFontScale(e.citation_count)+"px":"read_count"==n?i.scales.readFontScale(e.read_count)+"px":void 0}).attr("transform",i.cachedVals.computeLabelPosition).transition().duration(1500).attr("opacity",1),t.selectAll(".link").transition().duration(1500).attr("d",function(e){return i.cachedVals.line(e)})}}),k=Backbone.Model.extend({defaults:function(){return{graphData:{},selectedEntity:void 0,cachedEntity:void 0,query:void 0,linkLayer:!1,mode:"occurrences"}}});return s.extend({initialize:function(e){if(!e.endpoint)throw new Error("widget was not configured with an endpoint");e.broadcastFilteredQuery&&(this.broadcastFilteredQuery=e.broadcastFilteredQuery),this.model=new E({widgetName:e.widgetName||"AuthorNetwork"}),this.listenTo(this.model,"change:userVal",this.requestDifferentRows),this.filterCollection=new y,this.view=new S({graphView:e.graphView,model:this.model,filterCollection:this.filterCollection,networkType:e.networkType,helpText:e.helpText,graphMixin:e.graphMixin,showDetailGraphView:e.showDetailGraphView}),this.listenTo(this.view,"new-network-requested",this.requestDifferentQuery),this.listenTo(this.view,"filter:initiated",this.broadcastFilteredQuery),this.listenTo(this.view,"close",this.broadcastClose),this.widgetName="visualization_"+e.networkType,this.queryUpdater=new o(this.widgetName)},generateApiRequest:function(t){return new r({target:e.getOption(this,"endpoint"),query:new a({query:JSON.stringify(t.toJSON())}),options:{type:"POST",contentType:"application/json"}})},requestDifferentRows:function(e,t){var n=this.getCurrentQuery().clone();n.unlock(),n.set("rows",this.model.get("userVal")),n.unset("hl"),n.unset("hl.fl");var i=this.generateApiRequest(n);this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,i)},requestDifferentQuery:function(e){this.model.set("cachedQuery",this.getCurrentQuery());var t=new a;t.set("q",e),t.set("rows",this.model.get("default")),t.set("sort","date desc");var n=this.generateApiRequest(t);this.setCurrentQuery(t),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setOriginalQuery","processResponse");var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setOriginalQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setOriginalQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},setOriginalQuery:function(e){this.model.set("cachedQuery",void 0),this._originalQuery=e,this.setCurrentQuery(e)},getOriginalQuery:function(){return this._originalQuery},resetWidget:function(){this.view&&this.view.graphView&&(this.view.graphView.$el.empty(),this.view.graphView.stopListening()),this.filterCollection.reset(null,{silent:!0}),this.model.set(_.result(this.model,"defaults"),{silent:!0})},renderWidgetForListOfBibcodes:function(t){this.resetWidget(),this.model.set({graphData:{},loading:!0});var n=new r({target:e.getOption(this,"endpoint"),query:new a({bibcodes:t}),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)},renderWidgetForCurrentQuery:function(){this.resetWidget();var e=this.getCurrentQuery().clone();if(e.unlock(),e.get("__qid")){e.set("fl","bibcode"),e.set("rows","1000");t=this.composeRequest(e);this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,t)}else{e.set("rows",this.model.get("default")),e.unset("hl"),e.unset("hl.fl");var t=this.generateApiRequest(e);this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,t)}},processResponse:function(e){try{e.get("responseHeader.params.__qid");this.renderWidgetForListOfBibcodes(e.get("response").docs.map(function(e){return e.bibcode}))}catch(n){var t=e.toJSON();this.model.set({graphData:t.data,numFound:parseInt(t.msg.numFound),rows:parseInt(t.msg.rows),query:e.getApiQuery().get("q"),loading:!1}),this.model.trigger("newMetadata")}},broadcastFilteredQuery:function(){var e=_.flatten(this.filterCollection.pluck("papers")),t=this.getOriginalQuery().clone();t.unlock(),t.set("__bigquery",e),this.resetWidget(),this.getPubSub().publish(this.getPubSub().START_SEARCH,t)},broadcastClose:function(){this.resetWidget(),this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},testing:{detailView:x}})}),define("js/wraps/author_network",["js/widgets/network_vis/network_widget","js/components/api_targets"],function(e,t){var n={};return n.endpoint=t.SERVICE_AUTHOR_NETWORK,n.helpText="<p>The circular graph shows you the main author groups within your results.These groups are generated by a community detection algorithm, and their sizes represent the cumulative frequency of occurence in the result set of all their members. (In other words: people who co-author papers together appear in the same cluster.) Click on either a name or a group tolearn more about the papers by those particular authors. You can filter your current search resultsby clicking the 'add to filter' button in the detail view. </p>",n.networkType="author",function(){return new e(n)}}),define("hbs!js/wraps/templates/paper-network-data",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"\n        "+this.escapeExpression(this.lambda(e,e))+(null!=(r=t.unless.call(e,i&&i.last,{name:"unless",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+"\n"},2:function(e,t,n,i){return", "},4:function(e,t,n,i){return'        <button class="btn btn-xs btn-default filter-remove"><i class="s-filter-image"></i>remove group from filter</button>\n'},6:function(e,t,n,i){return'        <button class="btn btn-xs btn-default filter-add"><i class="s-filter-image"></i> add group to filter</button>\n'},8:function(e,t,n,i){return"           <p><b>Top papers from this group include:</b> </p>\n"},10:function(e,t,n,i){return"           <p><b>Papers in this group: </b></p>\n"},12:function(e,t,n,i){return'               <li title="'+this.escapeExpression(this.lambda(null!=e?e.node_name:e,e))+'">\n                   <a href="#abs/'+this.escapeExpression(this.lambda(null!=e?e.node_name:e,e))+'" data-bypass target="_blank"><b>'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</b></a>; <i>"+this.escapeExpression(this.lambda(null!=e?e.first_author:e,e))+"</i>\n                   ("+this.escapeExpression(this.lambda(null!=e?e.citation_count:e,e))+" citations)\n               </li>\n\n"},14:function(e,t,n,i){var r;return"\n               <li>\n"+(null!=(r=t.if.call(e,null!=e?e.inGroup:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.program(17,i,0),data:i}))?r:"")+'                   <a href="#abs/'+this.escapeExpression(this.lambda(null!=e?e.bibcode:e,e))+'" data-bypass target="_blank">'+this.escapeExpression(this.lambda(null!=e?e.bibcode:e,e))+"</a> (cited by "+this.escapeExpression(this.lambda(null!=e?e.percent:e,e))+"% of papers\n                   in this group)\n               </li>\n\n"},15:function(e,t,n,i){return'                   <i class="fa fa-star-o"></i>\n'},17:function(e,t,n,i){return'                   <i class="fa fa-star-o no-show"></i>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div style="padding: 0 -15px">\n<div class="s-group-title clearfix" style="border-bottom: 6px solid '+this.escapeExpression("function"==typeof(a=null!=(a=t.borderColor||(null!=e?e.borderColor:e))?a:t.helperMissing)?a.call(e,{name:"borderColor",hash:{},data:i}):a)+';">\n\n    <h3>Group '+this.escapeExpression("function"==typeof(a=null!=(a=t.groupIdToShow||(null!=e?e.groupIdToShow:e))?a:t.helperMissing)?a.call(e,{name:"groupIdToShow",hash:{},data:i}):a)+':\n       <span class="s-light-font"> '+(null!=(r=t.each.call(e,null!=(r=null!=e?e.summaryData:e)?r.titleWords:r,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'        </span>\n    </h3>\n\n    <div class="pull-right">\n'+(null!=(r=t.if.call(e,null!=e?e.inFilter:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?r:"")+'    </div>\n\n</div>\n\n   <div class="s-group-content">\n\n       <p>This group consists of <b>'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.summaryData:e)?r.paper_count:r,e))+"</b> papers, which have been cited, in total, <b>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.summaryData:e)?r.total_citations:r,e))+"</b>\n           times.</p>\n\n       <div>\n"+(null!=(r=t.if.call(e,null!=e?e.morePapers:e,{name:"if",hash:{},fn:this.program(8,i,0),inverse:this.program(10,i,0),data:i}))?r:"")+'           <ul class="list-unstyled s-top-papers">\n'+(null!=(r=t.each.call(e,null!=e?e.topNodes:e,{name:"each",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?r:"")+'           </ul>\n\n       </div>\n\n       <div>\n           <p><b> Papers highly referenced by papers in this group:</b> <br/>\n               (A <i class="fa fa-star-o"></i> indicates that this paper is also a member of Group '+this.escapeExpression("function"==typeof(a=null!=(a=t.groupIdToShow||(null!=e?e.groupIdToShow:e))?a:t.helperMissing)?a.call(e,{name:"groupIdToShow",hash:{},data:i}):a)+')</p>\n\n           <ul class="list-unstyled">\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.summaryData:e)?r.processedTopCommonReferences:r,{name:"each",hash:{},fn:this.program(14,i,0),inverse:this.noop,data:i}))?r:"")+"\n           </ul>\n           <small>(Click on a link above to view the paper's abstract page in ADS in a new tab)</small>\n       </div>\n\n\n\n   </div>\n\n</div>\n\n\n\n\n\n\n\n"},useData:!0});return t.registerPartial("js/wraps/templates/paper-network-data",n),n}),define("hbs!js/wraps/templates/paper-network-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-network-graph-div">\n    <div class="detail-panel s-detail-panel">\n        <h4 style="display:inline-block">Size wedges based on:</h4>\n        <div class="btn-group network-sizes" data-toggle="buttons">\n            <label class="btn btn-primary active">\n                <input type="radio" name="mode" value="paper_count" checked autocomplete="off"> Number of Papers\n            </label>\n            <label class="btn btn-primary">\n                <input type="radio" name="mode" value="total_citations" autocomplete="off"> Paper Citations\n            </label>\n            <label class="btn btn-primary">\n                <input type="radio" name="mode" value="total_reads" autocomplete="off"> Paper Downloads\n            </label>\n        </div>\n    </div>\n\n    <svg class="network-chart s-network-chart" width="400"\n         height="400" viewBox="0 0 300 300"\n         id="network-viz-main-chart"\n         style="font-family:helvetica,arial,san-serif"\n    >\n    </svg>\n</div>\n\n'},useData:!0});return t.registerPartial("js/wraps/templates/paper-network-container",n),n}),define("hbs!js/wraps/templates/paper-network-link-data",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'        <tr>\n            <td>\n                <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+'">'+this.escapeExpression("function"==typeof(r=null!=(r=t.name||(null!=e?e.name:e))?r:t.helperMissing)?r.call(e,{name:"name",hash:{},data:i}):r)+"</a>\n            </td>\n            <td>\n                "+this.escapeExpression("function"==typeof(r=null!=(r=t.percentOne||(null!=e?e.percentOne:e))?r:t.helperMissing)?r.call(e,{name:"percentOne",hash:{},data:i}):r)+"%\n            </td>\n            <td>\n                "+this.escapeExpression("function"==typeof(r=null!=(r=t.percentTwo||(null!=e?e.percentTwo:e))?r:t.helperMissing)?r.call(e,{name:"percentTwo",hash:{},data:i}):r)+"%\n            </td>\n        </tr>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div class="s-group-title s-paper-network-link-data-header">\n\n    <h3>References From Both <span style="color:'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.group1:e)?r.color:r,e))+'"> Group '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.group1:e)?r.name:r,e))+' </span> and <span\n            style="color:'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.group2:e)?r.color:r,e))+'"> Group '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.group2:e)?r.name:r,e))+' </span></h3>\n\n</div>\n\n<div class="s-group-content">\n    <p>These groups have <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.referencesLength||(null!=e?e.referencesLength:e))?a:t.helperMissing)?a.call(e,{name:"referencesLength",hash:{},data:i}):a)+' </b> unique references in common</p>\n\n    <p></p>\n    <small>(Click on a link below to view the paper\'s abstract page in ADS in a new tab)</small>\n    </p>\n\n\n    <table class="table table-condensed">\n        <thead>\n        <tr>\n            <th>\n                Paper\n            </th>\n            <th>\n                Group '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.group1:e)?r.name:r,e))+"\n            </th>\n            <th>\n                Group "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.group2:e)?r.name:r,e))+"\n            </th>\n        </tr>\n        </thead>\n        <tbody>\n"+(null!=(r=t.each.call(e,null!=e?e.shared:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"        </tbody>\n    </table>\n\n\n</div>\n\n"},useData:!0});return t.registerPartial("js/wraps/templates/paper-network-link-data",n),n}),define("js/wraps/paper_network",["marionette","js/widgets/network_vis/network_widget","js/components/api_query_updater","hbs!js/wraps/templates/paper-network-data","hbs!js/wraps/templates/paper-network-container","hbs!js/widgets/network_vis/templates/not-enough-data-template","hbs!js/wraps/templates/paper-network-link-data","js/components/api_targets","bootstrap"],function(e,t,n,i,r,a,s,o,l){var c={};c.endpoint=o.SERVICE_PAPER_NETWORK,c.networkType="paper",c.helpText="<p>Papers are grouped by shared references, because  they are more likely to discuss similar topics.</p> <p>If your search returned a large enough set of papers, you will see two views: a <b>summary view</b>  with groups of tightly linked papers, and a <b>detail view</b>  that gives you more information about the group </p>";Backbone.Model.extend({defaults:function(){return{graphData:{},selectedEntity:void 0,cachedEntity:void 0,linkLayer:!1,mode:"occurrences"}}});return c.graphView=e.ItemView.extend({template:r,className:"graph-view",events:{"change input[name=mode]":function(e){this.model.set("mode",e.target.value)},"change input[name=show-link]":function(e){this.model.set("linkLayer",e.target.checked)},"click .filter-remove":function(t){var n=this.model.get("selectedEntity"),i=_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:n}).node_name;e.getOption(this,"filterCollection").remove({id:i}),this.showSelectedEntity()},"click .filter-add":function(t){var n=this.model.get("selectedEntity"),i=_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:n}).node_name;e.getOption(this,"filterCollection").add({name:i}),this.showSelectedEntity()}},modelEvents:{"change:graphData":"renderGraph","change:selectedEntity":"showSelectedEntity","change:mode":"changeMode"},onRender:function(){this.model.get("graphData")&&this.renderGraph()},getConfig:function(){this.config={width:300,height:300,noGroupColor:"hsl(0, 0%, 65%)"},this.config.radius=Math.min(this.config.width,this.config.height)/1.5,this.config.outerRadius=.33*Math.min(this.config.width,this.config.height),this.config.innerRadius=.21*Math.min(this.config.width,this.config.height)},generateCachedVals:function(){var e=this;this.cachedVals={line:void 0,bundle:void 0,svg:void 0,arc:void 0},this.cachedVals.bundle=d3.layout.bundle(),this.cachedVals.line=d3.svg.line.radial().interpolate("bundle").tension(.3).radius(function(t){return t.startAngle?e.config.innerRadius+10:0}).angle(function(e){return e.startAngle?(e.startAngle+e.endAngle)/2:0}),this.cachedVals.svg=d3.select(this.$("svg.network-chart")[0]).attr("width",e.config.width).attr("height",e.config.height).append("g").attr("transform","translate("+e.config.width/2+","+e.config.height/2+")"),this.cachedVals.arc=d3.svg.arc().innerRadius(e.config.innerRadius).outerRadius(e.config.outerRadius),this.cachedVals.pie=d3.layout.pie().value(function(e){return e.paper_count}).sort(function(e,t){return e.node_name-t.node_name}),e.cachedVals.groupTicks=function(e){return{angle:(e.startAngle+e.endAngle)/2,label:e.data.node_label,data:e}}},computeScales:function(){var e=this.model.get("graphData").summaryGraph;this.scales={};var t=_.map(e.links,function(e){if(e.source!==e.target)return e.weight});this.scales.tensionScale=d3.scale.linear().domain([d3.min(t),d3.max(t)]).range([0,1]),this.scales.linkScale=d3.scale.linear().domain([d3.min(t),d3.max(t)]).range([3,22]);var n=_.pluck(e.nodes,"paper_count");this.scales.initialFontScale=d3.scale.linear().domain([d3.min(n),d3.max(n)]).range([9,14]),this.scales.fill=d3.scale.ordinal().domain([1,2,3,4,5,6]).range(["hsl(282, 59%, 61%)","hsl(349, 54%, 57%)","hsl(26, 94%, 73%)","hsl(152, 40%, 52%)","hsl(193, 65%, 69%)","hsl(220, 70%, 65%)","hsl(250, 44%, 58%)"])},renderGraph:function(){function e(e){return function(t,n,i){"mouseenter"===e?t.data.node_name>7?d3.select(this).attr("fill",d3.hsl(s.config.noGroupColor).darker(.7)):d3.select(this).attr("fill",d3.hsl(s.scales.fill(t.data.node_name)).darker(.7)):t.data.node_name>7?d3.select(this).attr("fill",s.config.noGroupColor):d3.select(this).attr("fill",s.scales.fill(t.data.node_name))}}function t(e){return function(t,n,i){var r=d3.select(this.parentNode).data()[0].data.data.node_name,a=d3.selectAll(".node-path").filter(function(e){return e.data.node_name===r})[0][0];"mouseenter"===e?r>7?d3.select(a).attr("fill",d3.hsl(s.config.noGroupColor).darker(.7)):d3.select(a).attr("fill",d3.hsl(s.scales.fill(r)).darker(.7)):r>7?d3.select(a).attr("fill",d3.hsl(s.config.noGroupColor)):d3.select(a).attr("fill",s.scales.fill(r))}}this.getConfig(),this.computeScales(),this.generateCachedVals();var n=this.cachedVals.svg,i=this.model.get("graphData").summaryGraph,r=[],s=this;i||this.$el.html(a());var o=this.cachedVals.pie,l=this.cachedVals.arc,c=o(i.nodes);_.findWhere(c,{startAngle:0}).startAngle=.001,n.selectAll("rect").data(c).enter().append("rect").classed("node-path",!0),this.renderLinkLayer(),n.selectAll("rect").remove(),n.selectAll(".node-path").data(c).enter().append("path").classed("node-path",!0).attr("fill",function(e,t){return e.data.node_name>7?s.config.noGroupColor:s.scales.fill(e.data.node_name)}).attr("d",l).attr("id",function(e,t){return"vis-group-"+e.data.node_name}).on("mouseover",e("mouseenter")).on("mouseout",e("mouseleave")).on("click",function(e,t){e.data.id;s.model.set("selectedEntity",this)});var u=n.selectAll(".groupLabel").data(function(){return _.map(c,function(e,t){return s.cachedVals.groupTicks(e)})}).enter().append("g").each(function(e){r.push(e.data.value)}).classed("groupLabel",!0).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+1*s.config.outerRadius/1+",0)"});r=d3.sum(r);var d=u.append("g").attr("x",0).attr("dy",".5em").attr("transform",function(e,t){return"rotate("+-(180*e.angle/Math.PI-90)+")"}).classed("summary-label-container",!0).classed("hidden",function(e){if(e.data.value/r<.08)return!0}).selectAll("text").data(function(e,t){var n=_.pairs(e.label);return n=_.sortBy(n,function(e){return-e[1]}),n=n.slice(0,5),_.map(n,function(t){return t[2]=e.data.data.id,t})}).enter().append("text").attr("x",0).classed("paper-network-labels",!0).attr("text-anchor","middle").attr("y",function(e,t,n){var r=_.findWhere(i.nodes,{id:e[2]}).paper_count;return t*s.scales.initialFontScale(r)-30}).attr("font-size",function(e,t,n){var r=_.findWhere(i.nodes,{id:e[2]}).paper_count;return s.scales.initialFontScale(r)+"px"}).text(function(e,t){return e[0]});d.on("mouseover",t("mouseenter")).on("mouseout",t("mouseleave")),d.on("click",function(e){var t=d3.select(this.parentNode).data()[0].data.data.node_name,n=s.$("#vis-group-"+t)[0];s.model.set("selectedEntity",n)})},parseLinks:function(e){var t=this.cachedVals.svg,n={name:"fake"};return e=_.chain(e).map(function(e){var i={};return i.source=t.selectAll(".node-path").filter(function(t,n){return t.data.stable_index==e.source})[0][0].__data__,i.target=t.selectAll(".node-path").filter(function(t,n){return t.data.stable_index==e.target})[0][0].__data__,i.source===i.target?void 0:(i.weight=e.weight,i.source.parent=n,i.target.parent=n,i)}).filter(function(e){if(e)return!0}).value()},updateLinkLayer:function(){var e,t=this,n=this.cachedVals.svg,i=t.model.get("graphData").summaryGraph.links;i=this.parseLinks(i),e=this.cachedVals.line,n.selectAll(".link").data(t.cachedVals.bundle(i)).transition().duration(1e3).attr("d",function(t){return e(t)})},renderLinkLayer:function(){var e,t,n=this,i=this.cachedVals.svg,r=n.model.get("graphData").summaryGraph.links;r=this.parseLinks(r),e=this.cachedVals.line,(t=i.append("g").classed("link-container",!0)).append("circle").attr("r",n.config.radius).classed("link-background",!0),t.selectAll(".link").data(n.cachedVals.bundle(r)).enter().append("path").attr("class","link").attr("d",function(t){return e(t)}).attr("stroke-width",function(e){var t=_.findWhere(r,function(t){return t.source==e[0]&&t.target==e[e.length-1]||t.target==e[0]&&t.source==e[e.length-1]}).weight;return n.scales.linkScale(t)}).on("click",function(e){n.model.set("selectedEntity",[e[0],e[2]])})},showSelectedEntity:function(){var t,n=this,r={},a=this.model.get("selectedEntity");if(_.isArray(a)){var o,l,c,u,d,h,p=[];o=a[0].data.id,l=a[1].data.id,c=n.getAllLinks(o),u=n.getAllLinks(l),d=_.flatten(_.pluck(c,"overlap")),h=_.flatten(_.pluck(u,"overlap")),_.each(_.intersection(d,h),function(e){percent1=_.filter(d,function(t){return t==e}).length/d.length,percent2=_.filter(h,function(t){return t==e}).length/h.length,p.push({name:e,percentOne:100*percent1,percentTwo:100*percent2})}),p=_.sortBy(p,function(e){return e.percentOne*e.percentTwo}).reverse(),r.shared=p,_.each(r.shared,function(e,t){r.shared[t].percentOne=r.shared[t].percentOne.toFixed(2),r.shared[t].percentTwo=r.shared[t].percentTwo.toFixed(2)}),r.group1={name:_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:o}).node_name},r.group1.color=r.group1.name<8?n.scales.fill(r.group1.name):n.config.noGroupColor,r.group2={name:_.findWhere(this.model.get("graphData").summaryGraph.nodes,{id:l}).node_name},r.group2.color=r.group1.name<8?n.scales.fill(r.group2.name):n.config.noGroupColor,r.referencesLength=r.shared.length,$(".details-container #selected-item").html(s(r))}else{var a=a.__data__.data.id,f=_.findWhere(n.model.get("graphData").summaryGraph.nodes,function(e){return e.id==a});summaryData=$.extend({},f),summaryData.processedTopCommonReferences=[],summaryData.titleWords=_.keys(f.node_label);var g=_.pluck(n.getAllNodes(a),"node_name");_.each(summaryData.top_common_references,function(e,t){var n=!!_.contains(g,t);summaryData.processedTopCommonReferences.push({bibcode:t,percent:(100*e).toFixed(0),inGroup:n})}),summaryData.processedTopCommonReferences=_.sortBy(summaryData.processedTopCommonReferences,function(e){return e[1]}).reverse(),filteredNodes=this.getAllNodes(f.id),t=_.sortBy(filteredNodes,function(e){return e.citation_count}).reverse(),r.morePapers=t.length>30,r.summaryData=summaryData,r.inFilter=!!e.getOption(n,"filterCollection").get(f.node_name),r.topNodes=t.slice(0,30),r.groupIdToShow=f.node_name,r.borderColor=f.node_name<8?n.scales.fill(f.node_name):n.config.noGroupColor,r.backgroundColor=d3.hsl(r.borderColor).brighter(),$(".details-container #selected-item").html(i(r))}$(".nav-tabs a[href='#selected-item']").tab("show")},changeMode:function(){var e,t,n,i,r=this,a=this.cachedVals.pie,s=this.cachedVals.arc,o=this.cachedVals.svg,l=[],c=[],u=this.model.get("graphData").summaryGraph,d=this.model.get("mode");a.value(function(e){if("references"===d){var t=_.findWhere(u.links,function(t){if(t.source===e.stable_index&&t.target===e.stable_index)return!0});return l.push(t.weight),t.weight}return l.push(e[d]),e[d]}),t=a(u.nodes),e=d3.scale.linear().domain([d3.min(l),d3.max(l)]).range([7,17]),_.findWhere(t,{startAngle:0}).startAngle=.001,o.selectAll(".node-path").each(function(e){this.oldStartAngle=e.startAngle,this.oldEndAngle=e.endAngle}).data(t,function(e){return e.data.id}).transition().duration(1e3).attrTween("d",function(e,t){var t=d3.interpolate({startAngle:this.oldStartAngle,endAngle:this.oldEndAngle},e);return function(e){var n=t(e);return this.startAngle=n.startAngle,this.endAngle=n.endAngle,s(n)}}),this.updateLinkLayer(),n=_.map(t,function(e){return c.push(e.value),r.cachedVals.groupTicks(e)}),c=d3.sum(c),i=o.selectAll(".groupLabel").data(n).transition().duration(1e3).attr("transform",function(e){return"rotate("+(180*e.angle/Math.PI-90)+")translate("+r.config.outerRadius+",0)"}),o.selectAll(".summary-label-container").data(n).classed("hidden",function(e){if(e.data.value/c<.08)return!0}).transition().duration(1e3).attr("transform",function(e,t){return"rotate("+-(180*e.angle/Math.PI-90)+")"}),i.selectAll("text").attr("y",function(t,n,i){var r=this.parentNode.__data__.data.value;return n*e(r)-30}).attr("font-size",function(t,n,i){var r=this.parentNode.__data__.data.value;return e(r)+"px"})},getAllNodes:function(e){var t=this.model.get("graphData").fullGraph,n=[];return _.each(t.nodes,function(t,i){t.group===e&&n.push(t)}),n},getAllLinks:function(e){var t=this.model.get("graphData").fullGraph,n=[];return links=[],filteredNodes=[],_.each(t.nodes,function(t,i){t.group===e&&n.push(i)}),_.each(t.links,function(e,t){-1===n.indexOf(e.source)&&-1===n.indexOf(e.target)||links.push(e)}),links}}),c.broadcastFilteredQuery=function(){var e=this.model.get("graphData"),t=this,n=[],i=this.getCurrentQuery().clone();this.filterCollection.each(function(i){var r=i.get("name"),a=_.findWhere(e.summaryGraph.nodes,{node_name:r}),s=t.view.graphView.getAllNodes(a.id);s=_.pluck(s,"node_name"),Array.prototype.push.apply(n,s)}),i.unlock(),i.set("__bigquery",n),this.resetWidget(),this.getPubSub().publish(this.getPubSub().START_SEARCH,i)},c.widgetName="PaperNetwork",function(){return new t(c)}}),define("hbs!js/widgets/wordcloud/templates/wordcloud-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<span class="s-large-close close-widget">x</span>\n\n\n<div class="col-sm-2" id="wordcloud-controlpanel">\n\n    <div>\n        This visualization shows you unique and frequent words from\n        a set of the top 100 search results.\n        <br/>\n        <b><a href="https://adsabs.github.io/help/actions/visualize#word-cloud" target="_blank">\n            Learn more about the concept cloud</a></b>\n        <br/>\n        <br/>\n    </div>\n\n    <div class="s-vis-item-format clearfix"><span style="font-size:14px"> Recalculate Cloud</span><br/><br/>\n        <div id= "ticker">\n\n        </div>\n        <div id="word-choice">\n\n        </div>\n        <div class="s-wordcloud-tick-container">\n            <span style="display:inline-block;margin-left: 0%;">|</span>\n            <span style="display:inline-block;margin-left: 24%;">|</span>\n            <span style="display:inline-block;margin-left: 23%;">|</span>\n            <span style="display:inline-block;margin-left: 22%;">|</span>\n            <span style="display:block;float:right;">|</span>\n        </div>\n        <div class="s-wordcloud-slider-labels"><span class="pull-left">Unique</span><span class="pull-right">Frequent</span></div>\n\n    </div>\n    <div class="selected-word-list">\n\n    </div>\n</div>\n\n\n\n<div class="s-wordcloud-container col-sm-10" id="wordcloud-container">\n\n    <svg id="wordcloud-svg" viewBox="0 0 1000 600" class="s-wordcloud-svg">\n    </svg>\n\n</div>\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/wordcloud/templates/wordcloud-template",n),n}),define("hbs!js/widgets/wordcloud/templates/selected-list-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"\n"+(null!=(r=t.each.call(e,null!=e?e.selectedWords:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+"\n"},2:function(e,t,n,i){return'\n        <li><span class="selected-word">'+this.escapeExpression(this.lambda(e,e))+'</span> <i class="close">&times;</i></li>\n\n'},4:function(e,t,n,i){return"\n    <li> Click on a term to add it to this list.</li>\n    <li> Click again on the term to remove it.</li>\n\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<h5> Selected Terms: </h5>\n<ul class="vis-select-list s-vis-select-list">\n\n'+(null!=(r=t.if.call(e,null!=e?e.selectedWords:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(4,i,0),data:i}))?r:"")+'\n\n</ul>\n\n<button class="btn btn-info apply-vis-facet">Apply Filter to Search</button>'},useData:!0});return t.registerPartial("js/widgets/wordcloud/templates/selected-list-template",n),n}),function(e){define("d3-cloud",["d3"],function(){return function(){!function(){function e(){function e(e,t,n){p[0],p[1];for(var i,r,a,s=t.x,o=t.y,c=Math.sqrt(p[0]*p[0]+p[1]*p[1]),d=x(p),h=Math.random()<.5?1:-1,f=-h;(i=d(f+=h))&&(r=~~i[0],a=~~i[1],!(Math.min(r,a)>c));)if(t.x=s+r,t.y=o+a,!(t.x+t.x0<0||t.y+t.y0<0||t.x+t.x1>p[0]||t.y+t.y1>p[1])&&(!n||!l(t,e,p[0]))&&(!n||u(t,n))){for(var g,m=t.sprite,b=t.width>>5,v=p[0]>>5,y=t.x-(b<<4),w=127&y,_=32-w,S=t.y1-t.y0,E=(t.y+t.y0)*v+(y>>5),A=0;A<S;A++){g=0;for(var k=0;k<=b;k++)e[E+k]|=g<<_|(k<b?(g=m[A*b+k])>>>w:0);E+=v}return delete t.sprite,!0}return!1}var p=[256,256],f=t,g=n,m=r,b=i,v=i,w=a,_=s,x=d,S=[],E=1/0,A=d3.dispatch("word","end"),k=null,C={};return C.start=function(){function t(){for(var t,u=+new Date;+new Date-u<E&&++a<r&&k;)(t=l[a]).x=p[0]*(Math.random()+.5)>>1,t.y=p[1]*(Math.random()+.5)>>1,o(t,l,a),t.hasText&&e(n,t,i)&&(s.push(t),A.word(t),i?c(i,t):i=[{x:t.x+t.x0,y:t.y+t.y0},{x:t.x+t.x1,y:t.y+t.y1}],t.x-=p[0]>>1,t.y-=p[1]>>1);a>=r&&(C.stop(),A.end(s,i))}var n=h((p[0]>>5)*p[1]),i=null,r=S.length,a=-1,s=[],l=S.map(function(e,t){return e.text=f.call(this,e,t),e.font=g.call(this,e,t),e.style=b.call(this,e,t),e.weight=v.call(this,e,t),e.rotate=w.call(this,e,t),e.size=~~m.call(this,e,t),e.padding=_.call(this,e,t),e}).sort(function(e,t){return t.size-e.size});return k&&clearInterval(k),k=setInterval(t,0),t(),C},C.stop=function(){return k&&(clearInterval(k),k=null),C},C.timeInterval=function(e){return arguments.length?(E=null==e?1/0:e,C):E},C.words=function(e){return arguments.length?(S=e,C):S},C.size=function(e){return arguments.length?(p=[+e[0],+e[1]],C):p},C.font=function(e){return arguments.length?(g=d3.functor(e),C):g},C.fontStyle=function(e){return arguments.length?(b=d3.functor(e),C):b},C.fontWeight=function(e){return arguments.length?(v=d3.functor(e),C):v},C.rotate=function(e){return arguments.length?(w=d3.functor(e),C):w},C.text=function(e){return arguments.length?(f=d3.functor(e),C):f},C.spiral=function(e){return arguments.length?(x=y[e+""]||e,C):x},C.fontSize=function(e){return arguments.length?(m=d3.functor(e),C):m},C.padding=function(e){return arguments.length?(_=d3.functor(e),C):_},d3.rebind(C,A,"on")}function t(e){return e.text}function n(){return"serif"}function i(){return"normal"}function r(e){return Math.sqrt(e.value)}function a(){return 30*(~~(6*Math.random())-3)}function s(){return 1}function o(e,t,n){if(!e.sprite){v.clearRect(0,0,(g<<5)/b,m/b);var i=0,r=0,a=0,s=t.length;for(--n;++n<s;){e=t[n],v.save(),v.font=e.style+" "+e.weight+" "+~~((e.size+1)/b)+"px "+e.font;var o=v.measureText(e.text+"m").width*b,l=e.size<<1;if(e.rotate){var c=Math.sin(e.rotate*f),u=Math.cos(e.rotate*f),d=o*u,h=o*c,p=l*u,y=l*c;o=Math.max(Math.abs(d+y),Math.abs(d-y))+31>>5<<5,l=~~Math.max(Math.abs(h+p),Math.abs(h-p))}else o=o+31>>5<<5;if(l>a&&(a=l),i+o>=g<<5&&(i=0,r+=a,a=0),r+l>=m)break;v.translate((i+(o>>1))/b,(r+(l>>1))/b),e.rotate&&v.rotate(e.rotate*f),v.fillText(e.text,0,0),e.padding&&(v.lineWidth=2*e.padding,v.strokeText(e.text,0,0)),v.restore(),e.width=o,e.height=l,e.xoff=i,e.yoff=r,e.x1=o>>1,e.y1=l>>1,e.x0=-e.x1,e.y0=-e.y1,e.hasText=!0,i+=o}for(var w=v.getImageData(0,0,(g<<5)/b,m/b).data,_=[];--n>=0;)if((e=t[n]).hasText){for(var x=(o=e.width)>>5,l=e.y1-e.y0,S=0;S<l*x;S++)_[S]=0;if(null==(i=e.xoff))return;r=e.yoff;for(var E=0,A=-1,k=0;k<l;k++){for(S=0;S<o;S++){var C=x*k+(S>>5),P=w[(r+k)*(g<<5)+(i+S)<<2]?1<<31-S%32:0;_[C]|=P,E|=P}E?A=k:(e.y0++,l--,k--,r++)}e.y1=e.y0+A,e.sprite=_.slice(0,(e.y1-e.y0)*x)}}}function l(e,t,n){n>>=5;for(var i,r=e.sprite,a=e.width>>5,s=e.x-(a<<4),o=127&s,l=32-o,c=e.y1-e.y0,u=(e.y+e.y0)*n+(s>>5),d=0;d<c;d++){i=0;for(var h=0;h<=a;h++)if((i<<l|(h<a?(i=r[d*a+h])>>>o:0))&t[u+h])return!0;u+=n}return!1}function c(e,t){var n=e[0],i=e[1];t.x+t.x0<n.x&&(n.x=t.x+t.x0),t.y+t.y0<n.y&&(n.y=t.y+t.y0),t.x+t.x1>i.x&&(i.x=t.x+t.x1),t.y+t.y1>i.y&&(i.y=t.y+t.y1)}function u(e,t){return e.x+e.x1>t[0].x&&e.x+e.x0<t[1].x&&e.y+e.y1>t[0].y&&e.y+e.y0<t[1].y}function d(e){var t=e[0]/e[1];return function(e){return[t*(e*=.1)*Math.cos(e),e*Math.sin(e)]}}function h(e){for(var t=[],n=-1;++n<e;)t[n]=0;return t}var p,f=Math.PI/180,g=64,m=2048,b=1;"undefined"!=typeof document?((p=document.createElement("canvas")).width=1,p.height=1,b=Math.sqrt(p.getContext("2d").getImageData(0,0,1,1).data.length>>2),p.width=(g<<5)/b,p.height=m/b):p=new Canvas(g<<5,m);var v=p.getContext("2d"),y={archimedean:d,rectangular:function(e){var t=4*e[0]/e[1],n=0,i=0;return function(e){var r=e<0?-1:1;switch(Math.sqrt(1+4*r*e)-r&3){case 0:n+=t;break;case 1:i+=4;break;case 2:n-=t;break;default:i-=4}return[n,i]}}};v.fillStyle=v.strokeStyle="red",v.textAlign="center","object"==typeof module&&module.exports?module.exports=e:(d3.layout||(d3.layout={})).cloud=e}()}.apply(e,arguments)})}(this),define("js/widgets/wordcloud/widget",["jquery","backbone","marionette","d3","js/components/api_request","js/widgets/base/base_widget","hbs!js/widgets/wordcloud/templates/wordcloud-template","hbs!js/widgets/wordcloud/templates/selected-list-template","js/components/api_targets","js/components/api_query_updater","js/components/api_query","js/components/api_feedback","jquery-ui","bootstrap","d3-cloud"],function(e,t,n,i,r,a,s,o,l,c,u,d){var h=t.Model.extend({initialize:function(){this.on("selected",function(e){this.add(e)}),this.on("unselected",function(e){this.remove(e)})},add:function(e){this.get("selectedWords").push(e),this.trigger("userChange:selectedWords",e)},remove:function(e){var e=e.trim(),t=_.without(this.get("selectedWords"),e);this.set("selectedWords",t),this.trigger("userChange:selectedWords",e)},reset:function(){this.set("selectedWords",[])},defaults:{selectedWords:[]}}),p=t.View.extend({initialize:function(e){e=e||{},this.model=new h,this.listenTo(this.model,"userChange:selectedWords",this.render)},template:o,render:function(){return this.$el.html(this.template(this.model.toJSON())),this},events:{"click .close":"removeWord","click .apply-vis-facet":"submitFacet"},removeWord:function(t){var n=e(t.target).parent().find(".selected-word").text();this.model.remove(n)},submitFacet:function(){this.model.get("selectedWords").length&&this.trigger("submitFacet")}}),f=n.ItemView.extend({className:"s-wordcloud-widget clearfix",events:{"click .close-widget":"signalCloseWidget"},initialize:function(e){e=e||{},this.listView=e.listView,this.listenTo(this.model,"change:processedWordList",this.onProcessedWordChange),this.listenTo(this.listView.model,"userChange:selectedWords",this.toggleHighlight)},signalCloseWidget:function(){this.trigger("close-widget")},toggleHighlight:function(e){var t=e.trim();i.selectAll(this.$("text")).filter(function(){if(this.textContent.trim()==t){var e=i.select(this);e.classed("selected",!e.classed("selected"))}})},template:s,render:function(){return this.$el.html(s({helpText:"<p>This word cloud allows you to view interesting words from the titles and abstracts of your search results.</p><p> Move the slider towards <strong> Frequent</strong> to view a word cloud that is simply composed of the words that appeared most frequently in your results. (This word cloud is likely to feature generic terms like 'observations' prominently.) </p> <p>Move the slider towards <strong>Unique</strong> to see a word cloud that shows words that appeared in your results but which appear very rarely in the rest of the ADS corpus.</p><p>To facet your ADS search, select words from the word cloud and click the 'Apply Filter to Search' button.</p>"})),this.listView.setElement(this.$(".selected-word-list")).render(),this.$(".icon-help").popover({trigger:"hover",placement:"right",html:!0}),this},onProcessedWordChange:function(){this.model.get("processedWordList").length>0&&(this.$(".s-loading").length&&this.render(),this.buildSlider(),this.buildCloudLayout())},buildCloudLayout:function(){i.layout.cloud().size([1e3,600]).words(this.model.get("processedWordList")).padding(3).rotate(function(){return 0}).font("Arial").fontSize(function(e){return e.size}).on("end",_.bind(this.draw,this)).start()},buildSlider:function(){var e=this;this.$("#word-choice").slider({value:e.model.get("currentSliderVal"),min:1,max:5,step:1,slide:function(t,n){e.model.set({currentSliderVal:n.value})}})},draw:function(){var e=this,t=this.model.get("renderVals"),n=i.select(this.$("#wordcloud-svg")[0]),r=this.model.get("processedWordList");if(this.$("#words-group").length)a=i.select(this.$("#wordcloud-svg")[0]).select("#words-group");else{var a=n.append("g").attr("id","words-group").attr("width",1e3).attr("height",600).attr("transform",function(){return"translate(500 300)"});n[0][0].addEventListener("click",function(t){var n=t.target.classList;n.contains("s-wordcloud-text")&&(n.contains("selected")?e.listView.model.trigger("unselected",t.target.textContent):e.listView.model.trigger("selected",t.target.textContent))})}var s=a.selectAll("text").data(r,function(e){return e.text}),o=this.listView.model.get("selectedWords");s.enter().append("text").classed("s-wordcloud-text",!0).text(function(e){return e.text}).style("fill",function(e,n){return t.fill(e.origSize)}).classed("selected",function(e,t){if(_.contains(o,e.text))return!0}).attr("transform",function(e,t){return t<15?"translate("+[1e3*Math.random(),-300]+")":t<30?"translate("+[1e3*Math.random(),300]+")":t<45?"translate("+[-500,600*+Math.random()]+")":"translate("+[500,600*-Math.random()]+")"}),s.exit().style("opacity",0).remove();e=this;s.attr("font-size",function(e){return e.size}).style("fill",function(e,n){return t.fill(e.origSize)}).transition().duration(1e3).attr("transform",function(e){return"translate("+[e.x,e.y]+")"})}}),g=t.Model.extend({initialize:function(){this.on("change:tfidfData",this.buildWCDict),this.on("change:currentSliderVal",this.buildWCDict)},defaults:{tfidfData:void 0,currentSliderVal:3,processedWordList:[],renderVals:{fill:void 0,glowScale:void 0,blur:void 0},colorRange:["#80E6FF","#7575FF","#7575FF","#47008F"],sliderRange:{1:[1,0],2:[.75,.25],3:[.5,.5],4:[.25,.75],5:[0,1]}},reset:function(){this.set(this.defaults,{silent:!0})},buildWCDict:function(){var e,t,n,r,a,s,o,l,c,u,d,h,p,f;e=this.get("tfidfData"),t=_.size(e),n=_.reduce(_.map(_.values(e),function(e){return e.total_occurrences}),function(e,t){return e+t},0)/t,r=_.reduce(_.map(_.values(e),function(e){return e.idf?e.idf:0}),function(e,t){return e+t},0)/t,l=this.get("sliderRange"),c=this.get("currentSliderVal"),a=_.map(e,function(e,t){return u=e.total_occurrences/n,d=e.idf/r,h=l[c][0]*d+l[c][1]*u,[t,h||0]}),a=_.last(_.sortBy(a,function(e){return e[1]}),50),a=_.object(a),s=_.min(_.values(a)),o=_.max(_.values(a)),p=[],(f={}).fill=i.scale.log().domain([s,o]),f.fill.domain([0,.25,.5,.75,1].map(f.fill.invert)).range(this.get("colorRange")).clamp(!0);var g=i.scale.log().domain([s,o]).range([30,70]);for(var m in a)p.push({text:m,size:g(a[m]),select:!1,origSize:a[m]});this.set("renderVals",f),this.set("processedWordList",p)}});return a.extend({initialize:function(e){e=e||{},this.listView=new p,this.model=new g,this.view=new f({model:this.model,listView:this.listView}),this.max_rows=l._limits.ConceptCloud.limit,this.on("all",this.onAllInternalEvents),this.listenTo(this.listView,"all",this.onAllInternalEvents),this.listenTo(this.view,"close-widget",_.bind(this.closeWidget,this)),this.widgetName="wordcloud",this.queryUpdater=new c(this.widgetName)},activate:function(e){_.bindAll(this,"setCurrentQuery","processResponse"),this.setBeeHive(e);var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},renderWidgetForCurrentQuery:function(){var e=this.getCurrentQuery(),t=this;if(e.get("__qid"))setTimeout(function(){t.getPubSub().publish(t.getPubSub().ALERT,new d({code:d.CODES.ALERT,msg:"The concept cloud endpoint cannot handle such a large query at this time",modal:!0}),1)});else{var i=new r({target:n.getOption(this,"endpoint")||l.SERVICE_WORDCLOUD,query:this.customizeQuery(e),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,i)}},renderWidgetForListOfBibcodes:function(e){e=e.slice(0,100);var t=new u;t.unlock(),t.set("q","bibcode:("+e.join(" OR ")+")"),t.set("rows",this.max_rows);var i=new r({target:n.getOption(this,"endpoint")||l.SERVICE_WORDCLOUD,query:new u({query:JSON.stringify(t.toJSON())}),options:{type:"POST",contentType:"application/json"}});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,i)},customizeQuery:function(e){var t=e.clone();t.unlock(),this.defaultQueryArguments&&(t=this.composeQuery(this.defaultQueryArguments,t));var n=this.max_rows;return t.has("rows")&&(n=t.get("rows")[0]),t.set("rows",Math.min(n,this.max_rows)),t},processResponse:function(e){try{e.get("responseHeader.params.__qid");this.renderWidgetForListOfBibcodes(e.get("response").docs.map(function(e){return e.bibcode}))}catch(t){data=e.toJSON(),this.model.set("tfidfData",data)}},close:function(){this.listView.destroy(),this.view.destroy(),n.Controller.prototype.destroy.apply(this,arguments)},setCurrentQuery:function(){this.listView.model.reset(),this.model.reset(),a.prototype.setCurrentQuery.apply(this,arguments)},onAllInternalEvents:function(e){if("submitFacet"===e){var t,n;t=this.listView.model.get("selectedWords"),(n=(n=this.getCurrentQuery()).clone()).unlock();var i=this.queryUpdater,r=t.map(function(e){return i.quoteIfNecessary(e)}).join(" OR ");this._updateFq(n,r),this.getPubSub().publish(this.getPubSub().START_SEARCH,n)}},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},_updateFq:function(e,t){var n="fq_"+this.widgetName;e.unset(n),this.queryUpdater.updateQuery(e,n,"limit",t);var i="{!type=aqp v=$"+n+"}",r=e.get("fq");r?(-1==_.indexOf(r,i)&&r.push(i),e.set("fq",r)):e.set("fq",[i])}})}),define("hbs!js/widgets/bubble_chart/templates/container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="s-large-close close-widget close">x</div>\n<div class="s-bubble-label-container">\n    <div class="graph-select reads-vs-time active">\n        <img src="../../../styles/img/reads_vs_time.png" alt=""/>\n    </div>\n    <div class="graph-select citations-vs-time">\n        <img src="../../styles/img/citations_vs_time.png" alt=""/>\n    </div>\n    <div class="graph-select reads-vs-citations">\n            <img src="../../styles/img/reads_vs_citations.png" alt=""/>\n    </div>\n</div>\n\n<div class="s-bubble-graph-container bubble-graph-container">\n    <div class="d3-tooltip"></div>\n    <svg class="s-bubble-chart-svg bubble-chart-svg" viewBox="0 0 1160 550" preserveAspectRatio="xMinYMin meet"></svg>\n</div>\n\n<div class="controls s-controls">\n    <div>\n        <h6>What is the Paper Graph?</h6>\n        This graph allows you to view metrics for both the long-term influence (citation count)\n        and recent popularity (90 day read count) of the top 1500 papers from your search results.\n    </div>\n    <div>\n        <h6>Customize Graph</h6>\n        * Click on a journal name at right to limit papers (click again to return to the unfiltered view)<br/>\n        * Click on the y axis log/linear options <br/>\n        * Click below to swap y axis and bubble radius  <br/>\n        * Click on a paper bubble to outline it for tracking purposes throughout the three graphs\n    </div>\n    <div>\n        <h6>Filter Your Search</h6>\n        Select papers by dragging from left to right around bubbles to form a box, then click submit\n        <button class="btn btn-success submit disabled"> Submit <i class="icon-go"></i></button>\n    </div>\n</div>\n\n'},useData:!0});return t.registerPartial("js/widgets/bubble_chart/templates/container",n),n}),define("hbs!js/widgets/bubble_chart/templates/tooltip",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"<h5>"+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+"</h5>\n("+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+")</br>\nCitations: <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.citation_count||(null!=e?e.citation_count:e))?r:t.helperMissing)?r.call(e,{name:"citation_count",hash:{},data:i}):r)+"</b>,\nReads: <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.read_count||(null!=e?e.read_count:e))?r:t.helperMissing)?r.call(e,{name:"read_count",hash:{},data:i}):r)+"</b><br/>\n"},3:function(e,t,n,i){var r;return'<div class="pull-right">\n    <i><b>...and '+this.escapeExpression("function"==typeof(r=null!=(r=t.extra||(null!=e?e.extra:e))?r:t.helperMissing)?r.call(e,{name:"extra",hash:{},data:i}):r)+" more </b></i>\n</div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=t.each.call(e,null!=e?e.bibs:e,{name:"each",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.extra:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/bubble_chart/templates/tooltip",n),n}),define("js/widgets/bubble_chart/widget",["d3","marionette","js/widgets/base/base_widget","js/components/api_request","hbs!js/widgets/bubble_chart/templates/container","hbs!js/widgets/bubble_chart/templates/tooltip","js/components/api_targets","js/components/api_query_updater","js/components/api_query"],function(e,t,n,i,r,a,s,o,l){var c=Backbone.Model.extend({initialize:function(e){this.on("change:solrData",this.modifyData)},modifyData:function(){var e,t;if(!_.isEmpty(this.get("solrData"))){var n=[];_.each(this.get("solrData"),function(e,t){try{e.pubdate=e.pubdate.replace(/(\D)00/g,function(e,t){return t+"01"}),e.date=new Date(e.pubdate),e.year=parseInt(e.bibcode.slice(0,4)),e.citation_count=e.citation_count?e.citation_count:0,e.read_count=e.read_count?e.read_count:0,e.title=e.title?e.title[0]:"",e.pub=e.bibcode.slice(4,9).replace(/\./g,""),n.push(e)}catch(t){console.warn(e,"didn't get added to bibcode list for some reason")}}),e=_.chain(n).pluck("pub").countBy(function(e){return e}).pairs().sortBy(function(e){return e[1]}).value().reverse();var i=0;_.each(e.slice(0,5),function(e){i+=e[1]}),i/n.length>=.25?(t=_.map(e,function(e){return e[0]}).slice(0,5),i/n.length<1&&t.push("other"),this.set("journalNames",t)):this.set("journalNames",[]),this.set("modifiedSolrData",n)}},reset:function(){this.set(this.defaults(),{silent:!0})},toggleTracked:function(e){var t=this.get("trackingBibs");_.contains(t,e)?this.set("trackingBibs",_.without(t,e)):(t.push(e),this.set("trackingBibs",t))},defaults:function(){return{solrData:{},modifiedSolrData:[],currentGraphData:{},yScale:"log",xScale:"linear",yLogPossible:!0,xLogPossible:!1,xValue:"date",yValue:"read_count",radius:"citation_count",journalNames:[],trackingBibs:[],selectedBibs:[],timeRange:"year",currentPub:void 0}}}),u=t.ItemView.extend({className:"bubble-chart s-bubble-chart",template:r,reset:function(){this.scales={},this.cache={}},modelEvents:{"change:modifiedSolrData":"render","change:currentPub":"rearrangeGraph","change:yScale":"rearrangeGraph","change:xScale":"rearrangeGraph","change:selectedBibs":"manageSubmitButton"},events:{"click .graph-select":function(e){var t=$(e.currentTarget);this.$(".graph-select").removeClass("active"),t.hasClass("reads-vs-time")?this.model.set({radius:"citation_count",xScale:"linear",xValue:"date",yValue:"read_count",yScale:"log"},{silent:!0}):t.hasClass("citations-vs-time")?this.model.set({radius:"read_count",xValue:"date",xScale:"linear",yValue:"citation_count",yScale:"log"},{silent:!0}):t.hasClass("reads-vs-citations")&&this.model.set({radius:"year",yValue:"read_count",xValue:"citation_count",xScale:"log"},{silent:!0}),this.rearrangeGraph(),t.addClass("active")},"click .submit":function(){this.trigger("filterBibs",this.model.get("selectedBibs"))},"click .close":function(){this.trigger("close-widget")}},getConfig:function(){this.config={},this.config.margin={left:80,bottom:40,right:20,top:60},this.config.height=500-(this.config.margin.top+this.config.margin.bottom),this.config.width=1e3-(this.config.margin.left+this.config.margin.right),this.config.animationLength=t.getOption(this,"testing")?0:500},cacheVals:function(){this.cache={},this.cache.svg=e.select(this.$("svg.bubble-chart-svg")[0]).append("g").attr("transform","translate("+this.config.margin.left+","+this.config.margin.top+")"),this.cache.realSvg=e.select(this.$("svg.bubble-chart-svg")[0]),this.cache.tooltip=e.select(this.$(".d3-tooltip")[0])},setScales:function(){this.scales={};var t,n,i,r=this.model.get("currentGraphData"),a=this,s=[];if(this.model.get("journalNames").length&&(this.scales.journalScale=e.scale.ordinal().domain(this.model.get("journalNames")).range(["hsla(282, 80%, 52%, 1)","hsla(1, 80%, 51%, 1)","hsla(152, 80%, 40%, 1)","hsla(193, 80%, 48%, 1)","hsla(220, 80%, 56%, 1)","hsla(0, 0%, 20%, 1)"])),"date"===a.model.get("xValue")){if((t=e.extent(r,function(e){return e.date}))[1].getFullYear()-t[0].getFullYear()>2)this.model.set("timeRange","year"),(o=new Date(t[0])).setMonth(o.getMonth()-12),s.push(o),(o=new Date(t[1])).setMonth(o.getMonth()+12),s.push(o);else{this.model.set("timeRange","month");var o=new Date(t[0]);o.setMonth(o.getMonth()-1),s.push(o),(o=new Date(t[1])).setMonth(o.getMonth()+1),s.push(o)}this.scales.xScale=e.time.scale().domain(s).range([0,a.config.width])}else"citation_count"==a.model.get("xValue")&&(i=e.extent(r,function(e){return e[a.model.get("xValue")]}),"log"===a.model.get("xScale")?this.scales.xScale=e.scale.log().domain(i).range([0,a.config.width]):this.scales.xScale=e.scale.linear().domain(i).range([0,a.config.width]));n=e.extent(r,function(e){return e[a.model.get("yValue")]}),"log"===this.model.get("yScale")?this.scales.yScale=e.scale.log().domain(n).range([a.config.height,0]):this.scales.yScale=e.scale.linear().domain(n).range([a.config.height,0]),"year"==a.model.get("radius")?this.scales.radiusScale=e.scale.linear().domain(e.extent(r,function(e){return e[a.model.get("radius")]})).range([2,14]):this.scales.radiusScale=e.scale.linear().domain(e.extent(r,function(e){return e[a.model.get("radius")]})).range([4,26])},finalProcess:function(){var t,n,i=this,r=this.model.get("modifiedSolrData");t=e.sum(_.pluck(r,i.model.get("yValue"))),n=e.sum(_.pluck(r,i.model.get("xValue"))),t?this.model.set("yLogPossible",!0):(this.model.set("yScale","linear",{silent:!0}),this.model.set("yLogPossible",!1)),n?this.model.set("xLogPossible",!0):(this.model.set("xScale","linear",{silent:!0}),this.model.set("xLogPossible",!1)),r=_.chain(r).filter(function(e){return"linear"===i.model.get("yScale")||(!!e[i.model.get("yValue")]||void 0)}).filter(function(e){return"linear"===i.model.get("xScale")||(!!e[i.model.get("xValue")]||void 0)}).sortBy(function(e){return-e[i.model.get("radius")]}).value(),this.model.set("currentGraphData",r),this.setScales()},resetSelection:function(){this.model.set("selectedBibs",[]),this.cache.svg.selectAll(".paper-circle.selected").classed("selected",!1),this.cache.svg.select("rect.selection").remove()},rearrangeGraph:function(){this.finalProcess(),this.resetSelection();var t,n,i,r,a,s=this.cache.svg,o=this.cache.realSvg,l=this.model.get("journalNames"),c=this;o.select("rect.selection").remove(),t=this.model.get("currentGraphData"),(r=c.model.get("currentPub"))&&(t=_.filter(t,function(e){return"other"===r?!_.contains(c.model.get("journalNames"),e.pub):e.pub===r})),n=e.svg.axis().scale(this.scales.yScale).orient("left").ticks(10).tickFormat(e.format("s")),a="date"===this.model.get("xValue")&&"year"==this.model.get("timeRange")?e.time.format("%Y"):"date"===this.model.get("xValue")&&"month"==this.model.get("timeRange")?e.time.format("%b-%Y"):e.format(""),xAxis=e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(a),s.select(".y-axis").transition().duration(c.config.animationLength).call(n),s.select(".x-axis").transition().duration(c.config.animationLength).call(xAxis),this.renderLabels(o.select(".y-label"),o.select(".x-label")),(i=s.selectAll(".paper-circle").data(t,function(e){return e.bibcode})).exit().remove(),i.transition().duration(c.config.animationLength).attr("r",function(e){return c.scales.radiusScale(e[c.model.get("radius")])+"px"}).attr("cy",function(e){return c.scales.yScale(e[c.model.get("yValue")])}).attr("cx",function(e){return c.scales.xScale(e[c.model.get("xValue")])}),i.enter().append("circle").classed("paper-circle",!0).classed("tracked",function(e){return!!_.contains(c.model.get("trackingBibs"),e.bibcode)}).attr("cx",function(e){return c.scales.xScale(e[c.model.get("xValue")])}).style("fill",function(e){if(l&&_.contains(l,e.pub))return c.scales.journalScale(e.pub)}).attr("cy",function(e){return c.scales.yScale(e[c.model.get("yValue")])}).attr("r",function(e){return c.scales.radiusScale(e[c.model.get("radius")])+"px"}),i.order()},onRender:function(){_.isEmpty(this.model.get("modifiedSolrData"))?this.$el.html("Not enough data to form the citations/reads graphs"):this.renderGraph()},renderLabels:function(e,t){function n(e,t){e.append("circle").classed("scale-choice",!0).classed("log",!0).classed("selected",function(){if("log"===i.model.get(t))return!0}).attr("r","6px").attr("cx",200).attr("cy",-10),e.append("text").attr("x",210).attr("y",-5).text("log").classed("log",!0),e.append("circle").classed("scale-choice",!0).classed("linear",!0).classed("selected",function(){if("linear"===i.model.get(t))return!0}).attr("r","6px").attr("cx",250).attr("cy",-10),e.append("text").attr("x",260).attr("y",-5).text("linear")}var i=this;e.selectAll("*").remove(),e.append("text").text(function(){return"citation_count"===i.model.get("yValue")?"Citation Count":"read_count"===i.model.get("yValue")?"90 Day Read Count":void 0}).classed("axis-title",!0),e.call(n,"yScale"),t.selectAll("*").remove(),t.append("text").text(function(){return"citation_count"===i.model.get("xValue")?"Citation Count":"date"===i.model.get("xValue")?"Date":void 0}).classed("axis-title",!0),"date"!==i.model.get("xValue")&&t.call(n,"xScale"),this.attachLogLinearEventListeners(),this.model.get("yLogPossible")||(e.selectAll(".scale-choice").classed("hidden",!0),e.selectAll("text.log").classed("hidden",!0)),this.model.get("xLogPossible")||(t.selectAll(".scale-choice").classed("hidden",!0),t.selectAll("text.log").classed("hidden",!0))},attachLogLinearEventListeners:function(){var t=this.cache.realSvg,n=this,i=[{container:".y-label",scale:"yScale"},{container:".x-label",scale:"xScale"}];_.each(i,function(i){t.selectAll(i.container+" .scale-choice").on("click",function(t){e.selectAll(i.container+" .scale-choice").classed("selected",!1);var r=e.select(this);r.classed("linear")?(n.model.set(i.scale,"linear"),r.classed("selected",!0)):(n.model.set(i.scale,"log"),r.classed("selected",!0))},this)})},renderGraph:function(){this.getConfig(),this.cacheVals(),this.finalProcess();var t,n,i,r,s,o=this.cache.svg,l=this.cache.realSvg,c=this,u=c.model.get("journalNames"),d=!1;t=this.model.get("currentGraphData"),i="year"==this.model.get("timeRange")?e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(e.time.format("%Y")):e.svg.axis().scale(this.scales.xScale).orient("bottom").tickFormat(e.time.format("%b-%Y")),s=e.svg.axis().scale(this.scales.yScale).orient("left").tickFormat(e.format("s")),o.append("g").attr("class","x-axis").attr("transform","translate(0,"+c.config.height+")").call(i),o.append("g").attr("class","y-axis").call(s),r=l.append("g").attr("transform","translate(35, 400) rotate(-90)").classed("y-label",!0),n=l.append("g").attr("transform","translate("+c.config.width/2+","+(c.config.height+c.config.margin.top+c.config.margin.bottom+10)+")").classed("x-label",!0),this.renderLabels(r,n),o.selectAll(".paper-circle").data(t).enter().append("circle").classed("paper-circle",!0).attr("r",function(e){return c.scales.radiusScale(e.citation_count)+"px"}).attr("cx",function(e){return c.scales.xScale(e.date)}).attr("cy",function(e){return c.scales.yScale(e.read_count)}).style("fill",function(e){if(u&&_.contains(u,e.pub))return c.scales.journalScale(e.pub)});var h=l.append("g").classed("journal-name-key",!0).attr("transform","translate("+(c.config.width+c.config.margin.right+c.config.margin.left)+","+(c.config.height/2-c.config.margin.top)+")");h.selectAll("rect").data(u).enter().append("rect").attr("width",13).attr("height",13).attr("y",function(e,t){return 22*t}).attr("fill",function(e){return"other"===e?"hsla(0, 0%, 20%, 1)":c.scales.journalScale(e)}),h.selectAll("text").data(u).enter().append("text").attr("x",15).attr("y",function(e,t){return 22*t+10}).text(function(e){return e}).on("click",function(t){var n=e.select(this);1==n.classed("journal-selected")?(n.classed("journal-selected",!1),c.model.set("currentPub",void 0)):(l.selectAll(".journal-selected").classed("journal-selected",!1),n.classed("journal-selected",!0),c.model.set("currentPub",t))}),l.on("click.tracking",function(t,n){if(e.select(e.event.target).classed("paper-circle")){var i=e.event.target.__data__.bibcode;c.model.toggleTracked(i),_.contains(c.model.get("trackingBibs"),i)?e.select(e.event.target).classed("tracked",!0):e.select(e.event.target).classed("tracked",!1)}}),l.on("mouseover.tooltip",function(t){if(e.select(e.event.target).classed("paper-circle")&&!d){var n,i,r,s,o=c.model.get("yValue"),l=c.model.get("xValue"),u=c.model.get("radius"),h=e.mouse(this.parentElement)[0],p=e.mouse(this.parentElement)[1],f={},g=e.event.target.__data__;s=e.mouse(this.parentElement)[0]-c.config.margin.left>500?"right":"left",(n=e.selectAll(".paper-circle").filter(function(e){if(e[o]==g[o]&&e[l]==g[l])return!0}).sort(function(e,t){return t[u]-e[u]}).data()).length>3&&(f.extra=n.length-3,n=n.slice(0,3)),f.bibs=n,c.cache.tooltip.html(a(f)),c.cache.tooltip.style({visibility:"hidden",display:"block"}),i=e.select(".d3-tooltip")[0][0].clientHeight,r=e.max([2.5*parseInt(e.select(e.event.target).attr("r")),10]),"left"===s?c.cache.tooltip.style("left",h+r+"px").style("top",p-i/2+"px").style("visibility","visible"):c.cache.tooltip.style("left",h-r-240+"px").style("top",p-i/2+"px").style("visibility","visible")}}),l.on("mousemove.tooltip",function(t){e.event.target.classList.contains("paper-circle")||c.cache.tooltip.style({display:"none"})}),l.on("mousedown.select",function(){if(e.event.target===e.event.currentTarget){d=!0,o.selectAll(".paper-circle.selected").classed("selected",!1),l.select("rect.selection").remove();var t=e.mouse(this);l.append("rect").attr({rx:6,ry:6,class:"selection",x:t[0],y:t[1],width:0,height:0})}}).on("mousemove.select",function(){if(d){var t=l.select("rect.selection");if(!t.empty()){var n=e.mouse(this),i={x:parseInt(t.attr("x"),10),y:parseInt(t.attr("y"),10),width:parseInt(t.attr("width"),10),height:parseInt(t.attr("height"),10)},r={x:n[0]-i.x,y:n[1]-i.y};if(i.width=r.x,i.height=r.y,r.x<0||r.y<0)return;t.attr(i),l.selectAll(".paper-circle").each(function(t,n){var r=e.select(this),a=parseInt(r.attr("cx")),s=parseInt(r.attr("cy"));a+c.config.margin.left>=i.x&&a+c.config.margin.left<=i.x+i.width&&s+c.config.margin.top>=i.y&&s+c.config.margin.top<=i.y+i.height?r.classed("selected",!0):r.classed("selected",!1)})}}}).on("mouseup.select",function(){d=!1;var e=[];o.selectAll(".paper-circle.selected").each(function(t){"none"!==this.style.display&&e.push(t.bibcode)}),c.model.set("selectedBibs",e)})},manageSubmitButton:function(){0===this.model.get("selectedBibs").length?this.$(".submit").addClass("disabled"):this.$(".submit").removeClass("disabled")}});return n.extend({initialize:function(e){e=e||{},this.model=new c,this.view=new u({model:this.model,testing:e.testing}),this.listenTo(this.view,"filterBibs",this.onFilterBibs),this.listenTo(this.view,"close-widget",this.broadcastClose),this.widgetName="bubble_chart",this.queryUpdater=new o(this.widgetName)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=this.getPubSub();t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},renderWidgetForListOfBibcodes:function(e){var t=new l;t.unlock(),t.set("q","bibcode:("+e.join(" OR ")+")"),t.set("rows",s._limits.BubbleChart.default),t.set("fl","title,bibcode,citation_count,read_count,pubdate");var n=new i({target:s.SEARCH,query:t});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,n)},renderWidgetForCurrentQuery:function(){var e=this.getCurrentQuery().clone();e.unlock(),e.set("rows",s._limits.BubbleChart.default),e.set("fl","title,bibcode,citation_count,read_count,pubdate"),e.unset("hl"),e.unset("hl.fl");var t=new i({target:s.SEARCH,query:e});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,t)},processResponse:function(e){this.model.reset(),this.view.reset(),this.model.set("solrData",e.get("response.docs"))},onFilterBibs:function(){var e=this.model.get("selectedBibs"),t=this.getCurrentQuery().clone();if(e.length){var n=this.queryUpdater,i="bibcode:("+e.map(function(e){return n.quoteIfNecessary(e)}).join(" OR ")+")";t.unlock(),this._updateFq(t,i),this.getPubSub().publish(this.getPubSub().START_SEARCH,t)}},_updateFq:function(e,t){var n="fq_"+this.widgetName;e.unset(n),this.queryUpdater.updateQuery(e,n,"limit",t);var i="{!type=aqp v=$"+n+"}",r=e.get("fq");r?(-1==_.indexOf(r,i)&&r.push(i),e.set("fq",r)):e.set("fq",[i])},broadcastClose:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")}})}),define("js/widgets/metrics/extractor_functions",[],function(){function e(e){return e.filter(function(e){return e.y>0}).length>0}function t(e,t){var n={};return _.each(t,function(t,i){e[i]?n[i]=t-e[i]:n[i]=t}),n}var n={};return n.plot_paperhist=function(n){var i,r=[],a=n.paperhist_data;return i=n.norm?[a["refereed publications normalized"],t(a["refereed publications normalized"],a["all publications normalized"])]:[a["refereed publications"],t(a["refereed publications"],a["all publications"])],_.each(i,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),r.push(n)}),[{key:"Refereed",values:r[0]},{key:"Non-refereed",values:r[1]}].filter(function(t,n){return e(t.values)})},n.plot_readshist=function(n){var i,r=[];return i=n.norm?[n.readshist_data["refereed reads normalized"],t(n.readshist_data["refereed reads normalized"],n.readshist_data["all reads normalized"])]:[n.readshist_data["refereed reads"],t(n.readshist_data["refereed reads"],n.readshist_data["all reads"])],_.each(i,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),r.push(n)}),[{key:"Refereed",values:r[0]},{key:"Non-refereed",values:r[1]}].filter(function(t,n){return e(t.values)})},n.plot_citshist=function(t){var n,i=[],r=t.citshist_data;return n=t.norm?[r["refereed to refereed normalized"],r["refereed to nonrefereed normalized"],r["nonrefereed to refereed normalized"],r["nonrefereed to nonrefereed normalized"]]:[r["refereed to refereed"],r["refereed to nonrefereed"],r["nonrefereed to refereed"],r["nonrefereed to nonrefereed"]],_.each(n,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),i.push(n)}),["Ref. citations to ref. papers","Ref. citations to non ref. papers","Non ref. citations to ref. papers","Non ref. citations to non ref. papers"].map(function(e,t){return{key:e,values:i[t]}}).filter(function(t,n){return e(t.values)})},n.plot_series=function(e){var t=e.series_data,n=[t.h,t.g,t.i10,t.tori,t.i100,t.read10],i=[];return _.each(n,function(e,t){var n=[];_.each(e,function(e,t){n.push({x:t,y:e})}),i.push(n)}),i[5]=_.map(i[5],function(e){return{x:e.x,y:e.y/10}}),[{key:"h Index",values:i[0]},{key:"g Index",values:i[1]},{key:"i10 Index",values:i[2]},{key:"tori Index",values:i[3]},{key:"i100 Index",values:i[4]},{key:"read10 Index",values:i[5]}]},n}),define("hbs!js/widgets/metrics/templates/metrics_container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n    <div class="s-metrics-metadata">\n      <i class="icon-loading"/> Loading metrics...\n    </div>\n\n'},3:function(e,t,n,i){var r;return'\n    <div class="metrics-metadata s-metrics-metadata">\n\n      <p>\n          This metrics report is optimized for printing: just find the print command in your browser\'s toolbar.\n      </p>\n\n      <p>\n        Currently showing metrics for <b>'+this.escapeExpression("function"==typeof(r=null!=(r=t.numFound||(null!=e?e.numFound:e))?r:t.helperMissing)?r.call(e,{name:"numFound",hash:{},data:i}):r)+"</b> records.\n      </p>\n\n    </div>\n\n"},5:function(e,t,n,i){var r,a;return'            <div style="padding-left:4%">\n                <h4 class="s-list-description">Metrics for</h4>\n                <h2 class="s-article-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+"</h2>\n            </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\n<div class="metrics-container">\n    <div class="print-visible"><h2 style="font-weight: 800;text-align:center;">NASA/ADS Metrics Report </h2> </div>\n    <div class="print-visible" style="text-align:center">'+this.escapeExpression("function"==typeof(a=null!=(a=t.url||(null!=e?e.url:e))?a:t.helperMissing)?a.call(e,{name:"url",hash:{},data:i}):a)+'</div>\n\n    <span class="s-large-close close-widget">x</span>\n\n'+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"\n\n\n         \x3c!--used by widget when it is on the abstract page--\x3e\n"+(null!=(r=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+'    <div class="s-metrics-section" id="papers">\n        <div class="s-metrics-title">\n            <h3>Papers</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n    <div class="s-metrics-section" id="citations">\n        <div class="s-metrics-title">\n            <h3>Citations</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n    <div class="s-metrics-section" id="reads">\n        <div class="s-metrics-title">\n            <h3>Reads</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n    <div class="s-metrics-section" id="indices">\n        <div class="s-metrics-title">\n            <h3>Indices</h3>\n        </div>\n        <div class="metrics-table s-metrics-table"></div><div class="metrics-graph s-metrics-graph"></div>\n    </div>\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/metrics/templates/metrics_container",n),n}),define("hbs!js/widgets/metrics/templates/graph_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'\n<div>\n  <p>\n   <b>Currently showing a limited subset of data for this view. </b>\n  </p>\n  <p>\n    <button class="btn btn-primary-faded btn-sm show-all" style="margin: 10px">Click here to load the graph and\n   RIQ and Tori indices. <i>(This may take a few moments.)</i></button>\n\n  </p>\n</div>\n\n'},3:function(e,t,n,i){var r;return'<div class="graph-container s-graph-container">\n'+(null!=(r=t.if.call(e,null!=e?e.normalizedGraphData:e,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'    <div>\n      <form action="" class="stacked-form">\n      <label> stacked\n        <input type="radio" name="bar-arrangement" value="stacked" checked/>\n      </label>\n      <label> grouped\n        <input type="radio" name="bar-arrangement" value="grouped"/>\n      </label>\n      </form>\n      <div class="pull-right graph-key">\n      </div>\n      <div class="s-metrics-svg-container" style="padding-bottom: 58%">\n        <svg class="s-metrics-svg" viewbox="0 0 480 250" preserveAspectRatio="xMinYMin meet"></svg>\n      </div>\n    </div>\n</div>\n\n'},4:function(e,t,n,i){var r;return'    <div class="graph-tab s-graph-tab '+(null!=(r=t.unless.call(e,null!=e?e.normalizedGraphData:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=t.unless.call(e,null!=e?e.normalized:e,{name:"unless",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+' " data-tab="total">\n      Total</div>\n    <div class="graph-tab s-graph-tab '+(null!=(r=t.unless.call(e,null!=e?e.normalizedGraphData:e,{name:"unless",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+" "+(null!=(r=t.if.call(e,null!=e?e.normalized:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+' " data-tab="normalized">\n      Normalized</div>\n'},5:function(e,t,n,i){return" no-show "},7:function(e,t,n,i){return"active"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=e?e.showingSimple:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/metrics/templates/graph_template",n),n}),define("hbs!js/widgets/metrics/templates/paper_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\n    <thead>\n    <tr>\n        <th>\n\n        </th>\n        <th>\n\n        </th>\n        <th>\n            Totals\n\n        </th>\n        <th>\n            Refereed\n\n        </th>\n\n    </tr>\n    </thead>\n\n    <tr>\n\n        <td>Number of papers</td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Number of Papers</b>" data-content="The total number of papers for which metrics were calculated. This may differ from total number of papers requested due to gaps in the metrics database. If you spot a discrepancy please let us know at adshelp@cfa.harvard.edu "></i>\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNumberOfPapers:e)?r[0]:r,e))+"\n        </td>\n        <td>\n            "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNumberOfPapers:e)?r[1]:r,e))+'\n        </td>\n\n    </tr>\n    <tr>\n        <td>Normalized paper count</td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Normalized Paper Count</b>" data-content="For a list of N papers (i=1,...N), where N<sub>auth</sub><sup>i</sup> is the number of authors for publication i, the normalized paper count is the sum over 1/N<sub>auth</sub><sup>i</sup>."></i>\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNormalizedPaperCount:e)?r[0]:r,e))+"\n        </td>\n        <td>\n            "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNormalizedPaperCount:e)?r[1]:r,e))+"\n        </td>\n\n    </tr>\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/paper_table",n),n}),define("hbs!js/widgets/metrics/templates/citations_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\n\n<thead>\n<tr>\n    <th>\n\n    </th>\n    <th>\n\n    </th>\n    <th class="hidden-abstract-page">\n        Totals\n\n    </th>\n    <th class="hidden-abstract-page">\n        Refereed\n\n    </th>\n\n</tr>\n</thead>\n\n<tr class="hidden-abstract-page">\n\n    <td>\n        Number of citing papers\n    </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Number of Citing Papers</b>" data-content="Number of unique papers citing the papers in the submitted list."></i>\n        &nbsp;\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.numberOfCitingPapers:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.numberOfCitingPapers:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> Total citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Total Citations</b>" data-content="The total number of times all papers in the list were cited."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalCitations:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Number of self-citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Number of Self-Citations</b>" data-content="The number of citing papers that were also in the list from which the metrics were computed."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.numberOfSelfCitations:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.numberOfSelfCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr class="hidden-abstract-page">\n    <td> Average citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Average Citations</b>" data-content="The total number of citations divided by the number of papers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageCitations:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Median citations </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Citations</b>" data-content="The median of the citation distribution."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianCitations:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> Normalized citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Normalized Citations</b>" data-content="For a list of N papers (i=1,...N), where N<sub>auth</sub><sup>i</sup> is the number of authors for publication i and C<sub>i</sub> the number of citations that this paper received, the normalized citation count for each article is C<sub>i</sub>/N<sub>auth</sub><sup>i</sup> ,and the \'normalized citations\' for this list of N papers is the sum of these N numbers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.normalizedCitations:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.normalizedCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> Refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Refereed Citations</b>" data-content="Number of refereed citing papers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.refereedCitations:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.refereedCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Average refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Average Refereed Citations</b>" data-content="The average number of citations from refereed publications to all/refereed publications in the list."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageRefereedCitations:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageRefereedCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr class="hidden-abstract-page">\n    <td> Median refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Refereed Citations</b>" data-content="The average median of citations from refereed publications to all refereed publications in the list."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianRefereedCitations:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianRefereedCitations:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> Normalized refereed citations  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Normalized Refereed Citations</b>" data-content="The normalized number of citations from refereed publications to all refereed publications in the list."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.normalizedRefereedCitations:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.normalizedRefereedCitations:e)?r[1]:r,e))+"\n    </td>\n\n</tr>\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/citations_table",n),n}),define("hbs!js/widgets/metrics/templates/indices_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\n\n<thead>\n<tr>\n    <th>\n\n    </th>\n    <th>\n\n    </th>\n    <th>\n        Totals\n\n    </th>\n    <th>\n        Refereed\n\n    </th>\n\n</tr>\n</thead>\n\n<tr>\n\n    <td>\n        h-index\n    </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>h-index</b>" data-content="The H-index is the largest number H such that H publications have at least H citations."></i>\n\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.hIndex:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.hIndex:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> m-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>m-index</b>" data-content="The m-index is defined as the h-index divided by number of years since the first published paper of the scientist (also called m-quotient)."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.mIndex:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.mIndex:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> g-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>g-index</b>" data-content="Given a set of articles ranked in decreasing order of the number of citations that they received, the g-index is the (unique) largest number such that the top g articles received (together) at least g<sup>2</sup> citations."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.gIndex:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.gIndex:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> i10-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>i10-index</b>" data-content="The i10-index is the number of publications with at least 10 citations."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.i10Index:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.i10Index:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> i100-index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>i100-index</b>" data-content="The i100-index is the number of publications with at least 100 citations."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.i100Index:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.i100Index:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> tori index  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>tori index</b>" data-content="The tori-index is calculated using the reference lists of the citing papers, where self-citations are removed. The contribution of each citing paper is then normalized by the number of remaining references in the citing papers and the number of authors in the cited paper."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.toriIndex:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.toriIndex:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> riq index </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>riq index</b>" data-content="The riq-index equals the square root of the tori-index, divided by the time between the first and last publication. A multiplication with 1000 has been applied."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.riqIndex:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.riqIndex:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr>\n    <td> read10-index  </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Read10-index</b>" data-content="Read10 is the current readership rate for all an individual\'s papers published in the most recent ten years, normalized for number of authors."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.read10Index:e)?r[0]:r,e))+"\n    </td>\n    <td>\n        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.read10Index:e)?r[1]:r,e))+"\n    </td>\n\n</tr>\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/indices_table",n),n}),define("hbs!js/widgets/metrics/templates/reads_table",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<thead>\n    <tr>\n        <th>\n\n        </th>\n        <th>\n\n        </th>\n        <th class="hidden-abstract-page">\n            Totals\n\n        </th>\n        <th class="hidden-abstract-page">\n            Refereed\n\n        </th>\n\n    </tr>\n    </thead>\n\n    <tr>\n\n        <td>\n            Total number of reads\n        </td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Total Number of Reads</b>" data-content="The total number of times all papers were read. For each paper, a read is counted if an ADS user runs a search in our system and then requests to either view the paper\\\'s full bibliographic record or download the fulltext."></i>\n\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNumberOfReads:e)?r[0]:r,e))+'\n        </td>\n        <td class="hidden-abstract-page">\n            '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNumberOfReads:e)?r[1]:r,e))+'\n        </td>\n\n    </tr>\n    <tr class="hidden-abstract-page">\n        <td> Average number of reads </td>\n        <td>\n            <i class="icon-help" data-toggle="popover" title="<b>Average Number of Reads</b>" data-content="The total number of reads divided by the number of papers."></i>\n        </td>\n        <td>\n            '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageNumberOfReads:e)?r[0]:r,e))+'\n        </td>\n        <td class="hidden-abstract-page">\n            '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageNumberOfReads:e)?r[1]:r,e))+'\n        </td>\n\n    </tr>\n <tr class="hidden-abstract-page">\n    <td> Median number of reads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Number of Reads</b>" data-content="The median of the reads distribution."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianNumberOfReads:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianNumberOfReads:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr>\n    <td> Total number of downloads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Total Number of Downloads</b>" data-content="The total number of times full text (article or e-print) was accessed."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNumberOfDownloads:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.totalNumberOfDownloads:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n<tr class="hidden-abstract-page">\n    <td> Average number of downloads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Average Number of Downloads</b>" data-content="The total number of downloads divided by the number of papers."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageNumberOfDownloads:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.averageNumberOfDownloads:e)?r[1]:r,e))+'\n    </td>\n\n</tr>\n\n<tr class="hidden-abstract-page">\n    <td> Median number of downloads </td>\n    <td>\n        <i class="icon-help" data-toggle="popover" title="<b>Median Number of Downloads</b>" data-content="The median of the downloads distribution."></i>\n    </td>\n    <td>\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianNumberOfDownloads:e)?r[0]:r,e))+'\n    </td>\n    <td class="hidden-abstract-page">\n        '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.medianNumberOfDownloads:e)?r[1]:r,e))+"\n    </td>\n\n</tr>\n\n\n"},useData:!0});return t.registerPartial("js/widgets/metrics/templates/reads_table",n),n}),function(e,t){"function"==typeof define&&define.amd?define("js/widgets/metrics/d3-tip",["d3"],t):t(e.d3)}(this,function(e){return e.tip=function(){function t(e){l=n(e),c=l.createSVGPoint(),document.body.appendChild(o)}function n(e){return"svg"===(e=e.node()).tagName.toLowerCase()?e:e.ownerSVGElement}function i(){var t=u||e.event.target,n={},i=t.getScreenCTM(),r=t.getBBox(),a=r.width,s=r.height,o=r.x,l=r.y;return c.x=o,c.y=l,n.nw=c.matrixTransform(i),c.x+=a,n.ne=c.matrixTransform(i),c.y+=s,n.se=c.matrixTransform(i),c.x-=a,n.sw=c.matrixTransform(i),c.y-=s/2,n.w=c.matrixTransform(i),c.x+=a,n.e=c.matrixTransform(i),c.x-=a/2,c.y-=s/2,n.n=c.matrixTransform(i),c.y+=s,n.s=c.matrixTransform(i),n}var r=function(){return"n"},a=function(){return[0,0]},s=function(){return" "},o=function(){var t=e.select(document.createElement("div"));return t.style({position:"absolute",top:0,opacity:0,"pointer-events":"none","box-sizing":"border-box"}),t.node()}(),l=null,c=null,u=null;t.show=function(){var n=Array.prototype.slice.call(arguments);n[n.length-1]instanceof SVGElement&&(u=n.pop());var i,l=s.apply(this,n),c=a.apply(this,n),p=r.apply(this,n),f=e.select(o),g=h.length,m=document.documentElement.scrollTop||document.body.scrollTop,b=document.documentElement.scrollLeft||document.body.scrollLeft;for(f.html(l).style({opacity:1,"pointer-events":"all"});g--;)f.classed(h[g],!1);return i=d.get(p).apply(this),f.classed(p,!0).style({top:i.top+c[0]+m+"px",left:i.left+c[1]+b+"px"}),t},t.hide=function(){return e.select(o).style({opacity:0,"pointer-events":"none"}),t},t.attr=function(n,i){if(arguments.length<2&&"string"==typeof n)return e.select(o).attr(n);var r=Array.prototype.slice.call(arguments);return e.selection.prototype.attr.apply(e.select(o),r),t},t.style=function(n,i){if(arguments.length<2&&"string"==typeof n)return e.select(o).style(n);var r=Array.prototype.slice.call(arguments);return e.selection.prototype.style.apply(e.select(o),r),t},t.direction=function(n){return arguments.length?(r=null==n?n:e.functor(n),t):r},t.offset=function(n){return arguments.length?(a=null==n?n:e.functor(n),t):a},t.html=function(n){return arguments.length?(s=null==n?n:e.functor(n),t):s};var d=e.map({n:function(){var e=i();return{top:e.n.y-o.offsetHeight,left:e.n.x-o.offsetWidth/2}},s:function(){var e=i();return{top:e.s.y,left:e.s.x-o.offsetWidth/2}},e:function(){var e=i();return{top:e.e.y-o.offsetHeight/2,left:e.e.x}},w:function(){var e=i();return{top:e.w.y-o.offsetHeight/2,left:e.w.x-o.offsetWidth}},nw:function(){var e=i();return{top:e.nw.y-o.offsetHeight,left:e.nw.x-o.offsetWidth}},ne:function(){var e=i();return{top:e.ne.y-o.offsetHeight,left:e.ne.x}},sw:function(){var e=i();return{top:e.sw.y,left:e.sw.x-o.offsetWidth}},se:function(){var e=i();return{top:e.se.y,left:e.e.x}}}),h=d.keys();return t},e.tip}),define("js/widgets/metrics/widget",["underscore","marionette","d3","js/widgets/base/base_widget","./extractor_functions","js/components/api_response","js/components/json_response","js/components/api_request","js/components/api_query","js/mixins/dependon","hbs!js/widgets/metrics/templates/metrics_container","hbs!js/widgets/metrics/templates/graph_template","hbs!js/widgets/metrics/templates/paper_table","hbs!js/widgets/metrics/templates/citations_table","hbs!js/widgets/metrics/templates/indices_table","hbs!js/widgets/metrics/templates/reads_table","bootstrap","js/components/api_feedback","js/components/api_targets","./d3-tip"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p,f,m,b,v,y,w){function _(e){if(!e)return e;var t=e.toString();return t.indexOf(".")>-1&&t.split(".")[1]?e.toFixed(1):e}var x=Backbone.Model.extend({defaults:function(){return{title:[],rows:[]}}}),S=t.ItemView.extend({className:"table table-hover s-metrics-table table-condensed",tagName:"table",onRender:function(){this.$('[data-toggle="popover"]').popover({html:!0,trigger:"hover"})}}),E=Backbone.Model.extend({defaults:function(){return{graphData:void 0,normalizedGraphData:void 0,normalized:!1,graphType:"histogram",barArrangement:"stacked",yAxisLabel:"Papers"}}}),A=t.ItemView.extend({className:"graph-view s-graph-view",initialize:function(){this.initial=!0},modelEvents:{"change:normalized":"render"},ui:{svg:"svg"},events:{"click .graph-tab":"updateTabValue"},updateTabValue:function(e){"normalized"===$(e.currentTarget).data("tab")?this.model.set("normalized",!0):this.model.set("normalized",!1)},colors:["#5683e0","#7ab889","#ffb639","#ed5e5b","#ce5cff","#1c459b"],drawHistogram:function(){function t(){m.domain([0,l]),w.transition().duration(500).delay(function(e,t){return 10*t}).attr("x",function(e,t,n){return g(e.x)+g.rangeBand()/s*n}).attr("width",g.rangeBand()/s).transition().attr("y",function(e){return m(e.y)}).attr("height",function(e){return p-m(e.y)})}function i(){m.domain([0,c]),w.transition().duration(500).delay(function(e,t){return 10*t}).attr("y",function(e){return m(e.y0+e.y)}).attr("height",function(e){return m(e.y0)-m(e.y0+e.y)}).transition().attr("x",function(e){return g(e.x)}).attr("width",g.rangeBand())}var r=this,a=this.model.get("normalized")?this.model.get("normalizedGraphData"):this.model.get("graphData"),s=a.length,o=n.layout.stack()(a.map(function(e){return e.values})),l=n.max(o,function(e){return n.max(e,function(e){return e.y})}),c=n.max(o,function(e){return n.max(e,function(e){return e.y0+e.y})}),u=n.select(this.$("svg")[0]),r=this,d={top:20,right:10,bottom:20,left:50},h=480-d.left-d.right,p=250-d.top-d.bottom,f=this.model.get("graphData")[0].values.map(function(e){return e.x}),g=n.scale.ordinal().domain(f).rangeRoundBands([0,h],.08),m=n.scale.linear().domain([0,c]).range([p,0]);this.$("svg").empty();var b=u.append("g").attr("transform","translate("+d.left+","+d.top+")").classed("graph-container-g",!0);if(!this.$(".graph-key").children().length){var v=n.select(this.$(".graph-key")[0]).selectAll("div").data(a.map(function(e){return e.key})).enter().append("div");v.append("div").classed("key-block",!0).style("background-color",function(e,t){return r.colors[t]}),v.append("span").text(function(e){return e})}this.tip||(this.tip=n.tip().attr("class","d3-tip").offset([-10,0]).html(function(t){var n=r.model.get("normalized")?"normalizedGraphData":"graphData";return r.model.get(n).map(function(n){return"<b>"+n.key+"</b>:&nbsp;"+e.findWhere(n.values,{x:t.x}).y.toFixed(2)}).join("<br/>")})),b.call(this.tip),b.append("g").attr("class","x axis").attr("transform","translate(0,"+p+")"),b.append("g").attr("class","y axis").attr("transform","translate(0,0)"),b.append("text").attr("text-anchor","middle").attr("transform","translate(-40,"+p/2+")rotate(-90)").classed("graph-label",!0).text(this.model.get("yAxisLabel")),this.$("input[name=bar-arrangement]").on("change",function(e){"grouped"===this.value?t():i()});var y,w=b.selectAll(".layer").data(o).enter().append("g").attr("class","layer").style("fill",function(e,t){return r.colors[t]}).selectAll("rect").data(function(e){return e}).enter().append("rect").attr("width",g.rangeBand()).attr("x",function(e){return g(e.x)}).on("mouseover",this.tip.show).on("mouseout",this.tip.hide);if(f.length>20){var _=Math.floor(f.length/5);y=f.filter(function(e){return e%_==0})}else y=f.length>8?f.filter(function(e){return e%2==0}):f;var x=n.svg.axis().scale(g).tickSize(0).tickValues(y).tickPadding(6).orient("bottom"),S=c>1?5:0,E=n.svg.axis().scale(m).tickSize(0).ticks(S).tickFormat(function(e){return e>1?n.format("s")(e):n.format(".1n")(e)}).orient("left");b.select(".x.axis").call(x),b.select(".y.axis").transition().call(E),b.selectAll("rect").transition().delay(function(e,t){return 10*t}).attr("y",function(e){return m(e.y0+e.y)}).attr("height",function(e){return m(e.y0)-m(e.y0+e.y)})},drawLineGraph:function(){var t=this;this.$(".stacked-form").remove();var i=n.tip().attr("class","d3-tip").offset([-10,0]).html(function(e){return e.key}),r=this.model.get("graphData");if(r){r.forEach(function(e){e.values.forEach(function(e){e.x=parseInt(e.x)})});var a=r[0].values.map(function(e){return e.x}),s=n.select(this.$("svg")[0]),o={top:20,right:80,bottom:30,left:50},l=480-o.left-o.right,c=250-o.top-o.bottom;if(g=s.append("g").attr("transform","translate("+o.left+","+o.top+")").attr("pointer-events","all"),1!==a.length){var u=n.scale.linear().domain(n.extent(a)).range([0,l]),d=n.scale.linear().range([c,0]);d.domain([0,n.max(e.flatten(r.map(function(e){return e.values.map(function(e){return e.y})})))]);var h=n.svg.axis().scale(u).tickSize(0).ticks(5).tickFormat(n.format()).tickPadding(6).orient("bottom"),p=n.svg.axis().scale(d).tickSize(0).ticks(5).tickFormat(function(e){return e>1?n.format("s")(e):n.format(".1n")(e)}).orient("left"),f=n.svg.line().x(function(e){return u(e.x)}).y(function(e){return d(e.y)});g.call(i),g.append("g").attr("class","x axis").attr("transform","translate(0,"+c+")").call(h),g.append("g").attr("class","y axis").call(p),g.selectAll(".index").data(r).enter().append("g").attr("class","index").append("path").attr("class","line").attr("d",function(e){return f(e.values)}).style("stroke",function(e,n){return t.colors[n]}),function(){var i=e.reduce(r,function(e,t){return e[t.key]=t.values,e},{}),a=s.append("g").attr("pointer-events","all"),h=a.append("line").attr({"pointer-events":"none",x1:o.left,x2:o.left,y1:o.top,y2:c+o.top,stroke:"black","stroke-width":"1px"}),p=e.map(i,function(e,t){return{key:t,el:a.append("circle").attr({r:3,"stroke-width":"2px",fill:"none","pointer-events":"none"}),data:e}}),f=g.append("foreignObject").attr({class:"info-box",width:"200px",height:"100px"}).style({"padding-left":"10px",opacity:.75,"font-size":"0.60em"}),m=e.memoize(function(e){if(e){var t="<table>";t+="<tr><td><strong>Year:</strong></td><td>&nbsp;"+e.year+"</td></tr>";for(var n in e.groups){var i=e.groups[n];t+="<tr>",t+='<td style="color:'+i.color+'"><strong>'+i.key+":</strong></td>",t+="<td>&nbsp;"+i.val.toFixed(5)+"</td>",t+="</tr>"}return t+="</table>"}},function(e){return e.year}),b=e.memoize(function(t){var i=n.bisector(function(e){return e.x}).left,r=[];return e.forEach(p,function(e){var n=e.data,a=i(n,t),s=n[a-1]||0,l=n[a]||n[n.length-1],c=t-s.x<l.x===t?s:l,h=u(c.x)+o.left,p=d(c.y)+o.top;r.push({dot:e,data:c,pos:{x:h,y:p}})},0),r}),v=e.memoize(function(t){return e.reduce(t,function(e,t){return e+t.pos.x},0)/t.length},function(e){return e[0].data.x}),y=function(e,n,i){var r=n.dot.el,a=n.data,s=n.pos;r.attr({visibility:null,transform:"translate("+s.x+","+s.y+")",stroke:t.colors[i]}),e.year=a.x,e.groups.push({key:n.dot.key,val:a.y,color:t.colors[i]})},w=e.debounce(function(){f.html(""),h.attr("visibility","hidden"),e.forEach(p,function(e){e.el.attr("visibility","hidden")})},300,{leading:!0});g.append("rect").attr({x:-10,width:l+20,height:c,visibility:"hidden"}).on("mouseout",w).on("mousemove",function(){var t=n.mouse(this),i=b(u.invert(t[0]).toFixed(0)),r=v(i),a={year:0,groups:[]};e.forEach(i,e.partial(y,a)),f.html(m(a)),h.attr({x1:r,x2:r,visibility:null})})}();var m=n.select(this.$(".graph-key")[0]).style({position:"absolute",right:0}).selectAll("div").data(r.map(function(e){return e.key})).enter().append("div");m.append("div").classed("key-block",!0).style("background-color",function(e,n){return t.colors[n]}),m.append("span").text(function(e){return e})}else g.append("text").attr("x",10).attr("y",100).text("time period is less than a year, refer to table to the left for values")}},drawGraph:function(){var e=this.model.get("graphType");"histogram"===e?this.drawHistogram():"line"===e&&this.drawLineGraph()},template:d,onRender:function(){this.drawGraph()}}),k=Backbone.Model.extend({defaults:function(){return{widgetName:"Metrics"}}}),C=t.LayoutView.extend({template:u,events:{"click .close-widget":"signalCloseWidget","click .show-all":"signalShowAll"},signalCloseWidget:function(){$(".d3-tip").remove(),this.trigger("close-widget")},signalShowAll:function(){this.$(".show-all").html('<i class="icon-loading"/>&nbsp;&nbsp;'+this.$(".show-all").html()),this.trigger("show-all")},modelEvents:{change:"render"},regions:{papersGraph:"#papers .metrics-graph",papersTable:"#papers .metrics-table",citationsGraph:"#citations .metrics-graph",citationsTable:"#citations .metrics-table",indicesGraph:"#indices .metrics-graph",indicesTable:"#indices .metrics-table",readsGraph:"#reads .metrics-graph",readsTable:"#reads .metrics-table"}}),P=i.extend({viewEvents:{"close-widget":"closeWidget","show-all":"showAll"},initialize:function(e){e=e||{},this.containerModel=new k,this.view=new C({model:this.containerModel}),this.childViews={},t.bindEntityEvents(this,this.view,t.getOption(this,"viewEvents")),this.dataExtractor=r,this.GraphModel=E,this.GraphView=A},defaultQueryArguments:{fl:["bibcode"]},components:{TableModel:x,TableView:S,GraphView:A,GraphModel:E,ContainerView:C},activate:function(t){this.setBeeHive(t),e.bindAll(this,"setCurrentQuery","processMetrics","checkIfSimpleRequired");var n=t.getService("PubSub");n.subscribe(n.INVITING_REQUEST,this.setCurrentQuery)},closeWidget:function(){this.reset(),this.componentParams&&this.componentParams.allowRedirect&&this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},showAll:function(){this.getIndicators()},reset:function(){this.childViews={},e.each(this.view.regions,function(e,t){this.view[t].currentView&&this.view[t].currentView.destroy()},this),this.containerModel.clear({silent:!0})},createTableViews:function(e,t){var n=1===t?this.createTableDataForOnePaper(e):this.createTableData(e);this.childViews.papersTableView=new S({template:h,model:new x(n.paperModelData)}),this.childViews.readsTableView=new S({template:m,model:new x(n.readsModelData)}),this.childViews.citationsTableView=new S({model:new x(n.citationsModelData),template:p}),this.childViews.indicesTableView=new S({model:new x(n.indicesModelData),template:f})},createTableData:function(t){var n={},i={refereed:t["basic stats refereed"],total:t["basic stats"]},r={refereed:t["citation stats refereed"],total:t["citation stats"]},a={refereed:t["indicators refereed"],total:t.indicators};return n.paperModelData={totalNumberOfPapers:[i.total["number of papers"],i.refereed["number of papers"]],totalNormalizedPaperCount:[i.total["normalized paper count"],i.refereed["normalized paper count"]]},n.readsModelData={totalNumberOfReads:[i.total["total number of reads"],i.refereed["total number of reads"]],averageNumberOfReads:[i.total["average number of reads"],i.refereed["average number of reads"]],medianNumberOfReads:[i.total["median number of reads"],i.refereed["median number of reads"]],totalNumberOfDownloads:[i.total["total number of downloads"],i.refereed["total number of downloads"]],averageNumberOfDownloads:[i.total["average number of downloads"],i.refereed["average number of downloads"]],medianNumberOfDownloads:[i.total["median number of downloads"],i.total["median number of downloads"]]},n.citationsModelData={numberOfCitingPapers:[r.total["number of citing papers"],r.refereed["number of citing papers"]],totalCitations:[r.total["total number of citations"],r.refereed["total number of citations"]],numberOfSelfCitations:[r.total["number of self-citations"],r.refereed["number of self-citations"]],averageCitations:[r.total["average number of citations"],r.refereed["average number of citations"]],medianCitations:[r.total["median number of citations"],r.refereed["median number of citations"]],normalizedCitations:[r.total["normalized number of citations"],r.refereed["normalized number of citations"]],refereedCitations:[r.total["total number of refereed citations"],r.refereed["total number of refereed citations"]],averageRefereedCitations:[r.total["average number of refereed citations"],r.refereed["average number of refereed citations"]],medianRefereedCitations:[r.total["median number of refereed citations"],r.refereed["median number of refereed citations"]],normalizedRefereedCitations:[r.total["normalized number of refereed citations"],r.refereed["normalized number of refereed citations"]]},n.indicesModelData={hIndex:[a.total.h,a.refereed.h],mIndex:[a.total.m,a.refereed.m],gIndex:[a.total.g,a.refereed.g],i10Index:[a.total.i10,a.refereed.i10],i100Index:[a.total.i100,a.refereed.i100],toriIndex:[a.total.tori,a.refereed.tori],riqIndex:[a.total.riq,a.refereed.riq],read10Index:[a.total.read10,a.refereed.read10]},e.each(n,function(t,n){e.each(t,function(e,n){t[n]=[_(e[0]),_(e[1])]})}),n},createGraphViews:function(e){var t=e.histograms,n=new E;this.childViews.papersGraphView=new A({model:n}),this.childViews.papersGraphView.model.set("graphData",this.dataExtractor.plot_paperhist({norm:!1,paperhist_data:t.publications})),this.childViews.papersGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_paperhist({norm:!0,paperhist_data:t.publications}));var i=new E({yAxisLabel:"Citations"});this.childViews.citationsGraphView=new A({model:i}),this.childViews.citationsGraphView.model.set("graphData",this.dataExtractor.plot_citshist({norm:!1,citshist_data:t.citations})),this.childViews.citationsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_citshist({norm:!0,citshist_data:t.citations}));var r=new E;this.childViews.readsGraphView=new A({model:r}),this.childViews.readsGraphView.model.set("graphData",this.dataExtractor.plot_readshist({norm:!1,readshist_data:t.reads})),this.childViews.readsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_readshist({norm:!0,readshist_data:t.reads}));var a=new E({graphType:"line"});this.childViews.indicesGraphView=new A({model:a}),e["time series"]?this.childViews.indicesGraphView.model.set("graphData",this.dataExtractor.plot_series({series_data:e["time series"]})):this.childViews.indicesGraphView.model.set({showingSimple:!0})},insertViews:function(){this.view.render(),["papers","citations","indices","reads"].forEach(function(e){this.view[e+"Table"].show(this.childViews[e+"TableView"]),this.view[e+"Graph"].show(this.childViews[e+"GraphView"])},this)},insertViewsForOnePaper:function(e){this.view.render({title:this.containerModel.get("title")}),this.view.$("#indices").hide(),this.view.$("#papers").hide(),this.view.$(".metrics-metadata").hide(),this.hasReads(e)?(this.view.readsTable.show(this.childViews.readsTableView),this.view.readsGraph.show(this.childViews.readsGraphView)):this.view.$(this.view.readsTable.el).html("No reads found for this article."),this.hasCitations(e)?(this.view.citationsTable.show(this.childViews.citationsTableView),this.view.citationsGraph.show(this.childViews.citationsGraphView)):this.view.$(this.view.citationsTable.el).html("No citations found for this article."),this.view.$(".hidden-abstract-page").hide()},createGraphViewsForOnePaper:function(e){var t=e.histograms,n=new this.GraphModel;this.childViews.citationsGraphView=new this.GraphView({model:n}),this.childViews.citationsGraphView.model.set("graphData",this.dataExtractor.plot_citshist({norm:!1,citshist_data:t.citations})),this.childViews.citationsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_citshist({norm:!0,citshist_data:t.citations}));var i=new this.GraphModel;this.childViews.readsGraphView=new this.GraphView({model:i}),this.childViews.readsGraphView.model.set("graphData",this.dataExtractor.plot_readshist({norm:!1,readshist_data:t.reads})),this.childViews.readsGraphView.model.set("normalizedGraphData",this.dataExtractor.plot_readshist({norm:!0,readshist_data:t.reads}))},createTableDataForOnePaper:function(t){var n={},i={refereed:t["basic stats refereed"],total:t["basic stats"]},r={refereed:t["citation stats refereed"],total:t["citation stats"]};return n.readsModelData={totalNumberOfReads:[i.total["total number of reads"],i.refereed["total number of reads"]],averageNumberOfReads:[i.total["average number of reads"],i.refereed["average number of reads"]],medianNumberOfReads:[i.total["median number of reads"],i.refereed["median number of reads"]],totalNumberOfDownloads:[i.total["total number of downloads"],i.refereed["total number of downloads"]],averageNumberOfDownloads:[i.total["average number of downloads"],i.refereed["average number of downloads"]],medianNumberOfDownloads:[i.total["median number of downloads"],i.total["median number of downloads"]]},n.citationsModelData={numberOfCitingPapers:[r.total["number of citing papers"],r.refereed["number of citing papers"]],totalCitations:[r.total["total number of citations"],r.refereed["total number of citations"]],numberOfSelfCitations:[r.total["number of self-citations"],r.refereed["number of self-citations"]],averageCitations:[r.total["average number of citations"],r.refereed["average number of citations"]],medianCitations:[r.total["median number of citations"],r.refereed["median number of citations"]],normalizedCitations:[r.total["normalized number of citations"],r.refereed["normalized number of citations"]],refereedCitations:[r.total["total number of refereed citations"],r.refereed["total number of refereed citations"]],averageRefereedCitations:[r.total["average number of refereed citations"],r.refereed["average number of refereed citations"]],medianRefereedCitations:[r.total["median number of refereed citations"],r.refereed["median number of refereed citations"]],normalizedRefereedCitations:[r.total["normalized number of refereed citations"],r.refereed["normalized number of refereed citations"]]},e.each(n,function(t,n){e.each(t,function(e,n){t[n]=[_(e[0]),_(e[1])]})}),n},hasCitations:function(e){return e["citation stats"]["total number of citations"]>0},hasReads:function(e){return e["basic stats"]["total number of reads"]>0},renderWidgetForCurrentQuery:function(e){e=e||{},this.reset(),this.containerModel.set({url:window.location.href,loading:!0});var t=this.getCurrentQuery()||e.currentQuery;t=this.customizeQuery(t);var n=this,i=[],r=void 0,a=y._limits.Metrics.default;t.set("rows",1e3);var s=function(o){t.set({start:o}),this._executeSearch(t).done(function(t){i=i.concat(t.get("response.docs").map(function(e){return e.bibcode})),r=r||t.get("response").numFound,(o+=1e3)>=r||o>=a?(r>a&&void 0===e.simple&&(e.simple=!0),n.containerModel.set({numFound:r>a?a:r,bibcodes:i}),n.getMetrics(i,e)):s(o)})}.bind(this);s(0)},checkIfSimpleRequired:function(){if(!this._currentQuery)return(new $.Deferred).resolve(!1);var e=this._currentQuery.clone();return e.unlock(),e.set({stats:"true","stats.field":"citation_count",fl:"id"}),this._executeSearch(e).then(function(e){return e.get("stats.stats_fields.citation_count.sum")>5e4})},getIndicators:function(){function t(t){var n=t.toJSON();this.childViews.indicesGraphView.model.set({graphData:this.dataExtractor.plot_series({series_data:n["time series"]}),showingSimple:!1});var i={refereed:n["indicators refereed"],total:n.indicators},r={hIndex:[i.total.h,i.refereed.h],mIndex:[i.total.m,i.refereed.m],gIndex:[i.total.g,i.refereed.g],i10Index:[i.total.i10,i.refereed.i10],i100Index:[i.total.i100,i.refereed.i100],toriIndex:[i.total.tori,i.refereed.tori],riqIndex:[i.total.riq,i.refereed.riq],read10Index:[i.total.read10,i.refereed.read10]};e.each(r,function(e,t){r[t]=[_(e[0]),_(e[1])]}),this.childViews.indicesTableView.model.set(r),this.childViews.indicesTableView.render(),this.childViews.indicesGraphView.render()}var n=this.getPubSub(),i={type:"POST",contentType:"application/json"},r=new l({bibcodes:this.containerModel.get("bibcodes"),types:["indicators","timeseries"]}),a=new o({target:y.SERVICE_METRICS,query:r,options:i});t=t.bind(this),n.subscribeOnce(n.DELIVERING_RESPONSE,t),n.publish(n.EXECUTE_REQUEST,a)},getMetrics:function(e,t){function n(t){function n(){try{this.processMetrics.apply(this,arguments),i.resolve()}catch(e){i.reject()}}var r=this.getPubSub(),a={type:"POST",contentType:"application/json"},s=new l({bibcodes:e});t&&s.set({types:["simple"]});var c=new o({target:y.SERVICE_METRICS,query:s,options:a});n=n.bind(this),r.subscribeOnce(r.DELIVERING_RESPONSE,n),r.publish(r.EXECUTE_REQUEST,c)}t=t||{};var i=$.Deferred();return n=n.bind(this),void 0!==t.simple?n(t.simple):this.checkIfSimpleRequired().done(n),i.promise()},processMetrics:function(e){if(this.containerModel.set("loading",!1),(e=e.attributes?e.attributes:e).Error||500===e.status)throw this.closeWidget(),new Error("Metrics Service Error");1===e["basic stats"]["number of papers"]?(this.createTableViews(e,1),this.createGraphViewsForOnePaper(e),this.insertViewsForOnePaper(e)):(this.createTableViews(e),this.createGraphViews(e),this.insertViews(e))},_executeSearch:function(t){var n=this.getPubSub(),i=new o({target:y.SEARCH,query:t}),r=$.Deferred();return n.subscribeOnce(n.DELIVERING_RESPONSE,e.bind(function(e){r.resolve(e)}),this),n.publish(n.EXECUTE_REQUEST,i),r},renderWidgetForListOfBibcodes:function(e){this.reset(),this.containerModel.set({numFound:e.length,loading:!0}),this.getMetrics(e,{simple:!1})}});return e.extend(P.prototype,c.BeeHive),P}),define("hbs!js/widgets/citation_helper/templates/citation_helper_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.success:r,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.program(4,i,0),data:i}))?r:""},2:function(e,t,n,i){var r;return'<div class="ch-alert alert-success alert-dismissable" role="alert">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n    '+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numRecords:r,e))+" records were added to library <b>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b>\n</div>\n"},4:function(e,t,n,i){var r;return'<div class="ch-alert alert-danger alert-dismissable" role="alert">\n    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n    No records were added to <b>'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b>: <em>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.error:r,e))+"</em>\n</div>\n"},6:function(e,t,n,i){var r;return"<div class=\"citation-helper-metadata s-citation-helper-metadata\">\n\n<h4>Suggested Articles</h4>\n<p>These suggestions are based on a 'friends-of-friends' analysis of the citation network for the papers in the library (scores start at 2).</p>\n    <br>\n\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"owner",{name:"compare",hash:{operator:"=="},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+'</div>\n<br>\n<ul class="citation-helper-list-container-list-container s-citation-helper-list-container">\n\n'+(null!=(r=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+"\n</ul>\n\n"},7:function(e,t,n,i){return'    <div class="row"><div class="col-xs-6"><button class="btn btn-sm btn-success submit-add-to-library">Add selected papers to this library</button></div></div>\n'},9:function(e,t,n,i){var r;return'    <li class="citation-helper-item s-citation-helper-item">\n        <div class="col-sm-10">\n            <div class="row s-top-row">\n                <div class="col-xs-1 ch-selectbox-col s-top-row-col">\n                    <input type="checkbox" value="'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'" name="identifier">\n                </div>\n                <div class="col=sm-3 col-xs-4 s-top-row-col">'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'</div>\n                <div class="col-sm-2 s-top-row-col"><b>score: '+this.escapeExpression("function"==typeof(r=null!=(r=t.score||(null!=e?e.score:e))?r:t.helperMissing)?r.call(e,{name:"score",hash:{},data:i}):r)+'</b></div>\n            </div>\n            <div class="row">\n                <div class="col-xs-10 col-xs-offset-1">\n                <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'">\n                    <h3 class="s-results-title">'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+'</h3>\n                </a>\n                </div>\n            </div>\n            <div class="row">\n                <div class="col-xs-10 col-xs-offset-1">\n                    <ul class="list-inline just-authors s-results-authors">\n                        <li class="article-author">\n                            '+this.escapeExpression("function"==typeof(r=null!=(r=t.author||(null!=e?e.author:e))?r:t.helperMissing)?r.call(e,{name:"author",hash:{},data:i}):r)+"\n                        </li>\n                    </ul>\n                </div>\n            </div>\n        </div>\n    </li>\n"},11:function(e,t,n,i){var r;return'    <div style="padding-left: 20px; padding-top: 50px;">\n        <div class="row s-message-control-row"><i>'+this.escapeExpression("function"==typeof(r=null!=(r=t.msg||(null!=e?e.msg:e))?r:t.helperMissing)?r.call(e,{name:"msg",hash:{},data:i}):r)+"</i></div>\n    </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.items:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.msg:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>"},useData:!0});return t.registerPartial("js/widgets/citation_helper/templates/citation_helper_template",n),n}),define("js/widgets/citation_helper/widget",["marionette","js/widgets/base/base_widget","js/components/api_response","js/components/json_response","js/components/api_request","js/components/api_query","js/mixins/dependon","hbs!js/widgets/citation_helper/templates/citation_helper_template","bootstrap","js/components/api_feedback","js/components/api_targets","analytics"],function(e,t,n,i,r,a,s,o,l,c,u,d){var h=Backbone.Model.extend({defaults:{items:[],widgetName:"CitationHelper",libraryID:null,permission:null,libname:null}}),p=e.ItemView.extend({template:o,events:{"click .close-widget":"signalCloseWidget","click .submit-add-to-library":"libraryAdd"},modelEvents:{change:"render"},libraryAdd:function(){this.$(".submit-add-to-library").html('<i class="fa fa-spinner fa-pulse"></i>');var e={};e.libraryID=this.model.get("libraryID"),e.libname=this.model.get("libname");var t=this.$("input:checked").map(function(){return this.value}).get();e.recordsToAdd=t,this.trigger("library-add",e)},signalCloseWidget:function(){this.trigger("close-widget")}}),f=t.extend({viewEvents:{"close-widget":"closeWidget","library-add":"libraryAddSubmit"},initialize:function(t){t=t||{},this.model=new h,this.view=new p({model:this.model}),e.bindEntityEvents(this,this.view,e.getOption(this,"viewEvents"))},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=e.getService("PubSub");t.subscribe(t.INVITING_REQUEST,this.setCurrentQuery),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),this.getBeeHive().getObject("AppStorage")&&this.setCurrentQuery(this.getBeeHive().getObject("AppStorage").getCurrentQuery())},libraryAddSubmit:function(e){var t={},n=this;t.library=e.libraryID,t.bibcodes=e.recordsToAdd,name=e.libname,this.getBeeHive().getObject("LibraryController").addBibcodesToLib(t).done(function(t,i){var r=t.numBibcodesRequested-parseInt(t.number_added);n.model.set("feedback",{success:!0,name:name,id:e.libraryID,numRecords:t.number_added,numAlreadyInLib:r})}).fail(function(t){n.model.set("feedback",{success:!1,name:name,id:e.libraryID,error:JSON.parse(arguments[0].responseText).error})}),this.clearFeedbackWithDelay()},clearFeedbackWithDelay:function(){var e=this;setTimeout(function(){e.model.unset("feedback")},5e3)},getSuggestions:function(e){var t=$.Deferred(),n=this.getPubSub(),i={type:"POST",contentType:"application/json"},s=new r({target:u.SERVICE_CITATION_HELPER,query:new a({bibcodes:e}),options:i});return n.subscribeOnce(n.DELIVERING_RESPONSE,function(e){t.resolve(e.toJSON())}),n.publish(n.EXECUTE_REQUEST,s),t.promise()},processResponse:function(e){if(e instanceof n){var t=_.map(e.get("response.docs"),function(e){return e.bibcode});this.getSuggestions(t)}else e instanceof i&&this.processSuggestions(e)},processSuggestions:function(e){(e=e.attributes?e.attributes:e).Error&&"Unable to get results!"===e.Error||500==e.status?this.model.set("msg","Citation Helper did not find any suggestions."):this.model.set("items",e)},renderWidgetForCurrentQuery:function(){this.reset(),this.dispatchRequest(this.getCurrentQuery())},reset:function(){this.model.clear({silent:!0}).set("items",[],{silent:!0})},closeWidget:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"results-page")},renderWidgetForListOfBibcodes:function(e,t){this.reset();var n=new r({target:u.SERVICE_CITATION_HELPER,query:new a({bibcodes:e}),options:{type:"POST",contentType:"application/json"}});this.model.set({libraryID:t.libid,permission:t.permission,libname:t.libname}),this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,n)}});return _.extend(f.prototype,s.BeeHive),f}),define("hbs!js/modules/orcid/widget/templates/container-template",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return" (<b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.totalPapers||(null!=e?e.totalPapers:e))?r:t.helperMissing)?r.call(e,{name:"totalPapers",hash:{},data:i}):r)+"</b>) "},3:function(e,t,n,i){return'            <p><i class="icon-loading"></i> Loading ORCID data...</p>\n'},5:function(e,t,n,i){var r,a;return'        <div style="margin-bottom: 10px;">\n            <span style="width: 40%;">ORCID Username:&nbsp;<b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidUserName||(null!=e?e.orcidUserName:e))?a:t.helperMissing)?a.call(e,{name:"orcidUserName",hash:{},data:i}):a)+"</b></span>\n            &nbsp;&nbsp;&nbsp;\n            <span>ORCID ID:&nbsp;<b>"+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidID||(null!=e?e.orcidID:e))?a:t.helperMissing)?a.call(e,{name:"orcidID",hash:{},data:i}):a)+'</b></span>\n        </div>\n\n         <p><i class="fa fa-info-circle"></i> To share this list of your ORCID papers:\n                    <ul>\n                      <li>\n                          Search for your ORCID ID in ADS (orcid:'+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidID||(null!=e?e.orcidID:e))?a:t.helperMissing)?a.call(e,{name:"orcidID",hash:{},data:i}):a)+')\n                      </li>\n                    <li>\n                        You can then share the url of your results:<br>  <a href="https://ui.adsabs.harvard.edu/#search/q=orcid%3A'+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidID||(null!=e?e.orcidID:e))?a:t.helperMissing)?a.call(e,{name:"orcidID",hash:{},data:i}):a)+'&sort=date+desc">https://ui.adsabs.harvard.edu/#search/q=orcid%3A'+this.escapeExpression("function"==typeof(a=null!=(a=t.orcidID||(null!=e?e.orcidID:e))?a:t.helperMissing)?a.call(e,{name:"orcidID",hash:{},data:i}):a)+'&sort=date+desc</a>\n                    </li>\n                    <li>\n                        Please note that claims take up to 24 hours to be indexed in ADS.\n                    </li>\n\n                    </ul>\n          </p>\n          <p> <i class="fa fa-info-circle"></i>\n               To claim papers in ORCID and add to this list <br>\n              <div style="padding-left:5%;">\n'+(null!=(r=t.if.call(e,null!=e?e.orcidUserName:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+'            </div>\n\n           </p>\n        <br>\n        <p> <a href="#orcid-instructions"> <i class="fa fa-arrow-circle-o-right"></i> Learn more about using ORCID with ADS</a></p>\n        <br>\n\n'},6:function(e,t,n,i){return'                <button class="btn btn-sm btn-default search-author-name"><i class="fa fa-search"></i> click here to search your name in ADS</button>\n'},8:function(e,t,n,i){return"                search your name in ADS</button>\n"},10:function(e,t,n,i){var r;return null!=(r=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"            ",helpers:t,partials:n}))?r:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'\n<div class="row s-results-control-row-container">\n\n\n    <div class="col-sm-10 col-sm-offset-1" style="padding:0 9%" >\n        <h2>\n            My ORCID Papers '+(null!=(r=t.if.call(e,null!=e?e.totalPapers:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n        </h2>\n        \x3c!--loading user data--\x3e\n"+(null!=(r=t.if.call(e,null!=e?e.loading:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?r:"")+'\n    </div>\n</div>\n<div class="row s-darker-background">\n    <div class="col-sm-10 s-main-content-container" style="margin-top:20px;padding-top: 20px; float:none">\n        <div class="row">\n            <ul class="col-sm-12 results-list  s-results-list list-unstyled s-display-block" aria-label="list of results">\n            </ul>\n        </div>\n'+(null!=(r=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n    </div>\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/modules/orcid/widget/templates/container-template",n),n}),define("hbs!js/modules/orcid/widget/templates/empty-template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="col-sm-10 col-sm-offset-1">\n    No papers retrieved from ORCID\n</div>'},useData:!0});return t.registerPartial("js/modules/orcid/widget/templates/empty-template",n),n}),define("js/modules/orcid/widget/widget",["underscore","js/widgets/list_of_things/widget","js/widgets/base/base_widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/formatter","hbs!js/modules/orcid/widget/templates/container-template","js/mixins/papers_utils","js/components/api_query","js/components/json_response","hbs!js/modules/orcid/widget/templates/empty-template","js/modules/orcid/extension"],function(e,t,n,i,r,a,s,o,l,c,u,d){return d(t.extend({initialize:function(n){t.prototype.initialize.apply(this,arguments);var i=this;this.view.getEmptyView=function(){return Marionette.ItemView.extend({template:u})},e.extend(this.view.events,{"click .search-author-name":function(){var e,t=this,n=this.model.get("orcidLastName")+", "+this.model.get("orcidFirstName");i.getBeeHive().getService("OrcidApi").getADSUserData().done(function(i){i&&i.nameVariations?(i.nameVariations.push(n),e='author:("'+i.nameVariations.join('" OR "')+'")'):e='author:"'+n+'"',t.trigger("search-author-name",e)})}}),this.view.delegateEvents(),this.view.template=s,this.view.model.set({mainResults:!0},{silent:!0}),this.listenTo(this.collection,"reset",this.checkDetails),this.listenTo(this.view,"search-author-name",function(e){var t=this.getPubSub(),n=new l({q:e});t.publish(t.START_SEARCH,n)}),this.on("orcid-update-finished",this.mergeDuplicateRecords)},orcidWidget:!0,activate:function(n){t.prototype.activate.apply(this,[].slice.apply(arguments)),e.bindAll(this,"processResponse"),this.on("orcidAction:delete",function(e){this.collection.remove(e)})},mergeDuplicateRecords:function(t){var n,i,r={},a=0;if(t?e.each(t,function(e){e._dupIdx=a++,(n=e.identifier)&&(n=n.toLowerCase(),r[n]?(r[n].push(e),i=!0):r[n]=[e])}):this.hiddenCollection.each(function(e){n=e.get("identifier"),e.attributes._dupIdx=a++,n&&(n=n.toLowerCase(),r[n]?(r[n].push(e.attributes),i=!0):r[n]=[e.attributes])}),i){var s={},o=[];e.each(r,function(t,n){if(t.length>1){var i=0;e.each(t,function(e,t){e.source_name&&"nasa ads"==e.source_name.toLowerCase()&&(i=t)});var r=t[i];t.splice(i,1),o.push(r._dupIdx),r.source_name=r.source_name||"",e.each(t,function(e){e.source_name&&(r.source_name+="; "+e.source_name),s[e._dupIdx]=!0})}});var l=function(t){var n=0;e.each(t,function(e){e.resultsIndex=n++,e.indexToShow=n})};if(t)(s=e.keys(s)).sort(function(e,t){return t-e}),e.each(s,function(e){t.splice(e,1)}),l(t);else{e.each(o,function(e){var t=this.hiddenCollection.models[e];t.set("source_name",t.attributes.source_name,{silent:!0})});var c=[];this.hiddenCollection.each(function(e){s[e.attributes._dupIdx]||c.push(e.attributes)}),l(c),this.hiddenCollection.reset(c),this.updatePagination({numFound:c.length})}}},processDocs:function(t,n,r){var n=i.addPaginationToDocs(n,0);return e.each(n,function(e,t){n[t]=o.prepareDocForViewing(e)}),n},getPaginationInfo:function(e,t){var n=t.length,r=this.model.get("perPage")||10,a=e.getApiQuery()||new l({orcid:"author X"}),s=i.getPageVal(0,r);return{numFound:n,perPage:r,start:0,page:s,showRange:[s*r,(s+1)*r-1],pageData:this._getPaginationData(s,r,n),currentQuery:a}},onShow:function(){var t=this.getBeeHive().getService("OrcidApi"),n=this;if(t){if(!t.hasAccess())return;n.model.set("loading",!0),t.getOrcidProfileInAdsFormat().done(function(t){var i=new c(t),r=i.get("responseHeader.params");r=e.reduce(e.pairs(r),function(e,t){return t[1]&&(e[t[0]]=t[1]),e},{}),i.setApiQuery(new l(r)),n.processResponse(i),n.model.set({orcidID:r.orcid,orcidUserName:r.firstName+" "+r.lastName,orcidFirstName:r.firstName,orcidLastName:r.lastName,loading:!1,totalPapers:i.get("response.docs")?i.get("response.docs").length:"0"})})}},update:function(t){if(t=t||{},this.hiddenCollection&&this.view.collection){this._originalCollection||(this._originalCollection=new this.hiddenCollection.constructor(this.hiddenCollection.models));var n=this._originalCollection,i=["ads","both","others",null];if(e.has(t,"filterBy")){var r=t.filterBy;e.isArray(r)||(r=[r]);for(var a in r)if(!e.contains(i,r[a]))throw Error("Unknown value for the filter: "+r[a]);n=new this.hiddenCollection.constructor(n.filter(function(t){if(t.attributes.orcid&&e.contains(r,t.attributes.orcid.provenance))return!0}))}if(e.has(t,"sortBy")&&t.sortBy){var s=0;n=new this.hiddenCollection.constructor(e.map(n.sortBy(t.sortBy),function(e){return e.attributes.resultsIndex=s++,e}))}this.hiddenCollection.reset(n.models),this.updatePagination({})}}}))}),define("js/wraps/author_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeHierarchicalCheckboxFacet({facetField:"author_facet_hier",facetTitle:"Authors",openByDefault:!0,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/bibgroup_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"bibgroup_facet",facetTitle:"Bib Groups",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/bibstem_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"bibstem_facet",facetTitle:"Publications",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}})}}),define("js/wraps/data_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"data_facet",facetTitle:"Data",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/database_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"database",facetTitle:"Collections",openByDefault:!0,logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/grants_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeHierarchicalCheckboxFacet({facetField:"grant_facet_hier",facetTitle:"Grants",logicOptions:{single:["limit to","exclude"],multiple:["or","exclude"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,r=this.queryUpdater.removeTmpEntry(n,"SelectedItems");if(r&&_.keys(r).length>0){r=_.values(r),_.each(r,function(e,t,n){n[t]='grant:"'+e.title+'"'}),n=n.clone();"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,"fq_grant","limit",r):"or"==e?this.queryUpdater.updateQuery(n,"fq_grant","expand",r):"exclude"==e&&(n.get("fq_grant")?this.queryUpdater.updateQuery(n,"fq_grant","exclude",r):(r.unshift("*:*"),this.queryUpdater.updateQuery(n,"fq_grant","exclude",r)));var a="{!type=aqp cache=false cost=150 v=$fq_grant}",s=n.get("fq");s?(-1==_.indexOf(s,a)&&s.push(a),n.set("fq",s)):n.set("fq",[a]),n.unset("facet.prefix"),n.unset("facet"),this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:r}))}},n}}),define("js/wraps/keyword_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"keyword_facet",facetTitle:"Keywords",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("js/wraps/object_facet",["js/components/api_response","js/components/api_request","js/components/api_query","js/components/solr_response","js/widgets/facet/factory","js/components/api_targets","analytics","cache","underscore","js/widgets/facet/reducers"],function(e,t,n,i,r,a,s,o,l,c){return function(){var e=r.makeHierarchicalCheckboxFacet({facetField:"simbad_object_facet_hier",facetTitle:"SIMBAD Objects",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}});return e._dispatchRequest=function(e,t){var n=this.getPubSub(),i=this;this.store.dispatch(this.actions.data_requested(e)),e?n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.translateSimbid(t,e)}):n.subscribeOnce(n.DELIVERING_RESPONSE,function(t){i.store.dispatch(i.actions.data_received(t.toJSON(),e))});var r=this.customizeQuery(this.getCurrentQuery()),t=(e?this.store.getState().facets[e].children:this.store.getState().children).length||0;r.set("facet.offset",t),e&&r.set("facet.prefix",e.replace("0/","1/"));var a=this.composeRequest(r);n.publish(n.DELIVERING_REQUEST,a)},e._simbidCache={},e.translateSimbid=function(n,i){var r=this,s=n.toJSON().facet_counts.facet_fields.simbad_object_facet_hier.map(function(e,t){if(t%2==0)return e.split("/")[e.split("/").length-1]}).filter(function(e){if(e)return e}),o=new t({target:a.SERVICE_OBJECTS,options:{type:"POST",contentType:"application/json",data:JSON.stringify({identifiers:s}),done:function(t){var a=n.toJSON();a.facet_counts.facet_fields.simbad_object_facet_hier=a.facet_counts.facet_fields.simbad_object_facet_hier.map(function(n,i){if(i%2==0){var r=n.split("/"),a=r[r.length-1],s=r.slice(0,2).concat([t[a].canonical]).join("/");return e._simbidCache[s]=a,s}return n},this),r.store.dispatch(r.actions.data_received(a,i))}}});this.getBeeHive().getService("Api").request(o)},e.submitFilter=function(e){var t=this.getCurrentQuery().clone();t.unlock();var n=this.store.getState().config.facetField,i="fq_"+n,r=c.getActiveFacets(this.store.getState(),this.store.getState().state.selected),a=r.map(function(e){if(this._simbidCache[e])t=e.split("/").slice(0,2).concat([this._simbidCache[e]]).join("/");else var t=e;return n+':"'+t+'"'},this);"and"==e||"limit to"==e?this.queryUpdater.updateQuery(t,i,"limit",a):"or"==e?this.queryUpdater.updateQuery(t,i,"expand",a):"exclude"!=e&&"not"!=e||(t.get(i)?this.queryUpdater.updateQuery(t,i,"exclude",a):(a.unshift("*:*"),this.queryUpdater.updateQuery(t,i,"exclude",a)));var o="{!type=aqp v=$"+i+"}",u=t.get("fq")||[];if(u.push(o),t.set("fq",l.unique(u)),"simbad_object_facet_hier"===n){var d=t.get("__simbad_object_facet_hier_fq_simbad_object_facet_hier")[0];t.set("__simbad_object_facet_hier_fq_simbad_object_facet_hier",[d].concat(r))}t.unset("facet.prefix"),t.unset("facet"),t.unset("start"),t.unset("rows"),this.dispatchNewQuery(t),s("send","event","interaction","facet-applied",JSON.stringify({name:n,logic:e,conditions:a}))},e}}),define("js/wraps/refereed_facet",["js/widgets/facet/factory","analytics"],function(e,t){return function(){var n=e.makeBasicCheckboxFacet({facetField:"property",facetTitle:"Refereed",openByDefault:!0,defaultQueryArguments:{"facet.query":"property:refereed"},preprocessors:function(e){return e.filter(function(e){return"notrefereed"===e.value||"refereed"===e.value}).map(function(e){return"notrefereed"===e.name&&(e.name="non-refereed"),e})},logicOptions:{single:["limit to","exclude"],multiple:["invalid choice"]}});return n.handleLogicalSelection=function(e){var n=this.getCurrentQuery(),i=this.findPaginator(n).paginator,r=this.queryUpdater.removeTmpEntry(n,"SelectedItems"),a=this;if(r&&_.keys(r).length>0){r=_.values(r),_.each(r,function(e,t,n){n[t]="property:"+a.queryUpdater.escapeInclWhitespace(e.value)}),n=n.clone();var s="fq_"+this.facetField;"and"==e||"limit to"==e?this.queryUpdater.updateQuery(n,s,"limit",r):"or"==e?this.queryUpdater.updateQuery(n,s,"expand",r):"exclude"!=e&&"not"!=e||this.queryUpdater.updateQuery(n,s,"exclude",r);var o="{!type=aqp v=$"+s+"}",l=n.get("fq");l?(-1==_.indexOf(l,o)&&l.push(o),n.set("fq",l)):n.set("fq",[o]),this.dispatchNewQuery(i.cleanQuery(n)),t("send","event","interaction","facet-applied",JSON.stringify({name:this.facetField,logic:e,conditions:r}))}},n}}),define("js/wraps/vizier_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"vizier_facet",facetTitle:"Vizier Tables",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("hbs!js/widgets/tabs/templates/tabs_inner",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<div class="tab-pane '+(null!=(r=t.if.call(e,null!=e?e.default:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'" id= '+this.escapeExpression("function"==typeof(a=null!=(a=t.id||(null!=e?e.id:e))?a:t.helperMissing)?a.call(e,{name:"id",hash:{},data:i}):a)+">"+this.escapeExpression("function"==typeof(a=null!=(a=t.view||(null!=e?e.view:e))?a:t.helperMissing)?a.call(e,{name:"view",hash:{},data:i}):a)+"</div>\n"},useData:!0});return t.registerPartial("js/widgets/tabs/templates/tabs_inner",n),n}),define("hbs!js/widgets/tabs/templates/tabs_outer",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="tab-widget">\n    \x3c!-- Nav tabs --\x3e\n    <ul class="nav nav-tabs">\n    </ul>\n\n    \x3c!-- Tab panes --\x3e\n    <div class="tab-content">\n    </div>\n</div>'},useData:!0});return t.registerPartial("js/widgets/tabs/templates/tabs_outer",n),n}),define("hbs!js/widgets/tabs/templates/tabs_title",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" active "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<li class="'+(null!=(r=t.if.call(e,null!=e?e.default:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'"> <a href="#'+this.escapeExpression("function"==typeof(a=null!=(a=t.id||(null!=e?e.id:e))?a:t.helperMissing)?a.call(e,{name:"id",hash:{},data:i}):a)+'" data-toggle="tab"> <h5>'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+"</h5></a></li>\n"},useData:!0});return t.registerPartial("js/widgets/tabs/templates/tabs_title",n),n}),define("js/widgets/tabs/tabs_widget",["underscore","marionette","bootstrap","hbs!js/widgets/tabs/templates/tabs_inner","hbs!js/widgets/tabs/templates/tabs_outer","hbs!js/widgets/tabs/templates/tabs_title"],function(e,t,n,i,r,a){return t.ItemView.extend({className:"s-tabs-widget",activate:function(t){var n,i=[];return e.each(this.widgets,function(e){e.activate(n=t.getHardenedInstance()),i.push({name:e.title,object:e,beehive:n})}),i},initialize:function(t){this.tabs=t.tabs||[],this.widgets=e.map(this.tabs,function(e,t){if(!e.widget)throw new Error('Missing "widget" for: '+e.title+" ["+t+"]");return e.widget})},render:function(){this.beforeRender&&this.beforeRender(),this.trigger("before:render",this);var t=$(r()),n=t.find("ul.nav"),s=t.find("div.tab-content");return e.each(this.tabs,function(e){n.append(a({id:e.id,title:e.title,default:e.default})),s.append(i({id:e.id,default:e.default}))},this),this.$el.html(t.html()),e.each(this.tabs,function(e){this.$("#"+e.id).append(e.widget.getEl())},this),this.bindUIElements(),this.onRender&&this.onRender(),this.trigger("render",this),this},onDestroy:function(){e.each(this.tabs,function(e){e.widget.destroy?e.widget.destroy():e.widget.remove&&e.widget.remove()},this)},getEl:function(){return this.el&&this.$el.children().length?this.el:this.render().el}})}),define("hbs!js/widgets/facet/graph-facet/templates/graph",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return"    "+this.escapeExpression("function"==typeof(r=null!=(r=t.statsDescription||(null!=e?e.statsDescription:e))?r:t.helperMissing)?r.call(e,{name:"statsDescription",hash:{},data:i}):r)+" : <b>"+this.escapeExpression("function"==typeof(r=null!=(r=t.statsCount||(null!=e?e.statsCount:e))?r:t.helperMissing)?r.call(e,{name:"statsCount",hash:{},data:i}):r)+"</b>\n    <hr/>\n"},3:function(e,t,n,i){return"loading...\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="pull-right s-view-metrics-button-container"></div>\n'+(null!=(r=t.if.call(e,null!=e?e.statsCount:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'<div class="graph-legend"></div>\n'+(null!=(r=t.unless.call(e,null!=e?e.graphData:e,{name:"unless",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+' <div class="s-svg-container">\n     <svg class="chart s-chart" viewBox="0 0 110 100" preserveAspectRatio="xMinYMin meet">\n     </svg>\n </div>\n\n<div style="position: relative;top: 30px;">\n    <div class="slider s-slider"></div>\n    <div class="graph-controls row">\n        <div class="slider-data col-sm-12">\n        </div>\n</div>\n\n\n</div>\n'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/graph",n),n}),define("js/widgets/facet/graph-facet/base_graph",["marionette","d3","jquery","jquery-ui","hbs!js/widgets/facet/graph-facet/templates/graph"],function(e,t,n,i,r){return e.ItemView.extend({className:"graph-facet",initialize:function(e){this.yAxisTitle=e.yAxisTitle,this.xAxisTitle=e.xAxisTitle,this.graphTitle=e.graphTitle,this.pastTenseTitle=e.pastTenseTitle,this.id=this.graphTitle+"-graph",this.fullWidth=110,this.fullHeight=100,this.width=this.fullWidth-this.margin.left-this.margin.right,this.height=this.fullHeight-this.margin.top-this.margin.bottom,this.currentScale="linear",this.on("facet:active",this.pulseApplyButton)},bins:12,margin:{top:5,right:5,bottom:20,left:20},template:r,insertLegend:function(){this.$(".graph-legend").html(this.legendTemplate({yAxisTitle:this.yAxisTitle}))},events:{"click .apply":"submitFacet","blur input[type=text]":"triggerGraphChange"},modelEvents:{change:"render"},pulseApplyButton:function(){this.$(".apply").addClass("draw-attention-primary-faded"),setTimeout(function(){this.$(".apply").removeClass("draw-attention-primary-faded")},2e3)},onRender:function(){this.model.get("graphData")&&(this.model.get("graphData").length<2?this.$el.html("Too little data to make a useful graph."):(this.insertLegend(),this.buildGraph(),this.addSliderWindows(),this.buildSlider(),this.addToOnRender&&this.addToOnRender()))}})}),define("hbs!js/widgets/facet/graph-facet/templates/year-graph-legend",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<span <span class="s-legend-color refereed"></span> refereed</span>&nbsp;&nbsp;\n<span> <span class="s-legend-color nonrefereed"></span> non refereed</span>\n'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/year-graph-legend",n),n}),define("js/widgets/facet/graph-facet/year_graph",["./base_graph","hbs!js/widgets/facet/graph-facet/templates/year-graph-legend","marionette","jquery-ui"],function(e,t,n,i){return e.extend({bins:10,margin:{top:5,right:0,bottom:20,left:10},id:"year-graph",legendTemplate:t,formatXAxisText:function(e){e.style("text-anchor","end").attr("dx","-.8em").attr("dy","-1.1em").attr("transform",function(e){return"rotate(-65)"})},buildGraph:function(){function e(e){return e%1==0}var t,i,r,a,s,o,l,c,u=this,d=d3.format("s");t=_.clone(this.model.get("graphData")),t=this.binData(t,this.bins),i=_.pluck(t,"x"),maxVal=d3.max(_.pluck(t,"y")),r=d3.scale.ordinal().domain(i).rangeRoundBands([0,this.width],.1),a=d3.scale.linear().domain([0,maxVal]).range([this.height,0]),s=d3.svg.axis().scale(r).orient("bottom"),o=d3.svg.axis().scale(a).ticks(5).orient("left").tickFormat(function(t){return t>=1&&e(t)?d(t):""}),l=d3.select(this.el).select(".chart").attr("width",this.fullWidth).attr("height",this.fullHeight),this.innerChart=l.append("g").classed("inner-chart",!0).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),(c=this.innerChart.selectAll("g").data(t).enter().append("g").classed("bar",!0).attr("transform",function(e){return"translate("+r(e.x)+",0)"})).append("rect").classed("full-bar",!0).attr("y",function(e){return a(e.y)}).attr("height",function(e){return u.height-a(e.y)}).attr("width",function(e){return r.rangeBand()*e.width/u.binSize}),c.append("rect").classed("refereed",!0).attr("y",function(e){return a(e.refCount)}).attr("height",function(e){return u.height-a(e.refCount)}).attr("width",function(e){return r.rangeBand()*e.width/u.binSize}),this.innerChart.append("g").classed({axis:!0,"x-axis":!0}).attr("transform","translate(0,"+this.height+")").call(s).selectAll("text").call(this.formatXAxisText),this.innerChart.append("g").classed({axis:!0,"y-axis":!0}).call(o).selectAll("text").style("text-anchor","start"),this.innerChart.append("text").attr("class","s-label").attr("x",this.width/2-20).attr("y",212).text(n.getOption(this,"xAxisTitle")),this.innerChart.append("text").attr("class","s-label").attr("y",-40).attr("x",-this.height/2).attr("transform","rotate(-90)").text(n.getOption(this,"yAxisTitle"))},binData:function(e,t){var n,i,r,a,s,o;if(e.length<=t)return this.binSize=1,e=_.map(e,function(e,t){return{x:""+e.x,y:e.y,width:1,refCount:e.refCount}});n=void 0,r=Math.floor(e.length/t),this.binSize=r,(i=e.length%t)&&(t+=Math.floor(i/r),(i%=r)&&(n=i)),a=[],s=[],o=[];for(var l=0;l<t;l++)a.push(r);return n&&a.push(n),_.each(a,function(t,n){for(var i=0,r=0,a=[];t>=1;){var l=e[0];a.push(l.x),i+=l.y,r+=l.refCount,e.shift(),t-=1}s.push(a),o.push({totalCount:i,refCount:r})}),s=_.map(s,function(e,t){return e.length>1?{x:e[0]+"-"+e[e.length-1],width:e.length}:{x:e[0]+"",width:1}}),e=_.map(s,function(e,t){return{x:e.x,y:o[t].totalCount,refCount:o[t].refCount,width:e.width}})},graphChange:function(e,t){function n(e){return e%1==0}var i,r,a,s,o,l,c,u=this,d=(i=_.clone(this.model.get("graphData")))[0].x,h=i[i.length-1].x;e!==d||t!==h?this.trigger("facet:active"):this.trigger("facet:inactive"),i=_.filter(i,function(n,i){return n.x>=e&&n.x<=t}),i=this.binData(i,this.bins),!0===this.sizeSort&&(i=_.sortBy(i,function(e){return e.y})),a=_.pluck(i,"x"),maxVal=d3.max(_.pluck(i,"y")),r=d3.scale.ordinal().domain(a).rangeRoundBands([0,this.width],.1),s=d3.scale.linear().domain([0,maxVal]).range([this.height,0]),o=d3.svg.axis().scale(r).orient("bottom");var p=d3.format("s");l=d3.svg.axis().scale(s).orient("left").tickFormat(function(e){return e>=1&&n(e)?p(e):""}),(c=this.innerChart.selectAll(".bar").data(i)).exit().remove();var f=c.enter().append("g").classed("bar",!0);f.append("rect").classed("full-bar",!0),f.append("rect").classed("refereed",!0);var g=a.length;c.transition(500).attr("transform",function(e){return"translate("+r(e.x)+",0)"}).delay(function(e,t){return 500*t/g}).select("rect").attr("y",function(e){return s(e.y)}).attr("height",function(e){return u.height-s(e.y)}).attr("width",function(e){return r.rangeBand()*e.width/u.binSize}),c.select(".refereed").transition(500).delay(function(e,t){return 500*t/g}).attr("y",function(e){return s(e.refCount)}).attr("height",function(e){return u.height-s(e.refCount)}).attr("width",function(e){return r.rangeBand()*e.width/u.binSize}),d3.select(this.el).select(".x-axis").call(o).selectAll("text").call(this.formatXAxisText),d3.select(this.el).select(".y-axis").transition().call(l).selectAll("text").style("text-anchor","start")},buildSlider:function(){var e=this,t=_.clone(this.model.get("graphData")),n=t[0].x,i=t[t.length-1].x;this.$(".slider").slider({range:!0,min:n,max:i,values:[n,i],stop:function(t,n){var i=n.values[0],r=n.values[1];e.graphChange(i,r)},slide:function(t,n){var i=n.values[0],r=n.values[1];e.$(".show-slider-data-first").val(i),e.$(".show-slider-data-second").val(r)}}),this.$(".show-slider-data-first").val(n),this.$(".show-slider-data-second").val(i)},addSliderWindows:function(){this.$(".slider-data").html('Limit results to papers from <br/> <input type="text" class="show-slider-data-first"></input> to <input type="text" class="show-slider-data-second"></input> <button class="apply btn btn-sm btn-primary-faded">Apply</button>')},triggerGraphChange:function(){var e,t;e=this.$(".show-slider-data-first").val(),t=this.$(".show-slider-data-second").val(),this.$(".slider").slider("values",[e,t]),this.graphChange(e,t)},submitFacet:function(){this.trigger("facet-applied",this.$(".slider").slider("values").join("-"))}})}),define("hbs!js/widgets/facet/graph-facet/templates/h-index-graph-legend",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'H-Index for results: <span id="h-index-container"> </span>\n<div class="ref-nonref hidden pull-right">\n    <div> <span class="s-legend-color refereed"></span> refereed</div>\n</div>\n    <div class="change-scale"> Y-axis:\n        <label>linear <input type="radio" name="'+this.escapeExpression("function"==typeof(r=null!=(r=t.yAxisTitle||(null!=e?e.yAxisTitle:e))?r:t.helperMissing)?r.call(e,{name:"yAxisTitle",hash:{},data:i}):r)+'-scale" value="linear" checked/></label>\n        <label>log <input type="radio" name="'+this.escapeExpression("function"==typeof(r=null!=(r=t.yAxisTitle||(null!=e?e.yAxisTitle:e))?r:t.helperMissing)?r.call(e,{name:"yAxisTitle",hash:{},data:i}):r)+'-scale" value="log"/></label>\n    </div>'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/h-index-graph-legend",n),n}),define("hbs!js/widgets/facet/graph-facet/templates/h-index-slider-window",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'Limit to top <input type="text" class="show-slider-data-first"> most '+this.escapeExpression("function"==typeof(r=null!=(r=t.pastTenseTitle||(null!=e?e.pastTenseTitle:e))?r:t.helperMissing)?r.call(e,{name:"pastTenseTitle",hash:{},data:i}):r)+'\n<button class="apply btn btn-sm btn-primary-faded pull-right">Apply</button>\n\n'},useData:!0});return t.registerPartial("js/widgets/facet/graph-facet/templates/h-index-slider-window",n),n}),define("js/widgets/facet/graph-facet/h_index_graph",["./base_graph","hbs!js/widgets/facet/graph-facet/templates/h-index-graph-legend","hbs!js/widgets/facet/graph-facet/templates/h-index-slider-window","marionette"],function(e,t,n,i){return e.extend({legendTemplate:t,xAxisClassName:"h-index-x-axis-title",addToOnRender:function(){this.hIndex&&this.$("#h-index-container").text(this.hIndex.x)},events:{"click .apply":"submitFacet","blur input[type=text]":"triggerGraphChange","change input[name*=scale]":"toggleScale"},buildGraph:function(){function e(e){return e%1==0}var t,n,r,a,s,o,l,c;t=_.clone(this.model.get("graphData")),this.hIndex=t[_.indexOf(t,_.findWhere(t,function(e){if(e.x>e.y)return!0}))-1],n=_.pluck(t,"x");var u=_.pluck(t,"y");maxVal=d3.max(u),minVal=d3.min(u);var d=[n[0]-1,n[n.length-1]+1];r=d3.scale.linear().domain(d).range([0,this.width]),a=d3.scale.linear().domain([minVal-1,maxVal+1]).range([this.height,0]),s=d3.svg.axis().scale(r).orient("bottom"),standardFormatter=d3.format("s"),o=d3.svg.axis().scale(a).orient("left").tickFormat(function(t){return t>=1&&e(t)?standardFormatter(t):""}),l=d3.select(this.el).select(".chart").attr("width",this.fullWidth).attr("height",this.fullHeight),this.innerChart=l.append("g").classed("inner-chart",!0).attr("transform","translate("+this.margin.left+","+this.margin.top+")"),this.innerChart.append("g").classed({axis:!0,"x-axis":!0}).attr("transform","translate(0,"+this.height+")").call(s).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"}),this.innerChart.append("g").classed({axis:!0,"y-axis":!0}).call(o),t.length>=40?(c=d3.svg.line().x(function(e){return r(e.x)}).y(function(e){return a(e.y)}),this.innerChart.append("path").datum(t).classed("line",!0).attr("d",c)):(this.$(".ref-nonref").removeClass("hidden"),this.innerChart.selectAll("circle").data(t).enter().append("circle").attr("class","dot").attr("r",2).classed("refereed",function(e){if(e.refereed)return!0}).attr("cx",function(e){return r(e.x)}).attr("cy",function(e){return a(e.y)})),this.hIndex&&(this.innerChart.append("line").classed({"h-index":!0,"h-index-1":!0}).attr("x1",r(this.hIndex.x)).attr("y1",a(minVal-1)).attr("x2",r(this.hIndex.x)).attr("y2",a(this.hIndex.y)),this.innerChart.append("line").classed({"h-index":!0,"h-index-2":!0}).attr("x1",r(n[0]-1)).attr("y1",a(this.hIndex.y)).attr("x2",r(this.hIndex.x)).attr("y2",a(this.hIndex.y))),this.innerChart.append("text").attr("class","s-label").attr("x",this.width/2-20).attr("y",180).text(i.getOption(this,"xAxisTitle")),this.innerChart.append("text").attr("class","s-label").attr("y",-40).attr("x",-this.height/2).attr("transform","rotate(-90)").text(i.getOption(this,"yAxisTitle"))},toggleScale:function(e){var t=$(e.target).attr("value");this.currentScale=t,this.graphChange()},graphChange:function(e){function t(e){return e%1==0}var n,i,r,a,s;e!==(n=_.clone(this.model.get("graphData")))[n.length-1].x?this.trigger("facet:active"):this.trigger("facet:inactive"),e?this.limitVal=e:this.limitVal||(this.limitVal=d3.max(_.pluck(n,"x"))),n=_.filter(n,function(e,t){return"log"===this.currentScale?e.x<=this.limitVal&&e.y>0:e.x<=this.limitVal},this);var o=_.pluck(n,"x"),l=_.pluck(n,"y");maxVal=d3.max(l),minVal=d3.min(l);var c=[o[0]-1,o[o.length-1]+1];if(i=d3.scale.linear().domain(c).range([0,this.width]),a=d3.svg.axis().scale(i).orient("bottom").tickFormat(d3.format("d")),"linear"===this.currentScale?r=d3.scale.linear().domain([minVal-1,maxVal+1]).range([this.height,0]):"log"===this.currentScale&&(r=d3.scale.log().domain([_.max([1,minVal-1]),maxVal+1]).range([this.height,0]).clamp(!0)),d3.select(this.el).select(".x-axis").call(a).selectAll("text").style("text-anchor","end").attr("dx","-.8em").attr("dy",".15em").attr("transform",function(e){return"rotate(-65)"}),standardFormatter=d3.format("s"),s=d3.svg.axis().scale(r).orient("left"),"log"===this.currentScale){var u=d3.format("s");s.tickFormat(function(e){var t=Math.log(e)/Math.log(10)+1e-6;return Math.abs(t-Math.floor(t))<.7?u(e):""})}else s=d3.svg.axis().scale(r).orient("left").tickFormat(function(e){return e>=1&&t(e)?standardFormatter(e):""});if(d3.select(this.el).select(".y-axis").transition().call(s),this.hIndex&&(_.contains(n,this.hIndex)?this.innerChart.selectAll(".h-index").classed("hidden",!1):this.innerChart.selectAll(".h-index").classed("hidden",!0),this.innerChart.select(".h-index-1").transition().attr("x1",i(this.hIndex.x)).attr("x2",i(this.hIndex.x)).attr("y2",r(this.hIndex.y)),this.innerChart.select(".h-index-2").transition().attr("y1",r(this.hIndex.y)).attr("x2",i(this.hIndex.x)).attr("y2",r(this.hIndex.y))),n.length>=40)$(".ref-nonref").addClass("hidden"),line=d3.svg.line().x(function(e){return i(e.x)}).y(function(e){return r(e.y)}),this.innerChart.selectAll(".dot").classed("hidden",!0),this.innerChart.selectAll(".line").datum(n).attr("d",line).classed("hidden",!1);else{this.$(".ref-nonref").removeClass("hidden"),this.innerChart.selectAll(".line").classed("hidden",!0),this.innerChart.selectAll(".dot").classed("hidden",!1);var d=this.innerChart.selectAll("circle").data(n);d.exit().remove(),d.enter().append("circle").attr("class","dot").attr("r",2),d.classed("refereed",function(e){if(e.refereed)return!0}).attr("cx",function(e){return i(e.x)}).attr("cy",function(e){return r(e.y)})}},buildSlider:function(){var e=this,t=_.clone(this.model.get("graphData")),n=t[t.length-1].x,i=t[0].x;this.$(".slider").slider({max:n,min:i,value:n,stop:function(t,n){e.graphChange(n.value)},slide:function(t,n){e.$(".show-slider-data-first").val(n.value)}}),this.$(".show-slider-data-first").val(n)},addSliderWindows:function(){this.$(".slider-data").html(n({pastTenseTitle:this.pastTenseTitle}))},triggerGraphChange:function(){var e;e=this.$(".show-slider-data-first").val(),this.$(".slider").slider("value",e),this.graphChange(e)},submitFacet:function(){var e=this.model.get("graphData")[this.$(".slider").slider("value")-1].y;this.trigger("facet-applied","["+e+" TO 9999999]")}})}),define("js/wraps/graph_tabs",["js/widgets/tabs/tabs_widget","js/widgets/facet/factory","js/widgets/facet/graph-facet/year_graph","js/widgets/facet/graph-facet/h_index_graph","js/mixins/formatter"],function(e,t,n,i,r){return function(){var a=t.makeGraphFacet({graphView:n,facetField:"year",defaultQueryArguments:{"facet.pivot":"property,year",facet:"true","facet.minCount":"1","facet.limit":"-1"},graphViewOptions:{yAxisTitle:"article count",xAxisTitle:"years"},processResponse:function(e){this.setCurrentQuery(e.getApiQuery());var t=e.get("facet_counts.facet_pivot.property,year");if(e.get("response.numFound")<2)this.model.set({graphData:[]});else{var n=_.findWhere(t,{value:"refereed"});n&&(n=n.pivot);var i=_.findWhere(t,{value:"notrefereed"});i&&(i=i.pivot);var r,a;_.each(n,function(e){var t=parseInt(e.value);void 0===r?r=t:t>r&&(r=t),void 0===a?a=t:parseInt(e.value)<a&&(a=parseInt(e.value))}),_.each(i,function(e){var t=parseInt(e.value);void 0===r?r=t:t>r&&(r=t),void 0===a?a=t:parseInt(e.value)<a&&(a=parseInt(e.value))});var s=_.range(a,r+1),o=[];_.each(s,function(e){var t=e+"";refCount=_.filter(n,function(e){return e.value===t})[0],refCount=refCount?refCount.count:0,nonRefCount=_.filter(i,function(e){return e.value===t})[0],nonRefCount=nonRefCount?nonRefCount.count:0,o.push({x:e,y:refCount+nonRefCount,refCount:refCount})}),o.length<2?this.model.set({graphData:[]}):this.model.set({graphData:o})}}}),s=t.makeGraphFacet({graphView:i,facetField:"citation_count",defaultQueryArguments:{"facet.pivot":"property,citation_count",facet:"true","facet.limit":"-1",stats:"true","stats.field":"citation_count"},graphViewOptions:{yAxisTitle:"citations",xAxisTitle:"number of records",pastTenseTitle:"cited"},processResponse:function(e){this.setCurrentQuery(e.getApiQuery());var t=e.get("facet_counts.facet_pivot.property,citation_count");if(e.get("response.numFound")<2)this.model.set({graphData:[]});else{var n=_.findWhere(t,{value:"refereed"});n&&(n=n.pivot);var i=_.findWhere(t,{value:"notrefereed"});i&&(i=i.pivot);var a=[];if(_.each(n,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){a.push({refereed:!0,x:void 0,y:t})})}),_.each(i,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){a.push({refereed:!1,x:void 0,y:t})})}),a.length<2)this.model.set({graphData:[]});else{a=a.sort(function(e,t){return t.y-e.y}),a=_.first(a,2e3),a=_.map(a,function(e,t){return e.x=t+1,e});var s;e.toJSON().stats&&(s=r.formatNum(e.get("stats.stats_fields.citation_count.sum"))),this.model.set({graphData:a,statsCount:s,statsDescription:"total number of citations"})}}}}),o=t.makeGraphFacet({graphView:i,facetField:"read_count",defaultQueryArguments:{"facet.pivot":"property,read_count",facet:"true","facet.limit":"-1",stats:"true","stats.field":"read_count"},graphViewOptions:{yAxisTitle:"recent reads",xAxisTitle:"number of records",pastTenseTitle:"read"},processResponse:function(e){this.setCurrentQuery(e.getApiQuery());var t=e.get("facet_counts.facet_pivot.property,read_count");if(e.get("response.numFound")<2)this.model.set({graphData:[]});else{var n=_.findWhere(t,{value:"refereed"});n&&(n=n.pivot);var i=_.findWhere(t,{value:"notrefereed"});i&&(i=i.pivot);var a=[];if(_.each(n,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){a.push({refereed:!0,x:void 0,y:t})})}),_.each(i,function(e){var t=e.value,n=e.count;_.each(_.range(n),function(){a.push({refereed:!1,x:void 0,y:t})})}),a.length<2)this.model.set({graphData:[]});else{a=a.sort(function(e,t){return t.y-e.y}),a=_.first(a,2e3),a=_.map(a,function(e,t){return e.x=t+1,e});if(e.toJSON().stats)var s=r.formatNum(e.get("stats.stats_fields.read_count.sum"));this.model.set({graphData:a,statsCount:s,statsDescription:"total recent (90 day) reads"})}}}}),l=new e({tabs:[{title:"Years",widget:a,id:"year-facet",default:!0},{title:"Citations",widget:s,id:"citations-facet"},{title:"Reads",widget:o,id:"reads-facet"}]});return l.yearGraphWidget=a,l.citationGraphWidget=s,l.readsGraphWidget=o,l}}),define("hbs!js/widgets/footer/footer",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return' <div class="container">\n        <footer>\n            <div class="row top-ads-links">\n                <div class="col-sm-4 col-sm-offset-1">\n                    <a href="http://www.nasa.gov" target="_blank"><img src="styles/img/nasa.svg" alt="NASA logo"></a>\n                    <a href="http://www.si.edu" target="_blank"><img class="smithsonian" src="styles/img/smithsonian.svg" alt="Smithsonian logo"></a>\n                    <a href="https://www.cfa.harvard.edu/" target="_blank"><img src="styles/img/cfa.png" title="Harvard Center for Astrophysics logo"></a>\n\n                </div>\n\n                <div class="col-md-6 col-md-offset-1">\n                    <h4>\n                        <a href="https://adsabs.github.io/blog/" target="_blank">\n                            <i class="fa fa-newspaper-o"></i> ADS Blog\n                        </a>\n                    </h4>\n                    <h4>\n                        <a href="https://adsabs.github.io/help/" target="_blank">\n                            <i class="fa fa-info-circle"></i> ADS Help\n                        </a>\n                     <h4>\n                        <a href="https://twitter.com/adsabs" target="_blank">\n                           <i class="fa fa-twitter"></i> @adsabs\n                        </a>\n                    </h4>\n                </div>\n            </div>\n            <br/>\n            <div class="row">\n                <div class="col-sm-4 col-sm-offset-1">\n                    <p><i class="fa fa-envelope"></i> adshelp[at]cfa.harvard.edu</p>\n                    <p>© The SAO/NASA Astrophysics Data System</p>\n                    <p>The ADS is operated by the Smithsonian Astrophysical Observatory under NASA Cooperative Agreement <em>NNX16AC86A</em></p>\n                </div>\n                <div class="col-sm-6 col-sm-offset-1">\n                    <a href="https://adsisdownorjustme.herokuapp.com/" target="_blank">Is ADS down? (or is it just me...)</a><br>\n                    <a href="http://adsabs.harvard.edu/mirrors.html" target="_blank">ADS Mirrors</a><br>\n                    <br/>\n                    <a href="http://www.si.edu" target="_blank">Smithsonian Institution</a><br>\n                    <a href="http://www.si.edu/Privacy" target="_blank">Smithsonian Privacy Notice</a><br>\n                    <a href="http://www.si.edu/Termsofuse" target="_blank">Smithsonian Terms of Use</a><br>\n                    <a href="http://www.cfa.harvard.edu/sao" target="_blank">Smithsonian Astrophysical Observatory</a><br>\n                    <a href="http://www.nasa.gov" target="_blank">NASA</a><br>\n                </div>\n            </div>\n\n        </footer>\n    </div>'},useData:!0});return t.registerPartial("js/widgets/footer/footer",n),n}),define("js/widgets/footer/widget",["marionette","hbs!js/widgets/footer/footer"],function(e,t){return e.ItemView.extend({template:t,className:"footer s-footer"})}),define("js/wraps/pubtype_facet",["js/widgets/facet/factory"],function(e){return function(){return e.makeBasicCheckboxFacet({facetField:"doctype",facetTitle:"Publication Type",logicOptions:{single:["limit to","exclude"],multiple:["and","or","exclude"]}})}}),define("hbs!js/widgets/graphics/templates/grid",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r,a;return'    <div class="s-grid-title">\n        <h4 class="s-list-description">Graphics from</h4>\n        <h2 class="s-article-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+"</h2>\n    </div>\n"},3:function(e,t,n,i){var r,a;return'\n<div class="s-grid-container">\n    <p><i>'+(null!=(r="function"==typeof(a=null!=(a=t.linkSentence||(null!=e?e.linkSentence:e))?a:t.helperMissing)?a.call(e,{name:"linkSentence",hash:{},data:i}):a)?r:"")+"</i></p>\n"+(null!=(r=t.each.call(e,null!=e?e.graphics:e,{name:"each",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>\n\n"},4:function(e,t,n,i){var r,a;return'    <a href="'+this.escapeExpression(this.lambda(null!=e?e.highres:e,e))+'" target="_blank">\n        <div class="grid-cell">\n'+(null!=(r=t.if.call(e,null!=e?e.interactive:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+'            <figure>\n                <img src="'+this.escapeExpression(this.lambda(null!=e?e.thumbnail:e,e))+'" alt="'+this.escapeExpression("function"==typeof(a=null!=(a=t.key||i&&i.key)?a:t.helperMissing)?a.call(e,{name:"key",hash:{},data:i}):a)+'" class="grid-cell__image"/>\n            </figure>\n            <figcaption>\n                '+this.escapeExpression("function"==typeof(a=null!=(a=t.key||i&&i.key)?a:t.helperMissing)?a.call(e,{name:"key",hash:{},data:i}):a)+"\n            </figcaption>\n        </div>\n    </a>\n\n"},5:function(e,t,n,i){return'            <div class="graphics_ribbon--interactive">\n                <span>INTERACTIVE</span>\n            </div>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=e?e.title:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.if.call(e,null!=e?e.graphics:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/graphics/templates/grid",n),n}),define("hbs!js/widgets/graphics/templates/sidebar",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'\n  <div class="s-right-col-widget-container">\n    <div class="graphics-container s-graphics-container">\n      <h4 class="s-right-col-widget-title">Graphics</h4>\n      <div class="grid-cell">\n        <img src="'+this.escapeExpression("function"==typeof(r=null!=(r=t.sampleGraphic||(null!=e?e.sampleGraphic:e))?r:t.helperMissing)?r.call(e,{name:"sampleGraphic",hash:{},data:i}):r)+'" alt="figure from paper" class="grid-cell__image" />\n        <p><i>Click to view more</i></p>\n      </div>\n    </div>\n  </div>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.sampleGraphic:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:""},useData:!0});return t.registerPartial("js/widgets/graphics/templates/sidebar",n),n}),define("js/widgets/graphics/widget",["marionette","js/widgets/base/base_widget","js/components/api_request","js/components/api_response","js/components/api_query","hbs!js/widgets/graphics/templates/grid","hbs!js/widgets/graphics/templates/sidebar","js/components/api_targets"],function(e,t,n,i,r,a,s,o){var l=Backbone.Model.extend({defaults:function(){return{graphics:void 0,title:void 0,linkSentence:void 0}}}),c=e.ItemView.extend({template:a,className:"s-graphics-grid",modelEvents:{change:"render"}}),u=e.ItemView.extend({template:s,className:"s-graphics-sidebar graphics-sidebar",modelEvents:{"change:graphics":"render"},triggers:{"click .graphics-container":"showGraphicsGrid"},serializeData:function(){var e=this.model.toJSON().graphics;return e?{sampleGraphic:e[_.keys(e)[0]].thumbnail}:{sampleGraphic:void 0}}});return t.extend({initialize:function(e){e=e||{},this.model=new l,this.view=!0===e.sidebar?new u({model:this.model}):new c({model:this.model}),t.prototype.initialize.apply(this,arguments)},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["processResponse","onDisplayDocuments"]),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},onDisplayDocuments:function(e){var t=e.get("q"),n=this;t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this.loadBibcodeData(t).done(function(){n.trigger("page-manager-event","widget-ready",{isActive:!0,widget:n})}))},loadBibcodeData:function(t){if(t===this._bibcode)return this.deferredObject=$.Deferred(),this.deferredObject.resolve(this.model),this.deferredObject.promise();this._bibcode=t,this.deferredObject=$.Deferred();a=new n({target:o.GRAPHICS+"/"+this._bibcode,query:new r});if(this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,a),!e.getOption(this,"sidebar")){var i=this.getCurrentQuery().clone();i.unlock(),i.set("q","bibcode:"+t),i.set("fl","title");var a=new n({target:o.SEARCH,query:i});this.getPubSub().publish(this.getPubSub().DELIVERING_REQUEST,a)}return this.deferredObject.promise()},processResponse:function(e){if(e instanceof i){var t=e.get("response.docs[0]['title']");t=t&&t.length?t[0]:"",this.model.set("title",t)}else{if(e.toJSON().Error){this.model.clear();var n=e.get("Error");return this.deferredObject.reject(n)}var r={};_.each(e.get("figures"),function(e){r[e.figure_label]=e.images[0],"interactive"===e.figure_type&&(r[e.figure_label].interactive=!0)},this),this.model.set({graphics:r,linkSentence:e.get("header")})}this.deferredObject&&this.model.get("title")&&this.model.get("graphics")&&this.deferredObject.resolve()},viewEvents:{showGraphicsGrid:"triggerShowGrid"},triggerShowGrid:function(){this.getPubSub().publish(this.getPubSub().NAVIGATE,"ShowGraphics",{href:"/abs/"+this._bibcode+"/graphics"})}})}),define("js/wraps/sidebar-graphics-widget",["js/widgets/graphics/widget"],function(e){var t={sidebar:!0};return function(){return new e(t)}}),define("js/widgets/list_of_things/details_widget",["./widget","js/mixins/add_stable_index_to_collection","js/mixins/link_generator_mixin","js/mixins/papers_utils"],function(e,t,n,i){var r=e.extend({defaultQueryArguments:{fl:"title,bibcode,author,keyword,pub,aff,volume,year,links_data,[citations],property,pubdate,abstract",rows:25,start:0},initialize:function(t){e.prototype.initialize.call(this,t),this.on("page-manager-message",function(e,t){"broadcast-payload"===e&&this.ingestBroadcastedPayload(t)}),this.listenTo(this.model,"change:bibcode",function(){this.reset()})},activate:function(t){e.prototype.activate.apply(this,[].slice.apply(arguments));var n=t.getService("PubSub");_.bindAll(this,"dispatchRequest","processResponse"),n.subscribe(n.DISPLAY_DOCUMENTS,this.dispatchRequest),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse)},ingestBroadcastedPayload:function(e){var t=this;setTimeout(function(){t.model.set("title",e.title)},100)},dispatchRequest:function(t){try{var n=t.get("q")[0].match(/bibcode:(.*)/)[1]}catch(e){return void console.error("was unable to parse the bibcode!")}this.model.set("bibcode",n),e.prototype.dispatchRequest.apply(this,arguments)},customizeQuery:function(){var t=e.prototype.customizeQuery.apply(this,arguments);if(Marionette.getOption(this,"sortOrder")&&t.set("sort",Marionette.getOption(this,"sortOrder")),this.model.get("queryOperator")){var n=this.model.get("queryOperator")+"("+t.get("q").join(" ")+")";"trending"===this.model.get("queryOperator")&&(n+="-"+t.get("q")[0])}else n=t.get("q");return t.set("q",n),t},extractValueFromQuery:function(e,t,n){if(e.has(t))for(var i=e.get(t),r=0;r<i.length;r++)if(i[r].indexOf(n+":")>-1)return i[r].replace(new RegExp(n+":","g"),"").replace(/\\?\"/g,"")},processDocs:function(e,n,i){var r=this,a=e.get("response").start||i.start||0;return _.each(n,function(e,t){n[t]=r.prepareDocForViewing(e)}),n=this.parseLinksData(n),t.addPaginationToDocs(n,a)}});return _.extend(r.prototype,n),_.extend(r.prototype,i),r}),define("js/wraps/references",["js/widgets/list_of_things/details_widget"],function(e){return function(){return new e({queryOperator:"references",sortOrder:"first_author asc",description:"Papers referenced by",operator:!0})}}),define("js/wraps/citations",["js/widgets/list_of_things/details_widget"],function(e){return function(){return new e({queryOperator:"citations",sortOrder:"date desc",description:"Papers which cite",operator:!0})}}),define("js/wraps/coreads",["js/widgets/list_of_things/details_widget"],function(e){return function(){return new e({queryOperator:"trending",description:"Papers also read by those who read",operator:!0,sortOrder:"date desc",removeSelf:!0})}}),define("hbs!js/widgets/meta_tags/template/metatags",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'<meta name="og:description" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)+'" data-highwire="true">\n<meta name="twitter:description" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.abstract||(null!=e?e.abstract:e))?r:t.helperMissing)?r.call(e,{name:"abstract",hash:{},data:i}):r)+'" data-highwire="true">\n'},3:function(e,t,n,i){return'<meta name="citation_author" content="'+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+'" data-highwire="true">\n<meta xmlns="http://www.w3.org/1999/xhtml" name="citation_author_institution" content="'+this.escapeExpression(this.lambda(null!=e?e.aff:e,e))+'" data-highwire="true">\n'},5:function(e,t,n,i){var r;return'<meta name="citation_firstpage" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.page||(null!=e?e.page:e))?r:t.helperMissing)?r.call(e,{name:"page",hash:{},data:i}):r)+'" data-highwire="true">\n'},7:function(e,t,n,i){var r;return'<meta name="citation_publication_date" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.pubdate||(null!=e?e.pubdate:e))?r:t.helperMissing)?r.call(e,{name:"pubdate",hash:{},data:i}):r)+'" data-highwire="true">\n'},9:function(e,t,n,i){var r;return'<meta name="citation_journal_title" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.pub||(null!=e?e.pub:e))?r:t.helperMissing)?r.call(e,{name:"pub",hash:{},data:i}):r)+'" data-highwire="true">\n'},11:function(e,t,n,i){var r;return'<meta name="citation_volume" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.volume||(null!=e?e.volume:e))?r:t.helperMissing)?r.call(e,{name:"volume",hash:{},data:i}):r)+'" data-highwire="true">\n'},13:function(e,t,n,i){var r;return'<meta name="citation_issue" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.issue||(null!=e?e.issue:e))?r:t.helperMissing)?r.call(e,{name:"issue",hash:{},data:i}):r)+'" data-highwire="true">\n'},15:function(e,t,n,i){var r;return'<meta name="citation_doi" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.doi||(null!=e?e.doi:e))?r:t.helperMissing)?r.call(e,{name:"doi",hash:{},data:i}):r)+'" data-highwire="true">\n'},17:function(e,t,n,i){var r;return'<meta name="citation_issn" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.issn||(null!=e?e.issn:e))?r:t.helperMissing)?r.call(e,{name:"issn",hash:{},data:i}):r)+'" data-highwire="true">\n'},19:function(e,t,n,i){return'<meta name="citation_keywords" content="'+this.escapeExpression(this.lambda(e,e))+'" data-highwire="true">\n'},21:function(e,t,n,i){var r;return'<meta name="citation_pdf_url" content="'+this.escapeExpression("function"==typeof(r=null!=(r=t.pdfUrl||(null!=e?e.pdfUrl:e))?r:t.helperMissing)?r.call(e,{name:"pdfUrl",hash:{},data:i}):r)+'" data-highwire="true">\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'<meta name="og:type" content="article" data-highwire="true">\n<meta name="twitter:card" content="summary" data-highwire="true">\n\n<meta name="citation_title" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+'" data-highwire="true">\n<meta name="og:title" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+'" data-highwire="true">\n<meta name="twitter:title" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)+'" data-highwire="true">\n\n<meta name="og:url" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.url||(null!=e?e.url:e))?a:t.helperMissing)?a.call(e,{name:"url",hash:{},data:i}):a)+'" data-highwire="true">\n<meta name="twitter:url" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.url||(null!=e?e.url:e))?a:t.helperMissing)?a.call(e,{name:"url",hash:{},data:i}):a)+'" data-highwire="true">\n<meta name="citation_abstract_html_url" content="'+this.escapeExpression("function"==typeof(a=null!=(a=t.url||(null!=e?e.url:e))?a:t.helperMissing)?a.call(e,{name:"url",hash:{},data:i}):a)+'" data-highwire="true">\n\n<meta name="og:image" content="https://ui.adsabs.harvard.edu/styles/img/transparent_logo.svg" data-highwire="true">\n<meta name="twitter:image" content="https://ui.adsabs.harvard.edu/styles/img/transparent_logo.svg" data-highwire="true">\n\n'+(null!=(r=t.if.call(e,null!=e?e.abstract:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.each.call(e,null!=e?e.author:e,{name:"each",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.page:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.pubdate:e,{name:"if",hash:{},fn:this.program(7,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.pub:e,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.volume:e,{name:"if",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.issue:e,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.doi:e,{name:"if",hash:{},fn:this.program(15,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.issn:e,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.each.call(e,null!=e?e.keyword:e,{name:"each",hash:{},fn:this.program(19,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.pdfUrl:e,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.noop,data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/meta_tags/template/metatags",n),n}),define("js/widgets/meta_tags/widget",["jquery","backbone","underscore","js/widgets/base/base_widget","hbs!js/widgets/meta_tags/template/metatags","js/mixins/link_generator_mixin"],function(e,t,n,i,r,a){var s=t.View.extend({destroy:function(){this.remove()}}),o=i.extend({initialize:function(e){this.options=e||{},this.view=new s},activate:function(e){this.setBeeHive(e);var t=e.getService("PubSub");n.bindAll(this,["onDisplayDocuments","processResponse"]),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments)},processResponse:function(e){var t=e.get("response.docs[0]");this.updateMetaTags(t)},getCachedDoc:function(e){var t=this.defaultQueryArguments.fl.split(","),i=this.getBeeHive().getObject("DocStashController").getDocs().filter(function(t){return t.bibcode===e});if(i.length){var r={issn:void 0,isbn:void 0};i.unshift(r),i=n.merge.apply(n,i);for(var a=Object.keys(i),s=0;s<t.length;s++)if(-1===a.indexOf(t[s]))return null;return i}return null},onDisplayDocuments:function(e){var t=e.get("q");t&&/bibcode:/.test(t[0])&&(t=t[0].replace(/bibcode:/,""));var n=this.getCachedDoc(t);if(n)return this.updateMetaTags(n);this.dispatchRequest(e.clone())},updateMetaTags:function(i){if(i.url=t.history.location.href,(i=this.parseResourcesData(i)).fullTextSources){var a=n.find(i.fullTextSources,function(e){return/PDF/.test(e.title)});a&&(i.pdfUrl=a.link)}i.doi&&i.doi.length&&(i.doi=i.doi[0]),i.aff&&i.author&&(i.author=n.map(i.author,function(e,t){return{name:e,aff:i.aff[t]}})),e("head").append(function(){return e(r(i)).filter(function(){var t=e(this).attr("name");return!t||!e('head>meta[name="'+t+'"]').length})});var s=document.createEvent("HTMLEvents");s.initEvent("ZoteroItemUpdated",!0,!0),document.dispatchEvent(s)},defaultQueryArguments:{fl:"links_data,[citations],keyword,property,first_author,year,issn,isbn,title,aff,abstract,bibcode,pub,volume,author,issue,pubdate,doi,page",rows:1}});return n.extend(o.prototype,a),o}),define("js/wraps/table_of_contents",["underscore","js/widgets/list_of_things/details_widget"],function(e,t){var n=t.extend({customizeQuery:function(n){var i=this.extractValueFromQuery(n,"q","bibcode");if(i){var r=t.prototype.customizeQuery.apply(this,arguments);return"E"==i[13]?r.set("q","bibcode:"+e.first(i,14).join("")+"*"):r.set("q","bibcode:"+e.first(i,13).join("")+"*"),this.sortOrder&&r.set("sort",this.sortOrder),this.queryOperator&&r.set("q",this.queryOperator+"("+r.get("q").join(" ")+")"),r}}});return function(){return new n({description:"Papers in the same volume as"})}}),define("js/widgets/resources/reducers",[],function(){return function(e,t){switch(e=e||{apiResponse:null,bibcode:null,dataProducts:[],error:null,fullTextSources:[],isLoading:!0,query:null},t.type){case"IS_LOADING":return Object.assign({},e,{isLoading:t.value});case"UPDATE_RESOURCES":return Object.assign({},e,{dataProducts:t.dataProducts,fullTextSources:t.fullTextSources});case"IS_ERRORED":return Object.assign({},e,{error:{e:t.value,msg:t.message}});case"UPDATE_API_RESPONSE":return Object.assign({},e,{apiResponse:t.value});case"UPDATE_QUERY":return Object.assign({},e,{query:t.value});case"UPDATE_BIBCODE":return Object.assign({},e,{bibcode:t.value});default:return e}}}),define("js/widgets/resources/actions",["underscore","js/components/api_query","analytics"],function(e,t,n){var i=["links_data","[citations]","property","bibcode","first_author","year","page","pub","pubdate","title","volume","doi","issue","issn"],r={};return r.updateResources=function(e){return e.fullTextSources=e.fullTextSources||[],e.dataProducts=e.dataProducts||[],{type:"UPDATE_RESOURCES",fullTextSources:e.fullTextSources,dataProducts:e.dataProducts}},r.updateBibcode=function(e){return{type:"UPDATE_BIBCODE",value:e}},r.loading=function(){return{type:"IS_LOADING",value:!0}},r.loaded=function(){return{type:"IS_LOADING",value:!1}},r.error=function(e,t){return{type:"IS_ERRORED",code:e,value:t}},r.updateApiResponse=function(e){return{type:"UPDATE_API_RESPONSE",value:e}},r.updateQuery=function(e){return{type:"UPDATE_QUERY",value:e}},r.emitAnalytics=function(e){return function(){n("send","event","interaction","full-text-link-followed",e)}},r.displayDocuments=function(e){return function(t){t(r.updateQuery(e));var n=e.get("q");if(!n||!/bibcode:/.test(n[0]))return t(r.handleError("NO_BIBCODE",null));n=n[0].replace("bibcode:",""),t(r.loadBibcodeData(n)),t(r.loading())}},r.handleError=function(e,t){return function(n,i,a){n(r.error(e,t)),a.destroy()}},r.processResponse=function(t){return function(n,i,a){n(r.updateApiResponse(t));var s=t.get("response.docs[0]");if(!s||e.isEmpty(s))return n(r.handleError("EMPTY_RESPONSE",null));s.link_server=a.getBeeHive().getObject("User").getUserData("USER_DATA").link_server,n(r.parseResources(s))}},r.loadBibcodeData=function(e){return function(n,a,s){if(e===a().bibcode)s.trigger("page-manager-event","widget-ready",{isActive:!0});else{n(r.updateBibcode(e));var o="bibcode:"+e;s.dispatchRequest(new t({q:o,fl:i.join(",")}))}}},r.parseResources=function(e){return function(t,n,i){try{e=i.parseResourcesData(e)}catch(e){t(r.handleError("PARSER_ERROR",e))}t(r.updateResources(e)),t(r.loaded())}},r.handleFeedback=function(t){return function(n,i,a){var s=i(),o=null;try{o=a.getPubSub().getCurrentPubSubKey().getId()}catch(e){}var l=s.query&&s.query.get?s.query.get("q")[0]:null;if(o===(t.psk&&t.psk.getId?t.psk.getId():-1)&&t&&t.request&&t.request.has("query")&&t.request.get("query").has("q")&&s.isLoading){var c=t.request.get("query").get("q");(c.length?c[0]:null)===l&&(n(r.updateBibcode(null)),e.delay(function(){n(r.handleError("API_QUERY_FAILED",null))},300))}}},r}),define("es6!js/widgets/resources/components/fullTextSources.jsx",["react"],function(e){function t(t){return t.openUrl?e.createElement("i",{className:"fa fa-university","data-toggle":"tooltip","data-placement":"top",title:"This resource is available through your institution.","aria-hidden":"true"}):t.openAccess?e.createElement("i",{className:"s-open-access-image","data-toggle":"tooltip","data-placement":"top",title:"This is an open access item.","aria-hidden":"true"}):null}return function(n){var i=n.sources;if(!i||!i.length)return null;var r=i.map(function(i){var r=n.onLinkClick.bind(this,i.title);return e.createElement("li",{key:i.title},e.createElement("a",{href:i.link,target:"_blank",onClick:r},i.title+" ",e.createElement(t,{openAccess:i.openAccess,openUrl:i.openUrl})))});return e.createElement("div",null,e.createElement("h3",{className:"s-right-col-widget-title"},e.createElement("i",{className:"icon-text","aria-hidden":"true"})," Full Text Sources"),e.createElement("ul",{className:"list-unstyled"},r))}}),define("es6!js/widgets/resources/components/dataProducts.jsx",["react"],function(e){return function(t){var n=t.products;if(!n||!n.length)return null;var i=n.map(function(n){var i=t.onLinkClick.bind(this,n.title);return e.createElement("li",{key:n.title},e.createElement("a",{href:n.link,onClick:i,target:"_blank"},n.title))});return e.createElement("div",null,e.createElement("h3",{className:"s-right-col-widget-title"},e.createElement("i",{className:"icon-data","aria-hidden":"true"})," Data Products"),e.createElement("ul",{className:"list-unstyled"},i))}}),define("es6!js/widgets/resources/components/loading.jsx",["react"],function(e){return function(t){return t.show?e.createElement("span",null,e.createElement("i",{className:"icon-loading","aria-hidden":"true"})," Loading..."):null}}),define("es6!js/widgets/resources/components/noSources.jsx",["react"],function(e){return e.createClass({displayName:"NoSources",render:function(){return this.props.noSources?e.createElement("div",null,e.createElement("h3",{className:"s-right-col-widget-title"},"No Sources Found")):null}})}),define("es6!js/widgets/resources/components/app.jsx",["../actions","react","react-redux","es6!./fullTextSources.jsx","es6!./dataProducts.jsx","es6!./loading.jsx","es6!./noSources.jsx"],function(e,t,n,i,r,a,s){var o=t.createClass({displayName:"App",render:function(){return t.createElement("div",{className:"s-right-col-widget-container"},t.createElement(a,{show:this.props.isLoading}),t.createElement(i,{sources:this.props.fullTextSources,onLinkClick:this.props.onLinkClick}),t.createElement(r,{products:this.props.dataProducts,onLinkClick:this.props.onLinkClick}),t.createElement(s,{noSources:this.props.noSources}))}}),l=function(e){return!e.isLoading&&!e.fullTextSources.length&&!e.dataProducts.length};return n.connect(function(e){return{fullTextSources:e.fullTextSources,dataProducts:e.dataProducts,isLoading:e.isLoading,noSources:l(e)}},function(t){return{onLinkClick:function(n){return t(e.emitAnalytics(n))}}})(o)}),define("es6!js/widgets/resources/widget.jsx",["underscore","backbone","react","react-dom","redux","react-redux","redux-thunk","js/widgets/base/base_widget","js/mixins/link_generator_mixin","./reducers","./actions","es6!./components/app.jsx"],function(e,t,n,i,r,a,s,o,l,c,u,d){var h=t.View.extend({initialize:function(t){e.assign(this,t)},render:function(){return i.render(n.createElement(a.Provider,{store:this.store},n.createElement(d,null)),this.el),this},destroy:function(){i.unmountComponentAtNode(this.el)}}),p=o.extend({initialize:function(e){this.options=e||{},this.NAME="ShowResources";var t=r.applyMiddleware(s.default.withExtraArgument(this));this.store=r.createStore(c,t),this.view=new h({store:this.store})},activate:function(t){this.setBeeHive(t);var n=t.getService("PubSub");e.bindAll(this,["processResponse","onDisplayDocuments","handleFeedback"]),n.subscribe(n.DISPLAY_DOCUMENTS,this.onDisplayDocuments),n.subscribe(n.DELIVERING_RESPONSE,this.processResponse),n.subscribe(n.FEEDBACK,this.handleFeedback)},processResponse:function(e){this.store.dispatch(u.processResponse(e))},onDisplayDocuments:function(e){this.store.dispatch(u.displayDocuments(e))},handleFeedback:function(e){this.store.dispatch(u.handleFeedback(e))}});return e.extend(p.prototype,l),p}),define("hbs!js/widgets/recommender/templates/recommender_template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'<div class="s-right-col-widget-container">\n\n<div>\n    <i class="icon-help pull-right" style="margin-top:7px" data-toggle="popover" data-placement="left" data-content="These recommendations are based on a number of factors, including text similarity, citations, and co-readership information. This feature is still in beta." data-container=".recommender-widget"></i>\n    <h4 class="s-right-col-widget-title">Suggested Articles</h4>\n</div>\n\n\n<ul class="list-unstyled">\n\n'+(null!=(r=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=t.each.call(e,null!=e?e.items:e,{name:"each",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+'    <button class="btn btn-xs btn-default button-toggle">more</button>\n</ul>\n\n'},2:function(e,t,n,i){var r;return null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,i&&i.index,0,{name:"compare",hash:{operator:"<="},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:""},3:function(e,t,n,i){var r;return'        <div>\n            <li>\n                <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'">'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+' (<i class="s-author">'+this.escapeExpression("function"==typeof(r=null!=(r=t.author||(null!=e?e.author:e))?r:t.helperMissing)?r.call(e,{name:"author",hash:{},data:i}):r)+"</i>)</a>;\n            </li>\n        </div>\n"},5:function(e,t,n,i){var r;return null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,i&&i.index,0,{name:"compare",hash:{operator:">"},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:""},6:function(e,t,n,i){var r;return'        <div class="hidden additional-papers">\n            <li>\n                <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'">'+this.escapeExpression("function"==typeof(r=null!=(r=t.title||(null!=e?e.title:e))?r:t.helperMissing)?r.call(e,{name:"title",hash:{},data:i}):r)+' (<i class="s-author">'+this.escapeExpression("function"==typeof(r=null!=(r=t.author||(null!=e?e.author:e))?r:t.helperMissing)?r.call(e,{name:"author",hash:{},data:i}):r)+"</i>)</a>;\n            </li>\n        </div>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return(null!=(r=t.if.call(e,null!=e?e.items:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+"</div>"},useData:!0});return t.registerPartial("js/widgets/recommender/templates/recommender_template",n),n}),define("js/widgets/recommender/widget",["marionette","js/components/api_query","js/components/api_targets","js/components/api_request","js/widgets/base/base_widget","hbs!js/widgets/recommender/templates/recommender_template","bootstrap","analytics"],function(e,t,n,i,r,a,s){var o=e.ItemView.extend({initialize:function(){this.listenTo(this.collection,"reset",this.render)},template:a,events:{"click .button-toggle":"toggleList","click a":"emitAnalyticsEvent"},emitAnalyticsEvent:function(e){s("send","event","interaction","suggested-article-link-followed")},toggleList:function(){this.$(".additional-papers").toggleClass("hidden"),this.$(".additional-papers").hasClass("hidden")?this.$(".button-toggle").text("more"):this.$(".button-toggle").text("less")},onRender:function(){this.$(".icon-help").popover({trigger:"hover"})},className:"recommender-widget s-recommender-widget"});return r.extend({initialize:function(){this.collection=new Backbone.Collection,this.view=new o({collection:this.collection})},activate:function(e){this.setBeeHive(e);var t=this.getPubSub();_.bindAll(this,["processResponse","onDisplayDocuments"]),t.subscribe(t.DISPLAY_DOCUMENTS,this.onDisplayDocuments),t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},onDisplayDocuments:function(e){var t=e.get("q");t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this.loadBibcodeData(t))},loadBibcodeData:function(e){if(e===this._bibcode)this.trigger("page-manager-event","widget-ready",{isActive:!0});else{this.collection.reset(),this._bibcode=e;var t=n.RECOMMENDER+"/"+e,r=new i({target:t});this.getPubSub().publish(this.getPubSub().EXECUTE_REQUEST,r)}},processResponse:function(e){if((e=e.toJSON()).recommendations)this.collection.reset(e.recommendations),this.trigger("page-manager-event","widget-ready",{isActive:!0});else if(e.Error&&"Unable to get results!"===e.Error)return}})}),define("js/wraps/paper_metrics",["js/widgets/metrics/widget","js/components/api_feedback"],function(e,t){return e.extend({initialize:function(t){this.on("page-manager-message",function(e,t){"broadcast-payload"===e&&this.ingestBroadcastedPayload(t)}),e.prototype.initialize.apply(this,arguments)},ingestBroadcastedPayload:function(e){var t=e.bibcode,n=this;this.containerModel.set("title",e.title),this.getMetrics([t]).done(function(){n.trigger("page-manager-event","widget-ready",{isActive:!0,widget:n}),n._waiting&&(n.onShow(),n._waiting=!1)}).fail(function(){n.trigger("page-manager-event","widget-ready",{isActive:!1,widget:n}),n.destroy()})},onShow:function(){var e=this.containerModel.get("data");e?(this.createTableViews(e,1),this.createGraphViewsForOnePaper(e),this.insertViewsForOnePaper(e)):this._waiting=!0}})}),define("js/wraps/paper_export",["js/widgets/export/widget","js/components/api_query","js/components/json_response"],function(e,t,n){return e.extend({initialize:function(t){this.on("page-manager-message",function(e,t){"broadcast-payload"===e&&this.ingestBroadcastedPayload(t)}),e.prototype.initialize.call(this,t)},activate:function(e){this.setBeeHive(e),_.bindAll(this,"setCurrentQuery","processResponse");var t=this.getPubSub();t.subscribe(t.DELIVERING_RESPONSE,this.processResponse)},ingestBroadcastedPayload:function(e){e.bibcode&&(this.bibcode=e.bibcode)},setSubView:function(e){this.renderWidgetForListOfBibcodes([this.bibcode],{format:e})}})}),define("hbs!js/wraps/abstract_page_library_add/template",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i,r,a){var s,o;return'<div class="s-library-area">\n    <div class="s-library-add-title library-add-title"  type="button" data-toggle="collapse" data-target="#library-console" aria-expanded="false" aria-controls="collapseExample">\n        <i class="fa fa-book fa-lg"></i> Add paper to a library &nbsp; <i class="fa fa-lg fa-caret-down"></i>\n    </div>\n    <div class="collapse '+(null!=(s=t.if.call(e,null!=e?e.libraryDrawerOpen:e,{name:"if",hash:{},fn:this.program(2,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'" id="library-console">\n\n        <div class="libraries-container">\n'+(null!=(s=t.if.call(e,null!=e?e.libraries:e,{name:"if",hash:{},fn:this.program(4,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'\n            <label for="#create-new">create a new library </label>\n            <input id="#create-new" class="form-control input-sm new-library-name s-display-inline" type="text" name="new-library-name" placeholder="New Library Name" value="'+this.escapeExpression("function"==typeof(o=null!=(o=t.newLibraryName||(null!=e?e.newLibraryName:e))?o:t.helperMissing)?o.call(e,{name:"newLibraryName",hash:{},data:i}):o)+'" style="max-width:188px"/>\n            <button class="btn btn-sm btn-success submit-create-library"></i>submit</button>\n\n        </div>\n\n        <div style="margin-top:6px" class="feedback s-feedback">\n\n        </div>\n\n    </div>\n\n'+(null!=(s=t.if.call(e,null!=e?e.feedback:e,{name:"if",hash:{},fn:this.program(8,i,0,r,a),inverse:this.noop,data:i}))?s:"")+"\n    \x3c!--end 'library area' if user is signed in--\x3e\n</div>\n"},2:function(e,t,n,i){return" in "},4:function(e,t,n,i,r,a){var s;return'            <div style="margin-top: 8px" class="">\n                <label for="#library-select">add to an existing library:</label>\n                <select id="library-select" name="library-select" class="form-control input-sm s-library-select">\n'+(null!=(s=t.each.call(e,null!=e?e.libraries:e,{name:"each",hash:{},fn:this.program(5,i,0,r,a),inverse:this.noop,data:i}))?s:"")+'                </select>\n                <button class="btn btn-sm btn-success submit-add-to-library">submit</button>\n            </div>\n            <div style="margin:10px 0 4px 0">\n                OR\n            </div>\n'},5:function(e,t,n,i,r,a){var s;return'                    <option value="'+this.escapeExpression(this.lambda(null!=e?e.id:e,e))+'" '+(null!=(s=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.id:e,null!=a[1]?a[1].selectedLibrary:a[1],{name:"compare",hash:{},fn:this.program(6,i,0,r,a),inverse:this.noop,data:i}))?s:"")+">"+this.escapeExpression(this.lambda(null!=e?e.name:e,e))+"</option>\n"},6:function(e,t,n,i){return' selected="true" '},8:function(e,t,n,i){var r;return"\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.success:r,{name:"if",hash:{},fn:this.program(9,i,0),inverse:this.program(15,i,0),data:i}))?r:"")+"\n"},9:function(e,t,n,i){var r;return'\n    <div class="alert alert-success alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.create:r,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.program(12,i,0),data:i}))?r:"")+"    </div>\n\n"},10:function(e,t,n,i){var r;return'        <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.id:r,e))+'"> Library <b>'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b></a> was successfully created and "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numRecords:r,e))+" new record was added.\n"},12:function(e,t,n,i){var r;return"        "+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numRecords:r,e))+' new record was added to  <a href="#/user/libraries/'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.id:r,e))+'"> library <b>'+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b></a>.\n"+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.numAlreadyInLib:r,{name:"if",hash:{},fn:this.program(13,i,0),inverse:this.noop,data:i}))?r:"")},13:function(e,t,n,i){var r;return"        ("+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.numAlreadyInLib:r,e))+" was already in the library).\n"},15:function(e,t,n,i){var r;return'\n    <div class="alert alert-danger alert-dismissable" role="alert">\n        <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">×</span></button>\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.feedback:e)?r.create:r,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.program(18,i,0),data:i}))?r:"")+"    </div>\n\n"},16:function(e,t,n,i){var r;return"        <b>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b> was not created, error occured.\n        <em>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.error:r,e))+"</em>\n"},18:function(e,t,n,i){var r;return"        Record was not added to <b>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.name:r,e))+"</b>, error occurred.\n        <em>"+this.escapeExpression(this.lambda(null!=(r=null!=e?e.feedback:e)?r.error:r,e))+"</em>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i,r,a){var s;return null!=(s=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(1,i,0,r,a),inverse:this.noop,data:i}))?s:""},useData:!0,useDepths:!0});return t.registerPartial("js/wraps/abstract_page_library_add/template",n),n}),define("js/wraps/abstract_page_library_add/widget",["js/widgets/query_info/query_info_widget","js/widgets/base/base_widget","hbs!js/wraps/abstract_page_library_add/template"],function(e,t,n){return e.extend({abstractPage:!0,initialize:function(e){e=e||{},this.model=new this.modelConstructor,this.view=new this.viewConstructor({model:this.model,template:n}),t.prototype.initialize.call(this,e)},activate:function(e){this.setBeeHive(e),_.bindAll(this);var t=this,n=this.getPubSub();if(n.subscribe(n.LIBRARY_CHANGE,this.processLibraryInfo),n.subscribe(n.USER_ANNOUNCEMENT,this.handleUserAnnouncement),n.subscribe(n.DISPLAY_DOCUMENTS,this.onDisplayDocuments),this.getBeeHive().getObject("User").isLoggedIn()){this.model.set("loggedIn",!0);this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.processLibraryInfo(e)})}},onDisplayDocuments:function(e){var t=e.get("q");t.length>0&&t[0].indexOf("bibcode:")>-1&&(t=t[0].replace("bibcode:",""),this._bibcode=t)}})}),define("hbs!js/widgets/library_individual/templates/library-header",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r,a;return"\n"+(null!=(r=t.if.call(e,null!=e?e.loggedIn:e,{name:"if",hash:{},fn:this.program(2,i,0),inverse:this.noop,data:i}))?r:"")+'\n    <div class="s-library-title">\n        <h2>'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+'</h2>\n    </div>\n    <div class="s-library-description">\n        <p>\n            '+this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)+'\n        </p>\n    </div>\n\n    \x3c!-- library info/admin drawer--\x3e\n    <div class="s-library-info">\n        <div class="col-sm-3"><h5>Number of Papers:</h5>'+this.escapeExpression("function"==typeof(a=null!=(a=t.num_documents||(null!=e?e.num_documents:e))?a:t.helperMissing)?a.call(e,{name:"num_documents",hash:{},data:i}):a)+'</div>\n        <div class="col-sm-3"><h5>Date Created:</h5><span>'+this.escapeExpression("function"==typeof(a=null!=(a=t.date_created||(null!=e?e.date_created:e))?a:t.helperMissing)?a.call(e,{name:"date_created",hash:{},data:i}):a)+'</span></div>\n        <div class="col-sm-3"> <h5>Date Last Modified:</h5>'+this.escapeExpression("function"==typeof(a=null!=(a=t.date_last_modified||(null!=e?e.date_last_modified:e))?a:t.helperMissing)?a.call(e,{name:"date_last_modified",hash:{},data:i}):a)+"</div>\n    </div>\n\n    \x3c!-- tabs --\x3e\n"+(null!=(r=t.if.call(e,null!=e?e.noDocuments:e,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.program(13,i,0),data:i}))?r:"")+"\n\n"},2:function(e,t,n,i){var r;return'    <div class="pull-right" style="position:relative;z-index:1">\n\n'+(null!=(r=t.if.call(e,null!=e?e.largeLibrary:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?r:"")+"    </div>\n"},3:function(e,t,n,i){return'            <button\n                    class="btn btn-default bigquery-export"\n                    data-placement="bottom"\n                    title="large libraries can take some time to export"\n                    data-toggle="tooltip"\n            >\n                <i class="icon-loading" style="display:none"></i>\n                <i class="fa fa-arrow-right"></i> View library in search results page\n            </button>\n'},5:function(e,t,n,i){var r;return null!=(r=t.if.call(e,null!=e?e.noDocuments:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:""},6:function(e,t,n,i){return'            <div title="Add some papers to this library to gain this option">\n                <button class="btn btn-default bigquery-export disabled" disabled>\n                    <i class="icon-loading" style="display:none"></i>\n                    <i class="fa fa-arrow-right"></i> View library in search results page\n                </button>\n            </div>\n'},8:function(e,t,n,i){return'            <button class="btn btn-default bigquery-export">\n                <i class="icon-loading" style="display:none"></i>\n                <i class="fa fa-arrow-right"></i> View library in search results page\n            </button>\n        '},10:function(e,t,n,i){var r;return'        \x3c!-- tab navigation works for only library page and optionally admin --\x3e\n        <ul class="s-library-nav-tabs">\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="icon-export"></i> Export</li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"><i class="icon-explore"></i> Metrics </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="fa fa-eye"></i> Visualize </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},11:function(e,t,n,i){return" active "},13:function(e,t,n,i){var r;return'        <ul class="s-library-nav-tabs" style="position:relative;top:40px;">\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n            <li class="tab s-tab dropdown '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"export",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <a data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="icon-export"></i> Export\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </a>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="export-bibtex">BibTeX</li>\n                    <li data-tab="export-aastex">AASTeX</li>\n                    <li data-tab="export-endnote">EndNote</li>\n                    <li data-tab="export-ris">RIS</li>\n                    <li data-tab="export-classic">ADS Classic</li>\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"metrics",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="metrics"><i class="icon-explore"></i> Metrics </li>\n            <li class="tab s-tab dropdown  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"visualization",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <div data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="fa fa-eye"></i> Visualize\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </div>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="visualization-AuthorNetwork">Author Network</li>\n                    <li data-tab="visualization-PaperNetwork">Paper Network</li>\n                    <li data-tab="visualization-ConceptCloud">Concept Cloud <small>(currently limited to first 100 records)</small></li>\n                    \x3c!--<li data-tab="visualization-BubbleChart">Bubble Chart</li>--\x3e\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"citation_helper",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="citation_helper"><i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},15:function(e,t,n,i){var r,a;return"\x3c!-- not public --\x3e\n\n"+(null!=(r=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.program(21,i,0),data:i}))?r:"")+'\n    \x3c!-- library info/admin drawer--\x3e\n\n    <div class="s-library-info">\n        <div class="col-sm-3"><h5>Number of Papers:</h5>'+this.escapeExpression("function"==typeof(a=null!=(a=t.num_documents||(null!=e?e.num_documents:e))?a:t.helperMissing)?a.call(e,{name:"num_documents",hash:{},data:i}):a)+'</div>\n        <div class="col-sm-3"><h5>Date Created:</h5><span>'+this.escapeExpression("function"==typeof(a=null!=(a=t.date_created||(null!=e?e.date_created:e))?a:t.helperMissing)?a.call(e,{name:"date_created",hash:{},data:i}):a)+'</span></div>\n        <div class="col-sm-3"> <h5>Date Last Modified:</h5>'+this.escapeExpression("function"==typeof(a=null!=(a=t.date_last_modified||(null!=e?e.date_last_modified:e))?a:t.helperMissing)?a.call(e,{name:"date_last_modified",hash:{},data:i}):a)+'</div>\n        <div class="col-sm-3"><h5>Owner:</h5>'+this.escapeExpression("function"==typeof(a=null!=(a=t.owner||(null!=e?e.owner:e))?a:t.helperMissing)?a.call(e,{name:"owner",hash:{},data:i}):a)+"</div>\n        <br/>\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"read",{name:"compare",hash:{},fn:this.program(26,i,0),inverse:this.program(28,i,0),data:i}))?r:"")+"\n    </div>\n\n    \x3c!-- tabs --\x3e\n"+(null!=(r=t.if.call(e,null!=e?e.noDocuments:e,{name:"if",hash:{},fn:this.program(35,i,0),inverse:this.program(38,i,0),data:i}))?r:"")+"\n\n"},16:function(e,t,n,i){var r,a;return'    <div class="pull-right" style="position:relative;z-index:1">\n\n'+(null!=(r=t.if.call(e,null!=e?e.largeLibrary:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.program(5,i,0),data:i}))?r:"")+'\n    </div>\n    <div class="editable-item">\n        <h2>'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+' <button class="btn btn-link toggle-form" data-field="name">edit</button></h2>\n        <form class="hidden" data-field="name">\n            <label  class="sr-only" for="#edit-library-title"> Change title </label>\n            <input class="form-control" type="text" id="edit-library-title" value="'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+'" maxlength="50"/>\n            <button class="btn btn-small btn-success" type="submit"><i class="fa fa-check"></i> submit</button>\n            <button class="btn btn-small btn-default" type="reset"> cancel</button>\n        </form>\n    </div>\n    <div class="editable-item">\n        <span>\n            <b>description</b>\n            <button class="btn btn-link toggle-form" data-field="description">edit</button>\n        </span>\n        <p>\n           '+(null!=(r=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(17,i,0),inverse:this.program(19,i,0),data:i}))?r:"")+'\n        </p>\n        <form class="hidden" data-field="description">\n            <label class="sr-only" for="#edit-library-description"> Change description </label>\n            <textarea class="form-control" id="edit-library-description" maxlength="200">'+this.escapeExpression("function"==typeof(a=null!=(a=t.description||(null!=e?e.description:e))?a:t.helperMissing)?a.call(e,{name:"description",hash:{},data:i}):a)+'</textarea>\n            <button class="btn btn-small btn-success" type="submit"><i class="fa fa-check"></i> submit</button>\n            <button class="btn btn-small btn-default" type="reset">cancel</button>\n        </form>\n    </div>\n\n'},17:function(e,t,n,i){var r;return this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)},19:function(e,t,n,i){return"(none) "},21:function(e,t,n,i){var r,a;return'\n    <div class="s-library-title">\n        <h2>'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+'</h2>\n    </div>\n    <div class="s-library-description">\n        <p>\n'+(null!=(r=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(22,i,0),inverse:this.program(24,i,0),data:i}))?r:"")+"        </p>\n    </div>\n\n"},22:function(e,t,n,i){var r;return"            "+this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)+"\n"},24:function(e,t,n,i){return"            (none)\n"},26:function(e,t,n,i){return'        <br/>\n        <p><i class="fa fa-cog"></i> You can <b>read</b> this library, but cannot alter it in any way. </p>\n\n'},28:function(e,t,n,i){var r,a;return'\n            <button class="btn btn-default"  type="button" data-toggle="collapse" data-target="#library-actions" aria-expanded="false" aria-controls="#library-actions">\n                <i class="fa fa-cog"></i> View editing options (You have <b>'+this.escapeExpression("function"==typeof(a=null!=(a=t.permission||(null!=e?e.permission:e))?a:t.helperMissing)?a.call(e,{name:"permission",hash:{},data:i}):a)+'</b> privileges)\n            </button>\n            <div class="collapse" id="library-actions" style="padding-top: 15px">\n'+(null!=(r=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(29,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"read",{name:"compare",hash:{operator:"!=="},fn:this.program(31,i,0),inverse:this.noop,data:i}))?r:"")+"\n"+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.permission:e,"owner",{name:"compare",hash:{},fn:this.program(33,i,0),inverse:this.noop,data:i}))?r:"")+"            </div>\n\n"},29:function(e,t,n,i){return"                <p>\n                    To <b>change the title or description</b>  of the library, click on the edit links above.\n                </p>\n"},31:function(e,t,n,i){return'                <p>\n                    To <b>add papers</b> to this library, perform a search in ADS and look for the  "add to libraries" button on the right.\n                </p>\n                <p>\n                    To <b>remove papers</b> from this library, click on the red "x" buttons next to each paper in the library list.\n                </p>\n'},33:function(e,t,n,i){return'                <p>\n                    To <b>make this library public</b>, click on the "Manage Access" tab below.\n                </p>\n                <p> To <b>delete</b>  this library, click on the button that follows.\n                    Once you click this button, the library will be deleted forever!\n                </p>\n                <button class="btn btn-danger btn-sm delete-library"><i class="fa fa-times"></i> Delete this library</button>\n'},35:function(e,t,n,i){var r;return'        \x3c!-- tab navigation works for only library page and optionally admin --\x3e\n        <ul class="s-library-nav-tabs">\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n'+(null!=(r=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?r:"")+'\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="icon-export"></i> Export</li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"><i class="icon-explore"></i> Metrics </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"> <i class="fa fa-eye"></i> Visualize </li>\n            <li class="s-tab s-disabled" title="Add some papers to this library to gain this option"><i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},36:function(e,t,n,i){var r;return'            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"admin",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="admin"><i class="fa fa-key"></i> Manage Access</li>\n'},38:function(e,t,n,i){var r;return'        \x3c!-- extended tab navigation should work --\x3e\n        <ul class="s-library-nav-tabs">\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"library",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="library"><i class="fa fa-list"></i> View Library</li>\n'+(null!=(r=t.if.call(e,null!=e?e.edit:e,{name:"if",hash:{},fn:this.program(36,i,0),inverse:this.noop,data:i}))?r:"")+'            <li class="tab s-tab dropdown '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"export",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <a  data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="icon-export"></i> Export\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </a>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="export-bibtex">BibTeX</li>\n                    <li data-tab="export-aastex">AASTeX</li>\n                    <li data-tab="export-endnote">EndNote</li>\n                    <li data-tab="export-ris">RIS</li>\n                    <li data-tab="export-classic">ADS Classic</li>\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"metrics",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="metrics"><i class="icon-explore"></i> Metrics </li>\n            <li class="tab s-tab dropdown  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"visualization",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'">\n                <div data-toggle="dropdown" aria-haspopup="true" role="button" aria-expanded="false">\n                    <i class="fa fa-eye"></i> Visualize\n                    <span class="fa fa-lg fa-caret-down"></span>\n                </div>\n                <ul class="dropdown-menu" role="menu">\n                    <li data-tab="visualization-AuthorNetwork">Author Network</li>\n                    <li data-tab="visualization-PaperNetwork">Paper Network</li>\n                    <li data-tab="visualization-ConceptCloud">Concept Cloud <small>(currently limited to first 100 records)</small></li>\n                    \x3c!--<li data-tab="visualization-BubbleChart">Bubble Chart</li>--\x3e\n                </ul>\n            </li>\n            <li class="tab s-tab  '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.active:e,"citation_helper",{name:"compare",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+'" data-tab="citation_helper"><i class="fa fa-flask"></i> Citation Helper </li>\n        </ul>\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\x3c!--duplicating some stuff here in the interests of simplicity, maybe that's not ideal?--\x3e\n\n"+(null!=(r=t.if.call(e,null!=e?e.publicView:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(15,i,0),data:i}))?r:"")},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/library-header",n),n}),define("js/widgets/library_individual/views/library_header",["marionette","hbs!js/widgets/library_individual/templates/library-header","moment","bootstrap"],function(e,t,n,i){var r=Backbone.Model.extend({initialize:function(e,t){t=t||{},this.on("change:permission",this.checkEditPermission)},defaults:function(){return{active:"library",date_created:void 0,date_last_modified:void 0,description:void 0,id:void 0,name:void 0,num_documents:0,num_users:0,permission:"read",owner:void 0,public:!1,currentEditField:void 0}},checkEditPermission:function(){"admin"==this.get("permission")||"owner"==this.get("permission")?this.set("edit",!0):this.set("edit",!1)}}),a=e.ItemView.extend({template:t,events:{"click .editable-item .toggle-form":"showForm","click .editable-item .btn-success":"submitEdit","click .editable-item .btn-default":"cancelEdit","click li[data-tab]:not(.active)":"triggerSubviewNavigate","click .delete-library":"triggerDeleteLibrary","click .bigquery-export":"triggerStartSearch"},modelEvents:{change:"render"},onRender:function(){this.$('[data-toggle="tooltip"]').tooltip()},formatDate:function(e){return n.utc(e).local().format("MMM D YYYY, h:mma")},serializeData:function(){var e=this.model.toJSON();return e.date_last_modified=this.formatDate(e.date_last_modified),e.date_created=this.formatDate(e.date_created),this.model.get("num_documents")>=2e3&&(e.largeLibrary=!0),0===this.model.get("num_documents")&&(e.noDocuments=!0),e},showForm:function(e){this.currentEditField=$(e.target).data("field");var t='form[data-field="'+this.currentEditField+'"]';$(t).removeClass("hidden")},submitEdit:function(e){e.preventDefault();var t='form[data-field="'+this.currentEditField+'"]',n=$(t).find("input, textarea").val(),i={};if(0===n.length||n===this.model.get(this.currentEditField))return this.cancelEdit(e);i[this.currentEditField]=n,this.trigger("updateVal",i),$(e.target).html('<i class="fa fa-spinner fa-pulse"></i>')},cancelEdit:function(e){e.preventDefault();var t=$(e.currentTarget).parent();t.find("input").val(this.model.get("name")),t.find("textarea").val(this.model.get("description")),t.addClass("hidden")},triggerSubviewNavigate:function(e){var t,n,i=$(e.currentTarget).data("tab");i.indexOf("-")>-1?(t=i.split("-")[0],n=i.split("-")[1]):t=i,this.trigger("navigate",t,n)},triggerDeleteLibrary:function(){this.trigger("delete-library")},triggerStartSearch:function(){this.$(".bigquery-export i").css("display","none"),this.$(".bigquery-export .icon-loading").css("display","inline-block"),this.trigger("start-search")}});return a.Model=r,a}),define("hbs!js/widgets/library_individual/templates/manage-permissions-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n\n<div class="public-container">\n\n</div>\n\n<h3>Library Collaborators</h3>\n<div class="permissions-list-container s-permissions-list-container">\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/manage-permissions-container",n),n}),define("hbs!js/widgets/library_individual/templates/make-public",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'\n    <h3><i class="fa fa-lg fa-unlock"></i> This Library is Public</h3>\n\n    <div class="s-permissions-list-container">\n\n        <p><b>Public libraries</b> are available for all to read.</p>\n        <p><b>Private libraries</b> are visible to only you and any collaborators.</p>\n\n         <p> The public address of this library is <a target="_blank" href="/#/public-libraries/'+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+'">'+this.escapeExpression("function"==typeof(r=null!=(r=t.host||(null!=e?e.host:e))?r:t.helperMissing)?r.call(e,{name:"host",hash:{},data:i}):r)+"/#/public-libraries/"+this.escapeExpression("function"==typeof(r=null!=(r=t.id||(null!=e?e.id:e))?r:t.helperMissing)?r.call(e,{name:"id",hash:{},data:i}):r)+'</a></p>\n         <p><button class="btn btn-danger btn-inverted public-button make-private"><i class="fa fa-lg fa-lock"></i> Make this library private. </button></p>\n\n    </div>\n\n'},3:function(e,t,n,i){return'\n        <h3> <i class="fa fa-lg fa-lock"></i> This Library is Private</h3>\n\n        <div class="s-permissions-list-container">\n\n            <p><b>Public libraries</b> are available for all to read.</p>\n            <p><b>Private libraries</b> are visible to only you and any collaborators.</p>\n\n            <p>\n              <button class="btn btn-success btn-inverted  public-button make-public"><i class="fa fa-lg fa-unlock"></i> Make this library public. </button>\n            </p>\n    </div>\n\n'},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return"\n\n"+(null!=(r=t.if.call(e,null!=e?e.public:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+"\n\n</div>"},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/make-public",n),n}),define("js/widgets/library_individual/views/manage_permissions",["marionette","hbs!js/widgets/library_individual/templates/manage-permissions-container","hbs!js/widgets/library_individual/templates/make-public","bootstrap"],function(e,t,n,i){var r=Backbone.Model.extend({});Backbone.Collection.extend({model:r});return e.ItemView.extend({className:"library-admin-view",initialize:function(e){this.model.set("host",window.location.host)},events:{"click .public-button":"togglePublicState"},togglePublicState:function(e){var t=$(e.target).hasClass("make-public");this.trigger("update-public-status",t)},modelEvents:{"change:public":"render"},template:t,onRender:function(){this.$(".public-container").html(n(this.model.toJSON()))}})}),define("hbs!js/widgets/library_individual/templates/layout-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="header s-header"></div>\n\n<div class="main s-main"></div>'},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/layout-container",n),n}),define("hbs!js/widgets/library_individual/templates/loading-library",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<div class="loading-library">\n    <h3> <i class="fa fa-spinner fa-pulse"></i> Loading Library...</h3>\n</div>'},useData:!0});return t.registerPartial("js/widgets/library_individual/templates/loading-library",n),n}),define("js/widgets/library_individual/widget",["marionette","js/components/api_query","js/widgets/base/base_widget","./views/library_header","./views/manage_permissions","hbs!js/widgets/library_individual/templates/layout-container","hbs!js/widgets/library_individual/templates/loading-library"],function(e,t,n,i,r,a,s){var o=e.ItemView.extend({template:s}),l=e.LayoutView.extend({className:"library-widget s-library-widget",template:a,regions:{header:".header",main:".main"}}),c=Backbone.Model.extend({defaults:function(){return{id:void 0,subView:void 0,publicView:!1}}});return n.extend({initialize:function(e){e=e||{},this.view=new l,this.model=new c,this.view.render(),this.headerModel=new i.Model,this.headerView=new i({model:this.headerModel}),this.view.header.show(this.headerView)},activate:function(e){this.setBeeHive(e),_.bindAll(this);var t=e.getService("PubSub");t.subscribe(t.LIBRARY_CHANGE,this.onLibraryChange),this.headerView.on("all",this.handleHeaderEvents,this)},onLibraryChange:function(e,t){"change"==t.ev&&t.id==this.model.get("id")&&this.updateSubView()},updateHeader:function(){var e=function(e){var t=this.getBeeHive().getObject("User").isLoggedIn();this.headerModel.set(_.extend(e,{active:this.model.get("subView"),publicView:this.model.get("publicView"),loggedIn:t}))}.bind(this);this.getBeeHive().getObject("LibraryController").getLibraryMetadata(this.model.get("id")).done(e)},updateSubView:function(){this.view.main.empty();var e=this,t=this.model.get("id"),n=this.model.get("subView");if(t&&n)if(e.view.main.show(new o),this.updateHeader(),["library","export","metrics","visualization","citation_helper"].indexOf(n)>-1)e.view.main.empty();else{if("admin"!==n)throw new Error("don't recognize that subview: ",n);var i=new r({model:this.headerModel});i.on("all",e.handleAdminEvents,e),this.view.main.show(i)}else console.warn("library widget's updateSubView called without requisite library id and view name in model")},setSubView:function(e){e&&(e=_.extend({subView:"library",publicView:!1},e),this.model.set(e)),this.updateSubView()},handleAdminEvents:function(e,t,n){var i=this;switch(e){case"update-public-status":var r={public:t},a=this.model.get("id");this.getBeeHive().getObject("LibraryController").updateLibraryMetadata(a,r).done(function(e,t){i.headerModel.set("public",e.public)}).fail(function(){})}},handleHeaderEvents:function(e,n,i){var r=this,a=this.model.get("id"),s=this.getBeeHive().getService("PubSub"),o=this.getBeeHive().getObject("LibraryController");switch(e){case"updateVal":o.updateLibraryMetadata(a,n).done(function(e){r.headerModel.set(e)});break;case"navigate":this.model.set("subView",n);var l={id:a,publicView:this.model.get("publicView"),subView:n};if(_.contains(["export","metrics","visualization","citation_helper"],l.subView)){switch(n){case"export":l.widgetName="ExportWidget",l.additional={format:i,libid:a};break;case"visualization":l.widgetName=i,l.additional={};break;case"metrics":l.widgetName="Metrics",l.additional={};break;case"citation_helper":l.widgetName="CitationHelper",l.additional={libid:a,permission:this.headerModel.get("permission"),libname:this.headerModel.get("name")}}s.publish(s.NAVIGATE,"library-"+n,l)}else"library"===l.subView?s.publish(s.NAVIGATE,"IndividualLibraryWidget",l):"admin"===l.subView&&s.publish(s.NAVIGATE,"LibraryAdminView",l);break;case"delete-library":o.deleteLibrary(a,this.headerModel.get("name"));break;case"start-search":o.getLibraryBibcodes(this.model.get("id")).done(function(e){var n=new t({__bigquery:e,__bigquerySource:"Library: "+r.headerModel.get("name"),sort:"date desc"});s.publish(s.START_SEARCH,n)})}}})}),define("hbs!js/widgets/libraries_all/templates/libraries-list-container",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return" s-sort-active "},3:function(e,t,n,i){var r;return"  "+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.order:e,"asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.program(6,i,0),data:i}))?r:"")},4:function(e,t,n,i){return" asc "},6:function(e,t,n,i){return" desc "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<h2>All ADS Libraries</h2>\n\n<table class="libraries-list-container table table-hover table-responsive">\n    <thead>\n    <tr>\n        <th>\n            \x3c!--page num --\x3e\n        </th>\n        <th>\n           \x3c!--public/private status--\x3e\n        </th>\n        <th> Library\n            <button title="sort by library name" class="btn btn-xs '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"name",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' btn-default" data-sort=\'{"sort":"name","type":"string"}\'><i class="fa fa-lg fa-sort"></i>'+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"name",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'</button>\n        </th>\n        <th> Papers\n            <button title="sort by number of papers"  class="btn btn-xs '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"num_documents",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' btn-default" data-sort=\'{"sort":"num_documents","type":"int"}\' ><i class="fa fa-lg fa-sort"></i> '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"num_documents",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'</button>\n        </th>\n        <th> Permission\n            <button title="sort by permission status (admin --\x3e read only)" class="btn btn-xs '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"permission",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' btn-default" data-sort=\'{"sort":"permission","type":"permission"}\'><i class="fa fa-lg fa-sort"></i> '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"permission",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'</button>\n        </th>\n        <th> Last Modified\n            <button title="sort by last modified" class="btn btn-xs '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date_last_modified",{name:"compare",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+' btn-default" data-sort=\'{"sort":"date_last_modified","type":"date"}\'><i class="fa fa-lg fa-sort"></i> '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date_last_modified",{name:"compare",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"</button>\n        </th>\n    </tr>\n    </thead>\n\n    <tbody></tbody>\n</table>\n"},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/libraries-list-container",n),n}),define("hbs!js/widgets/libraries_all/templates/library-item",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){return'    <i class="fa fa-lg fa-unlock" title="this library is public"></i>\n'},3:function(e,t,n,i){return'    <i class="fa fa-lg fa-lock text-light" title="this library is private"></i>\n'},5:function(e,t,n,i){var r;return'<p class="library-description">'+this.escapeExpression("function"==typeof(r=null!=(r=t.description||(null!=e?e.description:e))?r:t.helperMissing)?r.call(e,{name:"description",hash:{},data:i}):r)+"</p> "},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return"\n\n<td>\n    "+this.escapeExpression("function"==typeof(a=null!=(a=t.libNum||(null!=e?e.libNum:e))?a:t.helperMissing)?a.call(e,{name:"libNum",hash:{},data:i}):a)+"\n</td>\n<td>\n"+(null!=(r=t.if.call(e,null!=e?e.public:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.program(3,i,0),data:i}))?r:"")+'</td>\n\n<td>\n\n    <a href="#user/libraries/'+this.escapeExpression("function"==typeof(a=null!=(a=t.id||(null!=e?e.id:e))?a:t.helperMissing)?a.call(e,{name:"id",hash:{},data:i}):a)+'"><h3 class="s-library-title">'+this.escapeExpression("function"==typeof(a=null!=(a=t.name||(null!=e?e.name:e))?a:t.helperMissing)?a.call(e,{name:"name",hash:{},data:i}):a)+"</h3></a>\n    "+(null!=(r=t.if.call(e,null!=e?e.description:e,{name:"if",hash:{},fn:this.program(5,i,0),inverse:this.noop,data:i}))?r:"")+"\n\n</td>\n\n<td>"+this.escapeExpression("function"==typeof(a=null!=(a=t.num_documents||(null!=e?e.num_documents:e))?a:t.helperMissing)?a.call(e,{name:"num_documents",hash:{},data:i}):a)+"</td>\n\n<td>"+this.escapeExpression("function"==typeof(a=null!=(a=t.permission||(null!=e?e.permission:e))?a:t.helperMissing)?a.call(e,{name:"permission",hash:{},data:i}):a)+"</td>\n\n<td>"+this.escapeExpression("function"==typeof(a=null!=(a=t.date_last_modified||(null!=e?e.date_last_modified:e))?a:t.helperMissing)?a.call(e,{name:"date_last_modified",hash:{},data:i}):a)+"</td>\n"},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/library-item",n),n}),define("hbs!js/widgets/libraries_all/templates/no-libraries",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<br/>\n<br/>\n<p>\n    <b>You don\'t have any libraries yet!</b>\n</p>\n<p>\n    <a href="/#/">Search ADS</a> to find papers that you want to add.\n</p>\n\n<br/>\n<br/>'},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/no-libraries",n),n}),define("hbs!js/widgets/libraries_all/templates/loading-libraries",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'<h3> <i class="fa fa-spinner fa-pulse"></i> Loading Libraries...</h3>'},useData:!0});return t.registerPartial("js/widgets/libraries_all/templates/loading-libraries",n),n}),define("js/widgets/libraries_all/views/view_all_libraries",["marionette","hbs!js/widgets/libraries_all/templates/libraries-list-container","hbs!js/widgets/libraries_all/templates/library-item","hbs!js/widgets/libraries_all/templates/no-libraries","hbs!js/widgets/libraries_all/templates/loading-libraries","moment"],function(e,t,n,i,r,a){var s=e.ItemView.extend({formatDate:function(e){return a.utc(e).local().format("MMM D YYYY, h:mma")},serializeData:function(){var t=this.model.toJSON();return t.libNum=e.getOption(this,"libNum"),t.date_last_modified=this.formatDate(t.date_last_modified),t},template:n,tagName:"tr",triggers:{click:"navigateToLibrary"}});return e.CompositeView.extend({initialize:function(e){e=e||{}},template:t,childViewContainer:".libraries-list-container tbody",childView:s,childViewOptions:function(e,t){return{libNum:t+1}},childEvents:{navigateToLibrary:"triggerNavigate"},events:{"click thead button":"sortCollection"},modelEvents:{change:function(){this.collection.sort(),this.render()}},collectionEvents:{reset:function(){this.collection.sort(),this.render()}},triggerNavigate:function(e){this.trigger("navigate:library",e.model.get("id"))},sortCollection:function(e){var t=$(e.currentTarget).data("sort"),n=t.sort,i=n!==this.model.get("sort")?"asc":"asc"==this.model.get("order")?"desc":"asc";this.model.set({sort:n,type:t.type,order:i})},render:function(){return this.collection.length?e.CompositeView.prototype.render.apply(this,arguments):(this.$el.html(i()),this)}})}),define("js/widgets/libraries_all/widget",["marionette","js/widgets/base/base_widget","./views/view_all_libraries"],function(e,t,n){var i=Backbone.Model.extend({defaults:function(){return{name:void 0,description:void 0,id:void 0,permission:void 0,num_papers:0,date_created:void 0,date_last_modified:void 0}}}),r=Backbone.Model.extend({defaults:{sort:"name",order:"asc",type:"string"}}),a=Backbone.Collection.extend({initialize:function(e,t){this.containerModel=new r,this.options=t},model:i,comparator:function(e,t){var n=this.containerModel.get("sort"),i=this.containerModel.get("type"),r=this.containerModel.get("order");if("string"==i)return"asc"==r?e.get(n).localeCompare(t.get(n)):-e.get(n).localeCompare(t.get(n));if("date"==i)return"asc"==r?new Date(e.get(n))-new Date(t.get(n)):new Date(t.get(n))-new Date(e.get(n));if("permission"==i){var a=["read","write","admin","owner"];return"asc"==r?a.indexOf(e.get(n))-a.indexOf(t.get(n)):a.indexOf(t.get(n))-a.indexOf(e.get(n))}return"int"==i?"asc"==r?e.get(n)-t.get(n):t.get(n)-e.get(n):void 0}}),s=e.LayoutView.extend({className:"all-libraries-widget s-all-libraries-widget",template:function(){return'<div class="all-libraries-container"></div>'},regions:{container:".all-libraries-container"}});return t.extend({initialize:function(e){this.view=new s,this.libraryCollection=new a},activate:function(e){var t=this;this.setBeeHive(e),_.bindAll(this),this.getPubSub().subscribe(this.getPubSub().LIBRARY_CHANGE,this.updateCollection),this.getBeeHive().getObject("LibraryController").getLibraryMetadata().done(function(e){t.libraryCollection.reset(e)})},updateCollection:function(e){this.libraryCollection.reset(e)},setSubView:function(e){switch(e.view){case"libraries":var t=new n({collection:this.libraryCollection,model:this.libraryCollection.containerModel});t.on("all",this.handleSubViewEvents),this.view.container.show(t)}},handleSubViewEvents:function(e,t,n){switch(e){case"navigate:library":this.getPubSub().publish(this.getPubSub().NAVIGATE,"IndividualLibraryWidget",{subView:"library",id:t})}}})}),define("hbs!js/widgets/library_list/templates/library-container",["hbs","hbs/handlebars","hbs!js/widgets/list_of_things/templates/pagination-partial"],function(e,t){var n=t.template({1:function(e,t,n,i){return'        <h3 class="record-deleted"><i class="icon-success"/> Record successfully deleted</h3>\n'},3:function(e,t,n,i){var r;return'            <div class="btn-group sort-widget s-sort-widget">\n                \x3c!-- Single button --\x3e\n                <label for="sort-select" style="font-weight:bold;display:inline"> Sort:  </label>\n                <select class="form-control" id="sort-select" style="display:inline; width:180px">\n                    <optgroup label="descending">\n                        <option value="citation_count desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"citation_count desc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Citation Count desc</option>\n                        <option value="date desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date desc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Date desc</option>\n                        <option value="read_count desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"read_count desc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Read Count desc</option>\n                        <option value="first_author desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"first_author desc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>First Author desc</option>\n                        <option value="bibcode desc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"bibcode desc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Bibcode desc</option>\n                    </optgroup>\n                    <optgroup label="ascending">\n                        <option value="citation_count asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"citation_count asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Citation Count asc</option>\n                        <option value="date asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"date asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Date asc</option>\n                        <option value="read_count asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"read_count asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>Read Count asc</option>\n                        <option value="first_author asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"first_author asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'>First Author asc</option>\n                        <option value="bibcode asc" '+(null!=(r=(t.compare||e&&e.compare||t.helperMissing).call(e,null!=e?e.sort:e,"bibcode asc",{name:"compare",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+">Bibcode asc</option>\n                    </optgroup>\n                </select>\n\n"},4:function(e,t,n,i){return" selected "},6:function(e,t,n,i){var r;return null!=(r=this.invokePartial(n["js/widgets/list_of_things/templates/pagination-partial"],e,{name:"js/widgets/list_of_things/templates/pagination-partial",data:i,indent:"    ",helpers:t,partials:n}))?r:""},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r;return'<div class="s-library-actions">\n'+(null!=(r=t.if.call(e,null!=e?e.itemDeleted:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.hasRecords:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+'</div>\n<hr/>\n\n<ul class="library-list-container s-library-list-container">\n</ul>\n\n'+(null!=(r=t.if.call(e,null!=e?e.pagination:e,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.noop,data:i}))?r:"")+"\n</div>\n"},usePartial:!0,useData:!0});return t.registerPartial("js/widgets/library_list/templates/library-container",n),n}),define("hbs!js/widgets/library_list/templates/library-item-edit",["hbs","hbs/handlebars"],function(e,t){var n=t.template({1:function(e,t,n,i){var r;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(r=null!=(r=t.bibcode||(null!=e?e.bibcode:e))?r:t.helperMissing)?r.call(e,{name:"bibcode",hash:{},data:i}):r)+'/citations">cited: '+this.escapeExpression("function"==typeof(r=null!=(r=t.num_citations||(null!=e?e.num_citations:e))?r:t.helperMissing)?r.call(e,{name:"num_citations",hash:{},data:i}):r)+"</a>\n"},3:function(e,t,n,i){var r;return'                <div class="letter-icon s-letter-icon">\n\n                    <button class="btn-link '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'"\n                            aria-disabled="'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(8,i,0),data:i}))?r:"")+'">\n                        <i class="s-text-icon" aria-label="quick access to full text links"></i>\n                    </button>\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"if",hash:{},fn:this.program(10,i,0),inverse:this.noop,data:i}))?r:"")+'                </div>\n                <div class="letter-icon s-letter-icon">\n\n                    <button class="btn-link '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'"\n                            aria-disabled="'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(14,i,0),data:i}))?r:"")+'">\n                        <i class="s-list-icon" aria-label="quick links to lists of references, citations and more"></i>\n                    </button>\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"if",hash:{},fn:this.program(16,i,0),inverse:this.noop,data:i}))?r:"")+'                </div>\n                <div class="letter-icon s-letter-icon">\n\n                    <button class="btn-link  '+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"if",hash:{},fn:this.program(4,i,0),inverse:this.noop,data:i}))?r:"")+'"\n                            aria-disabled="'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"if",hash:{},fn:this.program(6,i,0),inverse:this.program(19,i,0),data:i}))?r:"")+'">\n                        <i class="s-data-icon" aria-label="quick links to data associated with this article"></i>\n                    </button>\n\n'+(null!=(r=t.if.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"if",hash:{},fn:this.program(21,i,0),inverse:this.noop,data:i}))?r:"")+"                </div>\n"},4:function(e,t,n,i){return" active-link s-active-link "},6:function(e,t,n,i){return" false "},8:function(e,t,n,i){return" true "},10:function(e,t,n,i){var r;return'                    <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.text:r,{name:"each",hash:{},fn:this.program(11,i,0),inverse:this.noop,data:i}))?r:"")+"                    </ul>\n"},11:function(e,t,n,i){var r;return"                        <li><a "+(null!=(r=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?r:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'"\n                            target="_blank">'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a></li>\n"},12:function(e,t,n,i){return'class="s-open-access"'},14:function(e,t,n,i){return" true"},16:function(e,t,n,i){var r;return'                    <ul class="hidden list-unstyled list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.list:r,{name:"each",hash:{},fn:this.program(17,i,0),inverse:this.noop,data:i}))?r:"")+"                    </ul>\n"},17:function(e,t,n,i){return'                        <li><a href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'">'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a></li>\n"},19:function(e,t,n,i){return" true  "},21:function(e,t,n,i){var r;return'                    <ul class="hidden list-unstyled link-details s-link-details" role="menu">\n\n'+(null!=(r=t.each.call(e,null!=(r=null!=e?e.links:e)?r.data:r,{name:"each",hash:{},fn:this.program(22,i,0),inverse:this.noop,data:i}))?r:"")+"                    </ul>\n"},22:function(e,t,n,i){var r;return"                        <li><a "+(null!=(r=t.if.call(e,null!=e?e.openAccess:e,{name:"if",hash:{},fn:this.program(12,i,0),inverse:this.noop,data:i}))?r:"")+' href="'+this.escapeExpression(this.lambda(null!=e?e.link:e,e))+'" target="_blank"\n                            >'+this.escapeExpression(this.lambda(null!=e?e.title:e,e))+"</a></li>\n"},24:function(e,t,n,i){return'            <button class="btn btn-sm btn-danger btn-inverse remove-record pull-right" title="delete record permanently from this library"><i class="fa fa-times"></i></button>\n'},26:function(e,t,n,i){var r,a;return'            <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.identifier||(null!=e?e.identifier:e))?a:t.helperMissing)?a.call(e,{name:"identifier",hash:{},data:i}):a)+'/abstract">\n                <h3 class="s-results-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+"</h3>\n            </a>\n"},28:function(e,t,n,i){var r,a;return'            <h3 class="s-results-title">'+(null!=(r="function"==typeof(a=null!=(a=t.title||(null!=e?e.title:e))?a:t.helperMissing)?a.call(e,{name:"title",hash:{},data:i}):a)?r:"")+"</h3>\n"},30:function(e,t,n,i){return'                <li class="article-author">'+this.escapeExpression(this.lambda(e,e))+"</li>\n"},32:function(e,t,n,i){var r;return"                <li><em>and "+this.escapeExpression("function"==typeof(r=null!=(r=t.extraAuthors||(null!=e?e.extraAuthors:e))?r:t.helperMissing)?r.call(e,{name:"extraAuthors",hash:{},data:i}):r)+" more</em></li>\n"},compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){var r,a;return'\n<div class="col-sm-12">\n\n    <div class="row s-top-row">\n        <div class="col-sm-1 col-xs-2 s-checkbox-col s-top-row-col">\n            '+this.escapeExpression("function"==typeof(a=null!=(a=t.indexToShow||(null!=e?e.indexToShow:e))?a:t.helperMissing)?a.call(e,{name:"indexToShow",hash:{},data:i}):a)+'.\n        </div>\n        <div class="col-sm-3 col-xs-4 s-top-row-col identifier s-identifier">\n            <a href="#abs/'+this.escapeExpression("function"==typeof(a=null!=(a=t.identifier||(null!=e?e.identifier:e))?a:t.helperMissing)?a.call(e,{name:"identifier",hash:{},data:i}):a)+'/abstract" aria-label="bibcode">\n                '+this.escapeExpression("function"==typeof(a=null!=(a=t.identifier||(null!=e?e.identifier:e))?a:t.helperMissing)?a.call(e,{name:"identifier",hash:{},data:i}):a)+'\n            </a>\n        </div>\n        <div class="col-sm-2 s-top-row-col" aria-label="date published">\n            '+this.escapeExpression("function"==typeof(a=null!=(a=t.formattedDate||(null!=e?e.formattedDate:e))?a:t.helperMissing)?a.call(e,{name:"formattedDate",hash:{},data:i}):a)+'\n        </div>\n        <div class="col-sm-2 col-xs-6 s-top-row-col" title="citation count">\n'+(null!=(r=t.if.call(e,null!=e?e.num_citations:e,{name:"if",hash:{},fn:this.program(1,i,0),inverse:this.noop,data:i}))?r:"")+'        </div>\n        <div class="col-sm-4">\n            <span class="s-results-links">\n'+(null!=(r=t.if.call(e,null!=e?e.links:e,{name:"if",hash:{},fn:this.program(3,i,0),inverse:this.noop,data:i}))?r:"")+"            </span>\n\n"+(null!=(r=t.if.call(e,null!=e?e.permission:e,{name:"if",hash:{},fn:this.program(24,i,0),inverse:this.noop,data:i}))?r:"")+'        </div>\n\n    </div>\n    <div class="row">\n\n        <div class="col-xs-10 col-xs-offset-1">\n'+(null!=(r=t.if.call(e,null!=e?e.identifier:e,{name:"if",hash:{},fn:this.program(26,i,0),inverse:this.program(28,i,0),data:i}))?r:"")+'        </div>\n    </div>\n\n    <div class="row">\n        <div class="col-xs-10 col-xs-offset-1">\n            <ul class="list-inline just-authors s-results-authors" aria-label="authors">\n'+(null!=(r=t.each.call(e,null!=e?e.authorFormatted:e,{name:"each",hash:{},fn:this.program(30,i,0),inverse:this.noop,data:i}))?r:"")+(null!=(r=t.if.call(e,null!=e?e.extraAuthors:e,{name:"if",hash:{},fn:this.program(32,i,0),inverse:this.noop,data:i}))?r:"")+"            </ul>\n\n        </div>\n\n    </div>\n\n</div>"},useData:!0});return t.registerPartial("js/widgets/library_list/templates/library-item-edit",n),n}),define("hbs!js/widgets/library_list/templates/empty-collection",["hbs","hbs/handlebars"],function(e,t){var n=t.template({compiler:[6,">= 2.0.0-beta.1"],main:function(e,t,n,i){return'\n<div style="padding: 40px 5%">\n    <p>You haven\'t added any bibcodes yet!</p>\n    <p>\n        If you have edit privileges for this library, you can  <a href="#">make a search in ADS </a>\n        and add papers using the blue "libraries" widget on the right.\n    </p>\n\n</div>'},useData:!0});return t.registerPartial("js/widgets/library_list/templates/empty-collection",n),n}),define("js/widgets/library_list/widget",["marionette","js/widgets/list_of_things/item_view","js/widgets/list_of_things/widget","js/widgets/list_of_things/paginated_view","js/widgets/list_of_things/model","hbs!js/widgets/library_list/templates/library-container","hbs!js/widgets/library_list/templates/library-item-edit","hbs!js/widgets/library_list/templates/empty-collection","js/mixins/link_generator_mixin","js/mixins/papers_utils","js/mixins/formatter","js/components/api_query","js/components/api_request","js/components/api_response","js/components/api_targets","js/mixins/add_stable_index_to_collection","js/mixins/add_secondary_sort","bootstrap"],function(e,t,n,i,r,a,s,o,l,c,u,d,h,p,f,g,m,b){var v=t.extend({template:s,triggers:{"click .remove-record":"removeRecord"},className:"library-item s-library-item write-permission",render:e.ItemView.prototype.render,serializeData:function(){var t=this.model.toJSON();return _.extend(t,{permission:e.getOption(this,"permission")})}}),y=i.extend({childView:v,template:a,className:"library-detail-view",childViewContainer:".library-list-container",events:{"change #sort-select":"changeSort","click a.page-control":"changePageWithButton","keyup input.page-control":"tabOrEnterChangePageWithInput","click .per-page":"changePerPage"},modelEvents:{change:"render"},changeSort:function(e){e.stopPropagation(),this.model.set("sort",e.target.value),this.trigger("changeSort")},childViewOptions:function(){if(this.model.get("editRecords"))return{permission:!0}},childEvents:{removeRecord:"removeRecord"},removeRecord:function(e){e.$(".remove-record").html('<i class="fa fa-spinner fa-pulse"></i>');var t=e.model.get("bibcode");this.trigger("removeRecord",t)}}),w=n.extend({setData:function(e){this.model.set({public:e.publicView,libraryID:e.id,editRecords:e.editRecords})},initialize:function(e){(e=e||{}).collection=new r,e.view=new y({collection:e.collection,model:this.model}),n.prototype.initialize.apply(this,[e]),this.view.model=this.model,this.listenTo(this.model,"change:libraryID",function(){this.reset()}),this.listenTo(this.view,"all",this.handleViewEvents)},changeSort:function(){var e=this.model.get("sort");this.reset(),this.dispatchRequest({sort:e})},defaultQueryArguments:{fl:"title,bibcode,author,keyword,pub,aff,volume,year,links_data,[citations],property,pubdate,abstract",rows:25,start:0,sort:"date desc"},activate:function(e){n.prototype.activate.apply(this,[].slice.apply(arguments))},onShow:function(){this.dispatchRequest()},composeRequest:function(e){var t=f.LIBRARIES+"/"+this.model.get("libraryID");return new h({target:t,query:e,options:{context:this,contentType:"application/x-www-form-urlencoded",done:this.createApiResponse.bind(this,e),fail:this.handleError}})},handleError:function(e){console.error("data for library list view not received",e)},createApiResponse:function(e,t){if(this.model.set("itemDeleted",!1),_.isString(t.solr))throw new Error(t.solr+": list of things widget can't render");t.solr.response.docs.length>1&&this.model.set("hasRecords",!0);var n=t.solr.responseHeader.params.sort;this.model.set({sort:n.split(",")[0]}),(t=new p(t.solr)).setApiQuery(e),this.processResponse(t)},executeRequest:function(e){this.getBeeHive().getService("Api").request(e)},dispatchRequest:function(e){var t=this.customizeQuery(new d);e&&t.set(e),m.addSecondarySort(t);var n=this.composeRequest(t);this.getBeeHive().getService("Api").request(n)},processDocs:function(e,t,n){if(!e.has("response"))return[];var i=e.get("response").start||n.start||0;return t=g.addPaginationToDocs(t,i),_.each(t,function(e,t){e.identifier=e.bibcode,e.noCheckbox=!0;if(e.author&&e.author.length>3){e.extraAuthors=e.author.length-3;var n=e.author.slice(0,3)}else e.author&&(n=e.author);if(e.author){var i=n.length-1;e.authorFormatted=_.map(n,function(e,t){return t==i||0==i?e:e+";"})}return e["[citations]"]&&e["[citations]"].num_citations>0?e.num_citations=this.formatNum(e["[citations]"].num_citations):e.num_citations=0,e.formattedDate=e.pubdate?this.formatDate(e.pubdate,{format:"yy/mm",missing:{day:"yy/mm",month:"yy"}}):void 0,e.shortAbstract=e.abstract?this.shortenAbstract(e.abstract):void 0,e},this),this.parseLinksData(t)},reset:function(){this.model.set({hasRecords:!1}),n.prototype.reset.apply(this,arguments)},handleViewEvents:function(e,t,n){var i=this;switch(e){case"changeSort":this.changeSort(t);break;case"removeRecord":var r={bibcode:[t],action:"remove"},a=this.model.get("libraryID");this.getBeeHive().getObject("LibraryController").updateLibraryContents(a,r).done(function(){i.reset(),i.model.set("itemDeleted",!0);var e=i.model.get("sort")?{sort:i.model.get("sort")}:{};i.dispatchRequest(e)})}}});return _.extend(w.prototype,l),_.extend(w.prototype,c),_.extend(w.prototype,u),w})}();